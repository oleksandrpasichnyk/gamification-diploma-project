!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e,n){"use strict";(function(t){var n=n||{};n.scope={},n.createTemplateTagFirstArg=function(t){return t.raw=t},n.createTemplateTagFirstArgWithRaw=function(t,e){return t.raw=e,t},n.arrayIteratorImpl=function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}},n.arrayIterator=function(t){return{next:n.arrayIteratorImpl(t)}},n.makeIterator=function(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):n.arrayIterator(t)},n.arrayFromIterator=function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n},n.arrayFromIterable=function(t){return t instanceof Array?t:n.arrayFromIterator(n.makeIterator(t))},n.ASSUME_ES5=!1,n.ASSUME_NO_NATIVE_MAP=!1,n.ASSUME_NO_NATIVE_SET=!1,n.SIMPLE_FROUND_POLYFILL=!1,n.ISOLATE_POLYFILLS=!1,n.objectCreate=n.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(t){var e=function(){};return e.prototype=t,new e},n.defineProperty=n.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var i=e[n];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")},n.global=n.getGlobal(this),n.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),n.TRUST_ES6_POLYFILLS=!n.ISOLATE_POLYFILLS||n.IS_SYMBOL_NATIVE,n.polyfills={},n.propertyToPolyfillSymbol={},n.POLYFILL_PREFIX="$jscp$";n.polyfill=function(t,e,i,r){e&&(n.ISOLATE_POLYFILLS?n.polyfillIsolated(t,e,i,r):n.polyfillUnisolated(t,e,i,r))},n.polyfillUnisolated=function(t,e,i,r){for(i=n.global,t=t.split("."),r=0;r<t.length-1;r++){var o=t[r];if(!(o in i))return;i=i[o]}(e=e(r=i[t=t[t.length-1]]))!=r&&null!=e&&n.defineProperty(i,t,{configurable:!0,writable:!0,value:e})},n.polyfillIsolated=function(t,e,i,r){var o=t.split(".");t=1===o.length,r=o[0],r=!t&&r in n.polyfills?n.polyfills:n.global;for(var a=0;a<o.length-1;a++){var s=o[a];if(!(s in r))return;r=r[s]}o=o[o.length-1],null!=(e=e(i=n.IS_SYMBOL_NATIVE&&"es6"===i?r[o]:null))&&(t?n.defineProperty(n.polyfills,o,{configurable:!0,writable:!0,value:e}):e!==i&&(n.propertyToPolyfillSymbol[o]=n.IS_SYMBOL_NATIVE?n.global.Symbol(o):n.POLYFILL_PREFIX+o,o=n.propertyToPolyfillSymbol[o],n.defineProperty(r,o,{configurable:!0,writable:!0,value:e})))},n.getConstructImplementation=function(){if(n.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(function(){function t(){}return new t,Reflect.construct(t,[],(function(){})),new t instanceof t}())return Reflect.construct;var t=Reflect.construct;return function(e,n,i){return e=t(e,n),i&&Reflect.setPrototypeOf(e,i.prototype),e}}return function(t,e,i){return void 0===i&&(i=t),i=n.objectCreate(i.prototype||Object.prototype),Function.prototype.apply.call(t,i,e)||i}},n.construct=n.getConstructImplementation(),n.underscoreProtoCanBeSet=function(){var t={};try{return t.__proto__={a:!0},t.a}catch(t){}return!1},n.setPrototypeOf=n.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:n.underscoreProtoCanBeSet()?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null,n.inherits=function(t,e){if(t.prototype=n.objectCreate(e.prototype),t.prototype.constructor=t,n.setPrototypeOf){var i=n.setPrototypeOf;i(t,e)}else for(i in e)if("prototype"!=i)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,i);r&&Object.defineProperty(t,i,r)}else t[i]=e[i];t.superClass_=e.prototype},n.polyfill("Reflect",(function(t){return t||{}}),"es6","es3"),n.polyfill("Reflect.construct",(function(t){return n.construct}),"es6","es3"),n.polyfill("Reflect.setPrototypeOf",(function(t){if(t)return t;if(n.setPrototypeOf){var e=n.setPrototypeOf;return function(t,n){try{return e(t,n),!0}catch(t){return!1}}}return null}),"es6","es5"),n.polyfill("Number.EPSILON",(function(t){return Math.pow(2,-52)}),"es6","es3"),n.polyfill("Number.MAX_SAFE_INTEGER",(function(){return 9007199254740991}),"es6","es3"),n.checkEs6ConformanceViaProxy=function(){try{var t={},e=Object.create(new n.global.Proxy(t,{get:function(n,i,r){return n==t&&"q"==i&&r==e}}));return!0===e.q}catch(t){return!1}},n.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,n.ES6_CONFORMANCE=n.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&n.checkEs6ConformanceViaProxy(),n.initSymbol=function(){},n.polyfill("Symbol",(function(t){if(t)return t;var e=function(t,e){this.$jscomp$symbol$id_=t,n.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})};e.prototype.toString=function(){return this.$jscomp$symbol$id_};var i=0,r=function(t){if(this instanceof r)throw new TypeError("Symbol is not a constructor");return new e("jscomp_symbol_"+(t||"")+"_"+i++,t)};return r}),"es6","es3"),n.initSymbolIterator=function(){},n.polyfill("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<e.length;i++){var r=n.global[e[i]];"function"==typeof r&&"function"!=typeof r.prototype[t]&&n.defineProperty(r.prototype,t,{configurable:!0,writable:!0,value:function(){return n.iteratorPrototype(n.arrayIteratorImpl(this))}})}return t}),"es6","es3"),n.initSymbolAsyncIterator=function(){},n.iteratorPrototype=function(t){return(t={next:t})[Symbol.iterator]=function(){return this},t},n.owns=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.polyfill("WeakMap",(function(t){function e(){}function i(t){var e=typeof t;return"object"===e&&null!==t||"function"===e}function r(t){if(!n.owns(t,a)){var i=new e;n.defineProperty(t,a,{value:i})}}function o(t){if(!n.ISOLATE_POLYFILLS){var i=Object[t];i&&(Object[t]=function(t){return t instanceof e?t:(Object.isExtensible(t)&&r(t),i(t))})}}if(n.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&n.ES6_CONFORMANCE)return t}else if(function(){if(!t||!Object.seal)return!1;try{var e=Object.seal({}),n=Object.seal({}),i=new t([[e,2],[n,3]]);return 2==i.get(e)&&3==i.get(n)&&(i.delete(e),i.set(n,4),!i.has(e)&&4==i.get(n))}catch(t){return!1}}())return t;var a="$jscomp_hidden_"+Math.random();o("freeze"),o("preventExtensions"),o("seal");var s=0,l=function(t){if(this.id_=(s+=Math.random()+1).toString(),t){t=n.makeIterator(t);for(var e;!(e=t.next()).done;)e=e.value,this.set(e[0],e[1])}};return l.prototype.set=function(t,e){if(!i(t))throw Error("Invalid WeakMap key");if(r(t),!n.owns(t,a))throw Error("WeakMap key fail: "+t);return t[a][this.id_]=e,this},l.prototype.get=function(t){return i(t)&&n.owns(t,a)?t[a][this.id_]:void 0},l.prototype.has=function(t){return i(t)&&n.owns(t,a)&&n.owns(t[a],this.id_)},l.prototype.delete=function(t){return!!(i(t)&&n.owns(t,a)&&n.owns(t[a],this.id_))&&delete t[a][this.id_]},l}),"es6","es3"),n.MapEntry=function(){},n.polyfill("Map",(function(t){if(n.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&n.ES6_CONFORMANCE)return t}else if(function(){if(n.ASSUME_NO_NATIVE_MAP||!t||"function"!=typeof t||!t.prototype.entries||"function"!=typeof Object.seal)return!1;try{var e=Object.seal({x:4}),i=new t(n.makeIterator([[e,"s"]]));if("s"!=i.get(e)||1!=i.size||i.get({x:4})||i.set({x:4},"t")!=i||2!=i.size)return!1;var r=i.entries(),o=r.next();return!o.done&&o.value[0]==e&&"s"==o.value[1]&&!((o=r.next()).done||4!=o.value[0].x||"t"!=o.value[1]||!r.next().done)}catch(t){return!1}}())return t;var e=new WeakMap,i=function(t){if(this.data_={},this.head_=a(),this.size=0,t){t=n.makeIterator(t);for(var e;!(e=t.next()).done;)e=e.value,this.set(e[0],e[1])}};i.prototype.set=function(t,e){var n=r(this,t=0===t?0:t);return n.list||(n.list=this.data_[n.id]=[]),n.entry?n.entry.value=e:(n.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:t,value:e},n.list.push(n.entry),this.head_.previous.next=n.entry,this.head_.previous=n.entry,this.size++),this},i.prototype.delete=function(t){return!(!(t=r(this,t)).entry||!t.list)&&(t.list.splice(t.index,1),t.list.length||delete this.data_[t.id],t.entry.previous.next=t.entry.next,t.entry.next.previous=t.entry.previous,t.entry.head=null,this.size--,!0)},i.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=a(),this.size=0},i.prototype.has=function(t){return!!r(this,t).entry},i.prototype.get=function(t){return(t=r(this,t).entry)&&t.value},i.prototype.entries=function(){return o(this,(function(t){return[t.key,t.value]}))},i.prototype.keys=function(){return o(this,(function(t){return t.key}))},i.prototype.values=function(){return o(this,(function(t){return t.value}))},i.prototype.forEach=function(t,e){for(var n,i=this.entries();!(n=i.next()).done;)n=n.value,t.call(e,n[1],n[0],this)},i.prototype[Symbol.iterator]=i.prototype.entries;var r=function(t,i){var r=i&&typeof i;"object"==r||"function"==r?e.has(i)?r=e.get(i):(r=""+ ++s,e.set(i,r)):r="p_"+i;var o=t.data_[r];if(o&&n.owns(t.data_,r))for(t=0;t<o.length;t++){var a=o[t];if(i!=i&&a.key!=a.key||i===a.key)return{id:r,list:o,index:t,entry:a}}return{id:r,list:o,index:-1,entry:void 0}},o=function(t,e){var i=t.head_;return n.iteratorPrototype((function(){if(i){for(;i.head!=t.head_;)i=i.previous;for(;i.next!=i.head;)return i=i.next,{done:!1,value:e(i)};i=null}return{done:!0,value:void 0}}))},a=function(){var t={};return t.previous=t.next=t.head=t},s=0;return i}),"es6","es3"),n.findInternal=function(t,e,n){t instanceof String&&(t=String(t));for(var i=t.length,r=0;r<i;r++){var o=t[r];if(e.call(n,o,r,t))return{i:r,v:o}}return{i:-1,v:void 0}},n.polyfill("Array.prototype.find",(function(t){return t||function(t,e){return n.findInternal(this,t,e).v}}),"es6","es3"),n.polyfill("Array.prototype.fill",(function(t){return t||function(t,e,n){var i=this.length||0;for(0>e&&(e=Math.max(0,i+e)),(null==n||n>i)&&(n=i),0>(n=Number(n))&&(n=Math.max(0,i+n)),e=Number(e||0);e<n;e++)this[e]=t;return this}}),"es6","es3"),n.typedArrayFill=function(t){return t||Array.prototype.fill},n.polyfill("Int8Array.prototype.fill",n.typedArrayFill,"es6","es5"),n.polyfill("Uint8Array.prototype.fill",n.typedArrayFill,"es6","es5"),n.polyfill("Uint8ClampedArray.prototype.fill",n.typedArrayFill,"es6","es5"),n.polyfill("Int16Array.prototype.fill",n.typedArrayFill,"es6","es5"),n.polyfill("Uint16Array.prototype.fill",n.typedArrayFill,"es6","es5"),n.polyfill("Int32Array.prototype.fill",n.typedArrayFill,"es6","es5"),n.polyfill("Uint32Array.prototype.fill",n.typedArrayFill,"es6","es5"),n.polyfill("Float32Array.prototype.fill",n.typedArrayFill,"es6","es5"),n.polyfill("Float64Array.prototype.fill",n.typedArrayFill,"es6","es5"),function(t){var e=function(){e.assert(!1,"Static class.")};e.isNumber=function(t){for(var n=[],i=0;i<arguments.length;++i)n[i-0]=arguments[i];n.forEach((function(t){if(("number"!=typeof t||!1!==isNaN(parseFloat(t))||!0!==isFinite(t))&&(e.logOnFail&&console.error("[ASSERT]","Not a number."),e.throwOnFail))throw Error("Not a number.")}))},e.assert=function(t,n){if(!0!==t&&(n=null==n?"Assertion failed.":n,e.logOnFail&&console.error("[ASSERT]",n),e.throwOnFail))throw Error(n)},e.assertWarn=function(t,n){!0!==t&&e.warn(null==n?"Assertion warning.":n)},e.assertInfo=function(t,n){!0!==t&&e.info(null==n?"Assertion info.":n)},e.log=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];console.info.apply(console,["%c%s","color: #000000","LOG:"].concat(n.arrayFromIterable(e)))},e.info=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];console.info.apply(console,["%c%s","color: #003bd2","INFO:"].concat(n.arrayFromIterable(e)))},e.warn=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];console.info.apply(console,["%c%s","color: #f67400","WARN:"].concat(n.arrayFromIterable(e)))},e.error=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];console.info.apply(console,["%c%s","color: #d50000","ERROR:"].concat(n.arrayFromIterable(e)))},e.time=function(t){e.timeProfiles[t]=performance.now()},e.timeEnd=function(t){e.timeProfiles[t]=performance.now()-e.timeProfiles[t]},e.throwOnFail=!0,e.logOnFail=!1,e.timeProfiles={};var i=function(){};i.randomBetween=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},i.clamp=function(t,e,n){return t<e?e:t>n?n:t},i.distance=function(t,e,n,i){return t-=n,e-=i,Math.sqrt(t*t+e*e)},i.distanceSqr=function(t,e,n,i){return(t-=n)*t+(e-=i)*e},i.angleBetween=function(t,e,n,i){return Math.atan2(i-e,n-t)},i.mapRange=function(t,e,n,i,r){return i+(r-i)*(t-e)/(n-e)},i.lerp=function(t,e,n){return t+n*(e-t)},i.equals=function(t,e,n){return t-(n=void 0===n?Number.EPSILON:n)<e&&t+n>e},i.PI_Q=Math.PI/4,i.PI2=2*Math.PI,i.DEG2RAD=.017453292519943295,i.RAD2DEG=57.29577951308232;var r=function(t){for(this.mRepeat=0,this.mPerm=[],t=0;512>t;t++)this.mPerm.push(r.__permutation[t%256])};r.prototype.__perlin=function(t,e,n){0<this.mRepeat&&(t%=this.mRepeat,e%=this.mRepeat,n%=this.mRepeat);var i=this.mPerm,r=255&~~t,o=255&~~e,a=255&~~n,s=n-~~n,l=(t-=~~t)*t*t*(t*(6*t-15)+10),h=(e-=~~e)*e*e*(e*(6*e-15)+10);n=s*s*s*(s*(6*s-15)+10);var c=i[i[i[r]+o]+a],u=i[i[i[r]+this.inc(o)]+a],d=i[i[i[r]+o]+this.inc(a)],p=i[i[i[r]+this.inc(o)]+this.inc(a)],m=i[i[i[this.inc(r)]+o]+a],f=i[i[i[this.inc(r)]+this.inc(o)]+a],g=i[i[i[this.inc(r)]+o]+this.inc(a)];return i=i[i[i[this.inc(r)]+this.inc(o)]+this.inc(a)],r=this.lerp(this.grad(c,t,e,s),this.grad(m,t-1,e,s),l),a=this.lerp(this.grad(u,t,e-1,s),this.grad(f,t-1,e-1,s),l),o=this.lerp(r,a,h),r=this.lerp(this.grad(d,t,e,s-1),this.grad(g,t-1,e,s-1),l),a=this.lerp(this.grad(p,t,e-1,s-1),this.grad(i,t-1,e-1,s-1),l),t=this.lerp(r,a,h),.5*(this.lerp(o,t,n)+1)},r.prototype.perlin=function(t,e,n,i,r){if(r=void 0===r?1:r,1===(i=void 0===i?1:i)&&1===r)return this.__perlin(t,e,n);for(var o=0,a=1,s=1,l=0,h=0;h<i;h++)o+=this.__perlin(t*a,e*a,n*a)*s,l+=s,s*=r,a*=2;return o/l},r.prototype.inc=function(t){return t++,0<this.mRepeat&&(t%=this.mRepeat),t},r.prototype.grad=function(t,e,n,i){switch(15&t){case 0:return e+n;case 1:return-e+n;case 2:return e-n;case 3:return-e-n;case 4:return e+i;case 5:return-e+i;case 6:return e-i;case 7:return-e-i;case 8:return n+i;case 9:return-n+i;case 10:return n-i;case 11:return-n-i;case 12:return n+e;case 13:return-n+i;case 14:return n-e;case 15:return-n-i}},r.prototype.lerp=function(t,e,n){return t+n*(e-t)},r.__permutation=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];var o=function(){this.mMap=new Map};o.prototype.has=function(t,e){return this.mMap.has(t)&&this.mMap.get(t).has(e)},o.prototype.set=function(t,e,n){var i=this.mMap.get(t);null==i&&(i=new Map,this.mMap.set(t,i)),i.set(e,n)},o.prototype.get=function(t,e){return null!=this.mMap.get(t)?this.mMap.get(t)&&this.mMap.get(t).get(e):null};var a=function(t,e){this.mReleased=[],this.mCapacity=void 0===e?100:e,this.mType=t};a.prototype.releaseAll=function(){this.mReleased.splice(0,this.mReleased.length)},a.prototype.get=function(){return 0<this.mReleased.length?this.mReleased.pop():new this.mType},a.prototype.release=function(t){(-1===this.mCapacity||this.mReleased.length<this.mCapacity)&&this.mReleased.push(t)},n.global.Object.defineProperties(a.prototype,{capacity:{configurable:!0,enumerable:!0,get:function(){return this.mCapacity},set:function(t){e.assert(0!==t,"Capacity cannot be equal to zero."),e.assert(-1<t,"Capacity cannot be smaller then -1."),this.mCapacity=t,this.mCapacity>this.mReleased.length&&this.mReleased.splice(0,this.mReleased.length-this.mCapacity)}}});var s=function(t,e,n){this.r=void 0===t?0:t,this.g=void 0===e?0:e,this.b=void 0===n?0:n},l=function(t,e,n){this.h=void 0===t?0:t,this.s=void 0===e?0:e,this.v=void 0===n?0:n},h=function(){};h.hex2rgb=function(t){return new s(t>>16&255,t>>8&255,255&t)},h.rgb2hex=function(t){return t.r<<16|t.g<<8|t.b},h.hsv2rgb=function(t){var e=t.h,n=t.s;t=t.v;var i=0,r=0,o=0,a=Math.floor(6*e),l=6*e-a;e=t*(1-n);var h=t*(1-l*n);switch(n=t*(1-(1-l)*n),a%6){case 0:i=t,r=n,o=e;break;case 1:i=h,r=t,o=e;break;case 2:i=e,r=t,o=n;break;case 3:i=e,r=h,o=t;break;case 4:i=n,r=e,o=t;break;case 5:i=t,r=e,o=h}return new s(255*i,255*r,255*o)},h.rgb2hsv=function(t){var e=t.r,n=t.g;t=t.b,e/=255,n/=255,t/=255;var i=Math.max(e,n,t),r=Math.min(e,n,t),o=0,a=i-r;if(i===r)o=0;else{switch(i){case e:o=(n-t)/a+(n<t?6:0);break;case n:o=(t-e)/a+2;break;case t:o=(e-n)/a+4}o/=6}return new l(o,0===i?0:a/i,i)},h.lerpHSV=function(t,e,n){n=void 0===n?.5:n,t=h.rgb2hsv(h.hex2rgb(t));var i=0,r=(e=h.rgb2hsv(h.hex2rgb(e))).h-t.h;if(t.h>e.h){var o=e.h;e.h=t.h,t.h=o,r=-r,n=1-n}return.5<r&&(t.h+=1,i=(t.h+n*(e.h-t.h))%1),.5>=r&&(i=t.h+n*r),h.rgb2hex(h.hsv2rgb(new l(i,t.s+n*(e.s-t.s),t.v+n*(e.v-t.v))))},h.hexColorToString=function(t){return t=t.toString(16),"#000000".substring(0,7-t.length)+t},h.intToRGBA=function(t,e){return"rgba("+(t>>16&255)+", "+(t>>8&255)+", "+(255&t)+", "+(void 0===e?1:e)+")"};var c={"*":"[^/]+","**":".+/?[^/]+","**/":".+/?"},u=function(t){this.mRegExp=new RegExp("^"+t.replace(/\./g,"\\.").replace(/\*\*$/g,".+").replace(/(?:\*\*\/|\*\*|\*)/g,(function(t){return c[t]}))+"$")};u.prototype.test=function(t){return this.mRegExp.test(t)};var d=function(t,n){t=void 0===t?0:t,n=void 0===n?0:n,e.isNumber(t,n),this.x=t,this.y=n};d.prototype.set=function(t,n){return t=void 0===t?0:t,n=void 0===n?0:n,e.isNumber(t,n),this.x=t,this.y=n,this},d.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},d.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},d.prototype.distance=function(t){var e=this.x-t.x;return t=this.y-t.y,Math.sqrt(e*e+t*t)},d.prototype.distanceSqr=function(t){var e=this.x-t.x;return e*e+(t=this.y-t.y)*t},d.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},d.prototype.multiplyScalar=function(t){return e.isNumber(t),this.x*=t,this.y*=t,this},d.prototype.dot=function(t){return this.x*t.x+this.y*t.y},d.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},d.prototype.lengthSqr=function(){return this.x*this.x+this.y*this.y},d.prototype.normalize=function(){var t=this.lengthSqr();return 0<t?(t=Math.sqrt(t),this.x/=t,this.y/=t):this.y=this.x=0,this},d.prototype.clamp=function(t,n){return e.isNumber(t,n),this.x=i.clamp(this.x,t,n),this.y=i.clamp(this.y,t,n),this},d.prototype.clampLength=function(t,n){return e.isNumber(t,n),t=i.clamp(this.length(),t,n),this.normalize(),this.multiplyScalar(t),this},d.prototype.lerp=function(t,n){return e.isNumber(n),this.x=i.lerp(this.x,t.x,n),this.y=i.lerp(this.y,t.y,n),this},d.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t},d.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},d.prototype.clone=function(){return new d(this.x,this.y)},d.prototype.equals=function(t,e){return e=void 0===e?Number.EPSILON:e,null!==t&&Math.abs(t.x-this.x)<e&&Math.abs(t.y-this.y)<e},d.prototype.isEmpty=function(){return 0===this.x&&0===this.y},d.prototype.setRotationFrom=function(t,n){return e.isNumber(n),this.subtract(t).setRotation(n).add(t)},d.prototype.setRotation=function(t){e.isNumber(t);var n=Math.cos(t);return t=Math.sin(t),this.set(this.x*n-this.y*t,this.x*t+this.y*n)},d.prototype.angleBetween=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},d.prototype.angle=function(){return Math.atan2(this.y,this.x)},d.prototype.perp=function(){return this.set(this.y,-this.x)},d.fromAngle=function(t,n){return e.isNumber(t),(n=n||new d).set(Math.cos(t),Math.sin(t))},d.randomRange=function(t,e,n){return(n=n||new d).x=Math.random()*(e.x-t.x)+t.x,n.y=Math.random()*(e.y-t.y)+t.y,n},d.prototype.toString=function(t){return t=void 0===t?2:t,"Vector: { x: "+this.x.toFixed(t)+", y: "+this.y.toFixed(t)+" }"},n.global.Object.defineProperties(d.prototype,{random:{configurable:!0,enumerable:!0,get:function(){return i.randomBetween(this.x,this.y)}}}),d.__cache=new d,d.pool=new a(d);var p=function(t,e){this.start=t,this.end=e};p.prototype.set=function(t,e){return this.start=t,this.end=e,this},p.prototype.clone=function(){return new p(this.start.clone(),this.end.clone())},p.prototype.copyTo=function(t){return t.set(this.start.clone(),this.end.clone())},p.prototype.copyFrom=function(t){return this.set(t.start.clone(),t.end.clone())},p.prototype.equals=function(t,e){return e=void 0===e?Number.EPSILON:e,this.start.equals(t.start,e)&&this.end.equals(t.end,e)||this.start.equals(t.end,e)&&this.end.equals(t.start,e)},p.prototype.reverse=function(){var t=this.start;return this.start=this.end,this.end=t,this},p.prototype.normalize=function(){return this.end.subtract(this.start).normalize().add(this.start),this},p.prototype.scale=function(t){return this.end.subtract(this.start).multiplyScalar(t).add(this.start),this},p.prototype.zero=function(){return this.set(new d,new d)},p.prototype.length=function(){return this.start.distance(this.end)},p.prototype.center=function(t){return(t=t||new d).set((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},p.prototype.containsXY=function(t,e){return this.contains(new d(t,e))},p.prototype.contains=function(t){return this.start.distance(t)+this.end.distance(t)===this.length()},p.prototype.intersects=function(t){var e=this.start,n=this.end,i=t.start,r=((t=t.end).y-i.y)*(n.x-e.x)-(t.x-i.x)*(n.y-e.y);if(0===r)return!1;var o=e.y-i.y,a=e.x-i.x;return e=(n.x-e.x)*o-(n.y-e.y)*a,o=((t.x-i.x)*o-(t.y-i.y)*a)/r,a=e/r,0<=o&&1>=o&&0<a&&1>a},p.prototype.intersectsCircle=function(t){var e=this.start,n=this.end;if(t.contains(e)||t.contains(n))return!0;var i=e.distance(n),r=(n.x-e.x)/i;n=(n.y-e.y)/i,i=r*(t.x-e.x)+n*(t.y-e.y);var o=new d(i*r+e.x,i*n+e.y).distance(new d(t.x,t.y));if(o<t.r){o=(i+(t=Math.sqrt(Math.pow(t.r,2)-Math.pow(o,2))))*r+e.x;var a=(i+t)*n+e.y;return this.__isInBoundsXY((i-t)*r+e.x,(i-t)*n+e.y)||this.__isInBoundsXY(o,a)}return!1},p.prototype.__isInBoundsXY=function(t,e){var n=this.start.x,i=this.start.y,r=this.end.x,o=this.end.y;return t>Math.min(n,r)&&t<Math.max(n,r)&&e>Math.min(i,o)&&e<Math.max(i,o)},p.prototype.toString=function(t){return t=void 0===t?2:t,"Line { start: "+this.start.toString(t)+", end: "+this.end.toString(t)+" }"},n.global.Object.defineProperties(p.prototype,{left:{configurable:!0,enumerable:!0,get:function(){return Math.min(this.start.x,this.end.x)}},right:{configurable:!0,enumerable:!0,get:function(){return Math.max(this.start.x,this.end.x)}},top:{configurable:!0,enumerable:!0,get:function(){return Math.min(this.start.y,this.end.y)}},bottom:{configurable:!0,enumerable:!0,get:function(){return Math.max(this.start.y,this.end.y)}},type:{configurable:!0,enumerable:!0,get:function(){return"Line"}}}),p.__cache=new p(new d,new d);var m=function(t,n,i,r){t=void 0===t?0:t,n=void 0===n?0:n,i=void 0===i?0:i,r=void 0===r?0:r,e.isNumber(t,n,i,r),this.x=t,this.y=n,this.width=i,this.height=r};m.prototype.set=function(t,n,i,r){return e.isNumber(t,n,i,r),this.x=t,this.y=n,this.width=i,this.height=r,this},m.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},m.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},m.prototype.size=function(t){return(t=t||new d).set(this.width,this.height)},m.prototype.zero=function(){return this.set(0,0,0,0)},m.prototype.equals=function(t,e){return e=void 0===e?Number.EPSILON:e,null!==t&&Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.width-t.width)<e&&Math.abs(this.height-t.height)<e},m.prototype.containsXY=function(t,e){return t>=this.x&&t<=this.right&&e>=this.y&&e<=this.bottom},m.prototype.contains=function(t){return t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom},m.prototype.intersects=function(t){return t.right>this.x&&t.bottom>this.y&&t.x<this.right&&t.y<this.bottom},m.prototype.intersection=function(t,e){e=e||new m;var n=this.x<t.x?t.x:this.x,i=this.right>t.right?t.right:this.right;if(i<=n)return new m;var r=this.y<t.y?t.y:this.y;return(t=this.bottom>t.bottom?t.bottom:this.bottom)<=r?new m:(e.set(n,r,i-n,t-r),e)},m.prototype.union=function(t){var e=this.x>t.x?t.x:this.x,n=this.y>t.y?t.y:this.y;return this.set(e,n,(this.right<t.right?t.right:this.right)-e,(this.bottom<t.bottom?t.bottom:this.bottom)-n)},m.prototype.expand=function(t,n,i,r){if(e.isNumber(t,n,i,r),0===this.volume)return this.set(t,n,i,r);var o=this.right,a=this.bottom;return this.x>t&&(this.x=t,this.width=o-t),this.y>n&&(this.y=n,this.height=a-n),o<t+i&&(this.width=t+i-this.x),a<n+r&&(this.height=n+r-this.y),this},m.prototype.expandXY=function(t,e){return t<this.x&&(this.width+=this.x-t,this.x=t),e<this.y&&(this.height+=this.y-e,this.y=e),t>this.x+this.width&&(this.width=t-this.x),e>this.y+this.height&&(this.height=e-this.y),this},m.prototype.inflate=function(t,n){return t=void 0===t?0:t,n=void 0===n?0:n,e.isNumber(t,n),this.x-=t,this.y-=n,this.width+=2*t,this.height+=2*n,this},m.prototype.clone=function(){return new m(this.x,this.y,this.width,this.height)},m.prototype.center=function(t){return(t=t||new d).set(this.x+.5*this.width,this.y+.5*this.height)},m.prototype.scale=function(t,e){return this.width*=t,this.height*=e,this},m.fromPoints=function(t){var e=new m;if(0===t.length)return e;for(var n=t.length,i=t[0].x,r=t[0].y,o=t[0].x,a=t[0].y,s=1;s<n;s++){var l=t[s],h=l.x;l=l.y,i=Math.min(h,i),o=Math.max(h,o),r=Math.min(l,r),a=Math.max(l,a)}return e.x=i,e.y=r,e.width=o-i,e.height=a-r,e},m.fromPointsXY=function(t){var e=new m;if(2>t.length)return e;for(var n=t.length,i=t[0],r=t[1],o=t[0],a=t[1],s=2;s<n;s+=2){var l=t[s],h=t[s+1];i=Math.min(l,i),o=Math.max(l,o),r=Math.min(h,r),a=Math.max(h,a)}return e.x=i,e.y=r,e.width=o-i,e.height=a-r,e},m.prototype.toString=function(t){return t=void 0===t?2:t,"Rectangle { x: "+this.x.toFixed(t)+", y: "+this.y.toFixed(t)+", width: "+this.width.toFixed(t)+", height: "+this.height.toFixed(t)+" }"},n.global.Object.defineProperties(m.prototype,{left:{configurable:!0,enumerable:!0,get:function(){return this.x},set:function(t){e.isNumber(t),this.x=t}},right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.width},set:function(t){e.isNumber(t),this.x=t-this.width}},top:{configurable:!0,enumerable:!0,get:function(){return this.y},set:function(t){e.isNumber(t),this.y=t}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.height},set:function(t){e.isNumber(t),this.y=t-this.height}},topLeft:{configurable:!0,enumerable:!0,get:function(){return new d(this.x,this.y)},set:function(t){this.left=t.x,this.top=t.y}},topRight:{configurable:!0,enumerable:!0,get:function(){return new d(this.right,this.y)},set:function(t){this.right=t.x,this.top=t.y}},bottomRight:{configurable:!0,enumerable:!0,get:function(){return new d(this.right,this.bottom)},set:function(t){this.right=t.x,this.bottom=t.y}},bottomLeft:{configurable:!0,enumerable:!0,get:function(){return new d(this.x,this.bottom)},set:function(t){this.x=t.x,this.bottom=t.y}},volume:{configurable:!0,enumerable:!0,get:function(){return this.width*this.height}},perimeter:{configurable:!0,enumerable:!0,get:function(){return 2*(this.width+this.height)}},isEmpty:{configurable:!0,enumerable:!0,get:function(){return 0>=this.width||0>=this.height}},lines:{configurable:!0,enumerable:!0,get:function(){return[new p(this.topLeft,this.topRight),new p(this.topRight,this.bottomRight),new p(this.bottomRight,this.bottomLeft),new p(this.bottomLeft,this.topLeft)]}},random:{configurable:!0,enumerable:!0,get:function(){var t=i.randomBetween(this.x,this.width),e=i.randomBetween(this.y,this.height);return new d(t,e)}}}),m.__cache=new m,m.pool=new a(m);var f=function(t,e,n,i,r,o){t=void 0===t?1:t,e=void 0===e?0:e,n=void 0===n?0:n,i=void 0===i?1:i,r=void 0===r?0:r,o=void 0===o?0:o,this.data=new Float32Array(6),this.set(t,e,n,i,r,o)};f.prototype.set=function(t,n,i,r,o,a){t=void 0===t?1:t,n=void 0===n?0:n,i=void 0===i?0:i,r=void 0===r?1:r,o=void 0===o?0:o,a=void 0===a?0:a,e.isNumber(t,n,i,r,o,a);var s=this.data;return s[0]=t,s[1]=n,s[2]=i,s[3]=r,s[4]=o,s[5]=a,this},f.prototype.translate=function(t,n){e.isNumber(t,n);var i=this.data,r=i[1],o=i[3],a=i[5];return this.data[4]=i[0]*t+i[2]*n+i[4],this.data[5]=r*t+o*n+a,this},f.prototype.setTranslation=function(t,n){return e.isNumber(t,n),this.data[4]=t,this.data[5]=n,this},f.prototype.setRotation=function(t,n){n=void 0===n?1:n,e.isNumber(t,n);var i=this.data;return i[0]=Math.cos(t)*n,i[2]=Math.sin(t)*n,i[1]=-i[2],i[3]=i[0],this},f.prototype.rotate=function(t){e.isNumber(t);var n=this.data,i=Math.cos(t);t=Math.sin(t);var r=n[0],o=n[2],a=n[4];return n[0]=r*i-n[1]*t,n[1]=r*t+n[1]*i,n[2]=o*i-n[3]*t,n[3]=o*t+n[3]*i,n[4]=a*i-n[5]*t,n[5]=a*t+n[5]*i,this},f.prototype.scale=function(t,n){e.isNumber(t,n);var i=this.data,r=i[1],o=i[2],a=i[3];return this.data[0]=i[0]*t,this.data[1]=r*t,this.data[2]=o*n,this.data[3]=a*n,this},f.prototype.skew=function(t,e){var n=Math.sin(t);t=Math.cos(t);var i=Math.sin(e);e=Math.cos(e);var r=this.data;this.set(r[0]*e-r[1]*n,r[0]*i+r[1]*t,r[2]*e-r[3]*n,r[2]*i+r[3]*t,r[4]*e-r[5]*n,r[4]*i+r[5]*t)},f.prototype.identity=function(){return this.set(1,0,0,1,0,0)},f.prototype.prepend=function(t){var e=this.data,n=t.data;t=e[0];var i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=n[0],h=n[1],c=n[2],u=n[3],d=n[4];return n=n[5],1===l&&0===h&&0===c&&1===u||(e[1]=t*h+i*u,e[0]=t*l+i*c,e[3]=r*h+o*u,e[2]=r*l+o*c),e[5]=a*h+s*u+n,e[4]=a*l+s*c+d,this},f.prototype.append=function(t){var e=this.data,n=t.data;t=e[0];var i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=n[0],h=n[1],c=n[2],u=n[3],d=n[4];return n=n[5],e[0]=t*l+r*h,e[1]=i*l+o*h,e[2]=t*c+r*u,e[3]=i*c+o*u,e[4]=t*d+r*n+a,e[5]=i*d+o*n+s,this},f.prototype.transformXY=function(t,n,i){e.isNumber(t,n),i=i||new d;var r=this.data;return i.x=r[0]*t+r[2]*n+r[4],i.y=r[1]*t+r[3]*n+r[5],i},f.prototype.transformDirectionXY=function(t,n,i){e.isNumber(t,n);var r=this.data;return(i=i||new d).x=r[0]*t+r[2]*n,i.y=r[1]*t+r[3]*n,i},f.prototype.transformVector=function(t,e){e=e||new d;var n=this.data;return e.set(n[0]*t.x+n[2]*t.y+n[4],n[1]*t.x+n[3]*t.y+n[5])},f.prototype.transformRect=function(t,e){e=e||new m;var n=Number.MAX_VALUE,i=-Number.MAX_VALUE,r=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=this.data,s=d.pool.get();t=[t.x,t.y,t.x+t.width,t.y,t.x,t.y+t.height,t.x+t.width,t.y+t.height];for(var l=0;l<t.length;l+=2)s.x=a[0]*t[l]+a[2]*t[l+1]+a[4],s.y=a[1]*t[l]+a[3]*t[l+1]+a[5],n>s.x&&(n=s.x),i<s.x&&(i=s.x),r>s.y&&(r=s.y),o<s.y&&(o=s.y);return d.pool.release(s),e.set(n,r,i-n,o-r)},f.prototype.invert=function(){var t=this.data,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=e*r-n*i;return 0===s?(t[0]=t[1]=t[2]=t[3]=0,t[4]=-o,t[5]=-a,this):(s=1/s,t[0]=r*s,t[1]=-n*s,t[2]=-i*s,t[3]=e*s,t[4]=(i*a-r*o)*s,t[5]=(n*o-e*a)*s,this)},f.prototype.__decompose=function(){var t=this.data,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4];t=t[5];var a=-Math.atan2(-i,r),s=Math.atan2(n,e),l=0,h=0,c=0;return 1e-5>Math.abs(a+s)?(l=s,0>e&&0<=r&&(l+=0>=l?Math.PI:-Math.PI)):(h=a,c=s),[o,t,l,Math.sqrt(e*e+n*n),Math.sqrt(i*i+r*r),h,c]},f.prototype.clone=function(){var t=new f,e=this.data;return t.set(e[0],e[1],e[2],e[3],e[4],e[5]),t},f.prototype.copyTo=function(t){var e=this.data,n=t.data;return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],t},f.prototype.copyFrom=function(t){return t.copyTo(this)},f.prototype.exactEquals=function(t){if(!t)return!1;var e=this.data;return t=t.data,e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},f.prototype.equals=function(t,e){if(e=void 0===e?Number.EPSILON:e,!t)return!1;var n=this.data;return t=t.data,Math.abs(n[0]-t[0])<e&&Math.abs(n[1]-t[1])<e&&Math.abs(n[2]-t[2])<e&&Math.abs(n[3]-t[3])<e&&Math.abs(n[4]-t[4])<e&&Math.abs(n[5]-t[5])<e},f.prototype.toString=function(t){return t=void 0===t?2:t,"        | "+this.value[0].toFixed(t)+" | "+this.value[1].toFixed(t)+" | "+this.value[4].toFixed(t)+" |\nMatrix: | "+this.value[2].toFixed(t)+" | "+this.value[3].toFixed(t)+" | "+this.value[5].toFixed(t)+" |"},n.global.Object.defineProperties(f.prototype,{isIdentity:{configurable:!0,enumerable:!0,get:function(){return this.exactEquals(f.__identity)}},value:{configurable:!0,enumerable:!0,get:function(){return this.data}}}),f.__cache=new f,f.__identity=new f,f.pool=new a(f);var g=function(t,e,n){this.x=void 0===t?0:t,this.y=void 0===e?0:e,this.r=void 0===n?1:n};g.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.r=n,this},g.prototype.clone=function(){return new g(this.x,this.y,this.r)},g.prototype.copyTo=function(t){return t.set(this.x,this.y,this.r)},g.prototype.copyFrom=function(t){return this.set(t.x,t.y,t.r)},g.prototype.equals=function(t,e){return e=void 0===e?Number.EPSILON:e,null!==t&&Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.r-t.r)<e},g.prototype.containsXY=function(t,e){return this.contains(new d(t,e))},g.prototype.contains=function(t){return new d(this.x,this.y).subtract(t).length()<=this.r},g.prototype.zero=function(){return this.set(0,0,0)},g.prototype.intersects=function(t){var e=new d(this.x,this.y).distance(new d(t.x,t.y));return e<=this.r+t.r&&e>=this.r-t.r},g.prototype.collide=function(t){return new d(this.x,this.y).distance(new d(t.x,t.y))<=this.r+t.r},g.prototype.overlap=function(t){return!(this.r<t.r)&&new d(this.x,this.y).distance(new d(t.x,t.y))<=this.r-t.r},g.prototype.center=function(t){return(t=t||new d).set(this.x,this.y)},g.getCircumferencePoint=function(t,e,n,i,r){return(r=r||new d).set(t+n*Math.sin(i),e+n*-Math.cos(i)),r},g.prototype.toString=function(t){return t=void 0===t?2:t,"Circle { x: "+this.x.toFixed(t)+", y: "+this.y.toFixed(t)+", r: "+this.r.toFixed(t)+" }"},n.global.Object.defineProperties(g.prototype,{volume:{configurable:!0,enumerable:!0,get:function(){return Math.PI*this.r*this.r}},perimeter:{configurable:!0,enumerable:!0,get:function(){return 2*Math.PI*this.r}},left:{configurable:!0,enumerable:!0,get:function(){return this.x-this.r}},right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.r}},top:{configurable:!0,enumerable:!0,get:function(){return this.y-this.r}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.r}},topPoint:{configurable:!0,enumerable:!0,get:function(){return new d(this.x,this.top)}},bottomPoint:{configurable:!0,enumerable:!0,get:function(){return new d(this.x,this.bottom)}}}),g.__cache=new g;var v=function(t){this.mVertices=t=void 0===t?[]:t,this.mLines=[],this.mBounds=new m,this.mCenter=new d,2<t.length&&this.refresh()};v.prototype.set=function(t){return this.mVertices=t,this.refresh(),this},v.prototype.copyTo=function(t){for(var e=this.mVertices.length,n=[],i=0;i<e;i++)n.push(this.mVertices[i].clone());return t.set(n)},v.prototype.copyFrom=function(t){for(var e=(t=t.mVertices).length,n=[],i=0;i<e;i++)n.push(t[i].clone());return this.set(n)},v.prototype.clone=function(){for(var t=this.mVertices,e=t.length,n=[],i=0;i<e;i++)n.push(t[i].clone());return new v(n)},v.prototype.containsXY=function(t,e){return this.contains(new d(t,e))},v.prototype.contains=function(t){if(t.x<this.mBounds.x||this.mBounds.x+this.mBounds.width<t.x||t.y<this.mBounds.y||this.mBounds.y+this.mBounds.height<t.y)return!1;var e=this.mCenter,n=this.mLines,i=n.length;if(e.equals(t))return!0;t=new p(t,e.clone()),e=0,t.scale((this.width+this.height)/t.length());for(var r=0;r<i;r++)e+=n[r].intersects(t)?1:0;return 0!=e%2},v.prototype.collide=function(t){if(!this.mBounds.intersects(t.mBounds))return!1;for(var e=this.mLines,n=e.length,i=(t=t.mLines).length,r=0;r<n;r++)for(var o=0;o<i;o++)if(e[r].intersects(t[o]))return!0;return!1},v.prototype.collideCircle=function(t){var e=this.mBounds,n=this.mLines;if(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)return!1;e=n.length;for(var i=0;i<e;i++)if(n[i].intersectsCircle(t))return!0;return!1},v.prototype.collideRectangle=function(t){if(!this.mBounds.intersects(t))return!1;for(var e=this.mLines,n=e.length,i=(t=t.lines).length,r=0;r<n;r++)for(var o=0;o<i;o++)if(e[r].intersects(t[o]))return!0;return!1},v.prototype.overlap=function(t){if(this.mBounds.width<t.mBounds.width||this.mBounds.height<t.mBounds.height||!this.contains(t.mCenter))return!1;for(var e=this.mLines,n=e.length,i=(t=t.mLines).length,r=0;r<n;r++)for(var o=0;o<i;o++)if(e[r].intersects(t[o]))return!1;return!0},v.prototype.overlapCircle=function(t){if(!this.containsXY(t.x,t.y))return!1;for(var e=this.mLines,n=e.length,i=0;i<n;i++)if(e[i].intersectsCircle(t))return!1;return!0},v.prototype.overlapRectangle=function(t){if(!this.contains(t.center()))return!1;for(var e=this.mLines,n=e.length,i=(t=t.lines).length,r=0;r<n;r++)for(var o=0;o<i;o++)if(e[r].intersects(t[o]))return!1;return!0},v.prototype.refresh=function(){var t=this.mCenter,e=this.mBounds,n=this.mVertices,i=this.mLines=[];t.set(0,0);for(var r=-Number.MAX_VALUE,o=-Number.MAX_VALUE,a=Number.MAX_VALUE,s=Number.MAX_VALUE,l=0;l<n.length;l++){var h=n[l];t.add(h);var c=h,u=c.x;r=u>r?u:r,o=(c=c.y)>o?c:o,a=u<a?u:a,s=c<s?c:s,i.push(new p(h,n[l+1]||n[0]))}return t.multiplyScalar(1/n.length),e.set(a,s,r-a,o-s),this},v.prototype.refreshCenter=function(){var t=this.mCenter,e=this.mVertices,n=e.length;t.set(0,0);for(var i=0;i<n;i++)t.add(e[i]);return t.multiplyScalar(1/e.length),this},v.prototype.refreshBounds=function(){for(var t,e,n=this.mBounds,i=this.mVertices,r=-Number.MAX_VALUE,o=-Number.MAX_VALUE,a=Number.MAX_VALUE,s=Number.MAX_VALUE,l=i.length,h=0;h<l;h++)r=(t=i[h].x)>r?t:r,o=(e=i[h].y)>o?e:o,a=t<a?t:a,s=e<s?e:s;return n.set(a,s,r-a,o-s),this},v.prototype.refreshLines=function(){for(var t=this.mVertices,e=this.mLines=[],n=0;n<t.length;n+=2)e.push(new p(t[n],t[n+1]||t[0]));return this},v.fromPath=function(t){var e=[];t=t.split(" ");for(var n=0;n<t.length;n+=2)e.push(new d(Number(t[n]),Number(t[n+1])));return new v(e)},v.prototype.setRotation=function(t){var e=this.mCenter,n=this.mVertices,i=Math.cos(t);t=Math.sin(t);for(var r=0,o=n.length;r<o;r++){var a=n[r];a.subtract(e).set(a.x*i-a.y*t,a.x*t+a.y*i).add(e)}return this.refresh()},v.prototype.setTranslation=function(t){var e=this.mVertices,n=e.length;t.subtract(this.mCenter);for(var i=0;i<n;i++)e[i].add(t);return this.refresh()},v.prototype.toString=function(t){t=void 0===t?2:t;for(var e=this.mLines,n=this.mVertices,i=e.length,r="",o="",a=0;a<i;a++)o+=e[a].toString(t);for(i=n.length,e=0;e<i;e++)r+=n[e].toString(t);return"Polygon { vertices: "+r+", bounds: "+this.mBounds.toString(t)+", center: "+this.mCenter.toString()+", lines: "+o+" }"},n.global.Object.defineProperties(v.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this.mBounds.width}},height:{configurable:!0,enumerable:!0,get:function(){return this.mBounds.height}},perimeter:{configurable:!0,enumerable:!0,get:function(){for(var t=this.mLines,e=t.length,n=0,i=0;i<e;i++)n+=t[i].length();return n}},vertices:{configurable:!0,enumerable:!0,get:function(){return this.mVertices}},center:{configurable:!0,enumerable:!0,get:function(){return this.mCenter}}}),v.__cache=new v;var y=function(){this.mPoints=[],this.mLookup=null,this.mBaked=!1,this.mStep=1/60,this.mEachT=[]};y.prototype.set=function(t){for(var e=[],n=0;n<arguments.length;++n)e[n-0]=arguments[n];return this.mPoints=this.__initPoints(e),this.__refreshEachT(),this.mBaked&&this.__refreshCache(),this},y.prototype.__initPoints=function(t){for(var e=[],n=6;n<t.length;n+=6)e=e.concat(t.slice(n-6,n+2));return e},y.prototype.__refreshCache=function(){for(var t=this.mLookup=[],e=this.getFullLength(),i=this.mPoints,r=i.length,o=0;o<r;o+=8)for(var a=y.getLength.apply(y,n.arrayFromIterable(i.slice(o,o+8))),s=a=this.mStep*e/a;1>s;s+=a)t.push(y.lerp.apply(y,[s].concat(n.arrayFromIterable(i.slice(o,o+8)))));return this},y.prototype.__refreshEachT=function(){for(var t=this.mPoints,e=this.mEachT=[],i=t.length,r=[],o=0;o<i;o+=8)r.push(y.getLength.apply(y,n.arrayFromIterable(t.slice(o,o+8))));t=this.getFullLength();for(var a=o=0;a<i;a+=8)o+=r[a/8],e.push(o/t);return this},y.lerp=function(t,e,n,i,r,o,a,s,l,h){var c=1-t,u=t*t,p=c*c,m=p*c,f=u*t;return(h=h||new d).set(e,n),h.x*=m,h.y*=m,h.x+=3*p*t*i,h.y+=3*p*t*r,h.x+=3*c*u*o,h.y+=3*c*u*a,h.x+=f*s,h.y+=f*l,h},y.prototype.interpolate=function(t,e){e=e||new d;var i=this.mLookup;if(this.mBaked)return e.copyFrom(i[Math.ceil((i.length-1)*t)]),e;for(var r=this.mEachT,o=this.mPoints,a=0;r[a]<t;)a++;return i=r[a-1]||0,r=r[a],o=o.slice(8*a,8*a+8),y.lerp.apply(y,[(t-i)/(r-i)].concat(n.arrayFromIterable(o),[e]))},y.getLength=function(t){for(var e=[],n=0;n<arguments.length;++n)e[n-0]=arguments[n];n=new d(e[0],e[1]);var i=new d(e[2],e[3]),r=new d(e[4],e[5]);return((e=new d(e[6],e[7])).distance(n)+n.distance(i)+i.distance(r)+r.distance(e))/2},y.prototype.getFullLength=function(){for(var t=this.mPoints,e=t.length,i=0,r=0;r<e;r+=8)i+=y.getLength.apply(y,n.arrayFromIterable(t.slice(r,r+8)));return i},n.global.Object.defineProperties(y.prototype,{baked:{configurable:!0,enumerable:!0,get:function(){return this.mBaked},set:function(t){this.mBaked=t,!this.mLookup&&this.mPoints&&this.__refreshCache()}}}),y.__cache=new y;var b={DIRECT:"direct",BUBBLE:"bubble"},_={REGULAR:"regular",OVERHEARD:"overheard"},x=function(){this.sender=null,this.name="",this.origin=this.target=null,this.canceled=!1,this.type=b.DIRECT};x.prototype.cancel=function(){this.canceled=!0},x.prototype.toString=function(){return"MESSAGE: { name: '"+this.name+"', sender: '"+(void 0!==this.sender.name?this.sender.name:"")+"', target: '"+this.target.name+"', path: '"+this.path+"' }"},x.prototype.__reset=function(){return this.sender=null,this.name="",this.target=null,this.canceled=!1,this.type=b.DIRECT,this},n.global.Object.defineProperties(x,{PROGRESS:{configurable:!0,enumerable:!0,get:function(){return"progress"}},COMPLETE:{configurable:!0,enumerable:!0,get:function(){return"complete"}},ERROR:{configurable:!0,enumerable:!0,get:function(){return"error"}},CHANGE:{configurable:!0,enumerable:!0,get:function(){return"change"}},READY:{configurable:!0,enumerable:!0,get:function(){return"ready"}},UPDATE:{configurable:!0,enumerable:!0,get:function(){return"update"}},RESIZE:{configurable:!0,enumerable:!0,get:function(){return"resize"}},pool:{configurable:!0,enumerable:!0,get:function(){return w}}});var w=new a(x),M=function(t,e,n,i,r,o,a){o=void 0===o?_.REGULAR:o,a=void 0===a?null:a,this.owner=t,this.name=e,this.callback=n,this.isOnce=i,this.context=void 0===r?null:r,this.pathPattern=a,this.glob=null==a?null:new u(a),this.type=o};M.prototype.off=function(){this.owner.__off(this)},M.prototype.__reset=function(){return this.pathPattern=this.owner=null,this};var S=null,T=function(){S=this,this.mCamera=this.mAssets=this.mDevice=this.mTime=this.mAudio=this.mInput=this.mEngine=null};n.global.Object.defineProperties(T,{engine:{configurable:!0,enumerable:!0,get:function(){return S.mEngine},set:function(t){S.mEngine=t}},input:{configurable:!0,enumerable:!0,get:function(){return S.mInput},set:function(t){S.mInput=t}},audio:{configurable:!0,enumerable:!0,get:function(){return S.mAudio},set:function(t){S.mAudio=t}},time:{configurable:!0,enumerable:!0,get:function(){return S.mTime},set:function(t){S.mTime=t}},device:{configurable:!0,enumerable:!0,get:function(){return S.mDevice},set:function(t){S.mDevice=t}},assets:{configurable:!0,enumerable:!0,get:function(){return S.mAssets},set:function(t){S.mAssets=t}},stage:{configurable:!0,enumerable:!0,get:function(){return S.mEngine.mStage}},driver:{configurable:!0,enumerable:!0,get:function(){return S.mEngine.mVideo}},camera:{configurable:!0,enumerable:!0,get:function(){return null!==S.mCamera&&!0===S.mCamera.mAdded?S.mCamera:null},set:function(t){S.mCamera=t}},magic:{configurable:!0,enumerable:!0,get:function(){return Math.random()}}}),new T;var E=function(t){this.mBindings=null,this.checkForStage=void 0!==t&&t};E.prototype.on=function(t,e,n){return this.__on(t,e,!1,n)},E.prototype.off=function(t){for(var n=[],i=0;i<arguments.length;++i)n[i-0]=arguments[i];for(i=0;i<n.length;i++){var r=n[i];if(-1!==r.indexOf("@")){e.error("Removing overheard bindings is not allowed.");break}if(null!==this.mBindings&&!0===this.mBindings.hasOwnProperty(r)){r=this.mBindings[r].slice();for(var o=0;o<r.length;o++)this.__off(r[o])}}},E.prototype.once=function(t,e,n){return this.__on(t,e,!0,n)},E.prototype.post=function(t,e){for(var i=[],r=1;r<arguments.length;++r)i[r-1]=arguments[r];(r=this.__draftMessage(t)).type===b.DIRECT?this.__invoke.apply(this,[this,r].concat(n.arrayFromIterable(i))):r.type===b.BUBBLE&&this.__postBubbles.apply(this,[this,r,!0].concat(n.arrayFromIterable(i))),!1===r.canceled&&this.__invokeOverheard.apply(this,[this,r].concat(n.arrayFromIterable(i))),x.pool.release(r)},E.prototype.__on=function(t,n,i,r){i=void 0!==i&&i,r=void 0===r?null:r,e.assert(null!==t,"name cannot be null."),e.assert(0<t.trim().length,"name cannot be null."),e.assert(0!==t.indexOf("~"),"Using `~` is not tot allowed here."),e.assert(null!==n,"callback cannot be null.");var o=t.indexOf("@");if(-1!==o){var a=t.substring(0,o);return t=t.substring(o+1),!1===(o=E.mOverheardHandlers).hasOwnProperty(a)&&(o[a]=[]),o=o[a],n=new M(this,a,n,i,r,_.OVERHEARD,t),o.push(n),n}return null===this.mBindings&&(this.mBindings={}),!1===this.mBindings.hasOwnProperty(t)&&(this.mBindings[t]=[]),n=new M(this,t,n,i,r,_.REGULAR),this.mBindings[t].push(n),n},E.prototype.__off=function(t){if(t.type===_.REGULAR){if(null!==this.mBindings&&!1!==this.mBindings.hasOwnProperty(t.name)){var e=this.mBindings[t.name];-1!==(t=e.indexOf(t))&&e.splice(t,1)}}else t.type===_.OVERHEARD&&!1!==(e=E.mOverheardHandlers).hasOwnProperty(t.name)&&-1!==(t=(e=e[t.name]).indexOf(t))&&e.splice(t,1)},E.prototype.__invoke=function(t,e,i){for(var r=[],o=2;o<arguments.length;++o)r[o-2]=arguments[o];if(!0!==e.canceled&&null!==this.mBindings&&(!0!==this.checkForStage||this===T.stage||null!==this.stage)&&void 0!==(o=this.mBindings[e.name])&&0!==o.length){o=o.slice(0);for(var a=0;a<o.length;a++){e.target=this;var s=o[a];if((!0!==this.checkForStage||s.owner.stage!==T.stage||null!==s.owner.stage)&&(s.callback.call.apply(s.callback,[s.context,e].concat(n.arrayFromIterable(r))),!0===s.isOnce&&this.__off(s),!0===e.canceled))break}}},E.prototype.__invokeOverheard=function(t,e,i){for(var r=[],o=2;o<arguments.length;++o)r[o-2]=arguments[o];if(!0!==e.canceled&&void 0!==(o=E.mOverheardHandlers[e.name])&&0!==o.length){o=o.slice(0);for(var a=0;a<o.length;a++){var s=o[a];if((!0!==this.checkForStage||s.owner.stage!==T.stage||null!==s.owner.stage)&&this.__checkPath(t.path,s)&&(e.target=this,s.callback.call.apply(s.callback,[s.context,e].concat(n.arrayFromIterable(r))),!0===s.isOnce&&this.__off(s),!0===e.canceled))break}}},E.prototype.__postBubbles=function(t,e,i,r){for(var o=[],a=3;a<arguments.length;++a)o[a-3]=arguments[a];e.origin=this,a=[this];for(var s=this;null!==s.parent;)a.push(s.parent),s=s.parent;for(s=0;s<a.length;s++){var l=a[s];if(l.__invoke.apply(l,[t,e].concat(n.arrayFromIterable(o))),!0===e.canceled)break}},E.prototype.__draftMessage=function(t){var e=x.pool.get();return e.__reset(),e.sender=this,"~"===t.charAt(0)?(e.name=t.substr(1),e.type=b.BUBBLE):e.name=t,e},E.prototype.__checkPath=function(t,e){return null!==t&&null!==e.pathPattern&&(t===e.pathPattern||(-1===e.pathPattern.indexOf("*")?t===e.pathPattern:e.glob.test(t)))},E.dispose=function(){E.mOverheardHandlers={}},n.global.Object.defineProperties(E.prototype,{parent:{configurable:!0,enumerable:!0,get:function(){return null}},stage:{configurable:!0,enumerable:!0,get:function(){return null}},path:{configurable:!0,enumerable:!0,get:function(){return null}}}),E.mOverheardHandlers={};var A={NORMAL:"normal",ITALIC:"italic"},C={NORMAL:"400",BOLD:"700"},P=null,L=function(t,e,n,i,r,o,a){i=void 0===i?A.NORMAL:i,r=void 0===r?C.NORMAL:r,this.name="def",this.family=void 0===t?"sans-serif":t,this.size=void 0===n?14:n,this.color=void 0===e?0:e,this.alpha=1,this.style=i,this.weight=r,this.strokeThickness=void 0===o?0:o,this.strokeColor=void 0===a?16777215:a,this.strokeAlpha=1,this.dropShadow=!1,this.shadowColor=this.shadowDistanceY=this.shadowDistanceX=0,this.shadowAlpha=1,this.shadowBlur=0};L.prototype.clone=function(t,e,n,i,r,o,a){t=void 0===t?null:t,e=void 0===e?NaN:e,n=void 0===n?NaN:n,i=void 0===i?null:i,r=void 0===r?null:r,o=void 0===o?NaN:o,a=void 0===a?NaN:a;var s=new L;return s.family=null===t?this.family:t,s.size=isNaN(n)?this.size:n,s.color=isNaN(e)?this.color:e,s.style=null===i?this.style:i,s.weight=null===r?this.weight:r,s.strokeThickness=isNaN(o)?this.strokeThickness:o,s.strokeColor=isNaN(a)?this.strokeColor:a,s.dropShadow=this.dropShadow,s.shadowAlpha=this.shadowAlpha,s.shadowBlur=this.shadowBlur,s.shadowColor=this.shadowColor,s.shadowDistanceX=this.shadowDistanceX,s.shadowDistanceY=this.shadowDistanceY,s},n.global.Object.defineProperties(L,{default:{configurable:!0,enumerable:!0,get:function(){return null===P&&(P=new L("sans-serif",0,14,A.NORMAL,C.NORMAL,0,0)),P}}});var R={},O=null,I=null,N=!1,D=function(t){null===O&&("undefined"!=typeof OffscreenCanvas&&!0===N?(I=new OffscreenCanvas(10,200),O=I.getContext("2d")):(I=document.createElement("canvas"),O=I.getContext("2d"),I.width=10,I.height=200)),t.size=24,this.mCanvas=I,this.mCtx=O,this.mStyle=t;var e=Math.floor(.7766*I.height);this.mCtx.clearRect(0,0,this.mCanvas.width,this.mCanvas.height),this.mCtx.font=t.weight+" "+t.size+'px "'+t.family+'"',this.mCtx.fillText("x",0,e,1);var n=this.mCtx.getImageData(0,0,1,this.mCanvas.height).data;t=this.__getBottom(n)-this.__getTop(n);for(var i=32;126>=i;i++)this.mCtx.fillText(String.fromCharCode(i),0,e,1);n=this.mCtx.getImageData(0,0,1,this.mCanvas.height).data,e-=i=this.__getTop(n),i=(n=this.__getBottom(n))-i,this.baseline=e,this.bottom=i,this.ascent=e-t,this.descent=i-e,this.xHeight=t,this.capHeight=e};D.prototype.__getTop=function(t){for(var e=3,n=t.length;e<n;e+=4)if(0<t[e])return(e-3)/4;return t.length/4},D.prototype.__getBottom=function(t){for(var e=t.length-1;0<e;e-=4)if(0<t[e])return(e+1)/4;return 0},D.get=function(t){var e=R[t];return null==e&&(e=new L(t,0,24),e=new D(e),R[t]=e),e},n.global.Object.defineProperties(D.prototype,{capHeightNormalized:{configurable:!0,enumerable:!0,get:function(){return this.capHeight/this.mStyle.size}},xHeightNormalized:{configurable:!0,enumerable:!0,get:function(){return this.xHeight/this.mStyle.size}},ascentNormalized:{configurable:!0,enumerable:!0,get:function(){return this.ascent/this.mStyle.size}},descentNormalized:{configurable:!0,enumerable:!0,get:function(){return this.descent/this.mStyle.size}},baselineNormalized:{configurable:!0,enumerable:!0,get:function(){return this.baseline/this.mStyle.size}},bottomNormalized:{configurable:!0,enumerable:!0,get:function(){return this.bottom/this.mStyle.size}}}),n.global.Object.defineProperties(D,{useOffscreenCanvas:{configurable:!0,enumerable:!0,get:function(){return N},set:function(t){N=t}}});var B=function(){this.segments=[],this.bounds=new m,this.shadowBounds=this.strokeBounds=null,this.lineWidth=[]},F=function(t,e,n,i){this.text=t,this.style=e,this.lineIndex=n,this.bounds=i},k=null,U=null,z=function(){throw Error("Singleton")};z.measure=function(t,e,n){for(var i=[],r=2;r<arguments.length;++r)i[r-2]=arguments[r];r=[];for(var o,a=/(~{([^}]+)}|^)(.+?(?=~{.+}|$|^))|(\n)/gm,s="def",l=0;null!==(o=a.exec(t));)o[4]&&l++,o[2]&&(s=o[2]),o[3]&&r.push({tag:s,text:o[3],style:i.filter((function(t){return t.name===s}))[0],lineIndex:l});a=new B;var h=i.filter((function(t){return"def"===t.name}))[0]||L.default;i=h.size*e,o=new m,l=new m;var c=null,u=-1,d=0,p=0;h=D.get(h.family).baselineNormalized*h.size;for(var f=0;f<r.length;f++){var g=r[f],v=g.style,y=z.__measure(g.text,v);p=D.get(v.family).baselineNormalized*v.size,u!==g.lineIndex&&(d=a.lineWidth[g.lineIndex]=0),p=i*g.lineIndex+h-p,y.x=d+2,y.y=p+2,d+=y.width,u=g.lineIndex,g.bounds=y,a.lineWidth[g.lineIndex]+=y.width,o.union(y),l.union(y.clone().inflate(v.strokeThickness,v.strokeThickness)),!0===v.dropShadow&&((p=y.clone()).inflate(v.shadowBlur,v.shadowBlur),p.x+=v.shadowDistanceX,p.y+=v.shadowDistanceY,(c=c||p).union(p)),a.segments.push(new F(g.text,v,g.lineIndex,g.bounds))}return a.bounds=o,a.strokeBounds=l,a.shadowBounds=c||new m,a},z.__measure=function(t,n,i){i=void 0===i?null:i,e.assert(null!=n,"Style cannot be null"),(i=i||new m).zero();var r=D.get(n.family);null===k&&(k="undefined"!=typeof OffscreenCanvas&&!0===D.useOffscreenCanvas?new OffscreenCanvas(0,0):document.createElement("canvas"),U=k.getContext("2d"));var o=0;return n.style===A.ITALIC&&(o=r.bottomNormalized*n.size/4),U.font=n.weight+" "+n.style+" "+n.size+'px "'+n.family+'"',t=Math.ceil(U.measureText(t).width),i.set(0,r.baselineNormalized*n.size,t+2+o,r.bottomNormalized*n.size+2)},z.measureBitmap=function(t,e,n,i){i=i||new m;for(var r=-1,o=0,a=0,s=0,l=0,h=0;h<t.length;h++){var c=t.charCodeAt(h);if(/(?:\r\n|\r|\n)/.test(t.charAt(h)))o=0,a+=e.lineHeight*n,r=-1;else{var u=e.chars[c];null!=u&&(0<=r&&u.kerning[r]&&(o+=u.kerning[r]),o+=u.xAdvance,l=Math.max(l,o+u.xOffset),s=Math.max(s,a+u.height+u.yOffset),r=c)}}return i.set(0,0,l,s)};var H=function(){this.mActualTime=this.mTime=0,this.mDeltaTimeMs=1e3/60,this.mDeltaTime=1e3/60*.001,this.mScale=1,this.mRenderOffset=this.mAlphaTime=0};n.global.Object.defineProperties(H.prototype,{now:{configurable:!0,enumerable:!0,get:function(){return this.mTime}},dt:{configurable:!0,enumerable:!0,get:function(){return this.mDeltaTime*this.mScale}},alpha:{configurable:!0,enumerable:!0,get:function(){return this.mAlphaTime}},delta:{configurable:!0,enumerable:!0,get:function(){return this.mDeltaTime*this.mScale}},scale:{configurable:!0,enumerable:!0,get:function(){return this.mScale},set:function(t){e.assert(0<=t,"Time scale must be >= 0."),this.mScale=t}}});var G=function(){return E.call(this)||this};n.inherits(G,E),G.prototype.onPause=function(){},G.prototype.onResume=function(){},G.prototype.onUpdate=function(){},G.prototype.onPostUpdate=function(){},G.prototype.onRender=function(){},G.prototype.onChildrenAdded=function(t){},G.prototype.onChildrenRemoved=function(t){},G.prototype.onChildrenChanged=function(t){},G.prototype.onComponentAdded=function(t,e){},G.prototype.onComponentRemoved=function(t,e){},G.prototype.dispose=function(){};var V={UNIVERSAL:"universal",LANDSCAPE:"landscape",PORTRAIT:"portrait"},j=function(t){t=void 0===t?null:t;var e=E.call(this)||this;return e.mContainerElement=t,e.mViewportElement=null,e.mSize=new m,e.isTransparent=!0,e.backgroundColor=0,e.mChecksLeftSeconds=0,e.mOrientation=V.UNIVERSAL,e.mOrientationLock=!1,e.mRotation=0,e.mIsPrimary=!1,e.mReflect=!1,e.__initialize(),e};n.inherits(j,E),j.prototype.__initialize=function(){var t=this;this.mViewportElement=document.createElement("div"),this.mViewportElement.style.position="relative",this.mContainerElement.appendChild(this.mViewportElement);var e=this.mContainerElement.style;e.userSelect="none",e.touchAction="none",e.cursor="auto",e.WebkitTapHighlightColor="rgba(0, 0, 0, 0)",e=this.mContainerElement.getBoundingClientRect(),this.mSize.set(e.left,e.top,e.width,e.height),this.mIsPrimary=this.isPrimary(),this.__onResize(),this.mBoundResize=function(e){return t.__onResize()},window.addEventListener("resize",this.mBoundResize)},j.prototype.isPrimary=function(){var t=screen.msOrientation||(screen.orientation||screen.mozOrientation||{}).type;return"landscape-primary"===t||"portrait-primary"===t||"landscape-secondary"!==t&&"portrait-secondary"!==t&&(e.warn("The orientation API isn't supported in this browser"),!0)},j.prototype.__update=function(){0>=this.mChecksLeftSeconds||(this.__onResize(),this.mChecksLeftSeconds-=T.time.delta)},j.prototype.refresh=function(){this.__onResize()},j.prototype.__onResize=function(){var t=this.mViewportElement.style,e=this.mContainerElement.getBoundingClientRect(),n=e.width>e.height?V.LANDSCAPE:V.PORTRAIT,i=m.pool.get().copyFrom(e),r=this.mIsPrimary;this.mIsPrimary=this.isPrimary(),this.mIsPrimary!==r&&(this.mReflect=!this.mReflect),this.mOrientationLock&&this.mOrientation!==n?(this.mRotation=this.mReflect?-1:1,t.transform=this.mReflect?"rotate(-90deg)":"rotate(90deg)",t.left=.5*(e.width-e.height)+"px",t.top=.5*(e.height-e.width)+"px",t.width=e.height+"px",t.height=e.width+"px",i.width=e.height,i.height=e.width):(this.mRotation=0,this.mReflect=!1,t.transform="rotate(0deg)",t.left="0px",t.top="0px",t.width=e.width+"px",t.height=e.height+"px"),!0!==this.mSize.equals(i)&&(this.mSize.copyFrom(i),this.post(x.RESIZE,i),this.mChecksLeftSeconds=1,m.pool.release(i))},j.prototype.dispose=function(){this.mViewportElement.remove(),window.removeEventListener("resize",this.mBoundResize)},n.global.Object.defineProperties(j.prototype,{orientation:{configurable:!0,enumerable:!0,get:function(){return this.mOrientation},set:function(t){this.mOrientation=t,this.__onResize()}},orientationLock:{configurable:!0,enumerable:!0,get:function(){return this.mOrientationLock},set:function(t){this.mOrientationLock=t,this.__onResize()}},size:{configurable:!0,enumerable:!0,get:function(){return this.mSize}},nativeElement:{configurable:!0,enumerable:!0,get:function(){return this.mViewportElement}},rotation:{configurable:!0,enumerable:!0,get:function(){return this.mRotation}},isLandscape:{configurable:!0,enumerable:!0,get:function(){return this.size.width>=this.size.height}},isPortrait:{configurable:!0,enumerable:!0,get:function(){return!this.isLandscape}}});var W=0,X=function(){var t=E.call(this,!0)||this;return t.mId=++W,t.mGameObject=null,t.mAdded=!1,t.enabled=!0,t};n.inherits(X,E),X.prototype.onAdded=function(t){},X.prototype.onRemoved=function(t){},X.prototype.onUpdate=function(){},X.prototype.onRender=function(){},X.prototype.removeFromParent=function(){null!==this.mGameObject&&this.mGameObject.removeComponent(this)},n.global.Object.defineProperties(X.prototype,{gameObject:{configurable:!0,enumerable:!0,get:function(){return this.mGameObject}},parent:{configurable:!0,enumerable:!0,get:function(){return this.mGameObject}},stage:{configurable:!0,enumerable:!0,get:function(){return null===this.mGameObject?null:this.mGameObject.stage}},path:{configurable:!0,enumerable:!0,get:function(){return null!==this.mGameObject?this.mGameObject.path+"#"+this.constructor.name:this.constructor.name}}});var Y={AUTO:"auto",NORMAL:"normal",ADD:"add",MULTIPLY:"multiply",SCREEN:"screen",OVERLAY:"overlay",DARKEN:"darken",LIGHTEN:"lighten",COLOR_DODGE:"colorDodge",COLOR_BURN:"colorBurn",HARD_LIGHT:"hardLight",SOFT_LIGHT:"softLight",DIFFERENCE:"difference",EXCLUSION:"exclusion",HUE:"hue",SATURATE:"saturate",COLOR:"color",LUMINOSITY:"luminosity",MASK:"mask",MASK_INV:"maskInv"},q={auto:"auto",normal:"source-over",add:"lighter",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten",colorDodge:"color-dodge",colorBurn:"color-burn",hardLight:"hard-light",softLight:"soft-light",difference:"difference",exclusion:"exclusion",due:"hue",saturate:"saturate",color:"color",luminosity:"luminosity",mask:"source-in",maskInv:"source-out"},Z=0,J=function(t,e,n,i,r,o){e=void 0===e?null:e,n=void 0===n?null:n,i=void 0===i?1:i,r=void 0===r?null:r,o=void 0===o?null:o,this.mId=++Z,this.mNative=t,this.mValid=!1,this.mRegion=new m,this.mUntrimmedRegion=new m,this.mRenderHeight=this.mRenderWidth=this.mDisplayHeight=this.mDisplayWidth=this.mNativeHeight=this.mNativeWidth=0,this.mScale=i,this.mRegistrationPoint=r,this.mSlice9borders=o,this.set(t,e,n,i)};J.prototype.set=function(t,n,i,r){n=void 0===n?null:n,i=void 0===i?null:i,r=void 0===r?1:r,e.assert(null!=t,"nativeElement cannot be null"),e.assert(!isNaN(r),"scale cannot be NaN"),this.mScale=r,this.mNative=t,this.mNativeWidth=t.naturalWidth||t.videoWidth||t.width,this.mNativeHeight=t.naturalHeight||t.videoHeight||t.height,this.mRegion=n||this.mRegion.set(0,0,this.mNativeWidth,this.mNativeHeight),this.mUntrimmedRegion=i||this.mUntrimmedRegion.set(0,0,this.mRegion.width,this.mRegion.height),this.mDisplayWidth=Math.ceil(this.mUntrimmedRegion.width*this.mScale),this.mDisplayHeight=Math.ceil(this.mUntrimmedRegion.height*this.mScale),this.mRenderWidth=Math.ceil(this.mRegion.width*this.mScale),this.mRenderHeight=Math.ceil(this.mRegion.height*this.mScale),this.mValid=null!=t&&0<this.mDisplayWidth&&0<this.mDisplayHeight},J.getScaleFactorFromName=function(t){var e=t.indexOf("@");if(-1===e)return 1;var n=t.indexOf("x",e);return parseFloat(t.substring(e+1,n))},J.removeScaleFactorFromName=function(t){var e=t.indexOf("@");if(-1===e)return t;var n=t.indexOf("x",e);return t.substring(0,e)+t.substring(n+1)},J.fromBase64String=function(t){var e=new Image;return e.src=t,new J(e)},J.fromCanvasAsImage=function(t,e,n){e=void 0===e?"image/png":e,n=void 0===n?1:n;var i=new Image;return i.src=t.toDataURL(e,n),new J(i)},J.fromCanvas=function(t){return T.driver.getTextureFromCanvas(t)},n.global.Object.defineProperties(J.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this.mDisplayWidth}},height:{configurable:!0,enumerable:!0,get:function(){return this.mDisplayHeight}},scale:{configurable:!0,enumerable:!0,get:function(){return this.mScale}},region:{configurable:!0,enumerable:!0,get:function(){return this.mRegion}},untrimmedRegion:{configurable:!0,enumerable:!0,get:function(){return this.mUntrimmedRegion}},nativeWidth:{configurable:!0,enumerable:!0,get:function(){return this.mNativeWidth}},nativeHeight:{configurable:!0,enumerable:!0,get:function(){return this.mNativeHeight}},displayWidth:{configurable:!0,enumerable:!0,get:function(){return this.mDisplayWidth}},displayHeight:{configurable:!0,enumerable:!0,get:function(){return this.mDisplayHeight}},renderWidth:{configurable:!0,enumerable:!0,get:function(){return this.mRenderWidth}},renderHeight:{configurable:!0,enumerable:!0,get:function(){return this.mRenderHeight}},isValid:{configurable:!0,enumerable:!0,get:function(){return this.mValid}},registrationPoint:{configurable:!0,enumerable:!0,get:function(){return this.mRegistrationPoint}},slice9borders:{configurable:!0,enumerable:!0,get:function(){return this.mSlice9borders}},native:{configurable:!0,enumerable:!0,get:function(){return this.mNative}},id:{configurable:!0,enumerable:!0,get:function(){return this.mId}}});var K=function(t,e){this.mWidth=Math.ceil(t),this.mHeight=Math.ceil(e)};K.prototype.resize=function(t,e){this.mWidth=t,this.mHeight=e},K.prototype.clear=function(){},n.global.Object.defineProperties(K.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this.mWidth},set:function(t){this.mWidth=t}},height:{configurable:!0,enumerable:!0,get:function(){return this.mHeight},set:function(t){this.mHeight=t}}});var Q=function(t,e){var n=K.call(this,t,e)||this;return n.mCanvas=document.createElement("canvas"),n.mCtx=n.mCanvas.getContext("2d"),n.resize(t,e),n};n.inherits(Q,K),Q.prototype.resize=function(t,e){this.mCanvas.width=Math.ceil(t),this.mCanvas.height=Math.ceil(e)},Q.prototype.clear=function(){this.mCtx.setTransform(1,0,0,1,0,0),this.mCtx.clearRect(0,0,this.mCanvas.width,this.mCanvas.height)},n.global.Object.defineProperties(Q.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this.mCanvas.width},set:function(t){this.mCanvas.width=t}},height:{configurable:!0,enumerable:!0,get:function(){return this.mCanvas.height},set:function(t){this.mCanvas.height=t}},native:{configurable:!0,enumerable:!0,get:function(){return this.mCanvas}},context:{configurable:!0,enumerable:!0,get:function(){return this.mCtx}}});var $=function(){this.parent=this.gameObject=null,this.endPassRequired=this.skipSelf=this.skipChildren=!1,this.endPassRequiredAt=-1,this.alpha=1,this.blendMode=Y.NORMAL,this.color=null};$.prototype.preRender=function(t,e){this.endPassRequired=null!==this.gameObject.mClipRect&&!1===this.gameObject.mClipRect.isEmpty,this.skipSelf=this.skipChildren=!(0<this.gameObject.mAlpha&&!0===this.gameObject.mVisible)},$.prototype.begin=function(t,e){this.alpha=this.gameObject.mAlpha*this.parent.alpha,this.color=null===this.gameObject.mColor?this.parent.color:this.gameObject.mColor,this.blendMode=this.gameObject.mBlendMode===Y.AUTO?this.parent.blendMode:this.gameObject.mBlendMode},$.prototype.upload=function(t,e){var n=(e=this.gameObject).worldTransformation;t.setSnapToPixels(e.snapToPixels),t.setGlobalAlpha(this.alpha),t.setGlobalBlendMode(this.blendMode),t.setTransform(n),!0===this.endPassRequired&&t.beginClip(e.mClipRect,e.mPivotX,e.mPivotY)},$.prototype.render=function(t,e){},$.prototype.end=function(t,e){t.endClip(),this.endPassRequiredAt=-1,this.endPassRequired=!1},$.getColoredTexture=function(t,e){if(16777215===e||null===e)return t;var n=e.toString();if($.__colorCache.has(t.id,n))return $.__colorCache.get(t.id,n);var i=t.region,r=i.width,o=i.height,a=new Q(r,o),s=a.context;return s.fillStyle=h.hexColorToString(e),s.fillRect(0,0,r,o),s.globalCompositeOperation="multiply",s.drawImage(t.native,i.x,i.y,i.width,i.height,0,0,i.width,i.height),s.globalCompositeOperation="destination-atop",s.drawImage(t.native,i.x,i.y,i.width,i.height,0,0,i.width,i.height),e=new J(a.native,null,t.untrimmedRegion.clone(),t.scale),$.__colorCache.set(t.id,n,e),e},$.__colorCache=new o,$.__dirty=!0,$.skipUnchangedFrames=!1;var tt=function(){var t=X.call(this)||this;return t.mChanged=!0,t.mCenter=new d,t.mMin=new d,t.mMax=new d,t};n.inherits(tt,X),tt.prototype.containsPoint=function(t){return e.error("Abstract method."),!1},tt.prototype.refresh=function(t,e){};var et=function(){var t=X.call(this)||this;return t.touchable=!0,t.mPointerInDispatched=!1,t};n.inherits(et,X);var nt=0,it=function(){var t=E.call(this,!0)||this;return t.mId=++nt,t.mName=null,t.mComponents=[],t.mChildren=[],t.mX=0,t.mY=0,t.mScaleX=1,t.mScaleY=1,t.mPivotX=0,t.mPivotY=0,t.mSkewX=0,t.mSkewY=0,t.mAnchorX=null,t.mAnchorY=null,t.mPivotOffsetX=0,t.mPivotOffsetY=0,t.mRotation=0,t.mBoundsCache=new m,t.mLocalTransform=new f,t.mWorldTransform=new f,t.mWorldTransformInverted=new f,t.mDirty=16777215,t.mParent=null,t.mTag=null,t.mAdded=!1,t.mNumChildrenRemoved=0,t.mNumComponentsRemoved=0,t.mDirtyFrameNum=0,t.mSuspendDirty=!1,t.mCollidersCache=[],t.mChildOrComponentBeenAdded=!1,t.mChildrenClone=null,t.mComponentClone=null,t};n.inherits(it,E),it.prototype.make=function(t){for(var e in this.mSuspendDirty=!0,t)t.hasOwnProperty(e)&&(this[e]=t[e]);return this.mSuspendDirty=!1,this.setTransformDirty(),this},it.prototype.checkStatic=function(t){if(!1===(void 0===t||t))return this.mDirtyFrameNum<T.engine.frameNum;var e=!1;return it.forEach(this,(function(t){if(t.mDirtyFrameNum>=T.engine.frameNum)return e=!0})),!e},it.prototype.onAdded=function(){},it.prototype.onRemoved=function(){},it.prototype.add=function(t){for(var e=[],n=0;n<arguments.length;++n)e[n-0]=arguments[n];for(n=0;n<e.length;n++){var i=e[n];i instanceof it?this.addChild(i):this.addComponent(i)}return this},it.prototype.addChild=function(t){return this.addChildAt(t,this.mChildren.length)},it.prototype.addChildAt=function(t,n){n=void 0===n?0:n,e.assert(t instanceof it,"Type error.");var i=this.mChildren.length;if(0>n||n>i)throw Error("Child index is out of bounds.");return t.mParent===this?this.setChildIndex(t,n):(this.mChildren.splice(n,0,t),t.removeFromParent(),t.__setParent(this),T.engine.onChildrenAdded(t,this),this.mChildOrComponentBeenAdded=!0,t)},it.prototype.__setParent=function(t){for(var e=t;null!==e&&e!==this;)e=e.mParent;if(e===this)throw Error("Object cannot be a child to itself.");return this.mParent=t,this.setTransformDirty(),!0},it.prototype.setChildIndex=function(t,e){var n=this.mChildren.indexOf(t);if(0>n)throw Error("Given child element was not found in children list.");return n===e||(this.mChildren.splice(n,1),this.mChildren.splice(e,0,t),null!==this.stage&&T.engine.onChildrenChanged(t),this.setTransformDirty()),t},it.prototype.removeFromParent=function(){return null!==this.mParent&&this.mParent.removeChild(this),this.setTransformDirty(),this},it.prototype.removeChild=function(t){return 0>(t=this.mChildren.indexOf(t))?null:this.removeChildAt(t)},it.prototype.getChildByName=function(t){for(var e=0;e<this.mChildren.length;e++)if(this.mChildren[e].name===t)return this.mChildren[e];return null},it.prototype.removeChildAt=function(t){if(null==(t=this.mChildren.splice(t,1)[0]))return null;var e=null!==this.stage;return t.__setParent(null),!0===e&&T.engine.onChildrenRemoved(t),this.setTransformDirty(),this.mNumChildrenRemoved++,t},it.prototype.removeAllChildren=function(){for(;0<this.mChildren.length;)this.removeChildAt(0);return this},it.prototype.getChildAt=function(t){return this.mChildren[t]},it.prototype.addComponent=function(t){return this.addComponentAt(t,this.mComponents.length)},it.prototype.addComponentAt=function(t,n){if(n=void 0===n?0:n,e.assert(t instanceof X,"Type error."),t.gameObject)throw Error("Component cannot be added to two game objects at the same time.");var i=this.mComponents.length;if(0>n||n>i)throw Error("Component index is out of bounds.");return this.mComponents.splice(n,0,t),t.mGameObject=this,t instanceof tt&&this.mCollidersCache.push(t),null===this.stage&&T.stage!==this||T.engine.onComponentAdded(this,t),this.mChildOrComponentBeenAdded=!0,t},it.prototype.removeComponentAt=function(t){if(null==(t=this.mComponents.splice(t,1)[0]))return null;if(t.mGameObject=null,t instanceof tt){var e=this.mCollidersCache.indexOf(t);-1<e&&this.mCollidersCache.splice(e,1)}return null===this.stage&&T.stage!==this||T.engine.onComponentRemoved(this,t),this.mNumComponentsRemoved++,t},it.prototype.removeComponent=function(t){return null==t?null:(e.assert(t instanceof X,"Type error."),-1<(t=this.mComponents.indexOf(t))?this.removeComponentAt(t):null)},it.prototype.removeAllComponents=function(){for(;0<this.mComponents.length;)this.removeComponentAt(0);return this},it.prototype.getComponent=function(t){for(var e=0;e<this.mComponents.length;e++){var n=this.mComponents[e];if(n instanceof t)return n}return null},it.prototype.getComponentAt=function(t){return 0<=t&&t<this.mComponents.length?this.mComponents[t]:null},it.prototype.__update=function(){if(this.onUpdate(),!1!==this.mChildOrComponentBeenAdded){if(0<this.mComponents.length){this.mComponentClone=this.mComponents.slice();for(var t=0;t<this.mComponentClone.length&&!1!==this.mAdded;t++){var e=this.mComponentClone[t];!1!==e.mAdded&&!1!==e.enabled&&e.onUpdate()}}if(0<this.mChildren.length)for(this.mChildrenClone=this.mChildren.slice(),t=0;t<this.mChildrenClone.length;t++)!0===(e=this.mChildrenClone[t]).mAdded&&e.__update()}},it.prototype.onUpdate=function(){},it.prototype.onGetLocalBounds=function(t){return(t=t||new m).set(0,0,0,0)},it.prototype.getBounds=function(t,e,n){if(t=void 0===t?null:t,e=void 0===e||e,n=n||new m,this.onGetLocalBounds(n),null==t&&(t=this.mParent),t!=this)if(t==this.mParent)if(!1===e){var i=f.pool.get();i.copyFrom(this.localTransformation),i.transformRect(n,n),f.pool.release(i)}else{if(!(!0===e&&64&this.mDirty))return n.copyFrom(this.mBoundsCache),n;(i=f.pool.get()).copyFrom(this.localTransformation),i.transformRect(n,n),f.pool.release(i)}else(i=f.pool.get()).copyFrom(this.worldTransformation),i.prepend(t.worldTransformationInverted),i.transformRect(n,n),f.pool.release(i);if(!0===e){i=m.pool.get();for(var r=0;r<this.mChildren.length;r++)i.zero(),this.mChildren[r].getBounds(t,e,i),n.union(i);m.pool.release(i),t==this.mParent&&64&this.mDirty&&(this.mBoundsCache.copyFrom(n),this.mDirty^=64)}return n},it.prototype.getStageBounds=function(t){t=t||new m,this.onGetLocalBounds(t);var e=f.pool.get();return e.copyFrom(this.worldTransformation),e.prepend(this.stage.worldTransformationInverted),e.transformRect(t,t),f.pool.release(e),t},it.prototype.hitTest=function(t){var e=this.getComponent(et);e=null!==e&&e.touchable;var n=this.onHitTestMask(t);if(!1===e||!1===n)return null;for(n=this.mChildren.length-1;0<=n;--n)if(null!==(e=this.mChildren[n].hitTest(t)))return e;return!0===this.onHitTest(t)?this:null},it.prototype.onHitTest=function(t){var e=!1,n=d.pool.get();if(this.worldTransformationInverted.transformVector(t,n),0<this.mCollidersCache.length){for(t=0;t<this.mCollidersCache.length;t++)if(!0===(e=this.mCollidersCache[t].containsPoint(n)))return!0}else e=this.localBounds.containsXY(n.x,n.y);return d.pool.release(n),e},it.prototype.onHitTestMask=function(t){return!0},it.prototype.setTransform=function(t,e,n,i,r,o,a,s){return this.mX=void 0===t?0:t,this.mY=void 0===e?0:e,this.mRotation=void 0===n?0:n,this.mScaleX=void 0===i?1:i,this.mScaleY=void 0===r?1:r,this.mAnchorX=void 0===o?0:o,this.mAnchorY=void 0===a?0:a,this.setTransformDirty(),this},it.prototype.relativeTo=function(t,e){return(e=(void 0===e?null:e)||new d).set(this.x,this.y),null==this.parent||null==t||(this.parent.localToGlobal(e,e),t.globalToLocal(e,e)),e},it.prototype.localToGlobal=function(t,e){return this.worldTransformation.transformVector(t,void 0===e?null:e)},it.prototype.globalToLocal=function(t,e){return this.worldTransformationInverted.transformVector(t,void 0===e?null:e)},it.prototype.alignAnchor=function(t,n){return t=void 0===t?.5:t,n=void 0===n?.5:n,e.isNumber(t,n),this.mAnchorX=t,this.anchorY=n,this},it.prototype.alignPivot=function(t,e){return this.alignPivotOffset(void 0===t?.5:t,void 0===e?.5:e)},it.prototype.alignPivotOffset=function(t,n,i){return t=void 0===t?.5:t,n=void 0===n?.5:n,i=void 0===i||i,e.isNumber(t,n),this.getBounds(this,i,m.__cache.zero()),this.mPivotOffsetX=m.__cache.width*t+m.__cache.x,this.mPivotOffsetY=m.__cache.height*n+m.__cache.y,this.__updatePivots(this),this.setTransformDirty(),this},it.prototype.spawn=function(t,e){e=void 0===e?null:e;var n=t.apply(null==e?this:e);return function t(e){e.done||("function"==typeof e.value?e.value((function(e){return t(n.next(e))})):t(n.next(e.value)))}(n.next()),n},it.prototype.wait=function(t){var e=this;return t=void 0===t?1:t,function(n){return setTimeout(n.bind(e,1e3*t),1e3*t)}},it.prototype.waitMessage=function(t){var e=this;return function(n){return e.once(t,n.bind(e))}},it.prototype.setDirty=function(t,e){void 0===e||e?it.forEach(this,(function(e){e.mDirty|=t,e.mDirtyFrameNum=T.engine.frameNum})):(this.mDirty|=t,this.mDirtyFrameNum=T.engine.frameNum),$.__dirty=!0},it.prototype.__updatePivots=function(t){t.getBounds(t,!0,m.__cache.zero()),t.mPivotX=null===t.mAnchorX?t.mPivotOffsetX:t.mPivotOffsetX+m.__cache.width*t.mAnchorX+m.__cache.x,t.mPivotY=null===t.mAnchorY?t.mPivotOffsetY:t.mPivotOffsetY+m.__cache.height*t.mAnchorY+m.__cache.y},it.prototype.setParentDirty=function(t){for(var e=this;null!=e;)e.mDirty|=t,e.mDirtyFrameNum=T.engine.frameNum,e=e.mParent;$.__dirty=!0},it.prototype.setTransformDirty=function(){!0!==this.mSuspendDirty&&(this.setDirty(65,!1),this.setDirty(78,!0),this.setParentDirty(96))},it.prototype.setRenderDirty=function(){!0!==this.mSuspendDirty&&this.setDirty(8,!0)},it.getBoundsWithPoints=function(t,e,n){n=n||new m;for(var i=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=new d,l=0;l<t.length;l+=2)e.transformXY(t[l],t[l+1],s),i>s.x&&(i=s.x),r<s.x&&(r=s.x),o>s.y&&(o=s.y),a<s.y&&(a=s.y);return n.set(i,o,r-i,a-o),n},it.intersects=function(t,e){var n=new d;return t.worldTransformationInverted.transformVector(e,n),t.localBounds.containsXY(n.x,n.y)},it.intersectsAt=function(t,e,n){return n=n||new d,d.__cache.set(),t.worldTransformationInverted.transformVector(e,d.__cache),!1!==t.localBounds.containsXY(d.__cache.x,d.__cache.y)&&(n.x=d.__cache.x-t.localBounds.x,n.y=d.__cache.y-t.localBounds.y,!0)},it.intersectsWith=function(t,e){for(var n=null,i=t.numChildren-1;0<=i;--i){var r=t.mChildren[i];if(null!=(n=it.intersectsWith(r,e)))return n;if(it.intersects(r,e)){n=r;break}}return null===n&&it.intersects(t,e)?t:null},it.findWithTag=function(t){return!1===T.engine.mTagCache.hasOwnProperty(t)?null:T.engine.mTagCache[t]},it.findComponents=function(t,n){e.assert(null!==t,"gameObject cannot be null."),e.assert(null!==n,"type cannot be null.");var i=[],r=function(t,e){for(var n=0;n<t.mComponents.length;n++){var o=t.mComponents[n];o instanceof e&&i.push(o)}for(n=0;n<t.mChildren.length;n++)r(t.mChildren[n],e)};return r(t,n),i},it.forEach=function(t,e){null==t&&(t=T.stage);var n=e(t);if(!0!==n)for(var i=0;i<t.mChildren.length&&!0!==(n=it.forEach(t.mChildren[i],e));i++);},it.find=function(t,e){if(null==e&&(e=T.stage),e.name===t)return e;for(var n=0;n<e.numChildren;n++){var i=it.find(t,e.getChildAt(n));if(null!=i)return i}return null},it.findById=function(t,e){if(null==e&&(e=T.stage),e.id===t)return e;for(var n=0;n<e.numChildren;n++){var i=it.findById(t,e.getChildAt(n));if(null!==i)return i}return null},n.global.Object.defineProperties(it.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this.mId}},numComponents:{configurable:!0,enumerable:!0,get:function(){return this.mComponents.length}},localTransformation:{configurable:!0,enumerable:!0,get:function(){if(1&this.mDirty){if(this.mDirty^=1,0===this.mSkewX&&0===this.mSkewY){if(0===this.mRotation)return this.mLocalTransform.set(this.mScaleX,0,0,this.mScaleY,this.mX-this.mPivotX*this.mScaleX,this.mY-this.mPivotY*this.mScaleY);var t=Math.cos(this.mRotation),e=Math.sin(this.mRotation),n=this.mScaleX*t,i=this.mScaleX*e;return e=this.mScaleY*-e,t*=this.mScaleY,this.mLocalTransform.set(n,i,e,t,this.mX-this.mPivotX*n-this.mPivotY*e,this.mY-this.mPivotX*i-this.mPivotY*t)}this.mLocalTransform.identity(),this.mLocalTransform.scale(this.mScaleX,this.mScaleY),this.mLocalTransform.skew(this.mSkewX,this.mSkewY),this.mLocalTransform.rotate(this.mRotation),n=this.mLocalTransform.data[0],i=this.mLocalTransform.data[1],t=this.mLocalTransform.data[2],e=this.mLocalTransform.data[3];var r=this.mX,o=this.mY;0===this.mPivotX&&0===this.mPivotY||(r=this.mX-n*this.mPivotX-t*this.mPivotY,o=this.mY-i*this.mPivotX-e*this.mPivotY),this.mLocalTransform.data[4]=r,this.mLocalTransform.data[5]=o}return this.mLocalTransform},set:function(t){var e=Math.PI/4,n=t.data[0],r=t.data[1],o=t.data[2],a=t.data[3],s=t.data[4];t=t.data[5],this.mPivotOffsetX=this.mPivotOffsetY=0,this.mAnchorX=null,this.mX=s,this.mY=t,(s=Math.atan(-o/a))!=s&&(s=0),(t=Math.atan(r/n))!=t&&(t=0),this.mScaleY=s>-e&&s<e?a/Math.cos(s):-o/Math.sin(s),this.mScaleX=t>-e&&t<e?n/Math.cos(t):r/Math.sin(t),i.equals(s,t)?(this.mRotation=s,this.mSkewX=this.mSkewY=0):(this.mRotation=0,this.mSkewX=s,this.mSkewY=t),this.setTransformDirty()}},worldTransformation:{configurable:!0,enumerable:!0,get:function(){return 32&this.mDirty&&(null!==this.mAnchorX||null!==this.mAnchorY)&&(this.mDirty^=32,this.__updatePivots(this),this.setDirty(79,!0)),2&this.mDirty&&(this.mDirty^=2,null!==this.mParent?this.mParent.worldTransformation.copyTo(this.mWorldTransform).append(this.localTransformation):this.localTransformation.copyTo(this.mWorldTransform)),this.mWorldTransform}},worldTransformationInverted:{configurable:!0,enumerable:!0,get:function(){return 4&this.mDirty&&(this.mDirty^=4,this.worldTransformation.copyTo(this.mWorldTransformInverted).invert()),this.mWorldTransformInverted}},localBounds:{configurable:!0,enumerable:!0,get:function(){return this.getBounds(this,!1)}},bounds:{configurable:!0,enumerable:!0,get:function(){return this.getBounds(this.mParent,!0)}},numChildren:{configurable:!0,enumerable:!0,get:function(){return this.mChildren.length}},name:{configurable:!0,enumerable:!0,get:function(){return this.mName},set:function(t){this.mName=t}},x:{configurable:!0,enumerable:!0,get:function(){return this.mX},set:function(t){this.mX!=t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mX=t,this.setTransformDirty())}},y:{configurable:!0,enumerable:!0,get:function(){return this.mY},set:function(t){this.mY!=t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mY=t,this.setTransformDirty())}},xy:{configurable:!0,enumerable:!0,get:function(){return new d(this.mX,this.mY)},set:function(t){this.mX===t.x&&this.mY===t.y||(this.mX=t.x,this.mY=t.y,this.setTransformDirty())}},pivotOffsetX:{configurable:!0,enumerable:!0,get:function(){return this.mPivotOffsetX},set:function(t){this.mPivotOffsetX!==t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mPivotOffsetX=t,this.__updatePivots(this),this.setTransformDirty())}},pivotOffsetY:{configurable:!0,enumerable:!0,get:function(){return this.mPivotOffsetY},set:function(t){this.mPivotOffsetY!==t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mPivotOffsetY=t,this.__updatePivots(this),this.setTransformDirty())}},anchorX:{configurable:!0,enumerable:!0,set:function(t){this.mAnchorX!==t&&(e.assert(null!==t&&!isNaN(t),"Value cannot be NaN"),this.mAnchorX=t,this.setTransformDirty())},get:function(){return this.mAnchorX}},anchorY:{configurable:!0,enumerable:!0,set:function(t){this.mAnchorY!==t&&(e.assert(null!==t&&!isNaN(t),"Value cannot be NaN"),this.mAnchorY=t,this.setTransformDirty())},get:function(){return this.mAnchorY}},pivotX:{configurable:!0,enumerable:!0,get:function(){return this.mPivotX}},pivotY:{configurable:!0,enumerable:!0,get:function(){return this.mPivotY}},scaleX:{configurable:!0,enumerable:!0,get:function(){return this.mScaleX},set:function(t){this.mScaleX!=t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mScaleX=t,this.setTransformDirty())}},scaleY:{configurable:!0,enumerable:!0,get:function(){return this.mScaleY},set:function(t){this.mScaleY!=t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mScaleY=t,this.setTransformDirty())}},scale:{configurable:!0,enumerable:!0,get:function(){return this.scaleX},set:function(t){this.mScaleX!=t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mScaleX=this.mScaleY=t,this.setTransformDirty())}},skewX:{configurable:!0,enumerable:!0,get:function(){return this.mSkewX},set:function(t){this.mSkewX!=t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mSkewX=t,this.setTransformDirty())}},skewY:{configurable:!0,enumerable:!0,get:function(){return this.mSkewY},set:function(t){this.mSkewY!=t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mSkewY=t,this.setTransformDirty())}},rotation:{configurable:!0,enumerable:!0,get:function(){return this.mRotation},set:function(t){this.mRotation!=t&&(e.assert(!isNaN(t),"Value cannot be NaN"),this.mRotation=t,this.setTransformDirty())}},parent:{configurable:!0,enumerable:!0,get:function(){return this.mParent}},root:{configurable:!0,enumerable:!0,get:function(){for(var t=this;null!=t.mParent;)t=t.mParent;return t}},stage:{configurable:!0,enumerable:!0,get:function(){return!0===this.mAdded?T.stage:null}},width:{configurable:!0,enumerable:!0,get:function(){return this.getBounds(this.mParent).width},set:function(t){e.assert(!isNaN(t),"Value cannot be NaN"),this.scaleX=1;var n=this.width;0!=n&&(this.scaleX=t/n)}},height:{configurable:!0,enumerable:!0,get:function(){return this.getBounds(this.mParent).height},set:function(t){e.assert(!isNaN(t),"Value cannot be NaN"),this.scaleY=1;var n=this.height;0!=n&&(this.scaleY=t/n)}},localWidth:{configurable:!0,enumerable:!0,get:function(){return this.getBounds(this,!1).width}},localHeight:{configurable:!0,enumerable:!0,get:function(){return this.getBounds(this,!1).height}},path:{configurable:!0,enumerable:!0,get:function(){return null!==this.mParent?this.mParent.path+"/"+this.mName:this.mName}},tag:{configurable:!0,enumerable:!0,get:function(){return this.mTag},set:function(t){if(this.mTag!==t){var e=this.mTag;this.mTag=t,this.mAdded&&T.engine.onTagUpdated(this,e,t)}}},touchable:{configurable:!0,enumerable:!0,set:function(t){var e=this.getComponent(et);!0===t?null===e?this.addComponent(new et):e.touchable=!0:null!==e&&this.removeComponent(e)},get:function(){var t=this.getComponent(et);return null!==t&&!0===t.touchable}}});var rt={NORMAL:"normal",NO_SCALE:"noScale",FIXED:"fixed",LETTERBOX:"letterBox",COVER:"cover"},ot=function(t){this.keyCode=t.keyCode,this.code=t.code,this.char=t.key,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.ctrlKey=t.ctrlKey},at=function(){this.mPixelRatioCache=null};at.prototype.getDevicePixelRatio=function(){return void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?window.screen.systemXDPI/window.screen.logicalXDPI:void 0!==window.devicePixelRatio?window.devicePixelRatio:1},n.global.Object.defineProperties(at.prototype,{os:{configurable:!0,enumerable:!0,get:function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(t)?"Windows Phone":/android/i.test(t)?"Android":/iPad|iPhone|iPod/.test(t)?"iOS":"unknown"}},isTouch:{configurable:!0,enumerable:!0,get:function(){return"ontouchstart"in window||0<navigator.maxTouchPoints}},isMobile:{configurable:!0,enumerable:!0,get:function(){return/Mobi/.test(navigator.userAgent)}},pixelRatio:{configurable:!0,enumerable:!0,get:function(){return null===this.mPixelRatioCache&&(this.mPixelRatioCache=this.getDevicePixelRatio()),this.mPixelRatioCache}},webAudioSupported:{configurable:!0,enumerable:!0,get:function(){return null!=window.AudioContext||null!=window.webkitAudioContext}}});var st=function(){var t=it.call(this)||this;return t.mAlpha=1,t.mBlendMode=Y.AUTO,t.mVisible=!0,t.mClipRect=null,t.mRenderer=t.getRenderer(),t.mCacheAsBitmap=!1,t.mCacheAsBitmapDynamic=!0,t.mCacheAsBitmapDirty=!0,t.mCacheAsBitmapMatrixCache=null,t.mCache=null,t.mCacheBounds=null,t.mColor=null,t.mSnapToPixels=!1,t};n.inherits(st,it),st.prototype.onRender=function(){},st.prototype.getRenderer=function(){return T.driver.getRenderer("DisplayObject",this)},st.prototype.onGetLocalBounds=function(t){return t=t||new m,null!==this.mClipRect?(this.mClipRect.copyTo(t),t):t.set(0,0,0,0)},st.prototype.getBounds=function(t,e,n){e=void 0===e||e,n=n||new m;var i=this.onGetLocalBounds();if(null==t&&(t=this.mParent),t!=this)if(t==this.mParent)if(!1===e||null!==this.mClipRect){var r=f.pool.get();r.copyFrom(this.localTransformation),r.transformRect(i,n),f.pool.release(r)}else{if(!(!0===e&&64&this.mDirty))return n.copyFrom(this.mBoundsCache),n;(r=f.pool.get()).copyFrom(this.localTransformation),r.transformRect(i,n),f.pool.release(r)}else(r=f.pool.get()).copyFrom(this.worldTransformation),r.prepend(t.worldTransformationInverted),r.transformRect(i,n),f.pool.release(r);if(t!==this?null!==this.mClipRect&&(n.x+=this.mPivotX,n.y+=this.mPivotY):i.copyTo(n),null!==this.mClipRect)return n;if(!0===e){for(i=m.pool.get(),r=0;r<this.mChildren.length;r++)i.zero(),this.mChildren[r].getBounds(t,e,i),n.union(i);m.pool.release(i),t==this.mParent&&64&this.mDirty&&(this.mBoundsCache.copyFrom(n),this.mDirty^=64)}return n},st.prototype.hitTest=function(t){var e=this.getComponent(et);e=null!==e&&e.touchable;var n=this.onHitTestMask(t);if(!1===this.visible||!1===e||!1===n)return null;for(n=this.mChildren.length-1;0<=n;--n)if(null!==(e=this.mChildren[n].hitTest(t)))return e;return!0===this.onHitTest(t)?this:null},st.prototype.onHitTestMask=function(t){if(null===this.mClipRect)return!0;var e=d.pool.get();return this.worldTransformationInverted.transformVector(t,e),t=this.mClipRect.containsXY(e.x-this.mPivotX,e.y-this.mPivotY),d.pool.release(e),t},n.global.Object.defineProperties(st.prototype,{color:{configurable:!0,enumerable:!0,get:function(){return this.mColor},set:function(t){this.mColor!==t&&(this.mColor=t,this.setRenderDirty())}},cacheAsBitmap:{configurable:!0,enumerable:!0,get:function(){return this.mCacheAsBitmap},set:function(t){t!==this.mCacheAsBitmap&&(this.mCacheAsBitmap=t,!1===t&&(this.mCache=null,this.mCacheAsBitmapDirty=!0,this.mCacheBounds=this.mCacheAsBitmapMatrixCache=null,this.setTransformDirty()))}},cacheAsBitmapDynamic:{configurable:!0,enumerable:!0,get:function(){return this.mCacheAsBitmapDynamic},set:function(t){this.mCacheAsBitmapDynamic=t}},alpha:{configurable:!0,enumerable:!0,get:function(){return this.mAlpha},set:function(t){e.assert(!isNaN(t),"Value cannot be NaN"),this.mAlpha!==i.clamp(t,0,1)&&(this.mAlpha=i.clamp(t,0,1),this.setRenderDirty())}},visible:{configurable:!0,enumerable:!0,get:function(){return this.mVisible},set:function(t){this.mVisible!==t&&(this.mVisible=t,this.setRenderDirty())}},blendMode:{configurable:!0,enumerable:!0,get:function(){return this.mBlendMode},set:function(t){this.mBlendMode!==t&&(this.mBlendMode=t,this.setRenderDirty())}},clipRect:{configurable:!0,enumerable:!0,get:function(){return this.mClipRect},set:function(t){this.mClipRect=t,this.setRenderDirty()}},snapToPixels:{configurable:!0,enumerable:!0,get:function(){return this.mSnapToPixels},set:function(t){this.mSnapToPixels=t}}});var lt=function(){var t=st.call(this)||this;return T.camera=t};n.inherits(lt,st),n.global.Object.defineProperties(lt.prototype,{worldTransformation:{configurable:!0,enumerable:!0,get:function(){var t=st.prototype.worldTransformation.clone();return t.prepend(this.stage.worldTransformationInverted),t}}});var ht=function(){var t=G.call(this)||this;return e.assert(null==t.constructor.instance,"Only single instance is allowed"),T.input=t,t.mViewportPosition=new d,t.mPointerPosition=new d,t.mStagePosition=new d,t.mDom=null,t.mEventList=null,t.mKeyEventList=null,t.mBoundListeners=[],t.mPointerQueue=[],t.mKeyQueue=[],t.mPressedKeys=[],t.mIsPointerDown=!1,t.mInputListeners=new Map,t.mTarget=null,t.mTargetComponent=null,t.mLockedTarget=null,t.mLastInTargetComponent=null,t.__initialize(),t};n.inherits(ht,G),ht.prototype.__initialize=function(){this.mDom=T.engine.viewport.nativeElement,this.__initListeners()},ht.prototype.__initListeners=function(){var t=this;this.mKeyEventList=ct;var e=!1;window.PointerEvent?(this.mEventList=pt,e=!0):T.device.isTouch&&T.device.isMobile?this.mEventList=ft:(this.mEventList=mt,e=!0);for(var n=0;3>n;n++)this.mDom.addEventListener(this.mEventList[n],(function(e){return t.__onPointerEvent(e)}),!1);for((n=function(e,n,i){var r=function(e){return i.call(t,e)};t.mBoundListeners.push({name:n,listener:r}),e.addEventListener(n,r)})(document,this.mEventList[0],this.__onPointerEventDoc),n(document,this.mEventList[2],this.__onPointerEventDoc),!0===e&&n(window,"wheel",this.__onPointerEventDoc),e=0;e<this.mKeyEventList.length;e++)n(document,this.mKeyEventList[e],this.__onKeyEvent)},ht.prototype.__onKeyEvent=function(t){return!0!==T.engine.isPaused&&(this.mKeyQueue.push(t),!0)},ht.prototype.__onPointerEventDoc=function(t){if(!0!==T.engine.isPaused){for(var e=!1,n=t.target;n;){if(n===this.mDom){e=!0;break}n=n.parentElement}"wheel"===t.type?!0===e&&this.__pushEvent(t):!1===e&&!0===this.mIsPointerDown&&this.__pushEvent(t)}},ht.prototype.__onPointerEvent=function(t){return!0!==T.engine.isPaused&&(t.preventDefault(),this.__pushEvent(t),!0)},ht.prototype.__pushEvent=function(t){var e=0===t.type.indexOf("touch")?this.__getTouchPos(this.mDom,t):this.__getPointerPos(this.mDom,t);this.mPointerQueue.push({e:t,x:e.x,y:e.y})},ht.prototype.__getPointerPos=function(t,e){var n=t.getBoundingClientRect(),i=T.engine.viewport.rotation;return new d((0===i?t.clientWidth:t.clientHeight)/n.width*(e.clientX-n.left),(0===i?t.clientHeight:t.clientWidth)/n.height*(e.clientY-n.top))},ht.prototype.__getTouchPos=function(t,e){var n=t.getBoundingClientRect();e=e.changedTouches[0];var i=T.engine.viewport.rotation;return new d((0===i?t.clientWidth:t.clientHeight)/n.width*(e.clientX-n.left),(0===i?t.clientHeight:t.clientWidth)/n.height*(e.clientY-n.top))},ht.prototype.onUpdate=function(){this.__updateKeyboard();for(var t=T.engine.viewport.size,e=T.engine.viewport.rotation,n=T.stage;0<this.mPointerQueue.length;){var i=this.mPointerQueue.shift(),r=i.x,o=i.y;1===e?(i.x=o,i.y=t.height-r):-1===e&&(i.x=t.width-o,i.y=r),this.mPointerPosition.x=i.x,this.mPointerPosition.y=i.y,this.mViewportPosition.copyFrom(this.mPointerPosition),null!==T.camera&&T.camera.worldTransformation.transformVector(this.mPointerPosition,this.mPointerPosition),this.mStagePosition.copyFrom(this.mPointerPosition),n.worldTransformationInverted.transformVector(this.mStagePosition,this.mStagePosition),r=dt[this.mEventList.indexOf(i.e.type)],this.__findTarget(this.mPointerPosition),this.__processNativeEvent(i,this.mPointerPosition,r)}},ht.prototype.__findTarget=function(t){null===(t=T.stage.hitTest(t))?this.mTargetComponent=this.mTarget=null:(this.mTarget=t,this.mTargetComponent=t.getComponent(et))},ht.prototype.__processNativeEvent=function(t,e,n){n===ht.POINTER_DOWN?this.mIsPointerDown=!0:n===ht.POINTER_UP&&(this.mIsPointerDown=!1);var i=0;if(n===ht.WHEEL&&(i=0<t.e.deltaY?1:-1),t=new gt(this.mTarget,e.x,e.y,t.e.button,i),this.post(n,t),null!==this.mTarget||null!==this.mLockedTarget){if(n===ht.POINTER_DOWN)this.mLockedTarget=this.mTarget;else if(n===ht.POINTER_UP&&null!==this.mLockedTarget)return this.mLockedTarget.post("~pointerUp",t),void(this.mLockedTarget=null);e=this.mTarget===this.mLockedTarget,null===this.mLockedTarget?null!==this.mTarget&&this.mTarget.post("~"+n,t):!0===e?this.mLockedTarget.post("~"+n,t):null!==this.mLockedTarget.mParent&&null!==this.mTarget&&this.mLockedTarget.mParent.post("~"+n,t)}},ht.prototype.__updateKeyboard=function(){for(;0<this.mKeyQueue.length;){var t=this.mKeyQueue.shift(),e=this.mKeyEventList.indexOf(t.type),n=this.mPressedKeys.indexOf(t.keyCode);"keyUp"===(e=ut[e])&&-1!==n?this.mPressedKeys.splice(n,1):"keyDown"===e&&-1===n&&(this.mPressedKeys.push(t.keyCode),e="keyPress"),this.post(e,new ot(t),t)}},ht.prototype.dispose=function(){for(G.prototype.dispose.call(this);0<this.mBoundListeners.length;){var t=this.mBoundListeners.pop();document.removeEventListener(t.name,t.listener)}T.input=null},n.global.Object.defineProperties(ht.prototype,{isPointerDown:{configurable:!0,enumerable:!0,get:function(){return this.mIsPointerDown}},pointerX:{configurable:!0,enumerable:!0,get:function(){return this.mPointerPosition.x}},pointerY:{configurable:!0,enumerable:!0,get:function(){return this.mPointerPosition.y}},stageX:{configurable:!0,enumerable:!0,get:function(){return this.mStagePosition.x}},stageY:{configurable:!0,enumerable:!0,get:function(){return this.mStagePosition.y}},viewportPosition:{configurable:!0,enumerable:!0,get:function(){return this.mViewportPosition}},pointerPosition:{configurable:!0,enumerable:!0,get:function(){return this.mPointerPosition}},stagePosition:{configurable:!0,enumerable:!0,get:function(){return this.mStagePosition}},pressedKeys:{configurable:!0,enumerable:!0,get:function(){return this.mPressedKeys}}}),n.global.Object.defineProperties(ht,{POINTER_DOWN:{configurable:!0,enumerable:!0,get:function(){return"pointerDown"}},POINTER_MOVE:{configurable:!0,enumerable:!0,get:function(){return"pointerMove"}},POINTER_UP:{configurable:!0,enumerable:!0,get:function(){return"pointerUp"}},WHEEL:{configurable:!0,enumerable:!0,get:function(){return"wheel"}}});var ct=["keydown","keyup"],ut=["keyDown","keyUp","keyPress"],dt="pointerMove pointerDown pointerUp pointerIn pointerOut wheel".split(" "),pt="pointermove pointerdown pointerup pointerenter pointerleave wheel".split(" "),mt="mousemove mousedown mouseup mouseenter mouseleave wheel".split(" "),ft=["touchmove","touchstart","touchend","touchenter","touchleave"],gt=function(t,e,n,i,r){this.mActiveObject=t,this.mX=e,this.mY=n,this.mButton=i,this.mDelta=void 0===r?0:r};n.global.Object.defineProperties(gt.prototype,{delta:{configurable:!0,enumerable:!0,get:function(){return this.mDelta}},button:{configurable:!0,enumerable:!0,get:function(){return this.mButton}},activeObject:{configurable:!0,enumerable:!0,get:function(){return this.mActiveObject}},x:{configurable:!0,enumerable:!0,get:function(){return this.mX}},y:{configurable:!0,enumerable:!0,get:function(){return this.mY}}});var vt=function(){var t=it.call(this)||this;if(t.mName="stage",t.mScaleMode=rt.NORMAL,t.mWidth=960,t.mHeight=640,t.mStageWidth=0,t.mStageHeight=0,t.mStageScaleFactor=0,t.mCacheWidth=0,t.mCacheHeight=0,t.mDPR=T.device.getDevicePixelRatio(),t.mAdded=!0,T.engine.hasSystem(ht)){var e=new et;e.mAdded=!0,t.addComponent(e)}return t};n.inherits(vt,it),vt.prototype.setSize=function(t,e){this.mWidth=t,this.mHeight=e,this.__refresh()},vt.prototype.onUpdate=function(){var t=T.engine.viewport.size;this.mCacheWidth===t.width&&this.mCacheHeight===t.height||(this.mCacheWidth=t.width,this.mCacheHeight=t.height,this.__refresh())},vt.prototype.refresh=function(){this.__refresh()},vt.prototype.__refresh=function(){var t=T.engine.viewport.size,n=t.width;if(t=t.height,this.mScaleMode===rt.FIXED){var i=Math.max(n*this.mHeight/t/n,t*this.mWidth/n/t),r=n*i;i*=t,this.mStageWidth=r,this.mStageHeight=i,this.mScaleX=this.mScaleY=this.mStageScaleFactor=Math.min(n/r,t/i)}else this.mScaleMode===rt.LETTERBOX||this.mScaleMode===rt.COVER?(r=this.mScaleMode===rt.COVER?Math.max(n/this.mWidth,t/this.mHeight):Math.min(n/this.mWidth,t/this.mHeight),this.mX=(n-this.mWidth*r)/2,this.mY=(t-this.mHeight*r)/2,this.mStageWidth=this.mWidth,this.mStageHeight=this.mHeight,this.mScaleX=this.mScaleY=this.mStageScaleFactor=r):this.mScaleMode===rt.NORMAL?(this.mStageWidth=n,this.mStageHeight=t,this.mScaleX=this.mScaleY=this.mStageScaleFactor=1):this.mScaleMode===rt.NO_SCALE?(this.mStageWidth=n*this.mDPR,this.mStageHeight=t*this.mDPR,this.mScaleX=this.mScaleY=this.mStageScaleFactor=1/this.mDPR):e.error("Not supported stage scale mode.");this.mStageWidth=Math.round(this.mStageWidth),this.mStageHeight=Math.round(this.mStageHeight),this.mX=Math.round(this.mX),this.mY=Math.round(this.mY),T.driver.__onResize(null,null),this.setTransformDirty(),this.mLocalTransform.set(this.mScaleX,0,0,this.mScaleY,this.mX,this.mY),this.post(x.RESIZE)},vt.prototype.getBounds=function(t,e,n){return(n=n||new m).set(-this.mX/this.mStageScaleFactor,-this.mY/this.mStageScaleFactor,this.mStageWidth+2*this.mX/this.mStageScaleFactor,this.mStageHeight+2*this.mY/this.mStageScaleFactor)},vt.prototype.onGetLocalBounds=function(t){return(t=t||new m).set(0,0,this.mStageWidth,this.mStageHeight)},vt.prototype.removeFromParent=function(){e.error("Not allowed.")},n.global.Object.defineProperties(vt.prototype,{scaleMode:{configurable:!0,enumerable:!0,get:function(){return this.mScaleMode},set:function(t){this.mScaleMode=t,this.__refresh()}},scaleFactor:{configurable:!0,enumerable:!0,get:function(){return this.mStageScaleFactor}},renderWidth:{configurable:!0,enumerable:!0,get:function(){return this.mStageWidth*this.mDPR*this.mStageScaleFactor}},renderHeight:{configurable:!0,enumerable:!0,get:function(){return this.mStageHeight*this.mDPR*this.mStageScaleFactor}},centerX:{configurable:!0,enumerable:!0,get:function(){return.5*this.mStageWidth}},centerY:{configurable:!0,enumerable:!0,get:function(){return.5*this.mStageHeight}},localTransformation:{configurable:!0,enumerable:!0,get:function(){return this.mLocalTransform},set:function(t){e.error("Not allowed.")}},scaleX:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return 1}},scaleY:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return 1}},pivotOffsetX:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return 0}},pivotOffsetY:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return 0}},anchorX:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return 0}},anchorY:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return 0}},x:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return this.mX/this.mStageScaleFactor}},y:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return this.mY/this.mStageScaleFactor}},rotation:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return 0}},width:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return this.mStageWidth}},height:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return this.mStageHeight}},name:{configurable:!0,enumerable:!0,set:function(t){e.error("Not allowed.")},get:function(){return this.mName}}});var yt=function(t,e,n,i){for(var r=tt.call(this)||this,o=[],a=[],s=0;4>s;s++)o.push(new d),a.push(new d);return r.mRect=new m,r.mNormals=o,r.mVertices=a,r.mLocalMin=new d,r.mLocalMax=new d,r.mLocalCenter=new d,r.set(t,e,n,i),r};n.inherits(yt,tt),yt.prototype.set=function(t,e,n,i){return this.mRect.set(t,e,n,i),this.mChanged=!0,this},yt.prototype.refresh=function(t,e){var n=this.mLocalMin,i=this.mLocalMax,r=this.mMin,o=this.mMax,a=this.mLocalCenter,s=this.mCenter;if(this.mChanged){var l=this.mVertices,h=this.mNormals,c=this.mRect,u=d.pool.get();t.transformVector(u.set(0,-1),h[0]),t.transformVector(u.set(1,0),h[1]),t.transformVector(u.set(0,1),h[2]),t.transformVector(u.set(-1,0),h[3]);for(var p=0;4>p;p++)h[p].normalize();t.transformVector(u.set(c.x,c.y),l[0]),t.transformVector(u.set(c.x+c.width,c.y),l[1]),t.transformVector(u.set(c.x+c.width,c.y+c.height),l[2]),t.transformVector(u.set(c.x,c.y+c.height),l[3]),a.set((l[0].x+l[2].x)/2,(l[0].y+l[2].y)/2),n.x=Math.min(l[0].x,l[1].x,l[2].x,l[3].x),n.y=Math.min(l[0].y,l[1].y,l[2].y,l[3].y),i.x=Math.max(l[0].x,l[1].x,l[2].x,l[3].x),i.y=Math.max(l[0].y,l[1].y,l[2].y,l[3].y),d.pool.release(u)}r.x=n.x+e.x,r.y=n.y+e.y,o.x=i.x+e.x,o.y=i.y+e.y,s.x=a.x+e.x,s.y=a.y+e.y},yt.prototype.containsPoint=function(t){return this.mRect.containsXY(t.x,t.y)};var bt=function(t,e,n){var i=tt.call(this)||this;return i.mCircle=new g(t,e,n),i.mLocalCenter=new d,i.mLocalMin=new d,i.mLocalMax=new d,i.mRadius=0,i.set(t,e,n),i};n.inherits(bt,tt),bt.prototype.set=function(t,e,n){return this.mCircle.set(t,e,n),this.mChanged=!0,this},bt.prototype.refresh=function(t,e){var n=this.mLocalMin,i=this.mLocalMax,r=this.mMin,o=this.mMax,a=this.mLocalCenter,s=this.mCenter;if(this.mChanged){var l=this.mCircle,h=l.r*Math.sqrt(t.data[0]*t.data[0]+t.data[1]*t.data[1]);t.transformXY(l.x,l.y,a),this.mRadius=h,n.x=a.x-h,n.y=a.y-h,i.x=a.x+h,i.y=a.y+h}r.x=n.x+e.x,r.y=n.y+e.y,o.x=i.x+e.x,o.y=i.y+e.y,s.x=a.x+e.x,s.y=a.y+e.y},bt.prototype.containsPoint=function(t){if(null===this.gameObject)return!1;var e=this.mCircle,n=d.pool.get();return t=n.set(e.x,e.y).distance(t),d.pool.release(n),t<=e.r};var _t=function(t,e,n){return e=new Q(t*n,e*n),(t=J.call(this,e.native)||this).set(e.native,null,null,1/n),t.renderTarget=e,t};n.inherits(_t,J),_t.prototype.resize=function(t,e,n){this.renderTarget.resize(t*n,e*n),this.set(this.renderTarget.native,null,null,1/n)},_t.prototype.__dumpToDocument=function(){var t=new Image;t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.background="#333",t.style.width="256px",t.style.height="auto",t.src=this.mNative.toDataURL("image/png"),document.body.appendChild(t)};var xt=function(t,e,n){return(t=J.call(this,t,null,null,n=void 0===n?1:n)||this).mSubTextures={},t.__parseAtlasData(e,n),t};n.inherits(xt,J),xt.prototype.__parseAtlasData=function(t,e){for(var n in t.frames){var i=t.frames[n],r=new m(i[0],i[1],i[2],i[3]),o=new m(i[4],i[5],i[6],i[7]),a=null,s=null;10===i.length?a=new d(i[8],i[9]):12===i.length?s=new m(i[8],i[9],i[10],i[11]):14===i.length&&(a=new d(i[8],i[9]),s=new m(i[10],i[11],i[12],i[13])),this.mSubTextures[n]=new J(this.native,r,o,e,a,s)}},xt.prototype.getTexture=function(t){var n=this.mSubTextures[t];return e.assertWarn(void 0!==n,"Texture '"+t+"' was not found"),n},xt.prototype.getTextures=function(t,e){if(e=(void 0===e?null:e)||[],null===(t=void 0===t?null:t)){for(var n in this.mSubTextures)e.push(this.mSubTextures[n]);return e}for(var i in n=[],t=new RegExp("^"+t.split("*").join(".*")+"$"),this.mSubTextures)t.test(i)&&n.push(i);for(xt.naturalSort(n),i=0;i<n.length;i++)e.push(this.mSubTextures[n[i]]);return e},xt.naturalSort=function(t,e){t.sort(xt.__naturalComparer(void 0===e?null:e))},xt.__naturalComparer=function(t,e){return t=void 0===t?null:t,e=void 0===e||e,function(n,i){var r=/(-?\d*\.?\d+)/g;n=String(null==t?n:n[t]).split(r),i=String(null==t?i:i[t]).split(r),r=Math.min(n.length,i.length);for(var o=0;o<r;o++){if(e)var a=Math.abs(parseFloat(n[o]))||n[o].toLowerCase(),s=Math.abs(parseFloat(i[o]))||i[o].toLowerCase();else a=parseFloat(n[o])||n[o].toLowerCase(),s=parseFloat(i[o])||i[o].toLowerCase();if(a<s)return-1;if(a>s)return 1}return 0}},n.global.Object.defineProperties(xt.prototype,{subTextures:{configurable:!0,enumerable:!0,get:function(){return this.mSubTextures}}});var wt={TEXTURE:"texture",TEXTURE_ATLAS:"textureAtlas",VECTOR_TEXTURE:"vectorTexture",VECTOR_TEXTURE_ATLAS:"vectorTextureAtlas",FONT:"font",BITMAP_FONT:"bitmapFont",XML:"xml",JSON:"json",VECTOR_GRAPHICS:"vectorGraphics",SOUND:"sound",SOUND_ATLAS:"soundAtlas"},Mt={FONT_FACE:"fontFace",IMAGE:"image",XHR:"xhr"},St=function(t){var e=E.call(this)||this;return e.mUrl=t,e.mData=null,e.mIsLoaded=!1,e.mNumOwners=0,e};n.inherits(St,E),St.prototype.load=function(){},St.prototype.abort=function(){1<this.mNumOwners||this.onAbort()},St.prototype.onAbort=function(){},St.prototype.onLoad=function(){this.mIsLoaded=!0,this.post(x.COMPLETE)},St.prototype.onError=function(){this.mIsLoaded=!1,this.post(x.ERROR)},n.global.Object.defineProperties(St.prototype,{data:{configurable:!0,enumerable:!0,get:function(){return this.mData}},url:{configurable:!0,enumerable:!0,get:function(){return this.mUrl}}});var Tt=function(t){return(t=St.call(this,t)||this).mImageElement=new Image,t.mImageElement.crossOrigin="anonymous",t};n.inherits(Tt,St),Tt.prototype.load=function(){var t=this;this.mData=this.mImageElement,this.mImageElement.onload=function(){return t.onLoad()},this.mImageElement.onerror=function(){return t.onError()},this.mImageElement.src=this.mUrl},Tt.prototype.onAbort=function(){this.mImageElement.onload=this.mImageElement.onabort=this.mImageElement.onerror=function(){},this.mImageElement.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYmBgAAgwAAAMAAMjcmNcAAAAAElFTkSuQmCC"};var Et=function(t){return(t=St.call(this,t)||this).mRequest=new XMLHttpRequest,t.mimeType=void 0,t.responseType="",t};n.inherits(Et,St),Et.prototype.load=function(){var t=this;this.mRequest.open("GET",this.mUrl,!0),""!=this.responseType&&(this.mRequest.responseType=this.responseType),null!=this.mRequest.overrideMimeType&&this.mimeType&&this.mRequest.overrideMimeType(this.mimeType),this.mRequest.onreadystatechange=function(){4===t.mRequest.readyState&&(200===t.mRequest.status||0===t.mRequest.status&&t.mRequest.responseText?(t.mData=""===t.responseType||"text"===t.responseType?t.mRequest.responseText:t.mRequest.response,t.onLoad()):t.onError())},this.mRequest.send(null)},Et.prototype.onAbort=function(){this.mRequest.abort()};var At=function(t,e,n){return(e=St.call(this,e)||this).mName=t,e.mTestingFontName="Courier New",e.mIsLocal=n,e.mTestingString="~ GHBDTN,.#$Mlck",e.mCheckDelay=50,e.mTestingElement=e.__getTestingElement(),e.metrics=null,e.mLoaderElement=e.__getLoaderElement(e.mIsLocal),e.mTestingElement.style.fontFamily=e.mTestingFontName,e.mDefaultFontWidth=e.mTestingElement.offsetWidth,e.mTestingElement.style.fontFamily='"'+t+'",'+e.mTestingFontName,e.mTimeoutHandle=-1,e};n.inherits(At,St),At.prototype.load=function(){this.mIsLocal?this.mLoaderElement.innerHTML+='\n @font-face {font-family: "'+this.mName+'"; src: url('+this.mUrl+");}":this.mLoaderElement.href=this.mUrl,this.__checkLoadingStatus()},At.prototype.onAbort=function(){clearTimeout(this.mTimeoutHandle),this.mTestingElement.parentNode.removeChild(this.mTestingElement)},At.prototype.__getLoaderElement=function(t){var e=this;return(t=document.createElement(t?"style":"link")).type="text/css",t.media="all",t.rel="stylesheet",t.onerror=function(){e.onError()},document.getElementsByTagName("head")[0].appendChild(t),t},At.prototype.__getTestingElement=function(){var t=document.createElement("span");return t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",t.style.visibility="hidden",t.style.fontSize="250px",t.innerHTML=this.mTestingString,document.body.appendChild(t),t},At.prototype.__checkLoadingStatus=function(){this.mDefaultFontWidth===this.mTestingElement.offsetWidth?this.mTimeoutHandle=setTimeout(this.__checkLoadingStatus.bind(this),this.mCheckDelay):(this.metrics=D.get(this.mName),this.mTestingElement.parentNode.removeChild(this.mTestingElement),this.onLoad())};var Ct=function(t,e){var n=E.call(this)||this;return n.mType=t,n.mName=e,n.mData=null,n.mLoaders=[],n.mNumLoaded=0,n.mIsReady=!1,n.mBindings=[],n};n.inherits(Ct,E),Ct.prototype.addLoader=function(t){return this.mLoaders.push(t),t.mNumOwners++,this.mBindings.push(t.on(x.COMPLETE,this.__onLoaderComplete,this)),this.mBindings.push(t.on(x.ERROR,this.__onLoaderError,this)),t},Ct.prototype.onLoaderRequested=function(t){},Ct.prototype.__onLoaderComplete=function(t){this.mNumLoaded++,this.mNumLoaded===this.mLoaders.length&&(this.mBindings.forEach((function(t){return t.off()})),this.onAllLoaded())},Ct.prototype.__onLoaderError=function(t){this.abort(),this.post(x.ERROR)},Ct.prototype.onAllLoaded=function(){},Ct.prototype.abort=function(){this.mNumLoaded=0,this.mBindings.forEach((function(t){return t.off()}));for(var t=0;t<this.mLoaders.length;t++)this.mLoaders[t].abort()},Ct.prototype.ready=function(t){this.mData=t,this.mIsReady=!0,this.post(x.COMPLETE)},n.global.Object.defineProperties(Ct.prototype,{type:{configurable:!0,enumerable:!0,get:function(){return this.mType}},name:{configurable:!0,enumerable:!0,get:function(){return this.mName}},data:{configurable:!0,enumerable:!0,get:function(){return this.mData}},isReady:{configurable:!0,enumerable:!0,get:function(){return this.mIsReady}},loaders:{configurable:!0,enumerable:!0,get:function(){return this.mLoaders}}});var Pt=function(t,e){return(t=Ct.call(this,wt.TEXTURE,t)||this).mUrl=e,t.mScale=1/J.getScaleFactorFromName(e),t.mImageLoader=null,t};n.inherits(Pt,Ct),Pt.prototype.onLoaderRequested=function(t){this.mImageLoader=t.get(Mt.IMAGE,this.mUrl),this.addLoader(this.mImageLoader)},Pt.prototype.onAllLoaded=function(){Ct.prototype.ready.call(this,new J(this.mImageLoader.data,null,null,this.mScale))};var Lt=function(t,e){return(t=Ct.call(this,wt.JSON,t)||this).mUrl=e,t.mXHR=null,t};n.inherits(Lt,Ct),Lt.prototype.onLoaderRequested=function(t){this.mXHR=t.get(Mt.XHR,this.mUrl),this.mXHR.mimeType="application/json",this.mXHR.responseType="json",this.addLoader(this.mXHR)},Lt.prototype.onAllLoaded=function(){Ct.prototype.ready.call(this,this.mXHR.data)};var Rt=function(t,e){return(t=Ct.call(this,wt.XML,t)||this).mUrl=e,t.mXHR=null,t};n.inherits(Rt,Ct),Rt.prototype.onLoaderRequested=function(t){this.mXHR=t.get(Mt.XHR,this.mUrl),this.mXHR.mimeType="text/xml",this.addLoader(this.mXHR)},Rt.prototype.onAllLoaded=function(){Ct.prototype.ready.call(this,(new DOMParser).parseFromString(this.mXHR.data,"text/xml"))};var Ot=function(t,e,n){var i=Ct.call(this,wt.FONT,t)||this;return!1===n&&(e="https://fonts.googleapis.com/css?family="+t.replace(/ /g,"+")),i.mUrl=e,i.mIsLocal=n,i};n.inherits(Ot,Ct),Ot.prototype.onLoaderRequested=function(t){t=t.get(Mt.FONT_FACE,this.mName,this.mUrl,this.mIsLocal),this.addLoader(t)},Ot.prototype.onAllLoaded=function(){Ct.prototype.ready.call(this)};var It=function(t,e,n){return(t=Ct.call(this,wt.TEXTURE_ATLAS,t)||this).mImageUrl=e,t.mDataUrl=n,t.mScale=1/J.getScaleFactorFromName(e),t.mImageLoader=null,t.mXHR=null,t};n.inherits(It,Ct),It.prototype.onLoaderRequested=function(t){this.mImageLoader=t.get(Mt.IMAGE,this.mImageUrl),this.addLoader(this.mImageLoader),this.mXHR=t.get(Mt.XHR,this.mDataUrl),this.mXHR.mimeType="application/json",this.mXHR.responseType="json",this.addLoader(this.mXHR)},It.prototype.onAllLoaded=function(){Ct.prototype.ready.call(this,new xt(this.mImageLoader.data,this.mXHR.data,this.mScale))};var Nt=function(t,e,n){return(t=Ct.call(this,wt.BITMAP_FONT,t)||this).mImageUrl=e,t.mXmlUrl=n,t.mScale=1/J.getScaleFactorFromName(e),t.mImageLoader=null,t.mXHR=null,t};n.inherits(Nt,Ct),Nt.prototype.onLoaderRequested=function(t){this.mImageLoader=t.get(Mt.IMAGE,this.mImageUrl),this.addLoader(this.mImageLoader),this.mXHR=t.get(Mt.XHR,this.mXmlUrl),this.mXHR.mimeType="text/xml",this.addLoader(this.mXHR)},Nt.prototype.onAllLoaded=function(){var t=(new DOMParser).parseFromString(this.mXHR.data,"text/xml"),e=new J(this.mImageLoader.data,null,null,this.mScale);Ct.prototype.ready.call(this,Nt.parse(t,e))},Nt.parse=function(t,e){var n=new Dt;n.texture=e,n.xml=t;var i=t.getElementsByTagName("info")[0],r=t.getElementsByTagName("common")[0];for(n.name=i.getAttribute("face"),n.size=parseInt(i.getAttribute("size"),10),n.lineHeight=parseInt(r.getAttribute("lineHeight"),10),n.baseline=parseInt(r.getAttribute("base"),10),n.chars={},i=t.getElementsByTagName("char"),r=0;r<i.length;r++){var o=i[r],a=parseInt(o.getAttribute("id"),10),s=parseInt(o.getAttribute("x"),10)+e.region.x,l=parseInt(o.getAttribute("y"),10)+e.region.y,h=parseInt(o.getAttribute("width"),10),c=parseInt(o.getAttribute("height"),10),u=parseInt(o.getAttribute("xoffset"),10),d=parseInt(o.getAttribute("yoffset"),10);o=parseInt(o.getAttribute("xadvance"),10),s=new m(s,l,h,c),(l=new Bt).texture=new J(e.native,s),l.xOffset=u,l.yOffset=d,l.width=h,l.height=c,l.xAdvance=o,n.chars[a]=l}for(t=t.getElementsByTagName("kerning"),e=0;e<t.length;e++)a=t[e],i=parseInt(a.getAttribute("first"),10),r=parseInt(a.getAttribute("second"),10),a=parseInt(a.getAttribute("amount"),10),n.chars[r]&&(n.chars[r].kerning[i]=a);return n};var Dt=function(){this.xml=this.texture=null,this.name="",this.lineHeight=this.size=0,this.chars={},this.baseline=0},Bt=function(){this.texture=null,this.xAdvance=this.height=this.width=this.yOffset=this.xOffset=0,this.kerning={}},Ft={NEWBORN:"newborn",PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped",COMPLETED:"completed"},kt=function(){this.mOutputNode=this.mInputNode=null};n.global.Object.defineProperties(kt.prototype,{_inputNode:{configurable:!0,enumerable:!0,get:function(){return e.assert(null!=this.mInputNode,"Input node must be specified in descendant class"),this.mInputNode}},_outputNode:{configurable:!0,enumerable:!0,get:function(){return e.assert(null!=this.mOutputNode,"Output node must be specified in descendant class"),this.mOutputNode}}});var Ut=function(){var t=kt.call(this)||this;return t.mGainL=T.audio._newGainNode(),t.mGainR=T.audio._newGainNode(),t.mSplitter=T.audio.context.createChannelSplitter(2),t.mMerger=T.audio.context.createChannelMerger(2),t.mSplitter.connect(t.mGainL,0),t.mSplitter.connect(t.mGainR,1),t.mGainL.connect(t.mMerger,0,0),t.mGainR.connect(t.mMerger,0,1),t.mValue=0,t.mInputNode=t.mSplitter,t.mOutputNode=t.mMerger,t};n.inherits(Ut,kt),n.global.Object.defineProperties(Ut.prototype,{pan:{configurable:!0,enumerable:!0,set:function(t){this.mValue=i.clamp(t,-1,1),this.mGainL.gain.setValueAtTime(1-i.clamp(this.mValue,0,1),0),this.mGainR.gain.setValueAtTime(1+i.clamp(this.mValue,-1,0),0)},get:function(){return this.mValue}}});var zt=0,Ht=function(t){var e=E.call(this)||this;return e.mId=++zt,e.mSound=t,e.mState=Ft.NEWBORN,e.mChannel="master",e.mVolume=1,e.mLoop=!1,e.mStartTime=0,e.mPausePosition=0,e.mStopPosition=0,e.mSrc=null,e.mGainNode=T.audio._newGainNode(),e.mFirstNode=e.mGainNode,e.mPlayNode=null,e.mSpatialPanner=null,e.mStereoPanner=null,e.mAnalyser=null,e};n.inherits(Ht,E),Ht.prototype.enableSpacePan=function(){return null==this.mSpatialPanner&&(this.mSpatialPanner=T.audio.context.createPanner(),this.mFirstNode&&(this.mSpatialPanner.connect(this.mFirstNode),this.mFirstNode=this.mSpatialPanner),this.__reconnectSource()),this.mSpatialPanner},Ht.prototype.enableStereoPan=function(){return null==this.mStereoPanner&&(this.mStereoPanner=new Ut,this.mFirstNode&&(this.mStereoPanner._outputNode.connect(this.mFirstNode),this.mFirstNode=this.mStereoPanner._inputNode),this.__reconnectSource()),this.mStereoPanner},Ht.prototype.enableAnalyser=function(){return null==this.mAnalyser&&(this.mAnalyser=T.audio.context.createAnalyser(),this.mFirstNode&&(this.mAnalyser.connect(this.mFirstNode),this.mFirstNode=this.mAnalyser),this.__reconnectSource()),this.mAnalyser},Ht.prototype.__reconnectSource=function(){null!=this.mSrc&&null!=this.mPlayNode&&null!=this.mFirstNode&&(this.mSrc.disconnect(this.mPlayNode),this.mSrc.connect(this.mFirstNode),this.mPlayNode=this.mFirstNode)},Ht.prototype._play=function(){var t=this;if(this.mState===Ft.PLAYING)return this;this.mState=Ft.PLAYING;var e=this.mSound.isSubClip&&!this.mLoop?this.mSound.duration-this.mPausePosition:void 0;this.mGainNode.gain.setValueAtTime(this.mVolume,0);var n=T.audio.context.createBufferSource();return n.buffer=this.mSound.native,n.loop=this.mLoop,n.onended=function(){return t.__onComplete()},this.mFirstNode&&n.connect(this.mFirstNode),this.mPlayNode=this.mFirstNode,this.mStartTime=T.audio.context.currentTime-this.mPausePosition,this.mLoop&&this.mSound.isSubClip&&(n.loopStart=this.mSound.offset,n.loopEnd=this.mSound.offset+this.mSound.duration),n.start(T.audio.context.currentTime,this.mSound.offset+this.mPausePosition,e),T.audio._resolveChannel(this),this.mSrc=n,this},Ht.prototype.stop=function(t){t=void 0===t?0:t,this.mState===Ft.PLAYING&&(this.mStopPosition=this.currentPosition,this.mGainNode.gain.cancelScheduledValues(0),this.mSrc.stop(T.audio.context.currentTime+t),this.mState=Ft.STOPPED)},Ht.prototype.pause=function(){this.mState===Ft.PLAYING&&(this.mPausePosition=this.currentPosition,this.stop(),this.mState=Ft.PAUSED)},Ht.prototype.resume=function(){this.mState===Ft.PAUSED&&this._play()},Ht.prototype.fade=function(t,e,n,i){i=void 0===i?"linear":i,0>=(n=void 0===n?0:n)?this.mGainNode.gain.setValueAtTime(e,0):(this.mGainNode.gain.setValueAtTime(t,0),"exp"===i?this.mGainNode.gain.exponentialRampToValueAtTime(Math.max(e,.01),T.audio.context.currentTime+n):this.mGainNode.gain.linearRampToValueAtTime(e,T.audio.context.currentTime+n))},Ht.prototype.__onComplete=function(){this.mSrc=null,this.mState!==Ft.PAUSED&&(this.mStartTime=0,this.mState=Ft.COMPLETED,this.post(x.COMPLETE))},n.global.Object.defineProperties(Ht.prototype,{currentPosition:{configurable:!0,enumerable:!0,get:function(){switch(this.mState){case Ft.PLAYING:return(T.audio.context.currentTime-this.mStartTime)%(this.mSound.duration+.01);case Ft.PAUSED:return this.mPausePosition;case Ft.COMPLETED:return this.mSound.duration;case Ft.STOPPED:return this.mStopPosition}return 0}},_outputNode:{configurable:!0,enumerable:!0,get:function(){return this.mGainNode}},channel:{configurable:!0,enumerable:!0,get:function(){return this.mChannel},set:function(t){this.mChannel!==t&&(this.mChannel=t,this.mState===Ft.PLAYING&&T.audio._resolveChannel(this))}},volume:{configurable:!0,enumerable:!0,get:function(){return this.mVolume},set:function(t){this.mVolume=t,this.mGainNode.gain.setValueAtTime(this.mVolume,0)}},loop:{configurable:!0,enumerable:!0,get:function(){return this.mLoop},set:function(t){this.mLoop=t}},pan:{configurable:!0,enumerable:!0,get:function(){return this.mStereoPanner.pan},set:function(t){0!==t&&null==this.mStereoPanner&&this.enableStereoPan(),this.mStereoPanner&&(this.mStereoPanner.pan=t)}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return this.mState===Ft.PLAYING}},duration:{configurable:!0,enumerable:!0,get:function(){return this.mSound.duration}}});var Gt=function(t){this.mName=t,this.mGain=T.audio._newGainNode(),this.mSounds=[],this.mEffects=[]};Gt.prototype.attachSound=function(t){var n=this;e.assert(null!=t,"Sound cannot be null"),t._outputNode.connect(this._inputNode),this.mSounds.push(t),t.on(x.COMPLETE,(function(){n.mSounds.splice(n.mSounds.indexOf(t),1),t._outputNode.disconnect(0)}))},Gt.prototype.detachSound=function(t){e.assert(null!=t,"Sound cannot be null");var n=this.mSounds.indexOf(t);-1<n&&(this.mSounds.splice(n,1),t._outputNode.disconnect(0))},Gt.prototype.stopAll=function(){for(var t=this.mSounds[0];this.mSounds.length;t=this.mSounds.shift())t.stop()},Gt.prototype.pauseAll=function(){for(var t=0;t<this.mSounds.length;t++)this.mSounds[t].pause()},Gt.prototype.resumeAll=function(){for(var t=0;t<this.mSounds.length;t++)this.mSounds[t].resume()},Gt.prototype.addEffect=function(t){return e.assert(null!=t,"Effect cannot be null"),t._outputNode.connect(this._inputNode),this.mEffects.unshift(t),this.__reconnectSounds(),t},Gt.prototype.removeEffect=function(t){return e.assert(null!=t,"Effect cannot be null"),t._outputNode.disconnect(0),this.mEffects.splice(this.mEffects.indexOf(t),1),this.__reconnectSounds(),t},Gt.prototype.removeAllEffects=function(){for(;this.mEffects.length;this.mEffects.shift())this.mEffects[0]._outputNode.disconnect(0);this.__reconnectSounds()},Gt.prototype.__reconnectSounds=function(){var t=this;this.mSounds.forEach((function(e){e._outputNode.disconnect(0),e._outputNode.connect(t._inputNode)}))},n.global.Object.defineProperties(Gt.prototype,{volume:{configurable:!0,enumerable:!0,set:function(t){this.mGain.gain.setValueAtTime(t,0)},get:function(){return this.mGain.gain.value}},_inputNode:{configurable:!0,enumerable:!0,get:function(){return this.mEffects.length?this.mEffects[0]._inputNode:this.mGain}},_outputNode:{configurable:!0,enumerable:!0,get:function(){return this.mGain}}});var Vt=function(){var t=G.call(this)||this;return T.audio=t,t.mContext=null,t.mCurrentListener=null,t.mChannels={},t.mMasterChannel=null,t.mIsPendingResume=!1,t.mPendingResume=0,t.mResumeTimeout=.1,t.__initialize(),t};n.inherits(Vt,G),Vt.prototype.onPause=function(){null!==this.mContext&&("running"===this.mContext.state&&this.mContext.suspend(),this.mIsPendingResume=!1)},Vt.prototype.onResume=function(){this.mPendingResume=this.mResumeTimeout,this.mIsPendingResume=!0},Vt.prototype.onUpdate=function(){this.mIsPendingResume&&(this.mPendingResume-=T.time.delta,0>=this.mPendingResume&&null!==this.mContext&&("suspended"===this.mContext.state||"interrupted"===this.mContext.state)&&(this.mContext.resume(),this.mIsPendingResume=!1))},Vt.prototype.__initialize=function(){try{this.mContext=new(window.AudioContext||window.webkitAudioContext)}catch(t){if(null==this.mContext)return void e.warn("no audio support")}this.__unlock(),this.mMasterChannel=new Gt("master"),this.mMasterChannel._outputNode.connect(this.mContext.destination),this.mChannels.master=this.mMasterChannel},Vt.prototype.dispose=function(){G.prototype.dispose.call(this),null!==this.mContext&&(this.stopAll(),this.mContext.close()),this.mIsPendingResume=!1,T.audio=null},Vt.prototype.__unlock=function(){var t=this,e=function(){var n=t.mContext.createBuffer(1,1,22050),i=t.mContext.createBufferSource();i.buffer=n,i.connect(t.mContext.destination),void 0===i.start?i.noteOn(0):i.start(0),"suspended"===i.context.state&&i.context.resume(),document.removeEventListener("touchstart",e),document.removeEventListener("click",e)};document.addEventListener("touchstart",e),document.addEventListener("click",e)},Vt.prototype.createChannel=function(t){if(null==this.mChannels[t]){var e=new Gt(t);e._outputNode.connect(this.mMasterChannel._inputNode),this.mChannels[t]=e}return this.mChannels[t]},Vt.prototype.getChannel=function(t){return this.mChannels[t]},Vt.prototype._resolveChannel=function(t){for(var e in this.mChannels)this.mChannels[e].detachSound(t);return(e=this.mChannels[""==t.channel?"master":t.channel]).attachSound(t),e},Vt.prototype.play=function(t,n,i,r,o){n=void 0===n?"master":n,i=void 0===i?1:i,r=void 0!==r&&r,o=void 0===o?0:o,e.assert(null!=t,"Param 'nameOrSound' cannot be null.");var a=null;return t.constructor===String&&(a=T.assets.getSound(t)),a.play(n,i,r,o)},Vt.prototype.stopAll=function(t){if(null===(t=void 0===t?null:t))for(var e in this.mChannels)this.mChannels[e].stopAll();else this.getChannel(t).stopAll()},Vt.prototype.pauseAll=function(t){if(null===(t=void 0===t?null:t))for(var e in this.mChannels)this.mChannels[e].pauseAll();else this.getChannel(t).pauseAll()},Vt.prototype.resumeAll=function(t){if(null===(t=void 0===t?null:t))for(var e in this.mChannels)this.mChannels[e].resumeAll();else this.getChannel(t).resumeAll()},Vt.prototype.looseListener=function(){this.mContext.listener.setPosition(0,0,1),this.mCurrentListener=null},Vt.prototype._newGainNode=function(){return void 0===this.mContext.createGain?this.mContext.createGainNode():this.mContext.createGain()},n.global.Object.defineProperties(Vt.prototype,{masterVolume:{configurable:!0,enumerable:!0,set:function(t){this.mMasterChannel.volume=t},get:function(){return this.mMasterChannel.volume}},context:{configurable:!0,enumerable:!0,get:function(){return this.mContext}},masterChannel:{configurable:!0,enumerable:!0,get:function(){return this.mMasterChannel}},currentListener:{configurable:!0,enumerable:!0,set:function(t){this.mCurrentListener=t},get:function(){return this.mCurrentListener}},resumeTimeout:{configurable:!0,enumerable:!0,get:function(){return this.mResumeTimeout},set:function(t){this.mResumeTimeout=t}}});var jt=function(t,e,n,i){n=void 0===n?NaN:n,this.mNativeBuffer=t,this.mStartOffset=void 0===e?0:e,this.mDuration=n||t.duration,this.mIsSubClip=void 0!==i&&i};jt.prototype.play=function(t,e,n,i){t=void 0===t?"master":t,e=void 0===e?1:e,n=void 0!==n&&n,i=void 0===i?0:i;var r=new Ht(this);return r.channel=t,r.volume=e,r.loop=n,r.pan=i,r._play()},jt.prototype.collectWaveData=function(t){for(var e=[],i=0;i<this.mNativeBuffer.numberOfChannels;i++)e[i]=this.mNativeBuffer.getChannelData(i);var r=this.mDuration/this.mNativeBuffer.duration,o=~~(this.mStartOffset/this.mNativeBuffer.duration*e[0].length);i=o+~~(e[0].length*r);var a=new Float32Array(t);t=~~(e[0].length*r/t),r=[];for(var s=0;o<i;o++)if(r.push(this.__averagePeak(e,o)),r.length>=t){var l=Math.max.apply(Math,n.arrayFromIterable(r));r=Math.min.apply(Math,n.arrayFromIterable(r)),a[s++]=(l+r)/2,r=[]}return a},jt.prototype.__averagePeak=function(t,e){var n=0;return t.forEach((function(t){return n+=Math.abs(t[e])})),n/t.length},n.global.Object.defineProperties(jt.prototype,{native:{configurable:!0,enumerable:!0,get:function(){return this.mNativeBuffer}},offset:{configurable:!0,enumerable:!0,get:function(){return this.mStartOffset}},duration:{configurable:!0,enumerable:!0,get:function(){return this.mDuration}},isSubClip:{configurable:!0,enumerable:!0,get:function(){return this.mIsSubClip}}});var Wt=function(t,n){return t=Ct.call(this,wt.SOUND,t)||this,!1===T.device.webAudioSupported?t:!1===T.engine.hasSystem(Vt)?(e.warn("[SoundAsset] Loading sound files without MasterAudio system."),t):(t.mUrl=n,t.mXHR=null,t)};n.inherits(Wt,Ct),Wt.prototype.onLoaderRequested=function(t){this.mXHR=t.get(Mt.XHR,this.mUrl),this.mXHR.responseType="arraybuffer",this.addLoader(this.mXHR)},Wt.prototype.onAllLoaded=function(){var t=this;T.audio.context.decodeAudioData(this.mXHR.data,(function(e){Ct.prototype.ready.call(t,new jt(e))}))};var Xt=function(t,e){if((t=jt.call(this,t)||this).mClips={},null!==e)for(var n in e.sounds)t.addSubSound(n,e.sounds[n][0],e.sounds[n][1]);return t};n.inherits(Xt,jt),Xt.prototype.addSubSound=function(t,e,n){return n=void 0===n?NaN:n,this.mClips[t]=new jt(this.native,void 0===e?0:e,n,!0),this.mClips[t]},Xt.prototype.removeSubSound=function(t){delete this.mClips[t]},Xt.prototype.playSubSound=function(t,e,n,i,r){return e=void 0===e?"master":e,n=void 0===n?1:n,i=void 0!==i&&i,r=void 0===r?0:r,null==(t=this.mClips[t])?null:((t=new Ht(t)).channel=e,t.volume=n,t.loop=i,t.pan=r,t._play())},n.global.Object.defineProperties(Xt.prototype,{subSounds:{configurable:!0,enumerable:!0,get:function(){return this.mClips}}});var Yt=function(t,n,i){return(t=Ct.call(this,wt.SOUND_ATLAS,t)||this).mSoundUrl=n,t.mDataUrl=i,!1===T.device.webAudioSupported?t:!1===T.engine.hasSystem(Vt)?(e.warn("[SoundAsset] Loading sound files without MasterAudio system."),t):(t.mAudioXHR=null,t.mDataXHR=null,t)};n.inherits(Yt,Ct),Yt.prototype.onLoaderRequested=function(t){this.mAudioXHR=t.get(Mt.XHR,this.mSoundUrl),this.mAudioXHR.responseType="arraybuffer",this.addLoader(this.mAudioXHR),this.mDataXHR=t.get(Mt.XHR,this.mDataUrl),this.mDataXHR.mimeType="application/json",this.mDataXHR.responseType="json",this.addLoader(this.mDataXHR)},Yt.prototype.onAllLoaded=function(){var t=this;T.audio.context.decodeAudioData(this.mAudioXHR.data,(function(e){Ct.prototype.ready.call(t,new Xt(e,t.mDataXHR.data))}))};var qt={LINE_STYLE:"lineStyle",FILL_STYLE:"fillStyle",ARC:"arc",RECT:"rect",ROUNDED_RECT:"roundedRect",BEZIER_CURVE_TO:"bezierCurveTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEGIN_PATH:"beginPath",CLOSE_PATH:"closePath",FILL:"fill",LINE_TO:"lineTo",MOVE_TO:"moveTo",STROKE:"stroke",BOUNDS:"bounds",SHADOW_COLOR:"shadowColor",SHADOW_BLUR:"shadowBlur",LINE_DASH:"setLineDash",FILL_GRD:"gradientFillStyle",FILL_PATTERN:"patternFillStyle"},Zt=function(t,e){this.type=t,this.data=e};Zt.prototype.getNumber=function(t){return this.data[t]},Zt.prototype.getString=function(t){return this.data[t]},Zt.prototype.getBoolean=function(t){return this.data[t]},Zt.prototype.getObject=function(t){return this.data[t]};var Jt=function(){this.bounds=null,this.points=[],this.lastLineWidth=this.maxLineWidth=0,this.lineMul=.5},Kt={BEVEL:"bevel",MITER:"miter",ROUND:"round"},Qt=function(){this.stops={},this.native=null};Qt.prototype.addColorStop=function(t,e){this.stops[t]=e,this.native=null};var $t=function(t,e,n,i){var r=Qt.call(this)||this;return r.x0=t,r.y0=e,r.x1=n,r.y1=i,r.isAbsolute=!1,r};n.inherits($t,Qt),$t.prototype.addColorStop=function(t,e){this.stops[t]=e,this.native=null},$t.prototype.clone=function(){var t=new $t(this.x0,this.y0,this.x1,this.y1);for(var e in t.isAbsolute=this.isAbsolute,this.stops)t.stops[e]=this.stops[e];return t};var te={NONE:"none",ROUND:"round",SQUARE:"square"},ee=function(){this.mNodes=[],this.mTransform=new f,this.mCommandQueue=[],this.mPosY=this.mPosX=this.mPivotY=this.mPivotX=0,this.mName=null};ee.prototype.onGetLocalBounds=function(t,e){var n=new Jt,i=this.mCommandQueue.length,r=(e=e.clone().append(this.mTransform)).data,o=Math.sqrt(r[0]*r[0]+r[1]*r[1]);r=Math.sqrt(r[2]*r[2]+r[3]*r[3]);for(var a=0;a<i;a++){var s=this.mCommandQueue[a];switch(s.type){case qt.BEGIN_PATH:n.bounds&&(e.transformRect(n.bounds,n.bounds),t.mLocalBounds=t.mLocalBounds?t.mLocalBounds.union(n.bounds):n.bounds),n=new Jt;break;case qt.BOUNDS:for(var l=0;l<s.data.length;l+=2)n.points.push(s.getNumber(l),s.getNumber(l+1));break;case qt.LINE_STYLE:n.lastLineWidth=s.getNumber(0),s.getString(4)===Kt.MITER&&(n.lineMul=1);break;case qt.FILL:0!==n.points.length&&(s=m.fromPointsXY(n.points),n.bounds=n.bounds?n.bounds.union(s):s);break;case qt.STROKE:n.lastLineWidth>n.maxLineWidth&&(n.maxLineWidth=n.lastLineWidth),0===n.maxLineWidth&&(n.maxLineWidth=1),n.maxLineWidth*=n.lineMul,0!==n.points.length&&(s=m.fromPointsXY(n.points),1<n.points.length&&s.inflate(n.maxLineWidth*o,n.maxLineWidth*r),n.bounds=n.bounds?n.bounds.union(s):s)}}for(n.bounds&&(e.transformRect(n.bounds,n.bounds),t.mLocalBounds=t.mLocalBounds?t.mLocalBounds.union(n.bounds):n.bounds),n=0,i=this.mNodes.length;n<i;n++)this.mNodes[n].onGetLocalBounds(t,e);return t.mLocalBounds},ee.prototype.lineStyle=function(t,n,i,r,o,a){t=void 0===t?0:t,n=void 0===n?0:n,i=void 0===i?1:i,r=void 0===r?te.NONE:r,o=void 0===o?Kt.MITER:o,a=void 0===a?3:a,e.isNumber(t,n,i,a),0>=t||this.__pushCommand(qt.LINE_STYLE,t,n,i,r,o,a)},ee.prototype.shadowBlur=function(t){e.isNumber(t),this.__pushCommand(qt.SHADOW_BLUR,t)},ee.prototype.shadowColor=function(t,n){e.isNumber(t,n),this.__pushCommand(qt.SHADOW_COLOR,t,n)},ee.prototype.fillStyle=function(t,n){t=void 0===t?0:t,n=void 0===n?1:n,e.isNumber(t,n),this.__pushCommand(qt.FILL_STYLE,t,n)},ee.prototype.fillGradient=function(t){t instanceof $t&&this.__pushCommand(qt.FILL_GRD,t)},ee.prototype.fillPattern=function(t){this.__pushCommand(qt.FILL_PATTERN,t)},ee.prototype.clear=function(){this.mPosY=this.mPosX=0,this.mCommandQueue=[],this.mNodes=[],this.beginPath()},ee.prototype.moveTo=function(t,e){this.mPosX=t,this.mPosY=e,this.__pushCommand(qt.MOVE_TO,t,e)},ee.prototype.lineTo=function(t,e){this.mPosX=t,this.mPosY=e,this.__pushCommand(qt.LINE_TO,t,e),this.__pushCommand(qt.BOUNDS,this.mPosX,this.mPosY,t,e)},ee.prototype.arc=function(t,e,r,o,a,s){s=void 0!==s&&s;var l=!1,h=0,c=0,u=[];if(o!==a){if(Math.abs(o-a)>=i.PI2)u.push(t-r,e-r,t+r,e+r),c=g.getCircumferencePoint(t,e,r,a+.5*Math.PI),l=!0,a=o+i.PI2,h=c.x,c=c.y;else{var d=o%i.PI2+(0>o?i.PI2:0),p=a;for(s&&(p=d,d=a);p<d;)p+=i.PI2;var m=0===d||p>=i.PI2,f=d<=Math.PI&&p>=Math.PI||p>=3*Math.PI,v=d<=.5*Math.PI&&p>=.5*Math.PI||p>=2.5*Math.PI,y=d<=1.5*Math.PI&&p>=1.5*Math.PI||p>=3.5*Math.PI;if(!f||!m)var b=Math.cos(d)*r,_=Math.cos(p)*r;if(!y||!v)var x=Math.sin(d)*r,w=Math.sin(p)*r;u.push((f?-r:Math.min(b,_))+t,(y?-r:Math.min(x,w))+e,(m?r:Math.max(b,_))+t,(v?r:Math.max(x,w))+e)}this.__pushCommand(qt.ARC,t,e,r,o,a,s),this.__pushCommand.apply(this,[qt.BOUNDS].concat(n.arrayFromIterable(u))),!0===l&&this.__pushCommand(qt.MOVE_TO,h,c)}},ee.prototype.circle=function(t,e,n){this.__pushCommand(qt.ARC,t,e,n,0,i.PI2),this.__pushCommand(qt.BOUNDS,t-n,e-n,t+n,e+n)},ee.prototype.rect=function(t,n,i,r){e.isNumber(t,n,i,r),this.__pushCommand(qt.RECT,t,n,i,r),this.__pushCommand(qt.BOUNDS,t,n,t+i,n+r)},ee.prototype.roundedRect=function(t,n,i,r,o){e.isNumber(t,n,i,r,o),this.__pushCommand(qt.ROUNDED_RECT,t,n,i,r,o),this.__pushCommand(qt.BOUNDS,t,n,t+i,n+r)},ee.prototype.bezierCurveTo=function(t,e,n,i,r,o){var a=this.__bezierRange(this.mPosX,t,n,r,d.pool.get()),s=this.__bezierRange(this.mPosY,e,i,o,d.pool.get());this.mPosX=r,this.mPosY=o,this.__pushCommand(qt.BEZIER_CURVE_TO,t,e,n,i,r,o),this.__pushCommand(qt.BOUNDS,a.x,s.x,a.y,s.y),d.pool.release(a),d.pool.release(s)},ee.prototype.quadraticCurveTo=function(t,e,n,i){var r=this.__quadraticRange(this.mPosX,t,n,d.pool.get()),o=this.__quadraticRange(this.mPosY,e,i,d.pool.get());this.mPosX=n,this.mPosY=i,this.__pushCommand(qt.QUADRATIC_CURVE_TO,t,e,n,i),this.__pushCommand(qt.BOUNDS,r.x,o.x,r.y,o.y),d.pool.release(r),d.pool.release(o)},ee.prototype.__bezierRange=function(t,e,n,i,r){r=r||new d;var o=n-2*e+t-(i-2*n+e),a=2*(e-t)-2*(n-e),s=a*a-4*o*(t-e),l=Math.min(t,i),h=Math.max(t,i);if(0<=s){var c=1/(2*o);o=(-a+(s=Math.sqrt(s)))*c,a=(-a-s)*c,o=isFinite(o)?o:.5,a=isFinite(a)?a:.5,0<o&&1>o&&(s=this.__bezierDot(t,e,n,i,o),l=Math.min(s,l),h=Math.max(s,h)),0<a&&1>a&&(t=this.__bezierDot(t,e,n,i,a),l=Math.min(t,l),h=Math.max(t,h))}return r.x=l,r.y=h,r},ee.prototype.__bezierDot=function(t,e,n,i,r){var o=1-r;return t*o*o*o+3*e*r*o*o+3*n*r*r*o+i*r*r*r},ee.prototype.__quadraticRange=function(t,e,n,i){var r=n-t,o=(e-=t)/r;return r=t+(0>o||1<o?e*e/(2*e-r):0),i.x=Math.min(t,n,r),i.y=Math.max(t,n,r),i},ee.prototype.beginPath=function(){this.__pushCommand(qt.BEGIN_PATH)},ee.prototype.closePath=function(){this.__pushCommand(qt.CLOSE_PATH)},ee.prototype.setLineDash=function(t){this.__pushCommand(qt.LINE_DASH,t)},ee.prototype.stroke=function(){this.__pushCommand(qt.STROKE)},ee.prototype.fill=function(t){this.__pushCommand(qt.FILL,t)},ee.prototype.__pushCommand=function(t,e){for(var n=[],i=1;i<arguments.length;++i)n[i-1]=arguments[i];n=new Zt(t,n),this.mCommandQueue.push(n)},ee.prototype.searchNode=function(t,e){if((e=void 0===e?this:e).name===t)return e;for(var n=0,i=e.mNodes.length;n<i;n++){var r=this.searchNode(t,e.mNodes[n]);if(r)return r}},n.global.Object.defineProperties(ee.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.mName},set:function(t){this.mName=t}}});var ne=function(){this.data=null};ne.prototype.parse=function(t){return this.data=t,null};var ie=function(t,e){this.image=t,this.repetition=e,this.native=null};ie.prototype.clone=function(){return new ie(this.image,this.repetition)};var re={NONE_ZERO:"nonzero",EVEN_ODD:"evenodd"},oe=function(){this.L="-",this.w=this.l=1,this.F="0",this.r=this.f=1,this.c="b",this.j="m",this.m=4,this.a=1,this.d="",this.needsFill=!0,this.needsStroke=!1,this.fillColor=0,this.fillAlpha=1,this.lineColor=0,this.lineWidth=this.lineAlpha=1,this.lineCap=te.NONE,this.lineJoin=Kt.MITER,this.miterLimit=this.m,this.fillRule=re.NONE_ZERO,this.lineDash=[]};oe.prototype.merge=function(t){t.F&&(this.F=t.F),t.L&&(this.L=t.L),t.w&&(this.w=t.w),t.l&&(this.l*=t.l),t.f&&(this.f*=t.f),t.r&&(this.r=t.r),t.c&&(this.c=t.c),t.j&&(this.j=t.j),t.m&&(this.m=t.m),t.a&&(this.a=t.a),t.d&&(this.d=t.d)},oe.prototype.compute=function(){(this.needsFill="-"!==this.F)&&(this.fillColor=parseInt(this.F,16)),this.lineWidth=+this.w,(this.needsStroke="-"!==this.L&&0<this.lineWidth)&&(this.lineColor=parseInt(this.L,16));var t=Number(this.a);this.lineAlpha=Number(this.l)*t,this.fillAlpha=Number(this.f)*t,this.lineCap={b:te.NONE,r:te.ROUND,s:te.SQUARE}[this.c],this.lineJoin={m:Kt.MITER,r:Kt.ROUND,b:Kt.BEVEL}[this.j],this.miterLimit=Number(this.m),this.fillRule={1:re.NONE_ZERO,0:re.EVEN_ODD}[this.r],this.lineDash=this.d.split(",").map((function(t){return Number(t)}))},oe.prototype.clone=function(){var t=new oe;return t.L=this.L,t.l=this.l,t.w=this.w,t.F=this.F,t.f=this.f,t.r=this.r,t.c=this.c,t.j=this.j,t.m=this.m,t.a=this.a,t};var ae=function(t,e){t=void 0===t?null:t,e=void 0!==e&&e;var n=st.call(this)||this;return n.mBounds=new m,n.mLocalBounds=null,n.mGraphicsData=null,n.mDataOffsetX=0,n.mDataOffsetY=0,n.mTrim=e,n.mGraphicsData=null===t?new ee:"string"==typeof t?T.assets.getGraphicsData(t):t,e&&(n.mGraphicsData.onGetLocalBounds(n,new f),n.mLocalBounds&&(n.mDataOffsetX=n.mLocalBounds.x,n.mDataOffsetY=n.mLocalBounds.y,n.mLocalBounds=null)),n};n.inherits(ae,st),ae.prototype.getRenderer=function(){return T.driver.getRenderer("Graphics",this)},ae.prototype.onGetLocalBounds=function(t){return t=t||new m,null!==this.mClipRect?(this.mClipRect.copyTo(t),t):(this.mGraphicsData.onGetLocalBounds(this,new f),this.mLocalBounds&&t.copyFrom(this.mLocalBounds),this.mLocalBounds=null,this.mTrim||(t.width+=Math.max(0,t.x),t.height+=Math.max(0,t.y),t.x=Math.min(0,t.x),t.y=Math.min(0,t.y)),t)},ae.prototype.lineStyle=function(t,e,n,i,r,o){i=void 0===i?te.NONE:i,r=void 0===r?Kt.MITER:r,this.mGraphicsData.lineStyle(void 0===t?0:t,void 0===e?0:e,void 0===n?1:n,i,r,void 0===o?3:o)},ae.prototype.shadowBlur=function(t){this.mGraphicsData.shadowBlur(t)},ae.prototype.shadowColor=function(t,e){this.mGraphicsData.shadowColor(t,void 0===e?1:e)},ae.prototype.fillStyle=function(t,e){this.mGraphicsData.fillStyle(void 0===t?0:t,void 0===e?1:e)},ae.prototype.fillGradient=function(t){this.mGraphicsData.fillGradient(t)},ae.prototype.fillPattern=function(t){this.mGraphicsData.fillPattern(t)},ae.prototype.clear=function(){this.mBounds.zero(),this.mGraphicsData.clear(),this.setTransformDirty()},ae.prototype.moveTo=function(t,e){this.mGraphicsData.moveTo(t,e)},ae.prototype.lineTo=function(t,e){this.mGraphicsData.lineTo(t,e)},ae.prototype.arc=function(t,e,n,i,r,o){this.mGraphicsData.arc(t,e,n,i,r,void 0!==o&&o)},ae.prototype.circle=function(t,e,n){this.mGraphicsData.circle(t,e,n)},ae.prototype.rect=function(t,e,n,i){this.mGraphicsData.rect(t,e,n,i)},ae.prototype.roundedRect=function(t,e,n,i,r){this.mGraphicsData.roundedRect(t,e,n,i,r)},ae.prototype.bezierCurveTo=function(t,e,n,i,r,o){this.mGraphicsData.bezierCurveTo(t,e,n,i,r,o)},ae.prototype.quadraticCurveTo=function(t,e,n,i){this.mGraphicsData.quadraticCurveTo(t,e,n,i)},ae.prototype.beginPath=function(){this.mGraphicsData.beginPath()},ae.prototype.closePath=function(){this.mGraphicsData.closePath()},ae.prototype.setLineDash=function(t){this.mGraphicsData.setLineDash(t)},ae.prototype.stroke=function(){this.mGraphicsData.stroke(),this.setTransformDirty()},ae.prototype.fill=function(t){this.mGraphicsData.fill(void 0===t||t),this.setTransformDirty()},ae.prototype.createLinearGradient=function(t,e,n,i){return new $t(t,e,n,i)};var se=function(){return this.data=null,this._defs={},this};n.inherits(se,ne),se.prototype.parse=function(t){ne.prototype.parse.call(this,t);var e=this.__parseStyles(t.styles);return this._defs={},this.__parseDefs(t.defs,this._defs),this.__traverse(t,e,new ee,new oe)},se.prototype.__traverse=function(t,e,i,r){var o=this,a=this._defs,s=new ee,l=r.clone();if(i.mNodes.push(s),t.id&&(s.name=t.id),i=t.t){var c=i[0]||0,u=i[1]||0,d=i[2]||1,p=i[3]||1,f=i[5]||0,g=i[6]||0;s.mTransform.rotate(i[4]||0),s.mTransform.scale(d,p),s.mTransform.skew(i[7]||0,i[8]||0),s.mTransform.data[4]=c+f/d,s.mTransform.data[5]=u+g/p,s.mPivotX=f,s.mPivotY=g}if(t.cmds)for(i=t.cmds.split("$").filter((function(t){return t})).reverse(),c=new m,u="";0<i.length;){switch(d=(f=i.pop())[0],p=f.slice(1).split(",").map((function(t){return Number(t)})),s.beginPath(),"S"!==u&&"S"!==d&&(s.fillStyle(0,1),s.lineStyle(1,0,1,te.NONE,Kt.MITER,4)),u=d,d){case"S":p=e[p[0]],(l=r.clone()).merge(p),l.compute();break;case"p":this.__drawPath(f,s);break;case"r":f=p[0],g=p[1];var v=p[2],y=p[3],b=(void 0===p[4]?p[5]:p[4])||0,_=(void 0===p[5]?p[4]:p[5])||0;c.set(f,g,v,y),0!==b&&0!==_?(s.moveTo(f,g+_),s.quadraticCurveTo(f,g,f+b,g),s.lineTo(f+v-b,g),s.quadraticCurveTo(f+v,g,f+v,g+_),s.lineTo(f+v,g+y-_),s.quadraticCurveTo(f+v,g+y,f+v-b,g+y),s.lineTo(f+b,g+y),s.quadraticCurveTo(f,g+y,f,g+y-_),s.closePath()):s.rect(p[0],p[1],p[2],p[3]);break;case"c":f=2*p[2],c.set(0,0,f,f),s.circle(p[0],p[1],p[2]);break;case"e":for(f=p[0],g=p[1],v=p[2],y=p[3],p=this.__arcToBezier(f-v,g,v,y,0,0,0,f+v,g),y=this.__arcToBezier(f+v,g,v,y,0,0,0,f-v,g),p=[].concat(n.arrayFromIterable(p),n.arrayFromIterable(y)),s.moveTo(f-v,g),f=0,g=p.length;f<g;f++)v=p[f],s.bezierCurveTo(v[2],v[3],v[4],v[5],v[6],v[7]);break;case"l":f=p[2],g=p[3],s.moveTo(p[0],p[1]),s.lineTo(f,g);break;case"s":case"g":for(p=f.slice(1).split(",").map((function(t){return Number(t)})),s.moveTo(p[0],p[1]),f=2,g=p.length;f<g;f+=2)s.lineTo(p[f],p[f+1]);"g"===d&&s.closePath()}if(l.needsFill&&"S"!==d){if(this.__isRef(l.F)){if((d=a[l.F.slice(1)].clone())instanceof ie)s.fillPattern(d);else if(d instanceof $t){for(var x in d.isAbsolute||(d.x0*=c.width,d.x1*=c.width,d.y0*=c.height,d.y1*=c.height),d.stops)d.stops[x]=h.intToRGBA(parseInt(d.stops[x].slice(1),16),l.fillAlpha);s.fillGradient(d)}}else s.fillStyle(l.fillColor,l.fillAlpha);s.fill(l.fillRule===re.NONE_ZERO)}l.needsStroke&&(s.lineStyle(l.lineWidth,l.lineColor,l.lineAlpha,l.lineCap,l.lineJoin,l.miterLimit),s.setLineDash(l.lineDash),s.stroke())}return t.nodes&&t.nodes.forEach((function(t){o.__traverse(t,e,s,l)})),s},se.prototype.__isRef=function(t){return 0===t.indexOf("$")},se.prototype.__parseDefs=function(t,e){if(!t)return e;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];if("string"==typeof i)switch(i.charAt(0)){case"R":var r=(i=i.slice(1).split(" "))[0].split(",").map((function(t){return parseFloat(t)})),o=new $t(r[0],r[1],r[2],r[3]);o.isAbsolute=0===r[4],e[n]=o,r=1;for(var a=i.length;r<a;r++){var s=i[r].split(","),l="#"+s[1];o.addColorStop(parseFloat(s[0]),l)}}else o=this.__parseStyles(i.s),o=this.__traverse(i,o,new ee,new oe),o=new ae(o),r=new _t(o.width,o.height,T.driver.renderScaleFactor),T.driver.render(o,r,new f),e[n]=new ie(r.native,i.r)}return e},se.prototype.__parseStyles=function(t){return t?t.map((function(t){var e={};return t.split(" ").forEach((function(t){e[t[0]]=t.slice(1)})),e})):[]},se.prototype.__drawPath=function(t,e){var n=[];t.split(",").map((function(t){for(;0!==t.length;){var e=parseFloat(t);if(isNaN(e))n.push(t.charAt(0)),t=t.slice(1);else{n.push(e);for(var i=1;;i++)if(parseFloat(t.slice(0,i))===e){t=t.slice(i);break}}}})),n.reverse();for(var i=t=0,r=0,o=0,a=0,s=0,l=0,h=0,c="",u=0,d=0;0!==n.length;){var p=n[n.length-1];switch(c=p=p===p.toString()?n.pop():c,u=d=0,p===p.toLowerCase()&&(u=t,d=i),p){case"M":case"m":t=n.pop()+u,i=n.pop()+d,e.moveTo(t,i),r=t,o=i;break;case"L":case"l":t=n.pop()+u,i=n.pop()+d,e.lineTo(t,i);break;case"V":case"v":i=n.pop()+d,e.lineTo(t,i);break;case"H":case"h":t=n.pop()+u,e.lineTo(t,i);break;case"C":case"c":a=n.pop()+u;var m=n.pop()+d,f=n.pop()+u;s=n.pop()+d,t=n.pop()+u,i=n.pop()+d,e.bezierCurveTo(a,m,f,s,t,i),a=2*t-f,s=2*i-s;break;case"S":case"s":m=n.pop()+u,f=n.pop()+d,t=n.pop()+u,i=n.pop()+d,e.bezierCurveTo(a,s,m,f,t,i),a=2*t-m,s=2*i-f;break;case"Q":case"q":l=n.pop()+u,h=n.pop()+d,t=n.pop()+u,i=n.pop()+d,e.quadraticCurveTo(l,h,t,i),l=2*t-l,h=2*i-h;break;case"T":case"t":t=n.pop()+u,i=n.pop()+d,e.quadraticCurveTo(l,h,t,i),l=2*t-l,h=2*i-h;break;case"A":case"a":m=t,f=i;var g=n.pop(),v=n.pop(),y=n.pop(),b=n.pop(),_=n.pop();if(t=n.pop()+u,i=n.pop()+d,!(u=this.__arcToBezier(m,f,g,v,y,b,_,t,i)))break;for(d=0,m=u.length;d<m;d++)f=u[d],e.bezierCurveTo(f[2],f[3],f[4],f[5],f[6],f[7]);break;case"Z":e.closePath(),t=r,i=o}"C"!==p&&"c"!==p&&"S"!==p&&"s"!==p&&(a=t,s=i),"Q"!==p&&"q"!==p&&"T"!==p&&"t"!==p&&(l=t,h=i)}},se.prototype.__approxUnitArc=function(t,e){var n=4/3*Math.tan(e/4),i=Math.cos(t),r=Math.sin(t),o=Math.cos(t+e);return[i,r,i-r*n,r+i*n,o+(t=Math.sin(t+e))*n,t-o*n,o,t]},se.prototype.__vectorAngle=function(t,e,n,r){var o=0>t*r-e*n?-1:1;return t=i.clamp(t*n+e*r,-1,1),o*Math.acos(t)},se.prototype.__getArcCenter=function(t,e,n,i,r,o,a,s,l,h){var c=h*(t-n)/2+l*(e-i)/2,u=-l*(t-n)/2+h*(e-i)/2,d=a*a,p=s*s,m=c*c,f=u*u,g=Math.max(0,d*p-d*f-p*m);return t=h*(r=(g=Math.sqrt(g/(d*f+p*m))*(r===o?-1:1))*a/s*u)-l*(g=g*-s/a*c)+(t+n)/2,e=l*r+h*g+(e+i)/2,i=(c-r)/a,l=(u-g)/s,a=(-c-r)/a,u=(-u-g)/s,s=this.__vectorAngle(1,0,i,l),u=this.__vectorAngle(i,l,a,u),0===o&&0<u&&(u-=2*Math.PI),1===o&&0>u&&(u+=2*Math.PI),[t,e,s,u]},se.prototype.__arcToBezier=function(t,e,n,i,r,o,a,s,l){var h=Math.sin(r*Math.PI/180),c=Math.cos(r*Math.PI/180),u=-h*(t-s)/2+c*(e-l)/2;if((0!=(r=c*(t-s)/2+h*(e-l)/2)||0!==u)&&0!==n&&0!==i){n=Math.abs(n),i=Math.abs(i),1<(r=r*r/(n*n)+u*u/(i*i))&&(r=Math.sqrt(r),n*=r,i*=r);var d=this.__getArcCenter(t,e,s,l,o,a,n,i,h,c);for(t=[],e=d[2],o=d[3],o/=a=Math.max(Math.ceil(Math.abs(o)/(.5*Math.PI)),1),s=0;s<a;s++)t.push(this.__approxUnitArc(e,o)),e+=o;return t.map((function(t){for(var e=0;e<t.length;e+=2){var r=t[e]*n,o=t[e+1]*i,a=h*r+c*o;t[e]=c*r-h*o+d[0],t[e+1]=a+d[1]}return t}))}};var le=function(t,e){return(t=Ct.call(this,wt.VECTOR_GRAPHICS,t)||this).mUrl=e,t.mGraphicsData=null,t.mXHR=null,t};n.inherits(le,Ct),le.prototype.onLoaderRequested=function(t){this.mXHR=t.get(Mt.XHR,this.mUrl),this.mXHR.mimeType="application/json",this.mXHR.responseType="json",this.addLoader(this.mXHR)},le.prototype.onAllLoaded=function(){var t=this.mXHR.data;this.mGraphicsData=(new se).parse(t),this.mGraphicsData.name=this.name,Ct.prototype.ready.call(this,this.mGraphicsData)};var he=function(t,e,n,i,r){return(t=Ct.call(this,wt.VECTOR_TEXTURE,t)||this).mUrl=e,t.mBakeSelf=n,t.mBakeChildren=i,t.mNamesToBake=i&&r?r:[],t.mGraphicsData=null,t.mXHR=null,t};n.inherits(he,Ct),he.prototype.onLoaderRequested=function(t){this.mXHR=t.get(Mt.XHR,this.mUrl),this.mXHR.mimeType="application/json",this.mXHR.responseType="json",this.addLoader(this.mXHR)},he.prototype.onAllLoaded=function(){var t=this.mXHR.data;this.mGraphicsData=(new se).parse(t),this.mGraphicsData.name=this.name,t=this.bakeTextures();var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push({name:e,data:t[e]});Ct.prototype.ready.call(this,n)},he.prototype.bakeTextures=function(){var t={},n=this.mNamesToBake;if(this.mBakeChildren&&0===n.length){var i=function(t){if(0!==t.length)for(var e=0,r=t.length;e<r;e++)t[e].name&&n.push(t[e].name),i(t[e].mNodes)};i(this.mGraphicsData.mNodes)}this.mBakeSelf&&n.unshift(this.mGraphicsData.name);for(var r=0,o=n.length;r<o;r++){var a=n[r],s=this.mGraphicsData.searchNode(a);if(s){s=new ae(s,a!==this.mGraphicsData.name);var l=1/T.driver.renderScaleFactor,h=new _t(s.width,s.height,1);T.driver.render(s,h,(new f).scale(l,l)),t[a]=h}else e.warn("[BVGAsset] GraphicsData node with id '"+a+"' not found.")}return t};var ce={NONE:"none",LOADING:"loading",FINISHED:"finished"},ue=function(t){this.mAssetManager=t};ue.prototype.get=function(t,e,i){for(var r=[],o=2;o<arguments.length;++o)r[o-2]=arguments[o];return new(Function.prototype.bind.apply(this.mAssetManager.mLoaderTypeMap[t],[null,e].concat(n.arrayFromIterable(r))))};var de=function(){var t=E.call(this)||this;return null===T.assets&&(T.assets=t),t.mDefaultPath="",t.mTotalLoaded=0,t.mTotalPending=0,t.mTotalErrors=0,t.mIsAllLoaded=!1,t.mLoadingProgress=0,t.mQueue=[],t.mLoadersQueue={},t.mState=ce.NONE,t.mLoaderFactory=new ue(t),t.mAssets={},t.mAssetTypeMap={},t.mLoaderTypeMap={},t.registerDefaultTypes(),t};n.inherits(de,E),de.prototype.registerDefaultTypes=function(){this.mAssetTypeMap[wt.TEXTURE]=Pt,this.mAssetTypeMap[wt.TEXTURE_ATLAS]=It,this.mAssetTypeMap[wt.VECTOR_GRAPHICS]=le,this.mAssetTypeMap[wt.VECTOR_TEXTURE]=he,this.mAssetTypeMap[wt.FONT]=Ot,this.mAssetTypeMap[wt.BITMAP_FONT]=Nt,this.mAssetTypeMap[wt.XML]=Rt,this.mAssetTypeMap[wt.JSON]=Lt,this.mAssetTypeMap[wt.SOUND]=Wt,this.mAssetTypeMap[wt.SOUND_ATLAS]=Yt,this.mLoaderTypeMap[Mt.FONT_FACE]=At,this.mLoaderTypeMap[Mt.IMAGE]=Tt,this.mLoaderTypeMap[Mt.XHR]=Et},de.prototype.setAssetType=function(t,e){this.mAssetTypeMap[t]=e},de.prototype.setLoaderType=function(t,e){this.mLoaderTypeMap[t]=e},de.prototype.enqueueAsset=function(t,e){this.__validateState(),this.__validateName(e.type,t),this.mQueue.push(e)},de.prototype.__getAsset=function(t,e){for(var i=[],r=1;r<arguments.length;++r)i[r-1]=arguments[r];return new(Function.prototype.bind.apply(this.mAssetTypeMap[t],[null].concat(n.arrayFromIterable(i))))},de.prototype.addTexture=function(t,e){this.mTextures[t]=e},de.prototype.enqueueImage=function(t,e){this.enqueueAsset(t,this.__getAsset(wt.TEXTURE,t,this.mDefaultPath+e))},de.prototype.enqueueAtlas=function(t,e,n){this.enqueueAsset(t,this.__getAsset(wt.TEXTURE_ATLAS,t,this.mDefaultPath+e,this.mDefaultPath+n))},de.prototype.enqueueBitmapFont=function(t,e,n){this.enqueueAsset(t,this.__getAsset(wt.BITMAP_FONT,t,this.mDefaultPath+e,this.mDefaultPath+n))},de.prototype.enqueueXML=function(t,e){this.enqueueAsset(t,this.__getAsset(wt.XML,t,this.mDefaultPath+e))},de.prototype.enqueueJSON=function(t,e){this.enqueueAsset(t,this.__getAsset(wt.JSON,t,this.mDefaultPath+e))},de.prototype.enqueueVector=function(t,e){this.enqueueAsset(t,this.__getAsset(wt.VECTOR_GRAPHICS,t,this.mDefaultPath+e))},de.prototype.enqueueVectorTexture=function(t,e,n,i,r){i=void 0!==i&&i,!0!==(n=void 0!==n&&n)&&!0!==i||this.enqueueAsset(t,this.__getAsset(wt.VECTOR_TEXTURE,t,this.mDefaultPath+e,n,i,void 0===r?null:r))},de.prototype.enqueueSound=function(t,e){this.enqueueAsset(t,this.__getAsset(wt.SOUND,t,this.mDefaultPath+e))},de.prototype.enqueueSoundAtlas=function(t,e,n){this.enqueueAsset(t,this.__getAsset(wt.SOUND_ATLAS,t,this.mDefaultPath+e,this.mDefaultPath+n))},de.prototype.enqueueFont=function(t,e){this.enqueueAsset(t,this.__getAsset(wt.FONT,t,this.mDefaultPath+e,!0))},de.prototype.enqueueGoogleFont=function(t){this.enqueueAsset(t,this.__getAsset(wt.FONT,t,"",!1))},de.prototype.loadQueue=function(){if(this.__validateState(),0===this.mQueue.length)this.post(x.COMPLETE);else{this.mState=ce.LOADING;for(var t=0;t<this.mQueue.length;t++){var e=this.mQueue[t];e.onLoaderRequested(this.mLoaderFactory),0<e.loaders.length&&(e.once(x.COMPLETE,this.onAssetLoaded,this),e.once(x.ERROR,this.onAssetError,this),this.mTotalPending++,e.loaders.forEach((function(t){t.load()})))}}},de.prototype.onAssetLoaded=function(t){var e=this;this.mTotalLoaded++,this.mLoadingProgress=this.mTotalLoaded/this.mTotalPending;var n=t.sender;n.off(x.COMPLETE,x.ERROR),null==this.mAssets[n.type]&&(this.mAssets[n.type]={}),Array.isArray(n.data)?n.data.forEach((function(t){e.__validateName(t.name),e.mAssets[n.type][t.name]=t.data})):this.mAssets[n.type][n.name]=n.data,this.post(x.PROGRESS,this.mLoadingProgress),this.mTotalLoaded===this.mTotalPending&&(this.mQueue.splice(0,this.mQueue.length),this.mLoadersQueue={},this.mState=ce.FINISHED,this.mTotalPending=this.mTotalErrors=this.mTotalLoaded=0,this.mIsAllLoaded=!0,this.post(x.COMPLETE))},de.prototype.onAssetError=function(t){this.mTotalErrors++;var n=this.mTotalLoaded+this.mTotalErrors;this.mLoadingProgress=this.mTotalLoaded/this.mTotalPending,(t=t.sender).off(x.COMPLETE,x.ERROR),e.warn("[AssetManager] Error loading asset '"+t.name+"'."),this.post(x.ERROR,t),n===this.mTotalPending&&(this.mQueue.splice(0,this.mQueue.length),this.mLoadersQueue={},this.mState=ce.FINISHED,this.mTotalPending=this.mTotalErrors=this.mTotalLoaded=0,this.mIsAllLoaded=!0,this.post(x.COMPLETE))},de.prototype.getBitmapFont=function(t){var n=this.mAssets[wt.BITMAP_FONT][t];return null!=n?n:(e.warn("[AssetManager] BitmapFontData '"+t+"' was not found."),null)},de.prototype.getTexture=function(t){var n=this.mAssets[wt.TEXTURE];if(null!=n&&null!=(n=n[t]))return n;if(null!=(n=this.mAssets[wt.TEXTURE_ATLAS]))for(var i in n){var r=n[i].subTextures[t];if(null!=r)return r}if(null!=(i=this.mAssets[wt.VECTOR_TEXTURE])&&null!=(i=i[t]))return i;if(null!=(i=this.mAssets[wt.VECTOR_TEXTURE_ATLAS]))for(var o in i)if(null!=(n=i[o].subTextures[t]))return n;return e.warn("[AssetManager] Texture '"+t+"' was not found."),null},de.prototype.getGraphicsData=function(t){var n=this.mAssets[wt.VECTOR_GRAPHICS];if(null==n)return null;var i=n[t];if(i)return i;for(var r in n)if(i=n[r].searchNode(t))return i;return e.warn("[AssetManager] GraphicsData '"+t+"' was not found."),null},de.prototype.getTextures=function(t){var e=this.mAssets[wt.TEXTURE],n=this.mAssets[wt.TEXTURE_ATLAS],i=this.mAssets[wt.VECTOR_TEXTURE],r=this.mAssets[wt.VECTOR_TEXTURE_ATLAS],o=[],a=[];if(t=new RegExp("^"+t.split("*").join(".*")+"$"),null!=e)for(var s in e)t.test(s)&&a.push({name:s,atlas:null,isBakedVector:!1});if(null!=i)for(var l in i)t.test(l)&&a.push({name:l,atlas:null,isBakedVector:!0});if(null!=n)for(var h in n)for(var c in(s=n[h]).subTextures)t.test(c)&&a.push({name:c,atlas:s,isBakedVector:!1});if(null!=r)for(var u in r)for(var d in(n=r[u]).subTextures)t.test(d)&&a.push({name:d,atlas:n,isBakedVector:!0});for(xt.naturalSort(a,"name"),r=0;r<a.length;r++)null===(u=a[r]).atlas?!0===u.isBakedVector?o.push(i[u.name]):o.push(e[u.name]):o.push(u.atlas.mSubTextures[u.name]);return 0<o.length?o:null},de.prototype.getAtlas=function(t){var n=this.mAssets[wt.TEXTURE_ATLAS];return null==n?null:null!=n[t]?n[t]:(e.warn("[AssetManager] Atlas '"+t+"' was not found."),null)},de.prototype.getSound=function(t){var n=this.mAssets[wt.SOUND],i=this.mAssets[wt.SOUND_ATLAS];if(null!=n&&null!=(n=n[t]))return n;if(null!=i)for(var r in i)if(null!=(n=i[r].subSounds[t]))return n;return e.warn("[AssetManager] Sound '"+t+"' was not found."),null},de.prototype.getSoundAtlas=function(t){return null==this.mAssets[wt.SOUND_ATLAS]?null:this.mAssets[wt.SOUND_ATLAS][t]},de.prototype.getJSON=function(t){return null==this.mAssets[wt.JSON]?null:this.mAssets[wt.JSON][t]},de.prototype.getCustomAsset=function(t,e){return null==this.mAssets[t]?null:this.mAssets[t][e]},de.prototype.__validateState=function(){e.assert(this.mState===ce.NONE||this.mState===ce.FINISHED,"Illegal state.")},de.prototype.__validateName=function(t,n){null!=this.mAssets[t]&&e.assert(null==this.mAssets[t][n],"Asset with such name is already added.")},de.prototype.dispose=function(){this.mQueue.forEach((function(t){t.abort()}))},n.global.Object.defineProperties(de.prototype,{defaultPath:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultPath},set:function(t){this.mDefaultPath=t}},isAllLoaded:{configurable:!0,enumerable:!0,get:function(){return this.mIsAllLoaded}},numErrors:{configurable:!0,enumerable:!0,get:function(){return this.mTotalErrors}},state:{configurable:!0,enumerable:!0,get:function(){return this.mState}},path:{configurable:!0,enumerable:!0,get:function(){return"AssetManager"}}});var pe=function(){this.parentRenderers=[],this.endPassParentRenderers=[],this.isBackBufferActive=!0,this.customTransform=null};pe.prototype.reset=function(){this.parentRenderers.splice(0,this.parentRenderers.length),this.endPassParentRenderers.splice(0,this.endPassParentRenderers.length),this.isBackBufferActive=!0,this.customTransform=null};var me=function(){var t=$.call(this)||this;return t.texture=null,t.mTransformCache=new f,t.mTransform=null,t.mUseTransformCache=!1,t.mCanvas=document.createElement("canvas"),t.mContext=t.mCanvas.getContext("2d"),t.mContext.lineJoin="round",t.mContext.miterLimit=2,t.mMetrics=null,t};n.inherits(me,$),me.prototype.preRender=function(t,e){this.endPassRequired=null!==this.gameObject.mClipRect&&!1===this.gameObject.mClipRect.isEmpty,this.skipChildren=!(0<this.gameObject.mAlpha&&!0===this.gameObject.mVisible),this.skipSelf=!0===this.skipChildren},me.prototype.upload=function(t,e){16&(e=this.gameObject).mDirty&&(e.onGetLocalBounds(),this.mMetrics=e.mMetrics),(16&e.mDirty||8&e.mDirty)&&this.updateTransform(),this.mTransform=!0===this.mUseTransformCache?this.mTransformCache:this.gameObject.worldTransformation,t.setSnapToPixels(e.snapToPixels),t.setTransform(this.mTransform),t.setGlobalAlpha(this.alpha),t.setGlobalBlendMode(this.blendMode),!0===this.endPassRequired&&t.beginClip(e.mClipRect,e.mPivotX,e.mPivotY)},me.prototype.renderSegment=function(t,e,n,i,r,o){i=this.gameObject;var a=r.baselineNormalized*e.style.size;!0===o?(n.lineWidth=e.style.strokeThickness,n.strokeStyle=h.intToRGBA(e.style.strokeColor,e.style.strokeAlpha)):n.fillStyle=h.intToRGBA(e.style.color,e.style.alpha),n.font=e.style.weight+" "+e.style.style+" "+e.style.size+'px "'+e.style.family+'"',r=e.bounds.x-Math.min(t.strokeBounds.x,t.shadowBounds.x),a=a+e.bounds.y-Math.min(t.strokeBounds.y,t.shadowBounds.y),r+=i.padding.x,a+=i.padding.y,"center"===i.align?r+=.5*t.bounds.width-.5*t.lineWidth[e.lineIndex]:"right"===i.align&&(r+=t.bounds.width-t.lineWidth[e.lineIndex]),!0===o?n.strokeText(e.text,r,a):n.fillText(e.text,r,a)},me.prototype.render=function(t,e){var n=this.gameObject;if(!0===n.mHighQuality&&8&n.mDirty&&(n.mDirty^=8,n.mDirty|=16),16&n.mDirty){n.mDirty^=16,e=this.mCanvas;var i=this.mContext,r=1;i.textBaseline="alphabetic",!0===n.mHighQuality&&(r=this.mTransform.data,r=Math.max(Math.sqrt(r[0]*r[0]+r[2]*r[2]),Math.sqrt(r[1]*r[1]+r[3]*r[3]))*t.renderScaleFactor);var o=this.mMetrics.strokeBounds.clone();o.union(this.mMetrics.shadowBounds),o.inflate(n.padding.right,n.padding.bottom),o.scale(r,r),e.width=o.width,e.height=o.height,n=D.get(n.mDefaultStyle.family),o=this.mMetrics.segments,i.save(),i.scale(r,r);for(var a=0;a<o.length;a++)o[a].style.dropShadow&&(i.save(),i.shadowColor=h.intToRGBA(o[a].style.shadowColor,o[a].style.shadowAlpha),i.shadowBlur=o[a].style.shadowBlur,i.shadowOffsetX=o[a].style.shadowDistanceX*r,i.shadowOffsetY=o[a].style.shadowDistanceY*r,this.renderSegment(this.mMetrics,o[a],i,t,n,!1),i.restore());for(a=0;a<o.length;a++){var s=o[a];0<s.style.strokeThickness&&(i.lineJoin="round",i.miterLimit=2,this.renderSegment(this.mMetrics,s,i,t,n,!0))}for(a=0;a<o.length;a++)this.renderSegment(this.mMetrics,o[a],i,t,n,!1);i.restore(),null===this.texture?this.texture=new J(e,null,null,1/r):this.texture.set(e,null,null,1/r)}},me.prototype.updateTransform=function(){var t=this.gameObject,e=t.worldTransformation,n=0,i=0,r=Math.min(this.mMetrics.strokeBounds.x,this.mMetrics.shadowBounds.x),o=Math.min(this.mMetrics.strokeBounds.y,this.mMetrics.shadowBounds.y);!1===t.mAutoSize&&("center"===t.align?n=.5*(t.mFieldWidth-this.mMetrics.bounds.width):"right"===t.align&&(n=t.mFieldWidth-this.mMetrics.bounds.width),"middle"===t.mVerticalAlign?i=.5*(t.mFieldHeight-this.mMetrics.bounds.height):"bottom"===t.mVerticalAlign&&(i=t.mFieldHeight-this.mMetrics.bounds.height)),1==(0!==r||0!==o)||!1===t.mAutoSize?(this.mUseTransformCache=!0,e.copyTo(this.mTransformCache),this.mTransformCache.translate(r+n-t.padding.x,o+i-t.padding.y)):!1===t.padding.isEmpty?(this.mUseTransformCache=!0,e.copyTo(this.mTransformCache),this.mTransformCache.translate(-t.padding.x,-t.padding.y)):this.mUseTransformCache=!1};var fe=function(){var t=$.call(this)||this;return t.mCanvas=document.createElement("canvas"),t.mContext=t.mCanvas.getContext("2d"),t.texture=null,t};n.inherits(fe,$),fe.prototype.render=function(t,e){if(null!==(t=this.gameObject).mText&&16&t.mDirty){e=this.mCanvas;var n=this.mContext,i=t.mData,r=t.mText,o=t.onGetLocalBounds();t.mDirty^=16;var a=-1,s=0,l=0;for(e.width=o.width,e.height=o.height,o=0;o<r.length;o++){var h=r.charCodeAt(o);if(/(?:\r\n|\r|\n)/.test(r.charAt(o)))s=0,l+=i.lineHeight*t.mLineHeight,a=-1;else{var c=i.chars[h];if(null!=c){var u=c.texture;0<=a&&c.kerning[a]&&(s+=c.kerning[a]);var d=u.width,p=u.height;0!==d&&0!==p&&(n.drawImage(u.native,u.region.x,u.region.y,d,p,~~(u.untrimmedRegion.x+c.xOffset+s),~~(u.untrimmedRegion.y+c.yOffset+l),d,p),s+=c.xAdvance,a=h)}}}null===this.texture?this.texture=new J(e):this.texture.set(e)}};var ge=function(){return $.call(this)||this};n.inherits(ge,$);var ve=function(){var t=$.call(this)||this;return t.mCacheAsBitmapDirty=!0,t.mCacheAsBitmapMatrixCache=null,t.mCacheTexture=null,t.mCacheBounds=null,t.mIsClipped=!1,t.mIsCached=!1,t.mBakeInvertedMatrix=null,t};n.inherits(ve,$),ve.prototype.preRender=function(t,e){t=this.gameObject,this.endPassRequired=this.mIsClipped=null!==t.mClipRect,!0===t.mCacheAsBitmap&&(!1===t.mCacheAsBitmapDynamic?!1===this.mIsCached?(this.mIsCached=!0,t.setTransformDirty(),this.__refreshBitmapCache(),this.endPassRequired=this.mCacheAsBitmapDirty=!1):t.mDirty|=8:!0===(e=t.checkStatic(!0))&&!0===this.mCacheAsBitmapDirty?(t.setTransformDirty(),this.__refreshBitmapCache(),this.endPassRequired=this.mCacheAsBitmapDirty=!1):!1===e&&(this.mCacheAsBitmapDirty=!0,t.mDirty|=8)),this.skipChildren=!0===t.mCacheAsBitmap&&!1===this.mCacheAsBitmapDirty||this.mIsClipped&&t.mClipRect.isEmpty,this.skipSelf=!1,!0===this.skipChildren&&(this.endPassRequired=!1,this.skipSelf=!0)},ve.prototype.begin=function(t,e){t=this.gameObject,!0===this.skipChildren&&!0===e.isBackBufferActive?(this.alpha=1,this.blendMode=Y.NORMAL,this.color=null,this.skipSelf=0>=t.mAlpha||!1===t.mVisible||this.mIsClipped&&t.mClipRect.isEmpty):(this.alpha=t.mAlpha*this.parent.alpha,this.color=null===t.mColor?this.parent.color:t.mColor,this.blendMode=t.mBlendMode===Y.AUTO?this.parent.blendMode:t.mBlendMode,this.skipChildren=0>=t.mAlpha||!1===t.mVisible,this.skipSelf=!0===this.skipChildren||!1===this.mIsClipped||this.mIsClipped&&t.mClipRect.isEmpty)},ve.prototype.upload=function(t,e){var n=(e=this.gameObject).worldTransformation;!0===this.skipChildren&&this.mCacheAsBitmapMatrixCache&&(n=this.mCacheAsBitmapMatrixCache,!1===e.mCacheAsBitmapDynamic&&(n=(new f).append(this.gameObject.worldTransformation).append(this.mBakeInvertedMatrix).append(this.mCacheAsBitmapMatrixCache))),!0!==this.skipChildren&&!0!==this.endPassRequired||(t.setSnapToPixels(e.snapToPixels),t.setTransform(n),t.setGlobalAlpha(this.alpha),t.setGlobalBlendMode(this.blendMode)),!0===this.endPassRequired&&t.beginClip(e.mClipRect,e.mPivotX,e.mPivotY)},ve.prototype.render=function(t,e){!0===this.skipChildren&&!0===e.isBackBufferActive&&t.drawTexture(this.mCacheTexture)},ve.prototype.__refreshBitmapCache=function(){var t=this.gameObject.getBounds(T.stage,!0),e=T.stage.scaleFactor,n=T.driver.renderScaleFactor*e,i=f.pool.get();i.set(1,0,0,1,~~(-t.x*e-T.stage.mX),~~(-t.y*e-T.stage.mY)),!0===this.mIsClipped&&!0===this.skipChildren&&(i.data[4]+=this.gameObject.mPivotX*e,i.data[5]+=this.gameObject.mPivotY*e),null===this.mCacheBounds&&(this.mCacheBounds=new m),t.copyTo(this.mCacheBounds),t.width*=n,t.height*=n,null===this.mCacheTexture?this.mCacheTexture=new _t(t.width,t.height,1):this.mCacheTexture.resize(t.width,t.height,1),T.driver.render(this.gameObject,this.mCacheTexture,i),f.pool.release(i),null===this.mCacheAsBitmapMatrixCache&&(this.mCacheAsBitmapMatrixCache=new f),this.mCacheAsBitmapMatrixCache.copyFrom(i),this.mCacheAsBitmapMatrixCache.scale(1/T.driver.renderScaleFactor,1/T.driver.renderScaleFactor),this.mCacheAsBitmapMatrixCache.data[4]=-this.mCacheAsBitmapMatrixCache.data[4],this.mCacheAsBitmapMatrixCache.data[5]=-this.mCacheAsBitmapMatrixCache.data[5],this.mBakeInvertedMatrix=this.gameObject.worldTransformationInverted.clone()};var ye=function(){return me.apply(this,arguments)||this};n.inherits(ye,me),ye.prototype.render=function(t,e){me.prototype.render.call(this,t,e),t.drawTexture($.getColoredTexture(this.texture,this.gameObject.mColor))};var be=function(){return fe.apply(this,arguments)||this};n.inherits(be,fe),be.prototype.render=function(t,e){fe.prototype.render.call(this,t,e),t.drawTexture($.getColoredTexture(this.texture,this.gameObject.mColor))};var _e=function(){};_e.prototype.getValue=function(){},_e.prototype.getValueAt=function(t){};var xe=function(){return this.value=0,this};n.inherits(xe,_e),xe.prototype.getValue=function(){return this.getValueAt(Math.random())};var we=function(t,e,n){t=void 0===t?0:t,e=void 0===e?null:e,n=void 0===n?null:n;var i=xe.call(this)||this;return i.min=t,i.max=null===e?t:e,i.ease=n,i};n.inherits(we,xe),we.prototype.getValueAt=function(t){return null!==this.ease&&(t=this.ease(t)),this.value=this.min+t*(this.max-this.min)},we.fromObject=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return e[0]instanceof xe?e[0]:new(Function.prototype.bind.apply(we,[null].concat(n.arrayFromIterable(e))))};var Me={PENDING:0,EMITTING:1,PAUSED:2,FINISHED:3},Se={FRONT_TO_BACK:"frontToBack",BACK_TO_FRONT:"backToFront"},Te=function(t){this.mIsInitializer=void 0===t||t,this.scatter=null,this.isActive=!0};Te.prototype.preUpdate=function(t){},Te.prototype.update=function(t,e,n){},Te.prototype.postUpdate=function(t){},n.global.Object.defineProperties(Te.prototype,{isInitializer:{configurable:!0,enumerable:!0,get:function(){return this.mIsInitializer}}});var Ee=function(){this.textureIndex=0,this.life=this.alpha=this.scaleY=this.scaleX=1,this.age=0,this.energy=this.age/this.life,this.ay=this.ax=this.vy=this.vx=this.r=this.y=this.x=this.mass=0,this.color=null,this.anchorY=this.anchorX=.5};Ee.prototype.reset=function(){this.scaleX=this.scaleY=this.alpha=this.life=1,this.textureIndex=this.age=this.energy=this.mass=this.x=this.y=this.r=this.vx=this.vy=this.ax=this.ay=0,this.anchorX=this.anchorY=.5},Ee.prototype.update=function(t){0>=this.life?this.life=0:(this.x+=this.vx*t,this.y+=this.vy*t,0<this.mass&&(this.ax*=1/this.mass,this.ay*=1/this.mass),this.vx+=this.ax*t,this.vy+=this.ay*t,this.ay=this.ax=0,this.life-=t,this.age+=t,this.energy=this.age/(this.age+this.life))};var Ae=function(){var t=st.call(this)||this;return t.mTextures=[],t.mParticles=[],t.mRecycled=[],t.mInitializers=[],t.mActions=[],t.mSpace=null,t.mIsLocal=!0,t.mMaxParticles=1e4,t.mEmitCount=new we(10),t.mEmitNumRepeats=new we(0,Number.MAX_SAFE_INTEGER),t.mEmitNumRepeatsLeft=t.mEmitNumRepeats.getValue(),t.mEmitDuration=new we(1/60),t.mEmitDurationLeft=t.mEmitDuration.getValue(),t.mEmitInterval=new we(1/60),t.mEmitIntervalLeft=t.mEmitInterval.getValue(),t.mEmitDelay=new we(1),t.mEmitDelayLeft=t.mEmitDelay.getValue(),t.mNextUpdateAt=0,t.mState=Me.PENDING,t.__tmpLocal=new f,t.__tmpWorld=new f,t.mSortOrder=Se.FRONT_TO_BACK,t.mTextureNames=null,t.mPresimulateSeconds=0,t.mCurrentPresimulationTime=0,t};n.inherits(Ae,st),Ae.prototype.play=function(){this.mState!==Me.EMITTING&&this.mState!==Me.PAUSED&&(this.mEmitNumRepeatsLeft=this.mEmitNumRepeats.getValue(),this.mEmitDurationLeft=this.mEmitDuration.getValue(),this.mEmitIntervalLeft=this.mEmitInterval.getValue(),this.mEmitDelayLeft=this.mEmitDelay.getValue(),this.mState=Me.PENDING)},Ae.prototype.pause=function(){this.mState=Me.PAUSED},Ae.prototype.stop=function(){this.mParticles=[],this.mRecycled=[],this.mState=Me.FINISHED},Ae.prototype.simulate=function(t){for(e.isNumber(t),e.assert(0<t),this.mCurrentPresimulationTime=0,this.mPresimulateSeconds=t;this.mCurrentPresimulationTime<=this.mPresimulateSeconds;)this.onUpdate(),this.mCurrentPresimulationTime+=T.time.delta;this.mCurrentPresimulationTime=this.mPresimulateSeconds=0},Ae.prototype.getRenderer=function(){return T.driver.getRenderer("Emitter",this)},Ae.prototype.add=function(t){for(var e=[],n=0;n<arguments.length;++n)e[n-0]=arguments[n];for(n=0;n<e.length;n++){var i=e[n];i instanceof Te?this.addModifier(i):st.prototype.add.call(this,i)}return this},Ae.prototype.addModifier=function(t){return t.isInitializer?this.mInitializers.push(t):this.mActions.push(t),t},Ae.prototype.removeModifier=function(t){var e=this.mActions;return t.isInitializer&&(e=this.mInitializers),0<=(t=e.indexOf(t))&&(e.splice(t,1),!0)},Ae.prototype.__getTime=function(){return T.time.now},Ae.prototype.updateNextTick=function(t){t=void 0===t?0:t;var e=T.time.now,n=!1;this.mState===Me.PENDING&&(this.mNextUpdateAt=e+this.mEmitDelayLeft,this.mEmitDelayLeft-=t,0>=this.mEmitDelayLeft&&(this.mEmitDelayLeft=this.mEmitDelay.getValue(),this.mState=Me.EMITTING,n=!0)),this.mState===Me.EMITTING&&(0>=this.mEmitDurationLeft?(this.mEmitDurationLeft=this.mEmitDuration.getValue(),this.mEmitNumRepeatsLeft--,0>=this.mEmitNumRepeatsLeft?(this.mState=Me.FINISHED,this.post(x.COMPLETE)):this.mState=Me.PENDING):(n?(this.mNextUpdateAt=e,this.mEmitIntervalLeft=this.mEmitInterval.getValue()):(this.mEmitIntervalLeft-=t,this.mNextUpdateAt=e+this.mEmitIntervalLeft,0>=this.mEmitIntervalLeft&&(this.mEmitIntervalLeft=this.mEmitInterval.getValue())),this.mEmitDurationLeft-=t))},Ae.prototype.onUpdate=function(){if(this.mState!==Me.PAUSED){var t=T.time.delta;this.updateNextTick(t),T.time.now>=this.mNextUpdateAt&&this.mState===Me.EMITTING&&this.__create(this.mEmitCount.getValue());for(var e=this.mActions.length,n=this.mParticles.length,i=0;i<e;i++)!0===this.mActions[i].isActive&&this.mActions[i].preUpdate(t);for(i=n;i--;){n=this.mParticles[i];for(var r=0;r<e;r++)!0===this.mActions[r].isActive&&this.mActions[r].update(this,n,t);n.update(t),0===n.life&&(this.mRecycled.push(n),this.mParticles.splice(i,1))}for(n=0;n<e;n++)!0===this.mActions[n].isActive&&this.mActions[n].postUpdate(t);!0===this.mVisible&&0<this.mAlpha&&this.setDirty(1,!1)}},Ae.prototype.__create=function(t){var e=this.worldTransformation.clone();if(!1===this.mIsLocal){var n=this.mSpace.worldTransformationInverted.clone();e.prepend(n)}for(n=0;n<t;n++){if(0<this.mRecycled.length)var i=this.mRecycled.pop();else{if(this.mParticles.length>=this.mMaxParticles)break;i=new Ee}i.reset();for(var r=0;r<this.mInitializers.length;r++)!0===this.mInitializers[r].isActive&&this.mInitializers[r].update(this,i,0);!1===this.mIsLocal&&(e.transformXY(i.x,i.y,d.__cache),i.x=d.__cache.x,i.y=d.__cache.y),this.mParticles.push(i)}},n.global.Object.defineProperties(Ae.prototype,{state:{configurable:!0,enumerable:!0,get:function(){return this.mState}},maxParticles:{configurable:!0,enumerable:!0,get:function(){return this.mMaxParticles},set:function(t){if(0>t)throw Error("Bad argument error.");this.mMaxParticles=t}},emitCount:{configurable:!0,enumerable:!0,get:function(){return this.mEmitCount},set:function(t){this.mEmitCount=t}},emitNumRepeats:{configurable:!0,enumerable:!0,get:function(){return this.mEmitNumRepeats},set:function(t){this.mEmitNumRepeats=t,this.mEmitNumRepeatsLeft=this.mEmitNumRepeats.getValue()}},emitDuration:{configurable:!0,enumerable:!0,get:function(){return this.mEmitDuration},set:function(t){this.mEmitDuration=t,this.mEmitDurationLeft=this.mEmitDuration.getValue()}},emitInterval:{configurable:!0,enumerable:!0,get:function(){return this.mEmitInterval},set:function(t){this.mEmitInterval=t,this.mEmitIntervalLeft=this.mEmitInterval.getValue()}},emitDelay:{configurable:!0,enumerable:!0,get:function(){return this.mEmitDelay},set:function(t){this.mEmitDelay=t,this.mEmitDelayLeft=this.mEmitDelay.getValue()}},space:{configurable:!0,enumerable:!0,get:function(){return this.mSpace},set:function(t){this.mSpace=t,this.mIsLocal=null===this.mSpace||this.mSpace===this,this.setRenderDirty()}},textures:{configurable:!0,enumerable:!0,get:function(){return this.mTextures},set:function(t){this.mTextures=t,e.assert(!(null===this.mTextures||0===this.mTextures.length),"At least one texture must be provided."),this.setRenderDirty()}},textureNames:{configurable:!0,enumerable:!0,get:function(){return this.mTextureNames},set:function(t){this.mTextureNames=t,this.textures=t.map((function(t){return T.assets.getTexture(t)}))}},sortOrder:{configurable:!0,enumerable:!0,get:function(){return this.mSortOrder},set:function(t){this.mSortOrder=t,this.setRenderDirty()}}});var Ce=function(){var t=$.call(this)||this;return t.isLocal=!1,t.__tmpLocal=new f,t.__tmpWorld=new f,t};n.inherits(Ce,$),Ce.prototype.preRender=function(t,e){t=this.gameObject,this.endPassRequired=null!==this.gameObject.mClipRect&&!1===this.gameObject.mClipRect.isEmpty,this.skipChildren=!(0<t.mAlpha&&0<t.mTextures.length&&!0===t.mVisible),this.skipSelf=!(0<t.mTextures.length&&0<t.mParticles.length)},Ce.prototype.render=function(t,e){e=this.gameObject,t.setSnapToPixels(e.snapToPixels);var n=e.mParticles.length,i=this.__tmpLocal,r=this.__tmpWorld;if(i.identity(),e.sortOrder===Se.FRONT_TO_BACK)for(var o=0;o<n;o++)this.__renderParticle(e.mParticles[o],i,r,t);else for(--n;0<n;n--)this.__renderParticle(e.mParticles[n],i,r,t)},Ce.prototype.__renderParticle=function(t,e,n,i){var r=this.gameObject,o=r.textures[t.textureIndex],a=o.displayWidth*t.anchorX,s=o.displayHeight*t.anchorY;if(0===t.r)e.set(t.scaleX,0,0,t.scaleY,t.x-a*t.scaleX,t.y-s*t.scaleY);else{var l=Math.cos(t.r),h=Math.sin(t.r),c=t.scaleX*l,u=t.scaleX*h;h=t.scaleY*-h,l*=t.scaleY,e.set(c,u,h,l,t.x-a*c-s*h,t.y-a*u-s*l)}!0===r.mIsLocal?(n.identity(),n.copyFrom(e),n.prepend(r.worldTransformation)):(n.copyFrom(r.mSpace.worldTransformation),n.append(e)),i.setGlobalAlpha(r.mAlpha*t.alpha),i.setTransform(n),i.drawTexture($.getColoredTexture(o,null===t.color?r.mColor:t.color))};var Pe=function(){var t=$.call(this)||this;return t.pattern=null,t.patternTexture=null,t.sliceTextureCache=null,t.sizeWidthCache=null,t.sizeHeightCache=null,t.textureCache=null,t};n.inherits(Pe,$),Pe.prototype.preRender=function(t,e){e=null!==(t=this.gameObject).mClipRect&&t.mClipRect.isEmpty,this.endPassRequired=null!==t.mClipRect&&!t.mClipRect.isEmpty,this.skipChildren=e||0>=t.mAlpha||!1===t.mVisible,this.skipSelf=e||null===t.mTexture||0>=t.mAlpha||!1===t.mVisible},Pe.prototype.renderSlice9Grid=function(t,e,n){var i=t.mDevicePixelRatio,r=e.width*this.gameObject.mScaleX,o=e.height*this.gameObject.mScaleY;if(this.textureCache===e&&this.sizeWidthCache===r&&this.sizeHeightCache===o)return this.sliceTextureCache;this.textureCache=e,this.sizeWidthCache=r,this.sizeHeightCache=o,t=e.region.x;var a=e.region.y,s=e.region.width,l=e.region.height,h=e.untrimmedRegion.x*i;i*=e.untrimmedRegion.y,null===this.sliceTextureCache?this.sliceTextureCache=new _t(r,o,1/e.scale):this.sliceTextureCache.resize(r,o,1/e.scale);var c=this.sliceTextureCache.renderTarget.context,u=Math.min(this.gameObject.scaleX,this.gameObject.scaleY);1>=u&&(c.setTransform(u,0,0,u,0,0),r/=u,o/=u),u=n.x/e.scale;var d=n.y/e.scale,p=s-n.right/e.scale;n=l-n.bottom/e.scale;var m=t+s-p,f=h+r/e.scale-p,g=a+l-n,v=i+o/e.scale-n;c.drawImage(e.native,t,a,u,d,h,i,u,d),c.drawImage(e.native,m,a,p,d,f,i,p,d),c.drawImage(e.native,m,g,p,n,f,v,p,n),c.drawImage(e.native,t,g,u,n,h,v,u,n),m=t+u,f=h+u,g=a+d,v=i+d;var y=t+s-p,b=h+r/e.scale-p,_=a+l-n,x=i+o/e.scale-n;return s=s-u-p,r=r/e.scale-u-p,l=l-d-n,o=o/e.scale-d-n,c.drawImage(e.native,m,a,s,d,f,i,r,d),c.drawImage(e.native,y,g,p,l,b,v,p,o),c.drawImage(e.native,m,_,s,n,f,x,r,n),c.drawImage(e.native,t,g,u,l,h,v,u,o),c.drawImage(e.native,m,g,s,l,f,v,r,o),this.sliceTextureCache},Pe.prototype.render=function(t,e){e=t.mCtx;var n=this.gameObject,i=$.getColoredTexture(n.mTexture,this.color);if(null!==n.mSlice9grid){var r=this.gameObject.worldTransformation.data;r=f.pool.get().set(r[0]/this.gameObject.scaleX,r[1]/this.gameObject.scaleX,r[2]/this.gameObject.scaleY,r[3]/this.gameObject.scaleY,r[4],r[5]),t.setTransform(r),f.pool.release(r),i=this.renderSlice9Grid(t,i,n.mSlice9grid)}if(null===n.mTiling)t.drawTexture(i);else{if(null===this.pattern||this.patternTexture!==i){r=new Q(i.width,i.height);var o=i.region,a=i.untrimmedRegion;r.context.drawImage(i.native,o.x,o.y,o.width,o.height,a.x,a.y,o.width,o.height),this.pattern=e.createPattern(r.native,"repeat"),this.patternTexture=i}e.fillStyle=this.pattern,i=t.renderScaleFactor,(r=n.worldTransformation.clone()).scale(n.tiling.scaleX*i,n.tiling.scaleY*i),r.translate(n.tiling.wrapX/i,n.tiling.wrapY/i),t.setTransform(r),e.fillRect(-n.tiling.wrapX,-n.tiling.wrapY,n.tiling.width/n.tiling.scaleX,n.tiling.height/n.tiling.scaleY),e.fillStyle="black"}};var Le=function(){return ge.call(this)||this};n.inherits(Le,ge),Le.prototype.render=function(t,e){e=this.gameObject,this.__drawCommandBuffer(t),null!==e.mColor&&16777215!==e.mColor&&(t.context.globalCompositeOperation="multiply",this.__drawCommandBuffer(t,e.mColor))},Le.prototype.__drawCommandBuffer=function(t,e){e=void 0===e?null:e;var n=this.gameObject,i=t.context;i.save(),i.beginPath();var r=f.pool.get().copyFrom(n.worldTransformation);r.translate(-n.mDataOffsetX,-n.mDataOffsetY),this.__renderNode(t,e,n.mGraphicsData,r),f.pool.release(r),i.restore()},Le.prototype.__renderNode=function(t,n,i,r){var o=i.mCommandQueue,a=t.context,s=o.length,l=t.renderScaleFactor,c=i.mPivotX,u=i.mPivotY;r=r.clone().append(i.mTransform),t.setTransform(r);for(var d=0;d<s;d++){var p=o[d];switch(p.type){case qt.LINE_STYLE:a.lineWidth=p.getNumber(0)*l,a.strokeStyle=h.intToRGBA(null===n?p.getNumber(1):n,p.getNumber(2)),a.lineCap=p.getString(3),a.lineJoin=p.getString(4),a.miterLimit=p.getNumber(5);break;case qt.FILL_STYLE:a.fillStyle=h.intToRGBA(null===n?p.getNumber(0):n,p.getNumber(1));break;case qt.FILL_GRD:var m=p.getObject(0),f=m.native;if(!f){f=T.driver.renderScaleFactor;var g=[];for(var v in f=m.native=a.createLinearGradient(m.x0*f,m.y0*f,m.x1*f,m.y1*f),m.stops)g.push({percent:parseFloat(v),color:m.stops[v]});g.sort((function(t,e){return t.percent-e.percent})),m=0;for(var y=g.length;m<y;m++)p=g[m],f.addColorStop(p.percent,p.color)}a.fillStyle=f;break;case qt.FILL_PATTERN:(f=(g=p.getObject(0)).native)||(f=g.native=a.createPattern(g.image,g.repetition)),a.fillStyle=f;break;case qt.ARC:a.arc(p.getNumber(0)*l-c,p.getNumber(1)*l-u,p.getNumber(2)*l,p.getNumber(3),p.getNumber(4),p.getBoolean(5));break;case qt.RECT:a.rect(p.getNumber(0)*l-c,p.getNumber(1)*l-u,p.getNumber(2)*l,p.getNumber(3)*l);break;case qt.ROUNDED_RECT:g=p.getNumber(0),f=p.getNumber(1),m=p.getNumber(2),y=p.getNumber(3),p=p.getNumber(4),a.moveTo(g*l-c,(f+p)*l-u),a.quadraticCurveTo(g*l-c,f*l-u,(g+p)*l-c,f*l-u),a.lineTo((g+m-p)*l-c,f*l-u),a.quadraticCurveTo((g+m)*l-c,f*l-u,(g+m)*l-c,(f+p)*l-u),a.lineTo((g+m)*l-c,(f+y-p)*l-u),a.quadraticCurveTo((g+m)*l-c,(f+y)*l-u,(g+m-p)*l-c,(f+y)*l-u),a.lineTo((g+p)*l-c,(f+y)*l-u),a.quadraticCurveTo(g*l-c,(f+y)*l-u,g*l-c,(f+y-p)*l-u),a.closePath();break;case qt.BEZIER_CURVE_TO:a.bezierCurveTo(p.getNumber(0)*l-c,p.getNumber(1)*l-u,p.getNumber(2)*l-c,p.getNumber(3)*l-u,p.getNumber(4)*l-c,p.getNumber(5)*l-u);break;case qt.QUADRATIC_CURVE_TO:a.quadraticCurveTo(p.getNumber(0)*l-c,p.getNumber(1)*l-u,p.getNumber(2)*l-c,p.getNumber(3)*l-u);break;case qt.BEGIN_PATH:a.beginPath();break;case qt.CLOSE_PATH:a.closePath();break;case qt.FILL:a.fill(!0===p.getBoolean(0)?"nonzero":"evenodd");break;case qt.LINE_TO:a.lineTo(p.getNumber(0)*l-c,p.getNumber(1)*l-u);break;case qt.MOVE_TO:a.moveTo(p.getNumber(0)*l-c,p.getNumber(1)*l-u);break;case qt.LINE_DASH:a.setLineDash(p.getNumber(0));break;case qt.STROKE:a.stroke();break;case qt.SHADOW_BLUR:a.shadowBlur=p.getNumber(0)*l;break;case qt.SHADOW_COLOR:g=h.intToRGBA(null===n?p.getNumber(0):n,p.getNumber(1)),a.shadowColor=g;break;case qt.BOUNDS:break;default:e.error("Unsupported canvas command '"+p.type+"'.")}}for(o=0,a=i.mNodes.length;o<a;o++)this.__renderNode(t,n,i.mNodes[o],r)};var Re=function(t,e,n){this.mContainerElement=t,this.mClientWidth=e,this.mClientHeight=n,this.mTransform=new f,this.mIdentityMatrix=new f,this.mActiveSession=new pe,this.mSessions=[],this.mLastRenderTexture=null,this.mSnapToPixels=!1,this.mDevicePixelRatio=!0===T.engine.useHiDPR?T.device.getDevicePixelRatio():1,this.mGlobalBlendMode=Y.AUTO,this.mGlobalAlpha=1,this.mStageRenderer=new $,this.mRendererMap={},T.engine.viewport.on("resize",this.__onResize,this)};Re.prototype.render=function(t,e,n){},Re.prototype.getRenderer=function(t,e){return null},Re.prototype.__saveSession=function(){var t=Re.sessionPool.get();return t.reset(),this.mSessions.push(t),this.mActiveSession=t},Re.prototype.__restoreSession=function(){this.mSessions.pop(),this.mActiveSession=this.mSessions[this.mSessions.length-1]||null},Re.prototype.__collectParentRenderables=function(t,e,n){var i=e;if(null!==i){for(e=[],i=i.parent;null!==i;i=i.parent)e.splice(0,0,i);for(var r=0;r<e.length;r++)null!=(i=(i=e[r]).mRenderer)&&(t.parentRenderers.push(i),i.parent=n,n=i,i.preRender(this,t),!0===i.endPassRequired&&t.endPassParentRenderers.push(i))}},Re.prototype.beginClip=function(t,e,n){},Re.prototype.endClip=function(){},Re.prototype.__onResize=function(t,e){$.__dirty=!0,t=this.mContainerElement.clientHeight,this.mClientWidth=this.mContainerElement.clientWidth,this.mClientHeight=t},Re.prototype.start=function(){},Re.prototype.beginFrame=function(){this.clear()},Re.prototype.endFrame=function(){},Re.prototype.getTextureFromCanvas=function(t){return null},Re.prototype.setTransform=function(t){this.mTransform=t},Re.prototype.setSnapToPixels=function(t){this.mSnapToPixels=t},Re.prototype.getGlobalAlpha=function(){return this.mGlobalAlpha},Re.prototype.setGlobalAlpha=function(t){this.mGlobalAlpha=t},Re.prototype.getGlobalBlendMode=function(){return this.mGlobalBlendMode},Re.prototype.setGlobalBlendMode=function(t){this.mGlobalBlendMode=t},Re.prototype.drawTexture=function(t){},Re.prototype.drawTextureWithOffset=function(t,e,n){},Re.prototype.clear=function(){},Re.prototype.dispose=function(){Re.sessionPool.releaseAll()},n.global.Object.defineProperties(Re.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return null}},renderScaleFactor:{configurable:!0,enumerable:!0,get:function(){return this.mDevicePixelRatio}}}),Re.sessionPool=new a(pe);var Oe=function(t,e,n){return(t=Re.call(this,t,e,n)||this).mCtx=null,t.__createCanvas(),t.mRendererMap={DisplayObject:ve,Sprite:Pe,Emitter:Ce,Text:ye,BitmapText:be,Graphics:Le},t};n.inherits(Oe,Re),Oe.prototype.getRenderer=function(t,e){return(t=new this.mRendererMap[t]).gameObject=e,t},Oe.prototype.render=function(t,e,n){n=void 0===n?null:n;var i=null===(e=void 0===e?null:e);if(!0!==$.skipUnchangedFrames||!0!==i||!1!==$.__dirty){var r=this.__saveSession();if(r.isBackBufferActive=i,r.customTransform=n,n=this.mStageRenderer,null!==e){this.mLastRenderTexture=this.mCtx,this.mCtx=e.renderTarget.context,this.mGlobalAlpha=-1,this.mGlobalBlendMode=null,n.alpha=1,n.blendMode=Y.NORMAL,n.color=null,this.__collectParentRenderables(r,t,this.mStageRenderer),i=0;for(var o=r.parentRenderers.length;i!==o;i++){var a=r.parentRenderers[i];a.begin(this,r),!1===a.skipSelf&&a.upload(this,r)}0<r.parentRenderers.length&&(n=r.parentRenderers[r.parentRenderers.length-1])}if(this.renderObject(t,r,n),null!==e){for(;0<r.endPassParentRenderers.length;)r.endPassParentRenderers.pop().end(this,r);this.mCtx=this.mLastRenderTexture,this.mGlobalAlpha=-1,this.mGlobalBlendMode=null}this.__restoreSession()}},Oe.prototype.renderObject=function(t,e,n){var i=!1,r=t.mRenderer;if(null!=r){for(r.parent=n,r.preRender(this,e),i=0;i<t.mComponents.length;i++)t.mComponents[i].onRender();t.onRender(),r.begin(this,e),!1===r.skipSelf&&(r.upload(this,e),r.render(this,e)),i=r.skipChildren}if(!1===i)for(i=0;i<t.mChildren.length;i++)this.renderObject(t.mChildren[i],e,r||n);null!=r&&!0===r.endPassRequired&&r.end(this,e)},Oe.prototype.__createCanvas=function(){var t=this.mDevicePixelRatio,e=document.createElement("canvas");e.style.position="absolute",e.id="canvas",e.width=this.mClientWidth*t,e.height=this.mClientHeight*t,e.style.width=this.mClientWidth+"px",e.style.height=this.mClientHeight+"px",this.mContainerElement.appendChild(e),this.mCtx=e.getContext("2d")},Oe.prototype.__onResize=function(t,e){Re.prototype.__onResize.call(this,t,e),this.mGlobalBlendMode=null,this.mGlobalAlpha=-1,t=this.mDevicePixelRatio,this.mCtx.canvas.width=this.mClientWidth*t,this.mCtx.canvas.height=this.mClientHeight*t,this.mCtx.canvas.style.width=this.mClientWidth+"px",this.mCtx.canvas.style.height=this.mClientHeight+"px"},Oe.prototype.drawTexture=function(t){if(!1!==t.isValid){var e=this.mDevicePixelRatio;this.mCtx.drawImage(t.native,t.region.x,t.region.y,t.region.width,t.region.height,t.untrimmedRegion.x*e,t.untrimmedRegion.y*e,t.renderWidth*e,t.renderHeight*e)}},Oe.prototype.drawTextureWithOffset=function(t,e,n){if(!1!==t.isValid){var i=this.mDevicePixelRatio;this.mCtx.drawImage(t.native,t.region.x,t.region.y,t.region.width,t.region.height,(e+t.untrimmedRegion.x)*i,(n+t.untrimmedRegion.y)*i,t.renderWidth*i,t.renderHeight*i)}},Oe.prototype.beginClip=function(t,e,n){var i=this.mDevicePixelRatio;this.mCtx.save(),this.mCtx.beginPath(),this.mCtx.rect((t.x+e)*i,(t.y+n)*i,t.width*i,t.height*i),this.mCtx.clip()},Oe.prototype.endClip=function(){this.mCtx.restore(),this.mGlobalAlpha=-1,this.mGlobalBlendMode=null},Oe.prototype.setTransform=function(t){var n=this.mDevicePixelRatio,i=this.mActiveSession;!1===i.isBackBufferActive&&(null===i.customTransform?((t=t.clone()).data[4]-=T.stage.mX,t.data[5]-=T.stage.mY):(t=t.clone()).prepend(i.customTransform)),null!==T.camera&&(t=t.clone()).prepend(T.camera.worldTransformationInverted),this.mTransform=t,t=t.value,e.isNumber(t[0],t[1],t[2],t[3],t[4],t[5]),!0===this.mSnapToPixels?this.mCtx.setTransform(t[0],t[1],t[2],t[3],t[4]*n|0,t[5]*n|0):this.mCtx.setTransform(t[0],t[1],t[2],t[3],t[4]*n,t[5]*n)},Oe.prototype.setGlobalAlpha=function(t){e.isNumber(t),t!=this.mGlobalAlpha&&(this.mGlobalAlpha=t,this.mCtx.globalAlpha=t)},Oe.prototype.setGlobalBlendMode=function(t){t!==Y.AUTO&&(t=q[t],this.mGlobalBlendMode!==t&&(this.mGlobalBlendMode=t,this.mCtx.globalCompositeOperation=t))},Oe.prototype.clear=function(){if(!0!==$.skipUnchangedFrames||!1!==$.__dirty){this.mCtx.setTransform(1,0,0,1,0,0);var t=T.engine.viewport;!1===t.isTransparent?(this.mCtx.fillStyle=h.hexColorToString(t.backgroundColor),this.mCtx.fillRect(0,0,t.size.width*this.mDevicePixelRatio,t.size.height*this.mDevicePixelRatio)):this.mCtx.clearRect(0,0,t.size.width*this.mDevicePixelRatio,t.size.height*this.mDevicePixelRatio)}},Oe.prototype.getTextureFromCanvas=function(t){return new J(t)},Oe.prototype.dispose=function(){Re.prototype.dispose.call(this),null!==this.mCtx&&this.mCtx.canvas.remove()},n.global.Object.defineProperties(Oe.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return this.mCtx}}});var Ie=function(t,e){t=void 0===t?null:t,e=void 0===e||e;var n=st.call(this)||this;return n.mTexture=null,n.mTextureName=null,n.mTiling=null,n.mSlice9grid=null,n.mUseTextureProps=e,null!==t&&t.constructor===String?(n.mTextureName=t,n.texture=T.assets.getTexture(t)):n.texture=t,n};n.inherits(Ie,st),Ie.prototype.getRenderer=function(){return T.driver.getRenderer("Sprite",this)},Ie.prototype.onGetLocalBounds=function(t){return t=t||new m,this.mTexture?(null!==this.mClipRect?this.mClipRect.copyTo(t):null!==this.tiling?t.set(0,0,this.tiling.width,this.tiling.height):t.set(0,0,this.mTexture.displayWidth,this.mTexture.displayHeight),t):t},n.global.Object.defineProperties(Ie.prototype,{texture:{configurable:!0,enumerable:!0,get:function(){return this.mTexture},set:function(t){this.mTexture!==t&&(null===t?this.mTextureName=this.mTexture=null:(this.mTexture=t,!0===this.mUseTextureProps&&(t.slice9borders&&(this.slice9grid=t.slice9borders.clone()),null!==t.registrationPoint&&this.alignPivotOffset(t.registrationPoint.x,t.registrationPoint.y))),this.setDirty(16,!1),this.setRenderDirty())}},textureName:{configurable:!0,enumerable:!0,get:function(){return this.mTextureName},set:function(t){this.mTextureName!==t&&(null===t?this.texture=null:(this.mTextureName=t,this.texture=T.assets.getTexture(t)))}},tiling:{configurable:!0,enumerable:!0,get:function(){return this.mTiling},set:function(t){this.mTiling=t,this.setRenderDirty(),this.setDirty(16,!1)}},slice9grid:{configurable:!0,enumerable:!0,get:function(){return this.mSlice9grid},set:function(t){this.mSlice9grid=t,this.setRenderDirty(),this.setDirty(16,!1)}}});var Ne={NONE:"none",LEFT:"left",RIGHT:"right",CENTER:"center"},De={TOP:"top",MIDDLE:"middle",BOTTOM:"bottom"},Be=function(t,e,n,i,r,o,a,s){t=void 0===t?"":t,e=void 0===e?"sans-serif":e,n=void 0===n?0:n,i=void 0===i?14:i,r=void 0===r?A.NORMAL:r,o=void 0===o?C.NORMAL:o,a=void 0===a?0:a,s=void 0===s?16777215:s;var l=st.call(this)||this;return l.mText=t,l.mCacheBounds=new m,l.mTextWidth=0,l.mTextHeight=0,l.mDefaultStyle=new L(e,n,i,r,o,a,s),l.mStyles={},l.mAutoSize=!0,l.mAlign=Ne.LEFT,l.mVerticalAlign=De.MIDDLE,l.mMultiline=!1,l.mLineHeight=1.2,l.mTextBounds=new m,l.mFieldWidth=0,l.mFieldHeight=0,l.mPadding=new m(0,0,0,0),l.mMetrics=null,l.mHighQuality=!1,l};n.inherits(Be,st),Be.prototype.getRenderer=function(){return T.driver.getRenderer("Text",this)},Be.prototype.onGetLocalBounds=function(t){if(t=t||new m,16&this.mDirty){var e=this.text;!1===this.mMultiline&&(e=e.replace(/\n/g,""));var i,r=[this.mDefaultStyle];for(i in this.mStyles)r.push(this.mStyles[i]);this.mMetrics=z.measure.apply(z,[e,this.mLineHeight].concat(n.arrayFromIterable(r))),this.mTextBounds.copyFrom(this.mMetrics.bounds)}return null!==this.mClipRect?(this.mClipRect.copyTo(t),t):(!1===this.mAutoSize?(t.width=this.mFieldWidth,t.height=this.mFieldHeight):(t.width=this.mTextBounds.width,t.height=this.mTextBounds.height),t.width+=this.mPadding.right,t.height+=this.mPadding.bottom,t)},Be.prototype.setStyle=function(t,n){e.assert("def"!==t,"Please use 'setDefaultStyle' instead."),n.name=t,this.mStyles[t]=n,this.setDirty(16,!1),this.setTransformDirty()},Be.prototype.setDefaultStyle=function(t){this.mDefaultStyle=t,this.setDirty(16,!1),this.setTransformDirty()},Be.prototype.removeStyle=function(t){delete this.mStyles[t],this.setDirty(16,!1),this.setTransformDirty()},Be.prototype.getStyle=function(t){return this.mStyles.hasOwnProperty(t)?this.mStyles[t]:null},Be.prototype.getAllStyles=function(){var t,e=[];for(t in this.mStyles)e.push(this.mStyles[t]);return e},Be.prototype.getDefaultStyle=function(t){return this.mDefaultStyle},n.global.Object.defineProperties(Be.prototype,{multiline:{configurable:!0,enumerable:!0,set:function(t){this.mMultiline=t,this.setDirty(16,!1),this.setTransformDirty()},get:function(){return this.mMultiline}},lineHeight:{configurable:!0,enumerable:!0,set:function(t){this.mLineHeight=t,this.setDirty(16,!1),this.setTransformDirty()},get:function(){return this.mLineHeight}},size:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.size},set:function(t){this.mDefaultStyle.size!==t&&(this.mDefaultStyle.size=t,this.setDirty(16,!1),this.setTransformDirty())}},font:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.family},set:function(t){this.mDefaultStyle.family!==t&&(this.mDefaultStyle.family=t,this.setDirty(16,!1),this.setTransformDirty())}},textColor:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.color},set:function(t){this.mDefaultStyle.color!==t&&(this.mDefaultStyle.color=t,this.setDirty(16,!1),this.setTransformDirty())}},textAlpha:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.alpha},set:function(t){this.mDefaultStyle.alpha!==t&&(this.mDefaultStyle.alpha=t,this.setDirty(16,!1),this.setTransformDirty())}},fontStyle:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.style},set:function(t){this.mDefaultStyle.style!==t&&(this.mDefaultStyle.style=t,this.setDirty(16,!1),this.setTransformDirty())}},weight:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.weight},set:function(t){this.mDefaultStyle.weight!==t&&(this.mDefaultStyle.weight=t,this.setDirty(16,!1),this.setTransformDirty())}},align:{configurable:!0,enumerable:!0,get:function(){return this.mAlign},set:function(t){this.mAlign!==t&&(this.mAlign=t,this.setDirty(16,!1),this.setTransformDirty())}},vAlign:{configurable:!0,enumerable:!0,get:function(){return this.mVerticalAlign},set:function(t){this.mVerticalAlign!==t&&(this.mVerticalAlign=t,this.setDirty(16,!1),this.setTransformDirty())}},strokeColor:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.strokeColor},set:function(t){this.mDefaultStyle.strokeColor!==t&&(this.mDefaultStyle.strokeColor=t,this.setDirty(24,!1))}},strokeAlpha:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.strokeAlpha},set:function(t){this.mDefaultStyle.strokeAlpha!==t&&(this.mDefaultStyle.strokeAlpha=t,this.setDirty(24,!1))}},strokeThickness:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.strokeThickness},set:function(t){t!==this.mDefaultStyle.strokeThickness&&(this.mDefaultStyle.strokeThickness=t,this.setDirty(24,!1))}},fieldWidth:{configurable:!0,enumerable:!0,get:function(){return this.mFieldWidth},set:function(t){t!==this.mFieldWidth&&(this.mFieldWidth=t,this.setDirty(16,!1),this.setTransformDirty())}},fieldHeight:{configurable:!0,enumerable:!0,get:function(){return this.mFieldHeight},set:function(t){t!==this.mFieldHeight&&(this.mFieldHeight=t,this.setDirty(16,!1),this.setTransformDirty())}},text:{configurable:!0,enumerable:!0,get:function(){return this.mText},set:function(t){this.mText!==t&&(this.mText=t,this.setDirty(16,!1),this.setTransformDirty(),this.post(x.CHANGE))}},autoSize:{configurable:!0,enumerable:!0,get:function(){return this.mAutoSize},set:function(t){this.mAutoSize!==t&&(this.mAutoSize=t,this.setDirty(16,!1),this.setTransformDirty())}},padding:{configurable:!0,enumerable:!0,get:function(){return this.mPadding},set:function(t){this.mPadding=t,this.setDirty(16,!1),this.setTransformDirty()}},dropShadow:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.dropShadow},set:function(t){t!==this.mDefaultStyle.dropShadow&&(this.mDefaultStyle.dropShadow=t,this.setDirty(16,!1),this.setTransformDirty())}},shadowColor:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.shadowColor},set:function(t){t!==this.mDefaultStyle.shadowColor&&(this.mDefaultStyle.shadowColor=t,this.setDirty(24,!1))}},shadowAlpha:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.shadowAlpha},set:function(t){t!==this.mDefaultStyle.shadowAlpha&&(this.mDefaultStyle.shadowAlpha=t,this.setDirty(24,!1))}},shadowBlur:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.shadowBlur},set:function(t){t!==this.mDefaultStyle.shadowBlur&&(this.mDefaultStyle.shadowBlur=t,this.setDirty(24,!1))}},shadowDistanceX:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.shadowDistanceX},set:function(t){t!==this.mDefaultStyle.shadowDistanceX&&(this.mDefaultStyle.shadowDistanceX=t,this.setDirty(24,!1))}},shadowDistanceY:{configurable:!0,enumerable:!0,get:function(){return this.mDefaultStyle.shadowDistanceY},set:function(t){t!==this.mDefaultStyle.shadowDistanceY&&(this.mDefaultStyle.shadowDistanceY=t,this.setDirty(24,!1))}},highQuality:{configurable:!0,enumerable:!0,get:function(){return this.mHighQuality},set:function(t){this.mHighQuality=t,this.setDirty(16,!1),this.setTransformDirty()}}});var Fe=function(t,e){e=void 0===e?"":e;var n=st.call(this)||this;return n.mData=null!==t&&t.constructor===String?T.assets.getBitmapFont(t):t,n.mText=e,n.mAutoSize=!0,n.mMultiline=!1,n.mLineHeight=1.2,n.mBounds=new m,n.mTextBounds=new m,n.mFieldWidth=0,n.mFieldHeight=0,n};n.inherits(Fe,st),Fe.prototype.getRenderer=function(){return T.driver.getRenderer("BitmapText",this)},Fe.prototype.onGetLocalBounds=function(t){if(t=t||new m,null!==this.mClipRect)return this.mClipRect.copyTo(t),t;if(16&this.mDirty){var e=this.text;!1===this.mMultiline&&(e=e.replace(/\n/g,"")),z.measureBitmap(e,this.mData,this.mLineHeight,this.mTextBounds)}return!1===this.mAutoSize?(t.width=this.mFieldWidth,t.height=this.mFieldHeight):(t.width=this.mTextBounds.width,t.height=this.mTextBounds.height),t},n.global.Object.defineProperties(Fe.prototype,{multiline:{configurable:!0,enumerable:!0,set:function(t){this.mMultiline=t,this.setDirty(16,!1)},get:function(){return this.mMultiline}},lineHeight:{configurable:!0,enumerable:!0,set:function(t){this.mLineHeight=t,this.setDirty(16,!1)},get:function(){return this.mLineHeight}},fieldWidth:{configurable:!0,enumerable:!0,get:function(){return this.mFieldWidth},set:function(t){t!==this.mFieldWidth&&(this.mFieldWidth=t,this.setDirty(16,!1))}},fieldHeight:{configurable:!0,enumerable:!0,get:function(){return this.mFieldHeight},set:function(t){t!==this.mFieldHeight&&(this.mFieldHeight=t,this.setDirty(16,!1))}},text:{configurable:!0,enumerable:!0,get:function(){return this.mText},set:function(t){this.mText!==t&&(this.mText=t,this.setDirty(16,!1))}},autoSize:{configurable:!0,enumerable:!0,get:function(){return this.mAutoSize},set:function(t){this.mAutoSize!==t&&(this.mAutoSize=t,this.setDirty(16,!1))}}});var ke=function(){return this.value=new d,this};n.inherits(ke,_e),ke.prototype.getValue=function(){return this.getValueAt(Math.random())};var Ue=function(){return this.value=0,this};n.inherits(Ue,_e),Ue.prototype.getValue=function(){return this.getValueAt(Math.random())};var ze=function(t,e,n){e=void 0===e?null:e,n=void 0===n?null:n;var i=Ue.call(this)||this;return i.startColor=t,i.endColor=null===e?t:e,i.ease=n,i};n.inherits(ze,Ue),ze.prototype.getValueAt=function(t){return null!==this.ease&&(t=this.ease(t)),this.value=this.startColor===this.endColor?this.startColor:h.lerpHSV(this.startColor,this.endColor,t)},ze.fromObject=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return e[0]instanceof Ue?e[0]:new(Function.prototype.bind.apply(ze,[null].concat(n.arrayFromIterable(e))))};var He=function(t,e,n,i,r){t=void 0===t?0:t,e=void 0===e?0:e,n=void 0===n?null:n,i=void 0===i?null:i,r=void 0===r?null:r;var o=ke.call(this)||this;return o.minX=t,o.minY=e,o.maxX=null===n?t:n,o.maxY=null===i?e:i,o.ease=r,o};n.inherits(He,ke),He.prototype.getValue=function(){return this.value.x=Math.random()*(this.maxX-this.minX)+this.minX,this.value.y=Math.random()*(this.maxY-this.minY)+this.minY,this.value},He.prototype.getValueAt=function(t){return null!==this.ease&&(t=this.ease(t)),this.value.x=this.minX+t*(this.maxX-this.minX),this.value.y=this.minY+t*(this.maxY-this.minY),this.value},He.fromObject=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return e[0]instanceof ke?e[0]:new(Function.prototype.bind.apply(He,[null].concat(n.arrayFromIterable(e))))};var Ge=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=ke.call(this)||this).mCurve=new y,i.mCurve.baked=!0,i.mCurve.set.apply(i.mCurve,n.arrayFromIterable(e)),i.mPointsCache=e,i.mCache=new d,i};n.inherits(Ge,ke),Ge.prototype.getValueAt=function(t){return this.mCurve.interpolate(t,this.mCache),this.mCache},n.global.Object.defineProperties(Ge.prototype,{points:{configurable:!0,enumerable:!0,set:function(t){this.mPointsCache=t,this.mCurve.set.apply(this.mCurve,n.arrayFromIterable(t))},get:function(){return this.mPointsCache}}});var Ve=function(t,e,n,i){t=void 0===t?0:t,e=void 0===e?0:e,n=void 0===n?0:n,i=void 0===i?null:i;var r=ke.call(this)||this;return r.x=t,r.y=e,r.minRadius=n,r.maxRadius=null===i?n:i,r};n.inherits(Ve,ke),Ve.prototype.getValue=function(){return this.getValueAt(Math.random())},Ve.prototype.getValueAt=function(t){var e=this.minRadius+t*(this.maxRadius-this.minRadius);t=2*Math.random()*Math.PI,e*=e;var n=this.y+Math.sqrt(e)*Math.sin(t);return this.value.x=this.x+Math.sqrt(e)*Math.cos(t),this.value.y=n,this.value};var je=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=xe.call(this)||this).mCurve=new y,i.mCurve.baked=!0,i.mCurve.set.apply(i.mCurve,n.arrayFromIterable(e)),i.mPointsCache=e,i.mCache=new d,i};n.inherits(je,xe),je.prototype.getValueAt=function(t){return this.mCurve.interpolate(t,this.mCache),this.value=this.mCache.y},n.global.Object.defineProperties(je.prototype,{points:{configurable:!0,enumerable:!0,set:function(t){this.mPointsCache=t,this.mCurve.set.apply(this.mCurve,n.arrayFromIterable(t))},get:function(){return this.mPointsCache}}});var We=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this,!1)||this).scatter=He.fromObject.apply(He,n.arrayFromIterable(e)),i};n.inherits(We,Te),We.prototype.update=function(t,e,n){this.scatter.getValue(),e.ax+=this.scatter.value.x,e.ay+=this.scatter.value.y};var Xe=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this,!1)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(Xe,Te),Xe.prototype.update=function(t,e,n){e.alpha=this.scatter.getValueAt(e.energy)};var Ye=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this,!1)||this).scatter=ze.fromObject.apply(ze,n.arrayFromIterable(e)),i};n.inherits(Ye,Te),Ye.prototype.update=function(t,e,n){e.color=this.scatter.getValueAt(e.energy)};var qe=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this,!1)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(qe,Te),qe.prototype.update=function(t,e,n){e.scaleX=e.scaleY=this.scatter.getValueAt(e.energy)};var Ze=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this,!1)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(Ze,Te),Ze.prototype.update=function(t,e,n){e.r=this.scatter.getValueAt(e.energy)};var Je=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this,!1)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(Je,Te),Je.prototype.update=function(t,e,n){e.textureIndex=Math.round(this.scatter.getValueAt(e.energy))};var Ke=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this,!1)||this).scatter=He.fromObject.apply(He,n.arrayFromIterable(e)),i};n.inherits(Ke,Te),Ke.prototype.update=function(t,e,n){this.scatter.getValueAt(e.energy),e.anchorX=this.scatter.value.x,e.anchorY=this.scatter.value.y};var Qe=function(t){t=void 0===t?0:t;var e=Te.call(this,!1)||this;return e.angleShift=t,e};n.inherits(Qe,Te),Qe.prototype.update=function(t,e,n){e.r=(Math.atan2(e.vy,e.vx)*i.RAD2DEG-(90+this.angleShift))*n};var $e=function(t,e,n,i,r){r=void 0===r?.1:r;var o=Te.call(this,!1)||this;return o.x=t,o.y=e,o.width=n,o.height=i,o.resolution=r,o.field=[],o.widthScaled=Math.floor(o.width*o.resolution),o.heightScaled=Math.floor(o.height*o.resolution),o.reset(),o};n.inherits($e,Te),$e.prototype.reset=function(){this.field.splice(0,this.field.length);for(var t=0;t<this.heightScaled;t++)for(var e=0;e<this.widthScaled;e++)this.field.push(new d(0,0))},$e.prototype.setData=function(t){for(var e=0;e<this.heightScaled;e++)for(var n=0;n<this.widthScaled;n++)t(n,e,this.field[n+e*this.widthScaled])},$e.prototype.getVectorAt=function(t,e){return 0>(t=~~((t=Math.floor(t*this.resolution))+(e=Math.floor(e*this.resolution))*this.widthScaled))||t>=this.field.length?null:this.field[t]},$e.prototype.update=function(t,e,n){null!==(t=this.getVectorAt(e.x,e.y))&&(e.ax=t.x,e.ay=t.y)};var tn=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(tn,Te),tn.prototype.update=function(t,e,n){e.life=this.scatter.getValue()};var en=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(en,Te),en.prototype.update=function(t,e,n){e.mass=this.scatter.getValue()};var nn=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(nn,Te),nn.prototype.update=function(t,e,n){e.scaleX=e.scaleY=this.scatter.getValue()};var rn=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=He.fromObject.apply(He,n.arrayFromIterable(e)),i};n.inherits(rn,Te),rn.prototype.update=function(t,e,n){this.scatter.getValue(),e.vx=this.scatter.value.x,e.vy=this.scatter.value.y};var on=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=He.fromObject.apply(He,n.arrayFromIterable(e)),i};n.inherits(on,Te),on.prototype.update=function(t,e,n){t=this.scatter.getValue(),e.x=t.x,e.y=t.y};var an=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(an,Te),an.prototype.update=function(t,e,n){e.r=this.scatter.getValue()};var sn=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=we.fromObject.apply(we,n.arrayFromIterable(e)),i};n.inherits(sn,Te),sn.prototype.update=function(t,e,n){e.textureIndex=Math.round(this.scatter.getValue())};var ln=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=ze.fromObject.apply(ze,n.arrayFromIterable(e)),i};n.inherits(ln,Te),ln.prototype.update=function(t,e,n){e.color=this.scatter.getValue()};var hn=function(t){for(var e=[],i=0;i<arguments.length;++i)e[i-0]=arguments[i];return(i=Te.call(this)||this).scatter=He.fromObject.apply(He,n.arrayFromIterable(e)),i};n.inherits(hn,Te),hn.prototype.update=function(t,e,n){t=this.scatter.getValue(),e.anchorX=t.x,e.anchorY=t.y};var cn=function(){};cn.linear=function(t){return t},cn.quadraticIn=function(t){return t*t},cn.quadraticOut=function(t){return t*(2-t)},cn.quadraticInOut=function(t){return 1>(t*=2)?.5*t*t:-.5*(--t*(t-2)-1)},cn.cubicIn=function(t){return t*t*t},cn.cubicOut=function(t){return--t*t*t+1},cn.cubicInOut=function(t){return 1>(t*=2)?.5*t*t*t:.5*((t-=2)*t*t+2)},cn.quarticIn=function(t){return t*t*t*t},cn.quarticOut=function(t){return 1- --t*t*t*t},cn.quarticInOut=function(t){return 1>(t*=2)?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},cn.quinticIn=function(t){return t*t*t*t*t},cn.quinticOut=function(t){return--t*t*t*t*t+1},cn.quinticInOut=function(t){return 1>(t*=2)?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},cn.sinusoidalIn=function(t){return 1-Math.cos(t*Math.PI/2)},cn.sinusoidalOut=function(t){return Math.sin(t*Math.PI/2)},cn.sinusoidalInOut=function(t){return.5*(1-Math.cos(Math.PI*t))},cn.exponentialIn=function(t){return 0===t?0:Math.pow(1024,t-1)},cn.exponentialOut=function(t){return 1===t?1:1-Math.pow(2,-10*t)},cn.exponentialInOut=function(t){return 0===t?0:1===t?1:1>(t*=2)?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},cn.circularIn=function(t){return 1-Math.sqrt(1-t*t)},cn.circularOut=function(t){return Math.sqrt(1- --t*t)},cn.circularInOut=function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},cn.elasticIn=function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},cn.elasticOut=function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},cn.elasticInOut=function(t){return 0===t?0:1===t?1:1>(t*=2)?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1},cn.backIn=function(t){return t*t*(2.70158*t-1.70158)},cn.backOut=function(t){return--t*t*(2.70158*t+1.70158)+1},cn.backInOut=function(t){return 1>(t*=2)?.5*t*t*(3.5949095*t-2.5949095):.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},cn.bounceIn=function(t){return 1-cn.bounceOut(1-t)},cn.bounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},cn.bounceInOut=function(t){return.5>t?.5*cn.bounceIn(2*t):.5*cn.bounceOut(2*t-1)+.5},cn.smootherStep=function(t){return t*t*t*(t*(6*t-15)+10)};var un,dn=function(){};dn.linear=function(t,e,n){var r=t.length-1,o=r*e,a=Math.floor(o);return n=n||i.lerp,0>e?n(t[0],t[1],o):1<e?n(t[r],t[r-1],r-o):n(t[a],t[a+1>r?r:a+1],o-a)},dn.bezier=function(t,e){for(var n=0,i=t.length,r=Math.pow,o=0;o<i;o++){var a=r(1-e,i-o)*r(e,o)*t[o],s=i,l=o,h=dn.__factorial;n+=a*(s=h(s)/h(l)/h(s-l))}return n},dn.catmullRom=function(t,e){var n=t.length-1,i=n*e,r=Math.floor(i),o=function(t,e,n,i,r){var o=r*r;return(2*(e-n)+(t=.5*(n-t))+(i=.5*(i-e)))*r*o+(3*(n-e)-2*t-i)*o+t*r+e};return t[0]===t[n]?(0>e&&(r=Math.floor(i=n*(1+e))),o(t[(r-1+n)%n],t[r],t[(r+1)%n],t[(r+2)%n],i-r)):0>e?t[0]-(o(t[0],t[0],t[1],t[1],-i)-t[0]):1<e?t[n]-(o(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):o(t[r?r-1:0],t[r],t[n<r+1?n:r+1],t[n<r+2?n:r+2],i-r)},dn.__factorial=(un=[1],function(t){if(un[t])return un[t];for(var e=t;--t;)e*=t;return un[t]=e});var pn=cn.smootherStep,mn=function(t,e,n,i){e=void 0===e?.25:e,n=void 0===n?null:n,i=void 0===i?null:i;var r=X.call(this)||this;if(r.mValues=t,r.mDuration=e,r.mProperties=n,r.mPlugins=i,r.mIsPlaying=!1,r.mIsPaused=!1,r.mStartTime=0,r.mPausedTime=0,r.mValuesStart={},r.mElapsed=0,r.mInterpolation=dn.linear,r.mDelay=0,r.mRepeatDelay=0,r.mRepeats=0,r.mInitiated=!1,r.mStarted=!1,r.mReversed=!1,r.mYoyo=!1,r.mIsYoyoBack=!1,r.mReverseOnInit=!1,r.mRemoveOnComplete=!0,r.mPlayOnAdded=!0,r.mEase=pn,null!==r.mProperties)for(var o in r.mProperties)r[o]=r.mProperties[o];return r};n.inherits(mn,X),mn.prototype.__start=function(t){this.mIsPlaying=!0,this.mStartTime=t+this.mDelay},mn.prototype.play=function(){return this.mIsPaused?this.__resume():this.__start(T.time.now),this},mn.prototype.stop=function(){return this.mIsPlaying?(this.mIsPlaying=!1,this):this},mn.prototype.reset=function(){return this.mElapsed=0,this.mIsPlaying&&this.play(),this},mn.prototype.to=function(t,e){return this.mValues=t=void 0===t?{}:t,this.mDuration=void 0===e?.25:e,this.mInitiated=!1,this},mn.prototype.pause=function(){return this.mIsPlaying?(this.mIsPaused=!0,this.mPausedTime=T.time.now,this):this},mn.prototype.__resume=function(){this.mIsPaused&&(this.mIsPaused=!1,this.mStartTime+=T.time.now-this.mPausedTime)},mn.prototype.removeFromParent=function(){this.mIsPlaying&&this.stop(),X.prototype.removeFromParent.call(this)},mn.prototype.chain=function(t){return t?(this.mRemoveOnComplete=!1,t.playOnAdded=!1,this.on(x.COMPLETE,(function(){t.play()})),t):this},mn.prototype.onAdded=function(t){this.mPlayOnAdded&&this.__start(T.time.now)},mn.prototype.__update=function(t){},mn.prototype.set=function(t){for(var e in this.mValues=t,this.mValues)this.mValuesStart[e]=parseFloat(this.gameObject[e])},mn.prototype.reverse=function(t){return t=void 0!==t&&t,this.mInitiated?this.__reverse():this.mReverseOnInit=!0,t&&(this.mIsYoyoBack=!this.mIsYoyoBack),this},mn.prototype.__reverse=function(){for(var t in this.mValues){var e=n.makeIterator([this.mValuesStart[t],this.mValues[t]]);this.mValues[t]=e.next().value,this.mValuesStart[t]=e.next().value}},mn.prototype.onRender=function(){if(0===T.engine.numUpdates){var t=T.time.now;if(!(t<this.mStartTime||!1===this.mIsPlaying||!0===this.mIsPaused)&&!1!==this.mStarted&&!1!==this.mInitiated)for(var e in this.mElapsed=(t-this.mStartTime)/this.mDuration,1<this.mElapsed&&(this.mElapsed=1),t=this.mEase(this.mIsYoyoBack?1-this.mElapsed:this.mElapsed),this.mValues){var n=this.mValuesStart[e],i=this.mValues[e];null!==this.mPlugins&&this.mPlugins.hasOwnProperty(e)?(n=Array.isArray(i)?i:[n,i],this.gameObject[e]=dn.linear(n,t,this.mPlugins[e])):Array.isArray(i)?this.gameObject[e]=this.mInterpolation(i,t):this.gameObject[e]=n+(i-n)*(this.mIsYoyoBack?1-t:t)}}},mn.prototype.onUpdate=function(){var t=T.time.now;if(!(t<this.mStartTime||!1===this.mIsPlaying||!0===this.mIsPaused)){this.__collectStartingValues(),this.mElapsed=(t-this.mStartTime)/this.mDuration,1<this.mElapsed&&(this.mElapsed=1);var e,n=this.mEase(this.mIsYoyoBack?1-this.mElapsed:this.mElapsed);for(e in this.mValues){var i=this.mValuesStart[e],r=this.mValues[e];null!==this.mPlugins&&this.mPlugins.hasOwnProperty(e)?(i=Array.isArray(r)?r:[i,r],this.gameObject[e]=dn.linear(i,n,this.mPlugins[e])):Array.isArray(r)?this.gameObject[e]=this.mInterpolation(r,n):this.gameObject[e]=i+(r-i)*(this.mIsYoyoBack?1-n:n)}if(this.post(x.UPDATE,this.gameObject),1===this.mElapsed)if(0<this.mRepeats--)!0===this.mYoyo&&this.reverse(!0),this.mStartTime=t+this.mRepeatDelay,this.post("loop",this.gameObject);else if(this.mIsPlaying=!1,this.post(x.COMPLETE,this.gameObject),this.mRemoveOnComplete)this.removeFromParent();else{for(var o in this.mValues)this.mValuesStart[o]=this.mValues[o];this.mStarted=!1}}},mn.prototype.__collectStartingValues=function(){if(!1===this.mStarted){for(var t in this.mStarted=!0,this.post("start",this.gameObject),this.mValues)!this.mInitiated&&Array.isArray(this.mValues[t])&&(this.mValues[t]=[this.gameObject[t]].concat(this.mValues[t])),this.mValuesStart[t]=parseFloat(this.gameObject[t]);!0!==this.mReversed&&!0!==this.mReverseOnInit||this.__reverse(),this.mInitiated=!0}},n.global.Object.defineProperties(mn.prototype,{ease:{configurable:!0,enumerable:!0,get:function(){return this.mEase},set:function(t){this.mEase=t}},interpolation:{configurable:!0,enumerable:!0,get:function(){return this.mInterpolation},set:function(t){this.mInterpolation=t}},elapsed:{configurable:!0,enumerable:!0,get:function(){return this.mElapsed}},delay:{configurable:!0,enumerable:!0,get:function(){return this.mDelay},set:function(t){this.mDelay=t}},repeats:{configurable:!0,enumerable:!0,get:function(){return this.mRepeats},set:function(t){this.mRepeats=t}},repeatDelay:{configurable:!0,enumerable:!0,get:function(){return this.mRepeatDelay},set:function(t){this.mRepeatDelay=t}},loop:{configurable:!0,enumerable:!0,get:function(){return 1/0===this.mRepeats},set:function(t){this.mRepeats=t?1/0:0}},yoyo:{configurable:!0,enumerable:!0,get:function(){return this.mYoyo},set:function(t){this.mYoyo=t}},reversed:{configurable:!0,enumerable:!0,get:function(){return this.mReversed},set:function(t){this.mReversed=t}},removeOnComplete:{configurable:!0,enumerable:!0,get:function(){return this.mRemoveOnComplete},set:function(t){this.mRemoveOnComplete=t}},playOnAdded:{configurable:!0,enumerable:!0,get:function(){return this.mPlayOnAdded},set:function(t){this.mPlayOnAdded=t}},plugins:{configurable:!0,enumerable:!0,get:function(){return this.mPlugins},set:function(t){this.mPlugins=t}},duration:{configurable:!0,enumerable:!0,get:function(){return this.mDuration}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return!0===this.mIsPlaying&&!1===this.mIsPaused}}}),n.global.Object.defineProperties(mn,{defaultEase:{configurable:!0,enumerable:!0,get:function(){return pn},set:function(t){pn=t}}});var fn=function(t,n,i,r,o){r=void 0===r?14:r,o=void 0===o||o,e.assert(0<r,"FPS must be greater than 0."),this.mController=t,this.mName=n,this.mFrames=i,this.mNextFrameAt=this.mCurrentFrame=0,this.mFPS=r,this.mFrameDuration=1/this.mFPS,this.mLoop=o,this.mPaused=!1,this.mElapsed=0,this.mCompleted=this.mStopped=!1};fn.prototype.__play=function(){return!0===this.mCompleted&&(this.mElapsed=this.mCurrentFrame=0),this.mCompleted=this.mStopped=this.mPaused=!1,this.mNextFrameAt=T.time.now+this.mFrameDuration-this.mElapsed,this.mElapsed=0,this.mFrames[this.mCurrentFrame]},fn.prototype.__stop=function(){this.mStopped=!0,this.mCurrentFrame=0},fn.prototype.__pause=function(){this.mPaused=!0,this.mElapsed=this.mNextFrameAt-T.time.now},fn.prototype.__update=function(){if(T.time.now<this.mNextFrameAt||!0===this.mPaused||!0===this.mStopped||!0===this.mCompleted)return null;if(this.mCurrentFrame++,this.mCurrentFrame>=this.mFrames.length){if(!0!==this.mLoop)return this.mCurrentFrame=this.mFrames.length-1,this.mController.post(x.COMPLETE,this),this.mCompleted=!0,null;this.mCurrentFrame=0}return this.mNextFrameAt=T.time.now+this.mFrameDuration,this.mFrames[this.mCurrentFrame]},n.global.Object.defineProperties(fn.prototype,{fps:{configurable:!0,enumerable:!0,get:function(){return this.mFPS},set:function(t){e.assert(0<t,"FPS must be greater than 0."),this.mFPS=t,this.mFrameDuration=1/this.mFPS,this.mNextFrameAt+=this.mNextFrameAt-T.time.now}},loop:{configurable:!0,enumerable:!0,get:function(){return this.mLoop},set:function(t){this.mLoop=t}},frames:{configurable:!0,enumerable:!0,get:function(){return this.mFrames}},isPlaying:{configurable:!0,enumerable:!0,get:function(){return!1===this.mPaused&&!1===this.mStopped}},isComplete:{configurable:!0,enumerable:!0,get:function(){return this.mCompleted}},name:{configurable:!0,enumerable:!0,get:function(){return this.mName}}});var gn=function(){var t=X.call(this)||this;return t.mAnimations={},t.mCurrentAnim=null,t};n.inherits(gn,X),gn.prototype.getByName=function(t){return e.assert(null!==t,"Animation must be set first."),e.assert(this.mAnimations.hasOwnProperty(t),"Animation must be set first."),this.mAnimations[t]},gn.prototype.remove=function(t){e.assert(null!==t,"Animation name shall not be null."),e.assert(!0===this.mAnimations.hasOwnProperty(t),"Unable to find animation.");var n=this.mAnimations[t];null!==this.mCurrentAnim&&this.mCurrentAnim===n&&(this.stop(),delete this.mAnimations[t]),this.mCurrentAnim=null},gn.prototype.add=function(t,n,i,r){return i=void 0===i?14:i,r=void 0===r||r,e.assert(0<n.length,"Animation cannot be empty."),e.assert(0<i,"FPS must be greater than 0."),e.assert(0==this.mAnimations.hasOwnProperty(t),"Animation with same name already exists"),n=new fn(this,t,n,i,r),this.mAnimations[t]=n},gn.prototype.play=function(t){e.assert(this.mAnimations.hasOwnProperty(t),"Animation must be set first."),this.mCurrentAnim=this.mAnimations[t],t=this.mCurrentAnim.__play();var n=this.gameObject;null!==n&&null!==t&&(n.texture=t)},gn.prototype.stop=function(){null!==this.mCurrentAnim&&this.mCurrentAnim.__stop()},gn.prototype.pause=function(){null!==this.mCurrentAnim&&this.mCurrentAnim.__pause()},gn.prototype.onRender=function(){if(null!==this.mCurrentAnim){var t=this.mCurrentAnim.__update();null!==t&&(this.gameObject.texture=t)}},n.global.Object.defineProperties(gn.prototype,{currentAnimation:{configurable:!0,enumerable:!0,get:function(){return this.mCurrentAnim}}});var vn=function(t){t=void 0===t?.5:t;var e=kt.call(this)||this;return e.mWaveShaperNode=T.audio.context.createWaveShaper(),e.mInputNode=e.mWaveShaperNode,e.mOutputNode=e.mWaveShaperNode,e.mSamples=44100,e.mCurve=new Float32Array(e.mSamples),e.mValue=t,e.distortion=t,e};n.inherits(vn,kt),vn.prototype.__makeDistortionCurve=function(t,e,n){t=~~(100*t);for(var i,r=Math.PI/180,o=0;o<e;++o)i=2*o/e-1,n[o]=(3+t)*i*20*r/(Math.PI+t*Math.abs(i));return n},n.global.Object.defineProperties(vn.prototype,{distortion:{configurable:!0,enumerable:!0,set:function(t){this.mValue=i.clamp(t,0,1),this.__makeDistortionCurve(this.mValue,this.mSamples,this.mCurve),this.mWaveShaperNode.curve=this.mCurve},get:function(){return this.mValue}}});var yn=function(t){for(var e=[],n=0;n<arguments.length;++n)e[n-0]=arguments[n];e=e||[60,170,310,600,1e3,3e3,6e3,12e3,14e3,16e3],(n=kt.call(this)||this).mFilters=[];for(var i=0;i<e.length;i++)n.mFilters.push(n.__createFilter(e[i])),0<i&&n.mFilters[i-1].connect(n.mFilters[i]);return n.mInputNode=n.mFilters[0],n.mOutputNode=n.mFilters[n.mFilters.length-1],n.mMaxGainLevel=16,n.mPresets={},n};n.inherits(yn,kt),yn.prototype.__createFilter=function(t){var e=T.audio.context.createBiquadFilter();return e.type="peaking",e.frequency.setValueAtTime(t,0),e.Q.setValueAtTime(1,0),e.gain.setValueAtTime(0,0),e},yn.prototype.setLevelByIndex=function(t,n){e.assert(0<=t&&t<this.mFilters.length,"Frequency index is out of range"),0>t||t>=this.mFilters.length||(n=i.clamp(n,-1,1),n*=this.mMaxGainLevel,this.mFilters[t].gain.setValueAtTime(n,0))},yn.prototype.setLevelByFrequency=function(t,e){for(var n=0;n<this.mFilters.length;n++)this.mFilters[n].frequency.value===t&&this.setLevelByIndex(n,e)},yn.prototype.addPreset=function(t,n){for(var i=[],r=1;r<arguments.length;++r)i[r-1]=arguments[r];e.assert(i.length!=this.mFilters.length,"Number of preset values must be equal to frequencies number"),this.mPresets[t]=i},yn.prototype.savePreset=function(t){var e=this;this.mPresets[t]=[],this.mFilters.forEach((function(n){return e.mPresets[t].push(n.frequency.value/e.mMaxGainLevel)}))},yn.prototype.applyPreset=function(t){if(null!==this.mPresets[t])for(var e=0;e<this.mPresets[t].length;e++)this.setLevelByIndex(e,this.mPresets[t][e])};var bn=function(t){var e=kt.call(this)||this;return e.mInputNode=T.audio._newGainNode(),e.mOutputNode=T.audio._newGainNode(),e.mConvolver=T.audio.context.createConvolver(),e.mDry=T.audio._newGainNode(),e.mWet=T.audio._newGainNode(),e.mTone=T.audio.context.createBiquadFilter(),e.mConvolver.buffer=t,e.mInputNode.connect(e.mDry),e.mDry.connect(e.mOutputNode),e.mInputNode.connect(e.mTone),e.mTone.connect(e.mConvolver),e.mConvolver.connect(e.mWet),e.mWet.connect(e.mOutputNode),e.mDry.gain.setValueAtTime(1,0),e.mWet.gain.setValueAtTime(0,0),e.mTone.type="lowpass",e.mTone.frequency.setValueAtTime(350,0),e.mTone.Q.setValueAtTime(Math.SQRT1_2,0),e};n.inherits(bn,kt),n.global.Object.defineProperties(bn.prototype,{wet:{configurable:!0,enumerable:!0,set:function(t){t=i.clamp(t,0,1),this.mWet.gain.setValueAtTime(t,0)},get:function(){return this.mWet.gain.value}},dry:{configurable:!0,enumerable:!0,set:function(t){t=i.clamp(t,0,1),this.mDry.gain.setValueAtTime(t,0)},get:function(){return this.mDry.gain.value}},tone:{configurable:!0,enumerable:!0,set:function(t){t=i.clamp(t,10,T.audio.context.sampleRate/2),this.mTone.frequency.setValueAtTime(t,0)},get:function(){return this.mTone.frequency.value}}});var _n=function(t,e,n,i){e=void 0===e?"master":e,n=void 0!==n&&n,i=void 0===i?100:i;var r=X.call(this)||this;return r.mSoundClip=T.assets.getSound(t),r.mRolloff=i,r.mPlayOnAdded=!0,r.mStopOnRemove=!0,r.mSoundInstance=null,r.mCompleteBinding=null,r.mSpatialEffect=n,r.mChannelName=e,r};n.inherits(_n,X),_n.prototype.play=function(t,e,n){return t=void 0===t?1:t,e=void 0!==e&&e,(n=void 0!==n&&n)&&this.mSoundInstance&&this.stop(),this.mSoundInstance&&!n||(this.mSoundInstance=this.mSoundClip.play(this.mChannelName,t,e),this.mCompleteBinding=this.mSoundInstance.on(x.COMPLETE,this.__onSoundComplete,this),this.spatialEffect=this.mSpatialEffect),this.mSoundInstance},_n.prototype.stop=function(){this.mSoundInstance&&(this.mCompleteBinding.off(),this.mSoundInstance.stop(),this.mSoundInstance=null)},_n.prototype.__onSoundComplete=function(){this.mSoundInstance=null},_n.prototype.onAdded=function(t){this.mPlayOnAdded&&this.play()},_n.prototype.onRemoved=function(t){this.mStopOnRemove&&this.mSoundInstance&&this.mSoundInstance.stop()},_n.prototype.onUpdate=function(){if(this.mSpatialEffect&&null!=this.mSoundInstance&&!0===this.mSoundInstance.isPlaying){var t=T.stage,e=this.gameObject.localToGlobal(t.globalToLocal(new d(this.gameObject.pivotX,this.gameObject.pivotY)));this.mSoundInstance.mSpatialPanner.setPosition((e.x-t.centerX)/t.width*2,(e.y-t.centerY)/t.height*2,0)}},n.global.Object.defineProperties(_n.prototype,{playOnAdded:{configurable:!0,enumerable:!0,set:function(t){this.mPlayOnAdded=t},get:function(){return this.mPlayOnAdded}},stopOnRemove:{configurable:!0,enumerable:!0,set:function(t){this.mStopOnRemove=t},get:function(){return this.mStopOnRemove}},spatialEffect:{configurable:!0,enumerable:!0,set:function(t){(this.mSpatialEffect=t)&&null!=this.mSoundInstance&&!0===this.mSoundInstance.isPlaying&&((t=this.mSoundInstance.enableSpacePan()).rolloffFactor=this.mRolloff,t.refDistance=1,t.distanceModel="inverse")},get:function(){return this.mSpatialEffect}}});var xn=function(){return X.call(this)||this};n.inherits(xn,X),xn.prototype.onRemoved=function(t){this.loose()},xn.prototype.listen=function(){T.audio.currentListener=this},xn.prototype.loose=function(){T.audio.looseListener()},xn.prototype.onRender=function(){if(T.audio.currentListener===this){var t=T.audio.context.listener,e=T.stage,n=this.gameObject.localToGlobal(e.globalToLocal(new d(this.gameObject.pivotX,this.gameObject.pivotY))),i=(n.x-e.centerX)/e.width*2;e=(n.y-e.centerY)/e.height*2,null!=t.positionX?(t.positionX.setValueAtTime(i,0),t.positionY.setValueAtTime(e,0),t.positionZ.setValueAtTime(1,0)):t.setPosition(i,e,1)}};var wn=function(){var t=X.call(this)||this;return t.mCollider=new yt(0,0,0,0),t.mInGroup=!1,t.mIsSleeping=!1,t.mSleepTime=0,t.mContacts=[],t.mPivot=new d(Number.MAX_VALUE),t.mCachedPosition=new d,t.mPairs=[],t.mIsStatic=!1,t.mPosition=new d,t.mVelocity=new d,t.mForce=new d,t.mTransform=new f(Number.MAX_VALUE),t.mMass=1,t.mInvMass=1,t.frictionAir=.01,t.friction=.1,t.bounce=.1,t};n.inherits(wn,X),wn.prototype.update=function(){var t=this.gameObject,e=t.mCollidersCache,n=this.mCollider,i=this.mPosition,r=t.worldTransformation,o=r.data,a=this.mTransform;if(a.data[0]!==o[0]||a.data[2]!==o[2]){a.set(o[0],o[1],o[2],o[3],0,0),n.mChanged=!0,o=0;for(var s=e.length;o<s;o++)e[o].mChanged=!0}if(t!==T.stage){s=(o=this.mCachedPosition).x;var l=o.y;r.transformXY(t.pivotX,t.pivotY,o),i.x+=o.x-s,i.y+=o.y-l,t.parent.globalToLocal(i,o),t.x=o.x,t.y=o.y,t.worldTransformation.transformXY(t.pivotX,t.pivotY,o)}if(0===e.length)e=t.localBounds,t instanceof st&&null!==t.mClipRect?n.set(0,0,e.width,e.height):n.set(-t.pivotX,-t.pivotY,e.width,e.height),n.refresh(a,i);else for(t=0,n=e.length;t<n;t++)e[t].refresh(a,i)},wn.prototype.clearFlags=function(){var t=this.gameObject.mCollidersCache;this.mCollider.mChanged=!1;for(var e=0,n=t.length;e<n;e++)t[e].mChanged=!1},n.global.Object.defineProperties(wn.prototype,{mass:{configurable:!0,enumerable:!0,get:function(){return this.mMass},set:function(t){this.mMass=t,this.mInvMass=0===t||this.mIsStatic?0:1/t}},isStatic:{configurable:!0,enumerable:!0,get:function(){return this.mIsStatic},set:function(t){this.mIsStatic=t,this.mass=this.mMass}},x:{configurable:!0,enumerable:!0,set:function(t){this.mPosition.x=t},get:function(){return this.mPosition.x}},y:{configurable:!0,enumerable:!0,set:function(t){this.mPosition.y=t},get:function(){return this.mPosition.y}},forceX:{configurable:!0,enumerable:!0,set:function(t){this.mIsSleeping=!1,this.mForce.x=t},get:function(){return this.mForce.x}},forceY:{configurable:!0,enumerable:!0,set:function(t){this.mIsSleeping=!1,this.mForce.y=t},get:function(){return this.mForce.y}},velocityX:{configurable:!0,enumerable:!0,set:function(t){this.mVelocity.x=t},get:function(){return this.mVelocity.x}},velocityY:{configurable:!0,enumerable:!0,set:function(t){this.mVelocity.y=t},get:function(){return this.mVelocity.y}}});var Mn=function(){this.verticesB=this.verticesA=this.axis=null,this.rangeA=new Sn,this.rangeB=new Sn,this.offset=0};Mn.prototype.set=function(t,e,n){this.verticesA=t,this.verticesB=e,this.axis=n,this.refresh()},Mn.prototype.refresh=function(){Mn.__project(this.verticesA,this.axis,this.rangeA),Mn.__project(this.verticesB,this.axis,this.rangeB)},Mn.__project=function(t,e,n){for(var i=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=0,a=t.length;o<a;o++){var s=t[o].dot(e);i=s<i?s:i,r=s>r?s:r}n.min=i,n.max=r};var Sn=function(){this.max=this.min=0},Tn=5,En=1,An=.2,Cn=1,Pn=.1,Ln=1,Rn=function(){this.bodyB=this.bodyA=this.b=this.a=null,this.mIsStatic=this.mInCollision=!1,this.mMass=this.mBias=this.mFriction=this.mPositionImpulse=this.mTangentImpulse=this.mNormalImpulse=0,this.mOffset=new d,this.mNormal=new d,this.mOverlap=0,this.mChanged=!1};Rn.prototype.test=function(){return this.mInCollision},Rn.prototype.preSolve=function(){var t=this.mNormal.x,e=this.mNormal.y,n=this.bodyA.mPosition,i=this.bodyB.mPosition,r=this.bodyA.mVelocity,o=this.bodyB.mVelocity,a=this.bodyA.mInvMass,s=this.bodyB.mInvMass,l=this.mOffset,h=this.mNormalImpulse*t+this.mTangentImpulse*-e,c=this.mNormalImpulse*e+this.mTangentImpulse*+t;l.x=i.x-n.x,l.y=i.y-n.y,r.x-=h*a,r.y-=c*a,o.x+=h*s,o.y+=c*s,t=(o.x-r.x)*t+(o.y-r.y)*e,this.mBias=t<-Rn.bounceTreshhold*Rn.unitsPerMeter*T.stage.mScaleX?-Math.max(this.bodyA.bounce,this.bodyB.bounce)*t:0,this.mMass=1/(a+s),this.mFriction=Math.min(this.bodyA.friction,this.bodyB.friction),this.mPositionImpulse=0},Rn.prototype.solveVelocity=function(){var t=this.mNormal.x,e=this.mNormal.y,n=-e,r=+t,o=this.bodyA.mVelocity,a=this.bodyB.mVelocity,s=this.bodyA.mInvMass,l=this.bodyB.mInvMass,h=-((a.x-o.x)*t+(a.y-o.y)*e-this.mBias)*this.mMass,c=Math.max(this.mNormalImpulse+h,0);h=c-this.mNormalImpulse,this.mNormalImpulse=c,t*=h,e*=h,o.x-=t*s,o.y-=e*s,a.x+=t*l,a.y+=e*l,e=-((a.x-o.x)*n+(a.y-o.y)*r)*this.mMass,h=this.mFriction*this.mNormalImpulse,e=(h=i.clamp(this.mTangentImpulse+e,-h,h))-this.mTangentImpulse,this.mTangentImpulse=h,n*=e,r*=e,o.x-=n*s,o.y-=r*s,a.x+=n*l,a.y+=r*l},Rn.prototype.solvePosition=function(){var t=this.mNormal.x,e=this.mNormal.y,n=this.bodyA.mInvMass,i=this.bodyB.mInvMass,r=this.bodyA.mPosition,o=this.bodyB.mPosition,a=this.mOffset;if(!(0>=(a=(this.mOverlap+((a.x-o.x+r.x)*t+(a.y-o.y+r.y)*e)-Rn.slop)*Rn.baumgarte))){a*=this.mMass;var s=this.mPositionImpulse;this.mPositionImpulse=Math.max(s+a,0),t*=a=this.mPositionImpulse-s,e*=a,r.x-=t*n,r.y-=e*n,o.x+=t*i,o.y+=e*i}},Rn.__id=function(t,e){return t.mId>e.mId?t.mId+"&"+e.mId:e.mId+"&"+t.mId},n.global.Object.defineProperties(Rn,{timeToSleep:{configurable:!0,enumerable:!0,get:function(){return Tn},set:function(t){Tn=t}},slop:{configurable:!0,enumerable:!0,get:function(){return En},set:function(t){En=t}},baumgarte:{configurable:!0,enumerable:!0,get:function(){return An},set:function(t){An=t}},unitsPerMeter:{configurable:!0,enumerable:!0,get:function(){return Cn},set:function(t){Cn=t}},sleepThreshold:{configurable:!0,enumerable:!0,get:function(){return Pn},set:function(t){Pn=t}},bounceTreshhold:{configurable:!0,enumerable:!0,get:function(){return Ln},set:function(t){Ln=t}}});var On=null,In=function(){var t=Rn.call(this)||this;t.a=null,t.b=null;for(var e=[],n=0;4>n;n++)e.push(new Mn);return t.mProjections=e,t};n.inherits(In,Rn),In.prototype.set=function(t,e,n,i){this.a=t,this.b=e,this.bodyA=n,this.bodyB=i,n=this.mProjections;for(var r=i=0;4>i;i+=2,r+=1)n[i].set(t.mVertices,e.mVertices,t.mNormals[r]),n[i+1].set(t.mVertices,e.mVertices,e.mNormals[r]);return this},In.prototype.__refreshProjectionsRanges=function(){for(var t=this.mProjections,e=0;4>e;e++)t[e].refresh()},In.prototype.test=function(){var t=this.a,e=this.b;if((t.mChanged||e.mChanged)&&(this.mChanged=!0),t.mMax.x<e.mMin.x||t.mMin.x>e.mMax.x||t.mMax.y<e.mMin.y||t.mMin.y>e.mMax.y)return this.mInCollision=!1;t=this.mProjections,e=this.mNormal;var n=this.bodyB.mPosition.x-this.bodyA.mPosition.x,i=this.bodyB.mPosition.y-this.bodyA.mPosition.y;this.mChanged&&(this.mChanged=!1,this.__refreshProjectionsRanges()),this.mOverlap=Number.MAX_VALUE;for(var r=0;4>r;r++){var o=t[r];o.offset=o.axis.x*n+o.axis.y*i;var a=o.rangeA.max,s=o.rangeB.min+o.offset;if(o.rangeA.min>o.rangeB.max+o.offset||s>a)return this.mInCollision=!1}for(n=0;4>n;n++){r=(i=t[n]).rangeA.min;var l=(o=i.rangeA.max)-(a=i.rangeB.min+i.offset),h=(s=i.rangeB.max+i.offset)-r;l=l<h?l:-h,r<a&&o<s?l=o-a:o>s&&(l=r-s),(r=Math.abs(l))<this.mOverlap&&(this.mOverlap=r,e.copyFrom(i.axis),0>l&&e.multiplyScalar(-1))}return this.mInCollision=!0},n.global.Object.defineProperties(In,{pool:{configurable:!0,enumerable:!0,get:function(){return null===On&&(On=new a(In,100)),On}}});var Nn=null,Dn=function(){var t=Rn.call(this)||this;return t.a=null,t.b=null,t.mBoxHalfWidth=0,t.mBoxHalfHeight=0,t.mBoxRotate=new d,t.mCircleCenter=new d,t};n.inherits(Dn,Rn),Dn.prototype.set=function(t,e,n,i){return this.a=t,this.b=e,this.bodyA=n,this.bodyB=i,this},Dn.prototype.__rotate=function(t,e,n,i,r){var o=t.x-e,a=t.y-n;t.x=i*o-r*a+e,t.y=r*o+i*a+n},Dn.prototype.test=function(){var t=this.a,e=this.b;if(t.mChanged&&(this.mChanged=!0),t.mMax.x<e.mMin.x||t.mMin.x>e.mMax.x||t.mMax.y<e.mMin.y||t.mMin.y>e.mMax.y)return this.mInCollision=!1;if(this.mChanged){this.mChanged=!1;var n=this.bodyA.mTransform.data,r=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=Math.sqrt(n[2]*n[2]+n[3]*n[3]);this.mBoxRotate.set(n[0]/r,n[1]/r),this.mBoxHalfWidth=t.mRect.width/2*r,this.mBoxHalfHeight=t.mRect.height/2*o}n=this.mBoxRotate,r=this.mNormal;var a=this.mCircleCenter.copyFrom(e.mCenter),s=this.mBoxHalfWidth,l=this.mBoxHalfHeight;(o=0!==n.y)&&this.__rotate(a,t.mCenter.x,t.mCenter.y,n.x,-n.y);var h=a.x-t.mCenter.x;if(a=a.y-t.mCenter.y,0===h&&0===a)return this.mOverlap=e.mRadius+s,r.set(-1,0),this.mInCollision=!0;var c=i.clamp(h,-s,s),u=i.clamp(a,-l,l);return(t=h===c&&a===u)&&(Math.abs(h)>Math.abs(a)?c=0<c?s:-s:u=0<u?l:-l),(h=(s=h-c)*s+(l=a-u)*l)>(e=e.mRadius)*e&&!t?this.mInCollision=!1:(0===h?(this.mOverlap=e,r.set(0,1)):(h=Math.sqrt(h),this.mOverlap=e-h,t?r.set(-s/h,-l/h):r.set(s/h,l/h)),o&&this.__rotate(r,0,0,n.x,n.y),this.mInCollision=!0)},n.global.Object.defineProperties(Dn,{pool:{configurable:!0,enumerable:!0,get:function(){return null===Nn&&(Nn=new a(Dn,100)),Nn}}});var Bn=null,Fn=function(){var t=Rn.call(this)||this;return t.a=null,t.b=null,t};n.inherits(Fn,Rn),Fn.prototype.set=function(t,e,n,i){return this.a=t,this.b=e,this.bodyA=n,this.bodyB=i,this},Fn.prototype.test=function(){var t=this.a,e=this.b,n=e.mCenter.x-t.mCenter.x,i=e.mCenter.y-t.mCenter.y;return t=t.mRadius+e.mRadius,0===n&&0===i?(this.mOverlap=t,this.mNormal.set(1,0),this.mInCollision=!0):(e=n*n+i*i)>t*t?this.mInCollision=!1:(e=Math.sqrt(e),this.mOverlap=t-e,this.mNormal.set(n/e,i/e),this.mInCollision=!0)},n.global.Object.defineProperties(Fn,{pool:{configurable:!0,enumerable:!0,get:function(){return null===Bn&&(Bn=new a(Fn,100)),Bn}}});var kn=function(){};kn.prototype.test=function(t){};var Un=function(){var t=G.call(this)||this;return t.mBodies=[],t.mPairs=[],t.mContacts=[],t.mBroadPhase=new kn,t.mPairsHash=Object.create(null),t.mBoundsBody=null,t.mBoundsLeft=new yt(0,0,0,0),t.mBoundsRight=new yt(0,0,0,0),t.mBoundsTop=new yt(0,0,0,0),t.mBoundsBottom=new yt(0,0,0,0),t.mGravity=new d(0,1e3),t.mIterations=5,t.mSleepEnabled=!0,t.delta=1/60,t};n.inherits(Un,G),Un.prototype.collisionInfo=function(t,e,i,r,o){for(var a=[],s=4;s<arguments.length;++s)a[s-4]=arguments[s];if((s=this.mPairsHash[Rn.__id(t,e)])&&s.mInCollision){var l=s.a===t?1:-1;i.call.apply(i,[r,s.mNormal.x*l,s.mNormal.y*l,s.mOverlap].concat(n.arrayFromIterable(a)))}},Un.prototype.isColliding=function(t,e,i,r,o){for(var a=[],s=4;s<arguments.length;++s)a[s-4]=arguments[s];if(e=void 0===e?null:e,i=void 0===i?null:i,r=void 0===r?null:r,s=t.mPairs,null===e){a=0;for(var l=s.length;a<l;a++)if(s[a].mInCollision)return!0;return!1}l=0;for(var h=s.length;l<h;l++){var c=s[l];if(!1!==c.mInCollision){var u=c.bodyA===t&&c.bodyB===e?1:c.bodyA===e&&c.bodyB===t?-1:0;if(0!==u)return i&&i.call.apply(i,[r,c.mNormal.x*u,c.mNormal.y*u,c.mOverlap].concat(n.arrayFromIterable(a))),!0}}return!1},Un.prototype.onChildrenAdded=function(t){var e=this;it.forEach(t,(function(t){(t=t.getComponent(wn))&&e.__addBody(t)}))},Un.prototype.onChildrenRemoved=function(t){var e=this;it.forEach(t,(function(n){(n=n.getComponent(wn))&&e.__removeBody(n,t)}))},Un.prototype.onComponentAdded=function(t,e){e instanceof wn?this.__addBody(e):e instanceof tt&&this.__addCollider(t,e)},Un.prototype.onComponentRemoved=function(t,e){e instanceof wn?this.__removeBody(e,t):e instanceof tt&&this.__removeCollider(t,e)},Un.prototype.__addBody=function(t){var e=this.mBodies,n=t.gameObject.mCollidersCache;if(t.mPairs.length=0,0===n.length)this.__addPairs(t.mCollider,t);else for(var i=0,r=n.length;i<r;i++)this.__addPairs(n[i],t);e.push(t)},Un.prototype.__removeBody=function(t,e){var n=this.mBodies;if(0===(e=e.mCollidersCache).length)this.__removePairs(t.mCollider);else for(var i=0,r=e.length;i<r;i++)this.__removePairs(e[i]);t.mPairs.length=0,n.splice(n.indexOf(t),1)},Un.prototype.__addCollider=function(t,e){var n=t.getComponent(wn);n&&-1!==this.mBodies.indexOf(n)&&(this.__addPairs(e,n),1===t.mCollidersCache.length&&this.__removePairs(n.mCollider))},Un.prototype.__removeCollider=function(t,e){var n=t.getComponent(wn);if(n&&-1!==this.mBodies.indexOf(n)){this.__removePairs(e);for(var i=n.mPairs,r=i.length-1;0<=r;r--){var o=i[r];o.a!==e&&o.b!==e||i.splice(r,1)}0===t.mCollidersCache.length&&this.__addCollider(t,n.mCollider)}},Un.prototype.__addPairs=function(t,e){var n=this.mBodies;t.mChanged=!0;for(var i=0,r=n.length;i<r;i++){var o=n[i],a=o.gameObject.mCollidersCache;if(o!==e)if(0===a.length)this.__addPair(t,o.mCollider,e,o);else for(var s=0,l=a.length;s<l;s++)this.__addPair(t,a[s],e,o)}},Un.prototype.__addPair=function(t,e,n,i){var r=t.constructor===yt,o=e.constructor===yt;if(r&&o)r=In.pool.get();else if(r||o){if(r=Dn.pool.get(),o){o=n;var a=t;t=e,n=i,e=a,i=o}}else r=Fn.pool.get();r.mChanged=!0,r.set(t,e,n,i),r.mInCollision=!1,this.mPairs.push(r),this.mPairsHash[Rn.__id(t,e)]=r,n.mPairs.push(r),i.mPairs.push(r)},Un.prototype.__removePairs=function(t){for(var e=this.mPairs,n=this.mPairsHash,i=e.length-1;0<=i;i--){var r=e[i];r.a!==t&&r.b!==t||(e.splice(i,1),r instanceof In?In.pool.release(r):r instanceof Dn?Dn.pool.release(r):r instanceof Fn&&Fn.pool.release(r),delete n[Rn.__id(r.a,r.b)],r.bodyA.mPairs.splice(r.bodyA.mPairs.indexOf(r),1),r.bodyB.mPairs.splice(r.bodyB.mPairs.indexOf(r),1))}},Un.prototype.onPostUpdate=function(){for(var t=this.delta,e=this.mContacts,n=this.mBodies,i=this.mPairs,r=e.length=0,o=n.length;r<o;r++){var a=n[r];a.update(),a.mContacts.length=0,a.mInGroup=!1}for(r=0,o=i.length;r<o;r++)(a=i[r]).mIsStatic=(a.bodyA.mIsSleeping||0===a.bodyA.mInvMass)&&(a.bodyB.mIsSleeping||0===a.bodyB.mInvMass),!1===a.mIsStatic&&(a.mInCollision=!0);for(r=0,o=i.length;r<o;r++)(a=i[r]).mInCollision&&!1===a.mIsStatic&&a.test();for(r=0,o=i.length;r<o;r++)(a=i[r]).mInCollision?(!1===a.mIsStatic&&e.push(a),a.bodyA.mContacts.push(a),a.bodyB.mContacts.push(a)):(a.mNormalImpulse=0,a.mTangentImpulse=0);if(this.__solve(t),this.mSleepEnabled)for(t=[],e=[],i=0,r=n.length;i<r;i++)if((o=n[i]).clearFlags(),!o.mInGroup&&!o.mIsSleeping&&0!==o.mInvMass){for(t.length=0,e.length=0,e.push(o);0!==e.length;){a=(o=e.pop()).mContacts,t.push(o),o.mInGroup=!0;for(var s=0,l=a.length;s<l;s++){var h=a[s];(h=h.bodyA===o?h.bodyB:h.bodyA).mInGroup||0===h.mInvMass||e.push(h)}}for(o=!0,a=Rn.sleepThreshold*Rn.unitsPerMeter*T.stage.mScaleX,s=0,l=t.length;s<l;s++){var c=(h=t[s]).mVelocity;h.mSleepTime=c.x*c.x+c.y*c.y<a?h.mSleepTime+1:0,o=o&&h.mSleepTime>Rn.timeToSleep}for(a=0,s=t.length;a<s;a++)t[a].mIsSleeping=o}},Un.prototype.__solve=function(t){for(var e=this.mIterations,n=this.mContacts,i=this.mBodies,r=this.mGravity,o=0,a=i.length;o<a;o++){var s=i[o];if(0!==s.mInvMass&&!s.mIsSleeping){var l=s.mForce,h=s.mVelocity,c=s.mInvMass;s=1-s.frictionAir,h.x=(h.x+(l.x*c+r.x)*t)*s,h.y=(h.y+(l.y*c+r.y)*t)*s}}for(r=0,o=n.length;r<o;r++)n[r].preSolve();for(r=0;r<e;r++)for(o=0,a=n.length;o<a;o++)n[o].solveVelocity();for(t*=T.stage.mScaleX*Rn.unitsPerMeter,r=0,o=i.length;r<o;r++)(l=i[r]).mForce.set(0,0),0===l.mInvMass||l.mIsSleeping||(a=l.mPosition,l=l.mVelocity,a.x+=l.x*t,a.y+=l.y*t);for(i=0;i<e;i++)for(t=0,r=n.length;t<r;t++)n[t].solvePosition()},Un.prototype.__setBounds=function(){var t=T.stage.bounds,e=Number.MAX_SAFE_INTEGER;this.mBoundsLeft.set(-e,0,e,t.height),this.mBoundsRight.set(t.width,0,e,t.height),this.mBoundsTop.set(-e,-e,t.width+2*e,e),this.mBoundsBottom.set(-e,t.height,t.width+2*e,e)},n.global.Object.defineProperties(Un.prototype,{boundsEnabled:{configurable:!0,enumerable:!0,set:function(t){t?(this.mBoundsBody||(this.mBoundsBody=new wn,this.mBoundsBody.isStatic=!0,T.stage.addComponent(this.mBoundsLeft),T.stage.addComponent(this.mBoundsRight),T.stage.addComponent(this.mBoundsTop),T.stage.addComponent(this.mBoundsBottom),this.__setBounds()),T.stage.addComponent(this.mBoundsBody)):T.stage.removeComponent(this.mBoundsBody)}},gravityX:{configurable:!0,enumerable:!0,set:function(t){this.mGravity.x=t},get:function(){return this.mGravity.x}},gravityY:{configurable:!0,enumerable:!0,set:function(t){this.mGravity.y=t},get:function(){return this.mGravity.y}},iterations:{configurable:!0,enumerable:!0,set:function(t){this.mIterations=t},get:function(){return this.mIterations}},sleepEnabled:{configurable:!0,enumerable:!0,set:function(t){this.mSleepEnabled=t},get:function(){return this.mSleepEnabled}}});var zn=function(t){t=void 0===t?4200:t;var e=E.call(this,!1)||this;return e.mDuration=t,e.mSvgLogo='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 241.8 220.2"><defs><style>.b{fill:#f5f5f5}.c{fill:url(#a)}</style><pattern id="a" width="17.6" height="14.87" patternUnits="userSpaceOnUse" viewBox="0 0 17.6 14.9"><path fill="none" d="M0 0h17.6v14.87H0z"/><path class="b" d="M0 13.4v1.5h1.5A1.5 1.5 0 0 1 0 13.4z"/><path class="b" d="M8.8 0a1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 1 1-3 0A1.5 1.5 0 0 1 8.8 0H0v13.4a1.5 1.5 0 0 1 1.5-1.5A1.5 1.5 0 0 1 3 13.4a1.5 1.5 0 0 1-1.5 1.5h4.3a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.4 1.4 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5h6a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 3 0 1.5 1.5 0 0 1-1.5 1.5h5.8V0zm6.6.7a1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5 1.4 1.4 0 0 1-1.5-1.5A1.5 1.5 0 0 1 15.4.7zM.4 2.2A1.5 1.5 0 0 1 1.9.7a1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5A1.5 1.5 0 0 1 .4 2.2zm1.7 5.7A1.5 1.5 0 0 1 .6 6.4a1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 0 3zm2 3.8a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5zm.2-8a1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 1.5 1.5 1.4 1.4 0 0 1-1.5 1.5 1.5 1.5 0 0 1-1.5-1.5zm2.2 3.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0zm2.2 5.3a1.5 1.5 0 1 1 1.5-1.5 1.5 1.5 0 0 1-1.5 1.5zm1.4-8a1.5 1.5 0 0 1 3 0 1.5 1.5 0 1 1-3 0zm2.5 5.7a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.4 1.4 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5zm3 3.5a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 1.5 1.5 1.4 1.4 0 0 1-1.5 1.5zm0-5.5a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 1.5 1.5 1.4 1.4 0 0 1-1.5 1.5z"/></pattern></defs><path class="c" d="M25.8 105.2c12.1 8.8 29.7 6.7 59.8 6.8-7.9-7.3-9.1-18.7-7.1-27.3-6.6 7.3-5.1 19.3-12.8 19.4-3.4.1-6.9-4.7-8.3-10.8-5.3 9.4-12 10.7-14.7-4.5-2.3 2-3.9 8.2-9.5 6.2S26.8 81.8 30 71.3A28.3 28.3 0 0 1 14.6 61c-1.4 20.8.5 36.4 11.2 44.2zM51.9 39.9c29.7-3.6 54-22.8 69.5-26.3-.1 0-40.7-.3-72.3 1.9 6.2 3.5 10.5 16.3 2.8 24.4zM170.4 34.2c5.6-2 32.1-9.5 54.4-2.7-3-13.7-22.9-17-71.8-17.8a32.2 32.2 0 0 1 17.4 20.5zM211.3 109.3c-12.2 2.1-12.8-8.8-32.9-8.9-15.5 0-35.2 13.2-36.1 13.7h49.3c19.1 0 32.5-.6 35.5-7.3s-2.7-12.3-10.7-15.6c5.3 5.6 4.1 16.5-5.1 18.1zM66 189.2c-5.9 5-26 17.8-43.6 6.3 3.6 8.4 13.6 12.7 45.1 12-1.6-2.4-5.3-10.4-1.5-18.3zM32 161.5c7.3 7.8 18.1 2.6 33.7-6.2 10.5-6 27.5-9.9 40.6-1.1 3.7-8.7 5.4-10.9 6.7-10.6s.7 2.7 5.6 7c.4-1 3.8-7.9 3.8-12l-59.9-.8c-1.5 6.6-9.9 19-23.9 17.4-2.4-.3-2.5-11.6 2.4-16.9a36.7 36.7 0 0 0-7.4.9c-4.4 5.1-7 16.4-1.6 22.3zM150.9 148.1c23.6-.5 26 19.9 41.1 21 10.9.9 13.6-16.8 35.7-11.8-1.3-11.1-7.7-16.2-22.2-17.4 3 10.3-6.6 28.5-19.3 21.5a1.5 1.5 0 0 1-.8-1.1c-.9-11 2.8-15.8 7.5-20.7l-55.7-.7a18.5 18.5 0 0 1 3.7 12.4 20.7 20.7 0 0 1 10-3.2zM162 195.9c-3.9 3.6-3.8 9.5-2.5 12.5h4.1c0-14.8 17-12.8 21.2-.8 22.7-1.5 30.9-3.2 36-8.7s6.4-15.3 6.8-27.1c-2.6 3-9.8 14.7-10.9 16.4-17.8 26.3-39.9-5.9-54.7 7.7z"/><path class="b" d="M150 42.6c-.2 10.4-9.8 13.6-9.4-.7-16.2 1.9-14.5 8.5-13.7 9.5 4.4 5.6 29 4.5 27.3-4.3a5.7 5.7 0 0 0-4.2-4.5z"/><path class="b" d="M162.2 46.4c-1.7-15.7-17.2-18.2-28.4-15.6s-22.3 12.7-15.6 25.4 46.2 10.3 44-9.8zm-37.8 6.7c-5.4-9.7 10.6-13.4 13.2-13.8 7.5-1.3 18.2-1.2 19.6 7.6 2 13.2-28.8 13.3-32.8 6.2zM184.7 68.8c-1.1 0-1.1 3.3-5.4 12.5.3 0 5.8 0 8.6.2-.7-9.1-2.1-12.7-3.2-12.7zM162.5 82.9l7-1.1c-2.5-4.6-5.8-8.6-7 1.1zM153.1 74.5a55.8 55.8 0 0 0-7.8 2c6.4 9.4 7.4 2.2 7.8-2zM134.8 94.6c.4-.2 4.9-3.1 6.9-4.1-1.9-2-8.1-9.9-6.9 4.1zM190.9 81.8a58.3 58.3 0 0 1 9 1.5 77.7 77.7 0 0 0 .4-8.8c-1.7-.3-7.2-1.2-10.3-1.5a52 52 0 0 1 .9 8.8z"/><path class="b" d="M216.5 76.2a39.1 39.1 0 0 1-5.6 10.4c13 3 25.3 10.8 18.1 23.1-3.8 6.6-16.4 7.5-37.4 7.5l-55.4-.2a32.3 32.3 0 0 1-18.8 1.1c-6.8 1.5-18.2 3.7-28.2-3.1-30.8-.4-49.7 3.2-64.9-7.1C6.4 95.7 11.6 60.3 12 56.8c-6.4-12.5-.8-29.4 2.3-34.1S29.4 7.5 44.4 13c.2-.1 27.5-2.4 76-2.4 74.4 0 105.2.8 107.6 22.3 6 2.4 13.2 13 6.2 21 4.8 9.4.1 19.1-9.7 21.5a37.4 37.4 0 0 1 10.7 5.7c1.4-2.5 8.5-19.8 4.8-41.9-4.5-27.1-17.9-33.2-35.4-34.9C157.9 0 88.5.2 81.7.1 38.1-.3 18.2-.5 8.1 22.2-3.1 47.6-2.6 91.7 9.1 108c7.7 10.7 19.1 15.3 37.9 15.3 34.5 0 141.3 1.4 165.3 1.8 11-.3 27.9-3.4 29.3-19.7s-6.8-25.2-25.1-29.2z"/><path class="b" d="M202.7 88.6c1.3-.2 6.5-2 10.7-12.6-3-.2-6.3-.5-10.1-1.1.8 11.4-3 14-.6 13.7z"/><path class="b" d="M231.9 56c-7.6 5.5-18.2 1.8-19.8-3.4-2.6-8.6 4.4-10.9 6.7-10.6 7.7.8 7 6.1 4 8.1a1.5 1.5 0 0 1-1.9-2.4c1.8-1.3 0-2.8-2.1-2.7s-5.4 1-3.8 6.7 17.1 7.3 18.9-4.4c1-6.8-5.8-16.4-32.5-15.4a108.5 108.5 0 0 0-30.4 5.2c1.2 8.3-1.9 15.7-8.5 20.1-5.3 11.2-41.6 17.9-48.4-2.7-7.5.8-13.1 10-13.9 14.9a1.4 1.4 0 0 1-1.6 1.2c-6.5-.7-16.7 3.6-17.9 20-1.3 18.3 14.9 29.2 31.7 25.4a21.7 21.7 0 0 1-5-3.5c-5.7-.2-13.7-1.1-17.4-12.1-.6-1.7 2.1-3.2 2.9-.9 2.5 7.8 8.3 9.6 11.8 10a23.3 23.3 0 0 1-4.4-13.3c-.1-2.5 3-2 3-.2-.1 12.3 14.5 29.4 42 13 33.9-20.2 50.8-8.1 55.8-5 1.4.9 9.2 5.2 13.7.1 1.8-2 4.1-10.3-6.4-14.9-4.2 3.7-11.5 3.3-8.9-3-32.1-5.7-50.2 2.7-61.8 10.2s-16.4.3-17-2.5c-1.8-8.4 16.6-26.2 60.2-24.6 1.3-3.9 5.3-5.7 8.1.6 7.4.6 18 3.2 28.9 3.2s18.2-5.3 14-17.1z"/><path class="b" d="M176 81.3l3.8-9.1a107.7 107.7 0 0 0-23.6 1.6c-1.1 15.7-9.6 10.9-13.8 3.6-27.3 10.6-19.1 22.7-10.5 18.6-1.6-15.7 6-15 12.5-7a77.4 77.4 0 0 1 15.1-5.4c1.4-15.6 10-9.6 13.3-2.1zM65.8 101.1c5.2-.4 1.4-10.4 17-26.2 13.1-13.2-7.9-26.6-17.9-13s-4.4 39.6.9 39.2z"/><path class="b" d="M49.8 63.9c-4.7 6.2-6.6 20.2-2.4 30.6 2.9 7 6.9-1.5 9.3-5.4-1.2-8.8 0-20.5 5.2-28.1-5.6-3.5-10.1.3-12.1 2.9zM32.3 74.3c-2.4 10.4-.6 17.3 2.6 18.1s4.7-5.4 7.3-7.6c-.6-7.7.9-15.8 4.2-21.2-8.7-3.1-12.8 5.3-14.1 10.7z"/><path class="b" d="M12.2 39.9c-1.8 22.1 15.2 28 18.9 28.5 1.7-3.6 6.8-11.4 17.2-7.3 5.5-6.4 12-4.8 15.5-2.5C73.9 48.2 92 53.8 89.6 69.3a16.6 16.6 0 0 1 7.9-1.7c1.7-5.9 7.7-14.9 15.9-16.1a18.6 18.6 0 0 1 5.1-15.2c-4 1.6-20.6 10.6-28.1 12.3-1.4.3-2.4-2.4-.3-3 9.3-2.5 26.9-13.5 42.8-17.6 19.5-5.2 34.5 6.7 32.1 22.8 10.1-14.5-5.4-34.6-20.7-36.4-33.4-4.1-53.3 26.5-98.8 28.9-7 .4-11.9-2-13.7-6s-.9-9 3.7-10.6c2.1-.7 3.5 2.3 1.1 2.8s-4.9 9.2 4.8 10.7c12.7 2 14.5-14.3 7.3-21.2s-34-9.4-36.5 20.9zM108.8 156a30.1 30.1 0 0 1 6.8 8.2 45.5 45.5 0 0 1 2-10.6 17.4 17.4 0 0 1-5-5.7 47.5 47.5 0 0 0-3.8 8.1zM40.3 152.4c7.2.6 18.4-6.1 19.7-17.7-20.3-.3-20.5 13-19.7 17.7zM105.5 182.8c-9.5-20.1-30.2-13.6-46.7-2.2-14.8 10.3-29.4 7.7-35.8.1a31.5 31.5 0 0 1-4.6-32.4C5 168 14.6 187.8 24.8 193.5c18.7 10.5 37.8-5 41.6-8.5 12.4-11.2 28.8-11.8 33.4 2.2 4 12.2-7.6 21.6-15.9 18.1-10.7-4.4-6.4-13.5-3.1-15.1a7.4 7.4 0 0 1 8.7 1.9c1.2 1.3-.5 3.6-2.1 2.1s-3.5-2.1-5.1-1.3-4.3 7.6 2.6 9.6c8.9 2.6 14.7-7.1 12-14.4-3.9-10.7-15.2-8.9-19.9-6.6-14.5 7.2-12.8 30 6 30.7 23.2.9 27-19.8 22.5-29.4zM188.4 159.2c11.6 4.5 18.7-15.8 11.7-23.9-4.2 7.6-13.1 10.2-11.7 23.9z"/><path class="b" d="M191.9 172.1c-15.6-.4-20.8-23.1-41.9-20.9-24 2.5-24.8 45.6-13.1 57.6h3.1c-4.1-9.4-6.7-28.1 7.8-38.2 1.7-1.1 3.6 1.3 1.7 2.5-13.6 9.4-10.2 27.6-6.2 35.7h3.5c-4.2-8.4-3.6-21.3 2.4-27.3 18.5-18.3 44.9 16.4 57.1-.5 8-11.1 12.7-17.8 26.8-16.9a13.3 13.3 0 0 0-7-4c-19.7-4.1-20.7 12.4-34.2 12z"/><path class="b" d="M208.6 182.8c-13.7 18.8-40.7-15.8-57.2.7-5.4 5.4-5.6 18-1.2 25.1h6.1c-2-5.6.6-12.1 3.8-14.9 17.6-15 37.6 17.6 54.2-7.3 1-1.5 8.3-14.5 13.9-19.3-10.5.6-14.4 8.6-19.6 15.7z"/><path class="b" d="M238.8 151.3c-4-14.1-13.7-23-25.3-23.2-.3 0-120-1.8-163.5-1.8-40.8 0-44.9 21.4-47.3 34.2-3.8 20.4 3.9 40.1 8.9 46.1 9.4 11.4 25.3 13.6 48 13.6l128.4-.3c35.9 0 44.8-12.6 48.4-23.6 4.7-14 5.7-33.3 2.4-45zm-1.3 15.2c-1.5 1.5-3.3-.7-6.8 2.3.1 26.5-6.3 35.4-19 38.4-16.1 3.8-43.4 4.7-112.7 4.4-5.8 3.8-19.8 6.6-29-1.2-23.1.7-48.8.4-51.7-18.1-4.9-4.8-12.3-15.9-8.2-33.2 5.2-21.3 22.1-24.3 34.6-23.9 4.2-2.6 10-3.9 17-3.4 2 .2 1.4 2.5 1.3 3l59.3.8c.1-2-.9-2.5.1-3.9s8.9 1.7 11.8 4.1l61.1 1c4.2-4.3 3.6-10 9.2 0 12.4.9 25 4.3 26.3 21.8 3.7 1.8 8.1 6.4 6.7 7.9z"/><path class="b" d="M166.6 208.3l15.1-.6c-3.8-8.4-15.4-10.2-15.1.6zM113.3 166.2c-11.1-19.9-33.8-15.2-46.1-8.3-16.4 9.1-28.6 15.1-37.4 5.6-5.7-6.1-4.3-16.7-.5-23.4-12.8 6.6-13.3 28.1-4 38.6 5.7 6.5 18.5 8.7 31.8-.5 16.2-11.4 36.6-18.1 48.8-1.1 5.5 7.7 6.4 22.9-3 31.6h7.1c8-7 11.2-28.4 3.3-42.5z"/><path class="b" d="M137.7 153.6c1.7-13.2-7.4-17.4-12.4-18.8 1.6 11.6-8 17-6.8 36 4.6 13.7 2 29.9-4.4 38h19c-8.6-12.6-10-41.8 4.6-55.2z"/></svg>',e.mSvgText='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 228.9 29"><defs><style>.a{fill:#f5f5f5}</style></defs><path class="a" d="M9.7 19a3.7 3.7 0 0 1 2.9 1.4 6 6 0 0 1 .9 3.6 4.6 4.6 0 0 1-1.4 3.8c-.9.7-2.5 1-4.7 1L0 28.7V10.1l6.6-.2a9.4 9.4 0 0 1 4.9 1c.9.7 1.4 2 1.4 3.9a5.1 5.1 0 0 1-.7 3A3.3 3.3 0 0 1 9.7 19zm-6.4-1.1h3.4a3.3 3.3 0 0 0 2.3-.6 2.5 2.5 0 0 0 .7-2.1 2.9 2.9 0 0 0-.7-2.1 5.1 5.1 0 0 0-2.6-.5H3.3zm0 8.3h3.5a3.9 3.9 0 0 0 2.6-.6c.5-.3.7-1.1.7-2.2a3 3 0 0 0-.7-2.4 3.8 3.8 0 0 0-2.7-.7H3.3zM22.9 10.1v14.3a2.1 2.1 0 0 0 .3 1.2 2.3 2.3 0 0 0 1.3.3h6.4l.2 2.6c-1.8.2-4.3.2-7.4.2s-4.2-1.2-4.2-3.8V10.1zM46.2 23.4h-6.9l-1.5 5.3h-3.5L39.9 11a1.2 1.2 0 0 1 1.2-.9h3.3a1.2 1.2 0 0 1 1.2.9l5.6 17.7h-3.5zm-.8-2.7l-1.9-6.4c-.2-1-.4-1.5-.4-1.6h-.7l-.4 1.6-1.9 6.4zM68.2 25.8l.3 2.5a18.5 18.5 0 0 1-5.7.7c-2.8 0-4.7-.7-5.8-2.1s-1.7-4-1.7-7.5.5-6 1.7-7.4 3-2.2 5.8-2.2a19.8 19.8 0 0 1 5.3.6l-.3 2.6a39.4 39.4 0 0 0-5-.2c-1.5 0-2.6.4-3.1 1.4s-.9 2.7-.9 5.2.3 4.3.9 5.2a3.2 3.2 0 0 0 3.1 1.5 37.5 37.5 0 0 0 5.4-.3zM79.1 20.3h-1.8a11.1 11.1 0 0 1 .2 1.9v6.5h-3.4V10.1h3.4v5.5a12.5 12.5 0 0 1-.2 2.1h1.8l5.1-7.6h3.7l-5 7.5a4.3 4.3 0 0 1-1.3 1.4 4.5 4.5 0 0 1 1.5 1.6l5.1 8h-3.7zM100 21.4l-3.8-1.2a5.1 5.1 0 0 1-2.8-2 5.9 5.9 0 0 1-.9-3.4c0-2 .5-3.4 1.4-4s2.6-1 5-1a24 24 0 0 1 5.8.6l-.2 2.4H99a4.7 4.7 0 0 0-2.5.4c-.4.2-.6.8-.6 1.7a2.5 2.5 0 0 0 .4 1.7 3.8 3.8 0 0 0 1.7.8l3.5 1.1a5.3 5.3 0 0 1 3 2 5.9 5.9 0 0 1 .9 3.4c0 2.1-.5 3.4-1.5 4.2s-2.7 1-5.1 1a30.8 30.8 0 0 1-6.1-.6L93 26l5.8.2a4.4 4.4 0 0 0 2.5-.5 2.2 2.2 0 0 0 .6-1.8 2.2 2.2 0 0 0-.4-1.6 3.5 3.5 0 0 0-1.5-.9zM126 10.1h3.5a1.2 1.2 0 0 1 1.3 1.4l.8 17.2h-3.3l-.7-15.8h-.5l-3.2 12.3a1.3 1.3 0 0 1-1.4 1.1H120a1.4 1.4 0 0 1-1.5-1.1l-3.2-12.3h-.5l-.6 15.8h-3.3l.7-17.2c.1-.9.5-1.4 1.4-1.4h3.5a1.2 1.2 0 0 1 1.3 1.2l2.7 10 .5 2.6h.4a26.1 26.1 0 0 1 .6-2.6l2.6-10a1.4 1.4 0 0 1 1.4-1.2zM141.4 28.7H138V10.1h3.4zM161.5 13h-5.7v15.7h-3.4V13h-5.7v-2.9h14.8zM180.9 10.1v18.6h-3.4v-8.5h-7.3v8.5h-3.4V10.1h3.4v7.3h7.3v-7.3zM196 13.1l-.2-2.6a24.4 24.4 0 0 1 5.9-.7 8.9 8.9 0 0 1 4.5.9 3.5 3.5 0 0 1 1.5 3.3 6.4 6.4 0 0 1-.7 3.1 13.3 13.3 0 0 1-2.4 3.3l-4.9 5.3 2.8-.2h5.8v3.2h-12.7v-2a2 2 0 0 1 .5-1.4l4.9-5.4c2.2-2.4 3.3-4.2 3.3-5.6a1.3 1.3 0 0 0-.7-1.3 5.7 5.7 0 0 0-2.2-.3 52.9 52.9 0 0 0-5.4.4zM214.3 28.7V10.1l7-.2c2.8 0 4.8.7 5.9 2.1s1.7 3.8 1.7 7.4-.6 6.1-1.7 7.5-3.1 2-5.9 2-4.5 0-7-.2zm3.4-16v13.4h3.6a3.6 3.6 0 0 0 3.2-1.4 12.6 12.6 0 0 0 .8-5.3c0-2.5-.3-4.3-.9-5.3a3.3 3.3 0 0 0-3.1-1.4h-3.6zM.1 8.1v-8h2.7a2.9 2.9 0 0 1 2.1.5 3 3 0 0 1 .5 2 2.9 2.9 0 0 1-.5 1.9 2.5 2.5 0 0 1-1.9.6H1.2v3zm1.1-4h1.6a1.6 1.6 0 0 0 1.1-.3 2.1 2.1 0 0 0 .3-1.2 2.3 2.3 0 0 0-.3-1.3A1.6 1.6 0 0 0 2.8 1H1.2zM9.7 0a3 3 0 0 1 2.5.9 5.2 5.2 0 0 1 .7 3.2 5 5 0 0 1-.7 3.2 3 3 0 0 1-2.5.9 2.8 2.8 0 0 1-2.4-.9 5 5 0 0 1-.7-3.2A5.2 5.2 0 0 1 7.3.9 2.8 2.8 0 0 1 9.7 0zm1.6 1.7A1.7 1.7 0 0 0 9.7 1a1.6 1.6 0 0 0-1.5.7 4.5 4.5 0 0 0-.4 2.4 4.5 4.5 0 0 0 .4 2.4 1.6 1.6 0 0 0 1.5.7 1.7 1.7 0 0 0 1.6-.7 4.5 4.5 0 0 0 .4-2.4 4.5 4.5 0 0 0-.4-2.4zM24.2.1l-1.6 7.6a.4.4 0 0 1-.4.4h-1.3a.4.4 0 0 1-.4-.4l-1.2-5.8a3.4 3.4 0 0 1-.1-.9h-.3l-.2.9-1.1 5.8V8h-1.7c-.3 0-.4-.1-.5-.4L13.9.1h1.2l1.2 6.1a5.1 5.1 0 0 0 .1 1h.3c0-.3.1-.7.1-1L18 .5a.4.4 0 0 1 .4-.4h1.3a.2.2 0 0 1 .2.2.2.2 0 0 1 .2.2l1.1 5.7c.1.3.1.6.2 1h.3v-.5a1.1 1.1 0 0 0 .1-.5L22.9.1zM30.3 7.1V8H27a1.6 1.6 0 0 1-1.2-.4 1.2 1.2 0 0 1-.4-1v-5a1.4 1.4 0 0 1 .4-1.1A2.1 2.1 0 0 1 27 .1h3.4V1h-3.2l-.5.2a.7.7 0 0 0-.1.5v1.7h3.3v1h-3.3v2a1.1 1.1 0 0 0 .1.6h3.6zM37.6 8.1h-1.2l-.7-2.5a1.1 1.1 0 0 0-1-.8h-1.6v3.3h-1.2v-8h2.8a3.4 3.4 0 0 1 2 .5 2.4 2.4 0 0 1 .6 1.8 2.8 2.8 0 0 1-.3 1.4 2 2 0 0 1-1.2.6 1.4 1.4 0 0 1 1 1.2zm-4.5-4.3h1.6a1.6 1.6 0 0 0 1.1-.3 1.4 1.4 0 0 0 .3-1.1 1.6 1.6 0 0 0-.3-1.1 1.6 1.6 0 0 0-1.1-.3h-1.6zM43.9 7.1V8h-3.3a1.6 1.6 0 0 1-1.2-.4 1.2 1.2 0 0 1-.4-1v-5a1.4 1.4 0 0 1 .4-1.1 2.1 2.1 0 0 1 1.2-.4H44V1h-3.2a.6.6 0 0 0-.5.2.8.8 0 0 0-.2.5v1.7h3.4v1h-3.4v2a1.1 1.1 0 0 0 .2.6h3.6zM45.5 8.1v-8h2.9a3 3 0 0 1 2.4.9 5.2 5.2 0 0 1 .7 3.2 5.2 5.2 0 0 1-.7 3.2 3 3 0 0 1-2.4.9zm1.1-7v6h1.8a1.6 1.6 0 0 0 1.5-.7 5.7 5.7 0 0 0 .4-2.4 6.5 6.5 0 0 0-.4-2.4 1.8 1.8 0 0 0-1.5-.6h-1.8zM59.6 3.9a1.5 1.5 0 0 1 1.3.6 2.8 2.8 0 0 1 .3 1.5 2.2 2.2 0 0 1-.5 1.6 3.4 3.4 0 0 1-2 .5h-3v-8h2.6a3.7 3.7 0 0 1 2.1.4 1.8 1.8 0 0 1 .6 1.6 2.3 2.3 0 0 1-.3 1.3 1.4 1.4 0 0 1-1.1.5zm-2.8-.4h1.6a2.9 2.9 0 0 0 1.2-.2 1.3 1.3 0 0 0 .3-1c0-.5-.1-.9-.4-1a1.7 1.7 0 0 0-1.2-.3h-1.5zm0 3.7h1.7a1.7 1.7 0 0 0 1.2-.3c.3-.1.4-.5.4-1a1.7 1.7 0 0 0-.4-1.2 1.9 1.9 0 0 0-1.3-.3h-1.6zM65.6 5.3v2.8h-1.1V5.3L61.8.1h1.3l1.6 3.3a4.2 4.2 0 0 0 .3.9h.1a8.5 8.5 0 0 1 .3-.9L67 .1h1.2z"/></svg>',e};n.inherits(zn,E),zn.prototype.show=function(){var t=this,e=.001*this.mDuration;e="#logo,#splash-screen{position:relative;box-sizing:border-box}#logo-inner,#logo-name{margin-left:auto;margin-right:auto}#splash-screen{z-index:999;top:0;left:0;width:100%;height:100%;display:block;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQYV2OUkpL6/+zZMwYpKSkGEM3IwMDwnwEJMBJUAQCLUhABUGRZzwAAAABJRU5ErkJggg==);opacity:1;animation:hide 0s ease-in "+e+"s forwards}@keyframes hide{to{opacity:0}}#logo{top:20%;left:50%;animation:fadein "+e+"s linear forwards}@keyframes fadein{0%{opacity:0}100%,40%{opacity:1}}#logo-name{width:100%;margin-top:108px}";var n=document.createElement("style");n.type="text/css",n.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(n);var i=document.getElementById(T.engine.containerElementId),r=i.style.overflow;i.style.overflow="hidden";var o=document.createElement("div");o.id="splash-screen",i.appendChild(o);var a=document.createElement("div");a.id="logo",o.appendChild(a);var s=document.createElement("div");s.id="logo-inner",s.innerHTML=this.mSvgLogo,a.appendChild(s);var l=document.createElement("div");l.id="logo-name",l.innerHTML=this.mSvgText,a.appendChild(l);var h=function(){var e=o.offsetWidth,n=o.offsetHeight;e=t.calculateAspectRatioFit(e,n,.5*e,.5*n),a.style.width=e.width+"px",a.style.height=e.height+"px",a.style.marginLeft=.5*-e.width+"px",s.style.width=Math.min(e.width,e.height)+"px",s.style.height=Math.min(e.width,e.height)+"px",l.style.width=.9*Math.min(e.width,e.height)+"px",l.style.height=Math.min(e.width,e.height)+"px",l.style.marginTop="12px"};h();var c=i.offsetWidth,u=i.offsetHeight,d=setInterval((function(t){c===i.offsetWidth&&u===i.offsetHeight||(c=i.offsetWidth,u=i.offsetHeight,h())}),1e3/60);setTimeout((function(){clearTimeout(d),n.parentNode.removeChild(n),o.parentNode.removeChild(o),i.style.overflow=r,t.post(x.COMPLETE)}),this.mDuration),this.post(x.COMPLETE)},zn.prototype.calculateAspectRatioFit=function(t,e,n,i){return{width:t*(n=Math.min(n/t,i/e)),height:e*n}};var Hn=function(t,n,i){t=void 0===t?1:t,n=void 0===n?1:n,i=void 0===i||i;var r=X.call(this)||this;return e.assert(0<t,"the interval value must be greater than 0"),e.assert(0<n,"the ticksCount value must be greater than 0"),r.mStartOnAdded=i,r.mInterval=t,r.mTicksCount=n,r.mIsRunning=!1,r.mTick=0,r.mElapsedSeconds=0,r.mTotalElapsedSeconds=0,r};n.inherits(Hn,X),Hn.prototype.onAdded=function(){this.mStartOnAdded&&this.start()},Hn.prototype.onUpdate=function(){if(!1!==this.mIsRunning&&(this.mElapsedSeconds+=T.time.delta,this.mTotalElapsedSeconds+=T.time.delta,this.mElapsedSeconds>=this.mInterval)){this.mElapsedSeconds=0;for(var t=Math.max(1,~~(T.time.delta/this.mInterval)),e=0;e<t;e++)if(this.mTick++,this.post("tick",this.mTick),this.mTick>=this.mTicksCount){this.mIsRunning=!1,this.post("complete");break}}},Hn.prototype.start=function(){return this.mIsRunning=!0,this},Hn.prototype.stop=function(){return this.mIsRunning=!1,this.reset(),this},Hn.prototype.pause=function(){return this.mIsRunning=!1,this},Hn.prototype.reset=function(){return this.mTotalElapsedSeconds=this.mElapsedSeconds=this.mTick=0,this},n.global.Object.defineProperties(Hn.prototype,{ticksLeft:{configurable:!0,enumerable:!0,get:function(){return this.mTicksCount-this.mTick}},currentTick:{configurable:!0,enumerable:!0,get:function(){return this.mTick}},elapsedSeconds:{configurable:!0,enumerable:!0,get:function(){return this.mElapsedSeconds}},secondsToNextTick:{configurable:!0,enumerable:!0,get:function(){return this.mInterval-this.mElapsedSeconds}},isRunning:{configurable:!0,enumerable:!0,get:function(){return!0===this.mIsRunning}},isComplete:{configurable:!0,enumerable:!0,get:function(){return this.mTick>=this.mTicksCount}},ticksCount:{configurable:!0,enumerable:!0,get:function(){return this.mTicksCount},set:function(t){e.assert(0<t,"the ticksCount value must be greater than 0"),this.mTicksCount=t}},interval:{configurable:!0,enumerable:!0,get:function(){return this.mInterval},set:function(t){e.assert(0<t,"the interval value must be greater than 0"),this.mInterval=t}},totalElapsedSeconds:{configurable:!0,enumerable:!0,get:function(){return this.mTotalElapsedSeconds}},startOnAdded:{configurable:!0,enumerable:!0,get:function(){return this.mStartOnAdded},set:function(t){this.mStartOnAdded=t}}});var Gn=0,Vn=function(t,e,n,i){i=void 0===i?null:i;var r=E.call(this)||this;return r.id=++Gn,T.engine=r,r.mContainerElementId=t,r.mContainerElement=null,r.mVideoDriverClass=n,r.mSystemClasses=i,r.mStageWidth=0,r.mStageHeight=0,r.mLastUpdateTime=0,r.mFrameNum=0,r.mNumUpdates=0,r.mMaxUpdatesPerFrame=60,r.mLastRenderTime=0,r.mSystems=[],r.mGameObject=null,r.mIsRunning=!1,r.mIsStarted=!1,r.mIsPanic=!1,r.mRAFHandle=-1,r.mViewport=null,r.mVideo=null,r.mPaused=!1,r.mUnpausing=!1,r.mPauseOnHide=!0,r.mPauseOnBlur=!0,r.mTagCache={},r.mGameClass=e,r.mStage=null,r.mWasStopped=!1,r.mFrameTimes=[],r.mUseHiDPR=!1,r.mPendingDispose=!1,r.__initialize(),r};n.inherits(Vn,E),Vn.prototype.__initialize=function(){if(console.log("%c                         >>> BLACK <<<                         ","background: #000; color: #fff;"),this.mContainerElement=document.getElementById(this.mContainerElementId),!this.mContainerElement)throw Error("Container element was not found");T.device=new at,this.mStageWidth=this.mContainerElement.clientWidth,this.mStageHeight=this.mContainerElement.clientHeight,this.mUseHiDPR=T.device.isMobile,this.__bootViewport(),this.__update=this.__update.bind(this)},Vn.prototype.pause=function(){this.mPaused=!0;for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].onPause();this.post("paused")},Vn.prototype.resume=function(){!0===this.mPaused&&(this.mUnpausing=!0)},Vn.prototype.__setUnpaused=function(){this.mPaused=!1;for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].onResume();this.post("unpaused")},Vn.prototype.__bootViewport=function(){this.mViewport=new j(this.mContainerElement)},Vn.prototype.__bootSystems=function(){if(null!==this.mSystemClasses)for(var t=0;t<this.mSystemClasses.length;t++)this.__addSystem(new this.mSystemClasses[t])},Vn.prototype.__checkVisibility=function(){var t=this;void 0===document.hidden?(document.hidden=!1,document.visibilityState="visible",window.onpagehide=function(e){return t.__onVisibilityChangeFallback(e)},window.onpageshow=function(e){return t.__onVisibilityChangeFallback(e)}):document.addEventListener("visibilitychange",(function(e){return t.__onVisibilityChange(e)}),!1),window.onblur=function(e){return t.__onVisibilityChangeFallback(e)},window.onfocus=function(e){return t.__onVisibilityChangeFallback(e)}},Vn.prototype.__bootStage=function(){this.mStage=new vt,this.__checkVisibility(),document.hidden&&!0===this.mPauseOnHide&&this.pause()},Vn.prototype.__onVisibilityChangeFallback=function(t){"blur"===(t=t.type)&&!0===this.mPauseOnBlur||"pagehide"===t&&!0===this.mPauseOnHide?this.pause():("focus"===t||"pageshow"===t)&&!1===document.hidden&&this.resume()},Vn.prototype.__onVisibilityChange=function(){!0===this.mPauseOnHide&&"hidden"===document.visibilityState?this.pause():"visible"===document.visibilityState&&this.resume()},Vn.prototype.hasSystem=function(t){for(var e=0;e<this.mSystems.length;e++)if(this.mSystems[e]instanceof t)return!0;return!1},Vn.prototype.__addSystem=function(t){return this.mSystems.push(t),t},Vn.prototype.getSystem=function(t){for(var e=0;e<this.mSystems.length;e++){var n=this.mSystems[e];if(n instanceof t)return n}return null},Vn.prototype.__bootVideo=function(){this.mVideo=new this.mVideoDriverClass(this.mViewport.mViewportElement,this.mStageWidth,this.mStageHeight)},Vn.prototype.start=function(){if(!0===this.mWasStopped)e.error("Black engine cannot be re-started.");else if(T.engine=this,!0!==this.mIsStarted){T.time=new H,this.__bootSystems(),this.__bootStage(),this.__bootVideo(),this.mStage.__refresh(),this.post(x.READY),this.mGameObject=new this.mGameClass,this.mStage.addChild(this.mGameObject);var t=this;this.mIsStarted=!0,this.mVideo.start(),this.mRAFHandle=window.requestAnimationFrame((function(e){t.mIsRunning=!0,t.mLastUpdateTime=e,t.mLastRenderTime=t.mLastUpdateTime,t.__update(e,!0)}))}},Vn.prototype.stop=function(){this.mIsRunning=this.mIsStarted=!1,window.cancelAnimationFrame(this.mRAFHandle),console.log("%c                        <<< BYE BYE >>>                        ","background: #000; color: #fff;")},Vn.prototype.destroy=function(){this.mPendingDispose=!0},Vn.prototype.__dispose=function(){this.stop(),this.mVideo.dispose(),this.mViewport.dispose(),T.assets.dispose(),T.assets=null;for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].dispose();E.dispose(),this.mFrameNum=this.mNumUpdates=0,T.engine=null},Vn.prototype.__update=function(t,n){var i=T.time;if(!0===this.mPaused&&!0===this.mUnpausing&&(this.mUnpausing=!1,this.mLastRenderTime=this.mLastUpdateTime=t,this.__setUnpaused()),this.mRAFHandle=window.requestAnimationFrame(this.__update),!0!==this.mPaused){var r=Math.floor((t-this.mLastUpdateTime)/i.mDeltaTimeMs);for(!0===n&&(r=1),r>this.mMaxUpdatesPerFrame&&(this.post("looped",r),e.warn("Unable to catch up "+r+" update(s)."),r=this.mMaxUpdatesPerFrame),this.mNumUpdates=r,n=0;n<r;n++)i.mActualTime+=i.delta,i.mTime=i.mActualTime,this.__internalUpdate(),this.__internalSystemPostUpdate();for(n=t-i.mDeltaTimeMs;this.mLastUpdateTime<n;)this.mLastUpdateTime+=i.mDeltaTimeMs;i.mAlphaTime=0===r?(t-this.mLastUpdateTime)/i.mDeltaTimeMs:0,i.mTime=i.mActualTime+.001*(t-this.mLastUpdateTime)*i.mScale,this.__internalSystemRender(),this.mVideo.beginFrame(),this.mVideo.render(this.mStage),this.mVideo.endFrame(),this.mFrameNum++,this.mIsPanic=!1,$.__dirty=!1,this.mLastRenderTime=t,!0===this.mPendingDispose&&this.__dispose()}},Vn.prototype.__internalUpdate=function(){this.mViewport.__update();for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].onUpdate();this.mStage.__update()},Vn.prototype.__internalSystemPostUpdate=function(){for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].onPostUpdate()},Vn.prototype.__internalSystemRender=function(){for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].onRender()},Vn.prototype.onTagUpdated=function(t,e,n){if(null!==e){var i=this.mTagCache[e];i.splice(i.indexOf(t),1),0===i.length&&delete this.mTagCache[e]}null!==n&&(!1===this.mTagCache.hasOwnProperty(n)&&(this.mTagCache[n]=[]),this.mTagCache[n].push(t))},Vn.prototype.onChildrenAdded=function(t,e){var n=this;if(e.root instanceof vt){for($.__dirty=!0,e=0;e<this.mSystems.length;e++)this.mSystems[e].onChildrenAdded(t);it.forEach(t,(function(t){if(!0!==t.mAdded){n.onTagUpdated(t,null,t.mTag),t.mAdded=!0,t.onAdded();for(var e=0;e<t.mComponents.length;e++){var i=t.mComponents[e];!0!==i.mAdded&&(i.mAdded=!0,i.onAdded(t))}}}))}},Vn.prototype.onChildrenChanged=function(t){$.__dirty=!0;for(var e=0;e<this.mSystems.length;e++)this.mSystems[e].onChildrenChanged(t)},Vn.prototype.onChildrenRemoved=function(t){var e=this;$.__dirty=!0;for(var n=0;n<this.mSystems.length;n++)this.mSystems[n].onChildrenRemoved(t);it.forEach(t,(function(t){if(!0===t.mAdded){e.onTagUpdated(t,null,t.mTag),t.mAdded=!1,t.onRemoved();for(var n=0;n<t.mComponents.length;n++){var i=t.mComponents[n];!1!==i.mAdded&&(i.mAdded=!1,i.onRemoved(t))}}}))},Vn.prototype.onComponentAdded=function(t,e){$.__dirty=!0;for(var n=0;n<this.mSystems.length;n++)this.mSystems[n].onComponentAdded(t,e);!0!==e.mAdded&&(e.mAdded=!0,e.onAdded(t))},Vn.prototype.onComponentRemoved=function(t,e){$.__dirty=!0;for(var n=0;n<this.mSystems.length;n++)this.mSystems[n].onComponentRemoved(t,e);!1!==e.mAdded&&(e.mAdded=!1,e.onRemoved(t))},n.global.Object.defineProperties(Vn.prototype,{ups:{configurable:!0,enumerable:!0,get:function(){return.001*T.time.mDeltaTimeMs},set:function(t){e.isNumber(t),e.assert(0<t),T.time.mDeltaTimeMs=1e3/t,T.time.mDeltaTime=.001*T.time.mDeltaTimeMs}},viewport:{configurable:!0,enumerable:!0,get:function(){return this.mViewport}},containerElement:{configurable:!0,enumerable:!0,get:function(){return this.mContainerElement}},pauseOnHide:{configurable:!0,enumerable:!0,get:function(){return this.mPauseOnHide},set:function(t){this.mPauseOnHide=t}},pauseOnBlur:{configurable:!0,enumerable:!0,get:function(){return this.mPauseOnBlur},set:function(t){this.mPauseOnBlur=t}},isPaused:{configurable:!0,enumerable:!0,get:function(){return this.mPaused}},stage:{configurable:!0,enumerable:!0,get:function(){return this.mStage}},containerElementId:{configurable:!0,enumerable:!0,get:function(){return this.mContainerElementId}},useHiDPR:{configurable:!0,enumerable:!0,get:function(){return this.mUseHiDPR},set:function(t){this.mUseHiDPR=t}},frameNum:{configurable:!0,enumerable:!0,get:function(){return this.mFrameNum}},numUpdates:{configurable:!0,enumerable:!0,get:function(){return this.mNumUpdates}},maxUpdatesPerFrame:{configurable:!0,enumerable:!0,get:function(){return this.mMaxUpdatesPerFrame},set:function(t){this.mMaxUpdatesPerFrame=t}}}),t.Acceleration=We,t.AlphaOverLife=Xe,t.AnchorOverLife=Ke,t.AnimationController=gn,t.AnimationInfo=fn,t.Arcade=Un,t.Asset=Ct,t.AssetLoader=St,t.AssetManager=de,t.AssetManagerState=ce,t.AssetType=wt,t.AtlasTexture=xt,t.AtlasTextureAsset=It,t.BVGAsset=le,t.BVGParser=se,t.BVGStyle=oe,t.BindingType=_,t.BitmapFontAsset=Nt,t.BitmapFontCharData=Bt,t.BitmapFontData=Dt,t.BitmapTextField=Fe,t.BitmapTextRenderer=fe,t.BitmapTextRendererCanvas=be,t.Black=T,t.BlendMode=Y,t.BoxCollider=yt,t.BoxToBoxPair=In,t.BoxToCirclePair=Dn,t.BroadPhase=kn,t.Camera=lt,t.CanvasDriver=Oe,t.CanvasRenderTexture=_t,t.CapsStyle=te,t.Circle=g,t.CircleCollider=bt,t.CircleToCirclePair=Fn,t.Collider=tt,t.ColorHelper=h,t.ColorOverLife=Ye,t.ColorScatter=ze,t.ColorScatterBase=Ue,t.Component=X,t.Curve=y,t.Debug=e,t.Device=at,t.DisplayObject=st,t.DisplayObjectRendererCanvas=ve,t.DistortionEffect=vn,t.Ease=cn,t.Emitter=Ae,t.EmitterRendererCanvas=Ce,t.EmitterSortOrder=Se,t.EmitterState=Me,t.Engine=Vn,t.FillRule=re,t.FloatCurveScatter=je,t.FloatScatter=we,t.FloatScatterBase=xe,t.FontAlign=Ne,t.FontAsset=Ot,t.FontFaceAssetLoader=At,t.FontMetrics=D,t.FontStyle=A,t.FontVerticalAlign=De,t.FontWeight=C,t.GameObject=it,t.Glob=u,t.Graphics=ae,t.GraphicsCommand=Zt,t.GraphicsCommandType=qt,t.GraphicsData=ee,t.GraphicsGradient=Qt,t.GraphicsLinearGradient=$t,t.GraphicsPath=Jt,t.GraphicsPattern=ie,t.GraphicsRenderer=ge,t.GraphicsRendererCanvas=Le,t.HSV=l,t.ImageAssetLoader=Tt,t.InitialAnchor=hn,t.InitialColor=ln,t.InitialLife=tn,t.InitialMass=en,t.InitialPosition=on,t.InitialRotation=an,t.InitialScale=nn,t.InitialTexture=sn,t.InitialVelocity=rn,t.Input=ht,t.InputComponent=et,t.Interpolation=dn,t.JSONAsset=Lt,t.JointStyle=Kt,t.Key={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,DIGIT_0:48,DIGIT_1:49,DIGIT_2:50,DIGIT_3:51,DIGIT_4:52,DIGIT_5:53,DIGIT_6:54,DIGIT_7:55,DIGIT_8:56,DIGIT_9:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,PAUSE_BREAK:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,INSERT:45,DELETE:46,LEFT_WINDOW:91,RIGHT_WINDOW:92,CONTEXT_MENU:93,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,BACKQUOTE:192,BRAKET_LEFT:219,BACK_SLASH:220,BRAKET_RIGHT:221,SINGLE_QUOTE:222,SPACE:32},t.KeyInfo=ot,t.Line=p,t.LoaderType=Mt,t.MapMap=o,t.MasterAudio=Vt,t.MathEx=i,t.Matrix=f,t.Message=x,t.MessageBinding=M,t.MessageDispatcher=E,t.MessageType=b,t.Modifier=Te,t.ObjectPool=a,t.Orientation=V,t.Oriented=Qe,t.Pair=Rn,t.ParserBase=ne,t.Particle=Ee,t.Perlin=r,t.Polygon=v,t.Projection=Mn,t.RGB=s,t.RadialScatter=Ve,t.Range=Sn,t.Rectangle=m,t.RenderSession=pe,t.RenderTarget=K,t.RenderTargetCanvas=Q,t.Renderer=$,t.ReverbEffect=bn,t.RigidBody=wn,t.RotationOverLife=Ze,t.ScaleOverLife=qe,t.Scatter=_e,t.SimpleEQ=yn,t.Sound=_n,t.SoundAsset=Wt,t.SoundAtlasAsset=Yt,t.SoundAtlasClip=Xt,t.SoundChannel=Gt,t.SoundClip=jt,t.SoundEffect=kt,t.SoundInstance=Ht,t.SoundListener=xn,t.SoundState=Ft,t.SplashScreen=zn,t.Sprite=Ie,t.SpriteRendererCanvas=Pe,t.Stage=vt,t.StageScaleMode=rt,t.StereoPanner=Ut,t.System=G,t.TextField=Be,t.TextMetricsData=B,t.TextMetricsEx=z,t.TextRenderer=me,t.TextRendererCanvas=ye,t.TextSegmentMetricsData=F,t.TextStyle=L,t.Texture=J,t.TextureAsset=Pt,t.TextureOverLife=Je,t.TilingInfo=function(t,e,n,i,r,o){this.width=void 0===t?0:t,this.height=void 0===e?0:e,this.scaleX=void 0===n?1:n,this.scaleY=void 0===i?1:i,this.wrapX=void 0===r?0:r,this.wrapY=void 0===o?0:o},t.Time=H,t.Timer=Hn,t.Tween=mn,t.Vector=d,t.VectorCurveScatter=Ge,t.VectorField=$e,t.VectorScatter=He,t.VectorScatterBase=ke,t.VectorTextureAsset=he,t.VideoNullDriver=Re,t.Viewport=j,t.XHRAssetLoader=Et,t.XMLAsset=Rt,Object.defineProperty(t,"__esModule",{value:!0})}(e)}).call(this,n(5))},function(t,e,n){var i=n(2),r=n(3);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var o={insert:"head",singleton:!1};i(r,o);t.exports=r.locals||{}},function(t,e,n){"use strict";var i,r=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function s(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function l(t,e){for(var n={},i=[],r=0;r<t.length;r++){var o=t[r],l=e.base?o[0]+e.base:o[0],h=n[l]||0,c="".concat(l," ").concat(h);n[l]=h+1;var u=s(c),d={css:o[1],media:o[2],sourceMap:o[3]};-1!==u?(a[u].references++,a[u].updater(d)):a.push({identifier:c,updater:g(d,e),references:1}),i.push(c)}return i}function h(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var r=n.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var a=o(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function d(t,e,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=u(e,r);else{var o=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function p(t,e,n){var i=n.css,r=n.media,o=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),o&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var m=null,f=0;function g(t,e){var n,i,r;if(e.singleton){var o=f++;n=m||(m=h(e)),i=d.bind(null,n,o,!1),r=d.bind(null,n,o,!0)}else n=h(e),i=p.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var n=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var r=s(n[i]);a[r].references--}for(var o=l(t,e),h=0;h<n.length;h++){var c=s(n[h]);0===a[c].references&&(a[c].updater(),a.splice(c,1))}n=o}}}},function(t,e,n){(e=n(4)(!1)).push([t.i,"*\n{\n    padding: 0;\n    margin: 0;\n}\n\nbody,\nhtml\n{\n    overflow: hidden;\n}\n\n.webgl\n{\n    /* position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: #000000; */\n\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    touch-action: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n    cursor: auto;\n    position: absolute;\n    top: 0;\n    left: 0\n}\n\n#container {\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    touch-action: none;\n    user-select: none;\n    -webkit-tap-highlight-color: transparent;\n    cursor: auto;\n    position: absolute;\n    top: 0;\n    left: 0\n}",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(a=i,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(l," */")),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[n].concat(o).concat([r]).join("\n")}var a,s,l;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(i)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(r[a]=!0)}for(var s=0;s<t.length;s++){var l=[].concat(t[s]);i&&r[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),e.push(l))}},e}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e);n(1);function i(t,e){var n=t.__state.conversionName.toString(),i=Math.round(t.r),r=Math.round(t.g),o=Math.round(t.b),a=t.a,s=Math.round(t.h),l=t.s.toFixed(1),h=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=t.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+i+","+r+","+o+")":"CSS_RGBA"===n?"rgba("+i+","+r+","+o+","+a+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+r+","+o+"]":"RGBA_ARRAY"===n?"["+i+","+r+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+h+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+h+",a:"+a+"}":"unknown format"}var r=Array.prototype.forEach,o=Array.prototype.slice,a={BREAK:{},extend:function(t){return this.each(o.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(o.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=o.call(arguments);return function(){for(var e=o.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(r&&t.forEach&&t.forEach===r)t.forEach(e,n);else if(t.length===t.length+0){var i,o=void 0;for(o=0,i=t.length;o<i;o++)if(o in t&&e.call(n,t[o],o)===this.BREAK)return}else for(var a in t)if(e.call(n,t[a],a)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i=void 0;return function(){var r=this,o=arguments;function a(){i=null,n||t.apply(r,o)}var s=n||!i;clearTimeout(i),i=setTimeout(a,e),s&&t.apply(r,o)}},toArray:function(t){return t.toArray?t.toArray():o.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},s=[{litmus:a.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:i},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:i},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:i},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:i}}},{litmus:a.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:a.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:a.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(a.isNumber(t.r)&&a.isNumber(t.g)&&a.isNumber(t.b)&&a.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(a.isNumber(t.r)&&a.isNumber(t.g)&&a.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(a.isNumber(t.h)&&a.isNumber(t.s)&&a.isNumber(t.v)&&a.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(a.isNumber(t.h)&&a.isNumber(t.s)&&a.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],l=void 0,h=void 0,c=function(){h=!1;var t=arguments.length>1?a.toArray(arguments):arguments[0];return a.each(s,(function(e){if(e.litmus(t))return a.each(e.conversions,(function(e,n){if(l=e.read(t),!1===h&&!1!==l)return h=l,l.conversionName=n,l.conversion=e,a.BREAK})),a.BREAK})),h},u=void 0,d={hsv_to_rgb:function(t,e,n){var i=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),o=n*(1-e),a=n*(1-r*e),s=n*(1-(1-r)*e),l=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,n){var i=Math.min(t,e,n),r=Math.max(t,e,n),o=r-i,a=void 0;return 0===r?{h:NaN,s:0,v:0}:(a=t===r?(e-n)/o:e===r?2+(n-t)/o:4+(t-e)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/r,v:r/255})},rgb_to_hex:function(t,e,n){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),i=this.hex_with_component(i,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(u=8*e)|t&~(255<<u)}},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},f=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),g=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},v=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},y=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},b=function(){function t(){if(m(this,t),this.__state=c.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return f(t,[{key:"toString",value:function(){return i(this)}},{key:"toHexString",value:function(){return i(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function _(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||b.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(b.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function x(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||b.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(b.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}b.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=d.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");a.extend(t.__state,d.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},b.recalculateHSV=function(t){var e=d.rgb_to_hsv(t.r,t.g,t.b);a.extend(t.__state,{s:e.s,v:e.v}),a.isNaN(e.h)?a.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},b.COMPONENTS=["r","g","b","h","s","v","hex","a"],_(b.prototype,"r",2),_(b.prototype,"g",1),_(b.prototype,"b",0),x(b.prototype,"h"),x(b.prototype,"s"),x(b.prototype,"v"),Object.defineProperty(b.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(b.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=d.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var w=function(){function t(e,n){m(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return f(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),M={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){a.each(t,(function(t){M[t]=e}))}));var S=/(\d+(\.\d+)?)px/;function T(t){if("0"===t||a.isUndefined(t))return 0;var e=t.match(S);return a.isNull(e)?0:parseFloat(e[1])}var E={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var i=n,r=e;a.isUndefined(r)&&(r=!0),a.isUndefined(i)&&(i=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,i){var r=n||{},o=M[e];if(!o)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var l=r.x||r.clientX||0,h=r.y||r.clientY||0;s.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,l,h,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;a.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:s.initEvent(e,r.bubbles||!1,r.cancelable||!0)}a.defaults(s,i),t.dispatchEvent(s)},bind:function(t,e,n,i){var r=i||!1;return t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on"+e,n),E},unbind:function(t,e,n,i){var r=i||!1;return t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on"+e,n),E},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return E},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),i=n.indexOf(e);-1!==i&&(n.splice(i,1),t.className=n.join(" "))}else t.className=void 0;return E},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return T(e["border-left-width"])+T(e["border-right-width"])+T(e["padding-left"])+T(e["padding-right"])+T(e.width)},getHeight:function(t){var e=getComputedStyle(t);return T(e["border-top-width"])+T(e["border-bottom-width"])+T(e["padding-top"])+T(e["padding-bottom"])+T(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},A=function(t){function e(t,n){m(this,e);var i=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),E.bind(i.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return v(e,t),f(e,[{key:"setValue",value:function(t){var n=g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(w),C=function(t){function e(t,n,i){m(this,e);var r=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i,s=r;if(r.__select=document.createElement("select"),a.isArray(o)){var l={};a.each(o,(function(t){l[t]=t})),o=l}return a.each(o,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)})),r.updateDisplay(),E.bind(r.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),r.domElement.appendChild(r.__select),r}return v(e,t),f(e,[{key:"setValue",value:function(t){var n=g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return E.isActive(this.__select)?this:(this.__select.value=this.getValue(),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(w),P=function(t){function e(t,n){m(this,e);var i=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i;function o(){r.setValue(r.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),E.bind(i.__input,"keyup",o),E.bind(i.__input,"change",o),E.bind(i.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),E.bind(i.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return v(e,t),f(e,[{key:"updateDisplay",value:function(){return E.isActive(this.__input)||(this.__input.value=this.getValue()),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(w);function L(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var R=function(t){function e(t,n,i){m(this,e);var r=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i||{};return r.__min=o.min,r.__max=o.max,r.__step=o.step,a.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=L(r.__impliedStep),r}return v(e,t),f(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=L(t),this}}]),e}(w);var O=function(t){function e(t,n,i){m(this,e);var r=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));r.__truncationSuspended=!1;var o=r,s=void 0;function l(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function h(t){var e=s-t.clientY;o.setValue(o.getValue()+e*o.__impliedStep),s=t.clientY}function c(){E.unbind(window,"mousemove",h),E.unbind(window,"mouseup",c),l()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),E.bind(r.__input,"change",(function(){var t=parseFloat(o.__input.value);a.isNaN(t)||o.setValue(t)})),E.bind(r.__input,"blur",(function(){l()})),E.bind(r.__input,"mousedown",(function(t){E.bind(window,"mousemove",h),E.bind(window,"mouseup",c),s=t.clientY})),E.bind(r.__input,"keydown",(function(t){13===t.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,l())})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return v(e,t),f(e,[{key:"updateDisplay",value:function(){var t,n,i;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,i=Math.pow(10,n),Math.round(t*i)/i),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(R);function I(t,e,n,i,r){return i+(t-e)/(n-e)*(r-i)}var N=function(t){function e(t,n,i,r,o){m(this,e);var a=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:r,step:o})),s=a;function l(t){t.preventDefault();var e=s.__background.getBoundingClientRect();return s.setValue(I(t.clientX,e.left,e.right,s.__min,s.__max)),!1}function h(){E.unbind(window,"mousemove",l),E.unbind(window,"mouseup",h),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(t){var e=t.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(I(e,n.left,n.right,s.__min,s.__max))}function u(){E.unbind(window,"touchmove",c),E.unbind(window,"touchend",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),E.bind(a.__background,"mousedown",(function(t){document.activeElement.blur(),E.bind(window,"mousemove",l),E.bind(window,"mouseup",h),l(t)})),E.bind(a.__background,"touchstart",(function(t){if(1!==t.touches.length)return;E.bind(window,"touchmove",c),E.bind(window,"touchend",u),c(t)})),E.addClass(a.__background,"slider"),E.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return v(e,t),f(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(R),D=function(t){function e(t,n,i){m(this,e);var r=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===i?"Fire":i,E.bind(r.__button,"click",(function(t){return t.preventDefault(),o.fire(),!1})),E.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return v(e,t),f(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(w),B=function(t){function e(t,n){m(this,e);var i=y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.__color=new b(i.getValue()),i.__temp=new b(0);var r=i;i.domElement=document.createElement("div"),E.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",E.bind(i.__input,"keydown",(function(t){13===t.keyCode&&p.call(this)})),E.bind(i.__input,"blur",p),E.bind(i.__selector,"mousedown",(function(){E.addClass(this,"drag").bind(window,"mouseup",(function(){E.removeClass(r.__selector,"drag")}))})),E.bind(i.__selector,"touchstart",(function(){E.addClass(this,"drag").bind(window,"touchend",(function(){E.removeClass(r.__selector,"drag")}))}));var o,s=document.createElement("div");function l(t){g(t),E.bind(window,"mousemove",g),E.bind(window,"touchmove",g),E.bind(window,"mouseup",u),E.bind(window,"touchend",u)}function h(t){v(t),E.bind(window,"mousemove",v),E.bind(window,"touchmove",v),E.bind(window,"mouseup",d),E.bind(window,"touchend",d)}function u(){E.unbind(window,"mousemove",g),E.unbind(window,"touchmove",g),E.unbind(window,"mouseup",u),E.unbind(window,"touchend",u),f()}function d(){E.unbind(window,"mousemove",v),E.unbind(window,"touchmove",v),E.unbind(window,"mouseup",d),E.unbind(window,"touchend",d),f()}function p(){var t=c(this.value);!1!==t?(r.__color.__state=t,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function f(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function g(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientX,o=n.clientY,a=(i-e.left)/(e.right-e.left),s=1-(o-e.top)/(e.bottom-e.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),r.__color.v=s,r.__color.s=a,r.setValue(r.__color.toOriginal()),!1}function v(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),r.__color.h=360*n,r.setValue(r.__color.toOriginal()),!1}return a.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),a.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),a.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),a.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),a.extend(s.style,{width:"100%",height:"100%",background:"none"}),k(s,"top","rgba(0,0,0,0)","#000"),a.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=i.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),E.bind(i.__saturation_field,"mousedown",l),E.bind(i.__saturation_field,"touchstart",l),E.bind(i.__field_knob,"mousedown",l),E.bind(i.__field_knob,"touchstart",l),E.bind(i.__hue_field,"mousedown",h),E.bind(i.__hue_field,"touchstart",h),i.__saturation_field.appendChild(s),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return v(e,t),f(e,[{key:"updateDisplay",value:function(){var t=c(this.getValue());if(!1!==t){var e=!1;a.each(b.COMPONENTS,(function(n){if(!a.isUndefined(t[n])&&!a.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&a.extend(this.__color.__state,t)}a.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,k(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),a.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(w),F=["-moz-","-o-","-webkit-","-ms-",""];function k(t,e,n,i){t.style.background="",a.each(F,(function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "}))}var U=function(t,e){var n=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var r=n.getElementsByTagName("head")[0];try{r.appendChild(i)}catch(t){}},z='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',H=function(t,e){var n=t[e];return a.isArray(arguments[2])||a.isObject(arguments[2])?new C(t,e,arguments[2]):a.isNumber(n)?a.isNumber(arguments[2])&&a.isNumber(arguments[3])?a.isNumber(arguments[4])?new N(t,e,arguments[2],arguments[3],arguments[4]):new N(t,e,arguments[2],arguments[3]):a.isNumber(arguments[4])?new O(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new O(t,e,{min:arguments[2],max:arguments[3]}):a.isString(n)?new P(t,e):a.isFunction(n)?new D(t,e,""):a.isBoolean(n)?new A(t,e):null};var G=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},V=function(){function t(){m(this,t),this.backgroundElement=document.createElement("div"),a.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),E.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),a.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;E.bind(this.backgroundElement,"click",(function(){e.hide()}))}return f(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),a.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",E.unbind(t.domElement,"webkitTransitionEnd",e),E.unbind(t.domElement,"transitionend",e),E.unbind(t.domElement,"oTransitionEnd",e)};E.bind(this.domElement,"webkitTransitionEnd",e),E.bind(this.domElement,"transitionend",e),E.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-E.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-E.getHeight(this.domElement)/2+"px"}}]),t}();U(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var j=function(){try{return!!window.localStorage}catch(t){return!1}}(),W=void 0,X=!0,Y=void 0,q=!1,Z=[],J=function t(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),E.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=a.defaults(i,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),i=a.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),a.isUndefined(i.load)?i.load={preset:"Default"}:i.preset&&(i.load.preset=i.preset),a.isUndefined(i.parent)&&i.hideable&&Z.push(this),i.resizable=a.isUndefined(i.parent)&&i.resizable,i.autoPlace&&a.isUndefined(i.scrollable)&&(i.scrollable=!0);var r,o=j&&"true"===localStorage.getItem(nt(this,"isLocal")),s=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(t){n.parent?n.getRoot().preset=t:i.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return i.width},set:function(t){i.width=t,st(n,t)}},name:{get:function(){return i.name},set:function(t){i.name=t,l&&(l.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(e){i.closed=e,i.closed?E.addClass(n.__ul,t.CLASS_CLOSED):E.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return o},set:function(t){j&&(o=t,t?E.bind(window,"unload",s):E.unbind(window,"unload",s),localStorage.setItem(nt(n,"isLocal"),t))}}}),a.isUndefined(i.parent)){if(this.closed=i.closed||!1,E.addClass(this.domElement,t.CLASS_MAIN),E.makeSelectable(this.domElement,!1),j&&o){n.useLocalStorage=!0;var h=localStorage.getItem(nt(this,"gui"));h&&(i.load=JSON.parse(h))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,E.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),i.closeOnTop?(E.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(E.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),E.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var c=document.createTextNode(i.name);E.addClass(c,"controller-name"),l=K(n,c);E.addClass(this.__ul,t.CLASS_CLOSED),E.addClass(l,"title"),E.bind(l,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(a.isUndefined(i.parent)&&(X&&(Y=document.createElement("div"),E.addClass(Y,"dg"),E.addClass(Y,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Y),X=!1),Y.appendChild(this.domElement),E.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||st(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},E.bind(window,"resize",this.__resizeHandler),E.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),E.bind(this.__ul,"transitionend",this.__resizeHandler),E.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&at(this),s=function(){j&&"true"===localStorage.getItem(nt(n,"isLocal"))&&localStorage.setItem(nt(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((r=n.getRoot()).width+=1,a.defer((function(){r.width-=1})))};function K(t,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?t.__ul.insertBefore(i,n):t.__ul.appendChild(i),t.onResize(),i}function Q(t){E.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&E.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function $(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function tt(t,e){var n=t.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(-1!==i){var r=n.__rememberedObjectIndecesToControllers[i];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[i]=r),r[e.property]=e,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[t.preset])a=o[t.preset];else{if(!o.Default)return;a=o.Default}if(a[i]&&void 0!==a[i][e.property]){var s=a[i][e.property];e.initialValue=s,e.setValue(s)}}}}function et(t,e,n,i){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var r=void 0;if(i.color)r=new B(e,n);else{var o=[e,n].concat(i.factoryArgs);r=H.apply(t,o)}i.before instanceof w&&(i.before=i.before.__li),tt(t,r),E.addClass(r.domElement,"c");var s=document.createElement("span");E.addClass(s,"property-name"),s.innerHTML=r.property;var l=document.createElement("div");l.appendChild(s),l.appendChild(r.domElement);var h=K(t,l,i.before);return E.addClass(h,J.CLASS_CONTROLLER_ROW),r instanceof B?E.addClass(h,"color"):E.addClass(h,p(r.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,a.extend(n,{options:function(e){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),et(t,n.object,n.property,{before:i,factoryArgs:[a.toArray(arguments)]})}if(a.isArray(e)||a.isObject(e)){var r=n.__li.nextElementSibling;return n.remove(),et(t,n.object,n.property,{before:r,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof N){var i=new O(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});a.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],r=i[t];n[t]=i[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(i,t),e.apply(n,t)}})),E.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof O){var r=function(e){if(a.isNumber(n.__min)&&a.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,r=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=et(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(i),r&&o.listen(),o}return e};n.min=a.compose(r,n.min),n.max=a.compose(r,n.max)}else n instanceof A?(E.bind(e,"click",(function(){E.fakeEvent(n.__checkbox,"click")})),E.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof D?(E.bind(e,"click",(function(){E.fakeEvent(n.__button,"click")})),E.bind(e,"mouseover",(function(){E.addClass(n.__button,"hover")})),E.bind(e,"mouseout",(function(){E.removeClass(n.__button,"hover")}))):n instanceof B&&(E.addClass(e,"color"),n.updateDisplay=a.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=a.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&$(t.getRoot(),!0),e}),n.setValue)}(t,h,r),t.__controllers.push(r),r}function nt(t,e){return document.location.href+"."+e}function it(t,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,t.__preset_select.appendChild(i),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function rt(t,e){e.style.display=t.useLocalStorage?"block":"none"}function ot(t){var e=t.__save_row=document.createElement("li");E.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),E.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",E.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",E.addClass(i,"button"),E.addClass(i,"save");var r=document.createElement("span");r.innerHTML="New",E.addClass(r,"button"),E.addClass(r,"save-as");var o=document.createElement("span");o.innerHTML="Revert",E.addClass(o,"button"),E.addClass(o,"revert");var s=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?a.each(t.load.remembered,(function(e,n){it(t,n,n===t.preset)})):it(t,"Default",!1),E.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(n),e.appendChild(i),e.appendChild(r),e.appendChild(o),j){var l=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(nt(0,"isLocal"))&&h.setAttribute("checked","checked"),rt(t,l),E.bind(h,"change",(function(){t.useLocalStorage=!t.useLocalStorage,rt(t,l)}))}var c=document.getElementById("dg-new-constructor");E.bind(c,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||W.hide()})),E.bind(n,"click",(function(){c.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),W.show(),c.focus(),c.select()})),E.bind(i,"click",(function(){t.save()})),E.bind(r,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),E.bind(o,"click",(function(){t.revert()}))}function at(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function i(){E.removeClass(t.__closeButton,J.CLASS_DRAG),E.unbind(window,"mousemove",n),E.unbind(window,"mouseup",i)}function r(r){return r.preventDefault(),e=r.clientX,E.addClass(t.__closeButton,J.CLASS_DRAG),E.bind(window,"mousemove",n),E.bind(window,"mouseup",i),!1}t.__resize_handle=document.createElement("div"),a.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),E.bind(t.__resize_handle,"mousedown",r),E.bind(t.__closeButton,"mousedown",r),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function st(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function lt(t,e){var n={};return a.each(t.__rememberedObjects,(function(i,r){var o={},s=t.__rememberedObjectIndecesToControllers[r];a.each(s,(function(t,n){o[n]=e?t.initialValue:t.getValue()})),n[r]=o})),n}J.toggleHide=function(){q=!q,a.each(Z,(function(t){t.domElement.style.display=q?"none":""}))},J.CLASS_AUTO_PLACE="a",J.CLASS_AUTO_PLACE_CONTAINER="ac",J.CLASS_MAIN="main",J.CLASS_CONTROLLER_ROW="cr",J.CLASS_TOO_TALL="taller-than-window",J.CLASS_CLOSED="closed",J.CLASS_CLOSE_BUTTON="close-button",J.CLASS_CLOSE_TOP="close-top",J.CLASS_CLOSE_BOTTOM="close-bottom",J.CLASS_DRAG="drag",J.DEFAULT_WIDTH=245,J.TEXT_CLOSED="Close Controls",J.TEXT_OPEN="Open Controls",J._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||J.toggleHide()},E.bind(window,"keydown",J._keydownHandler,!1),a.extend(J.prototype,{add:function(t,e){return et(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return et(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;a.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Y.removeChild(this.domElement);var t=this;a.each(this.__folders,(function(e){t.removeFolder(e)})),E.unbind(window,"keydown",J._keydownHandler,!1),Q(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new J(e);this.__folders[t]=n;var i=K(this,n.domElement);return E.addClass(i,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Q(t);var e=this;a.each(t.__folders,(function(e){t.removeFolder(e)})),a.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=E.getOffset(t.__ul).top,n=0;a.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=E.getHeight(e))})),window.innerHeight-e-20<n?(E.addClass(t.domElement,J.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(E.removeClass(t.domElement,J.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&a.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:a.debounce((function(){this.onResize()}),50),remember:function(){if(a.isUndefined(W)&&((W=new V).domElement.innerHTML=z),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;a.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&ot(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&st(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=lt(this)),t.folders={},a.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=lt(this),$(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=lt(this,!0)),this.load.remembered[t]=lt(this),this.preset=t,it(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){a.each(this.__controllers,(function(e){this.getRoot().load.remembered?tt(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),a.each(this.__folders,(function(t){t.revert(t)})),t||$(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&function t(e){0!==e.length&&G.call(window,(function(){t(e)}));a.each(e,(function(t){t.updateDisplay()}))}(this.__listening)},updateDisplay:function(){a.each(this.__controllers,(function(t){t.updateDisplay()})),a.each(this.__folders,(function(t){t.updateDisplay()}))}});void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e});var ht=0,ct=1,ut=2,dt=0,pt=1,mt=2,ft=3;function gt(){}Object.assign(gt.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,t)}}}});for(var vt=[],yt=0;yt<256;yt++)vt[yt]=(yt<16?"0":"")+yt.toString(16);var bt,_t={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(vt[255&t]+vt[t>>8&255]+vt[t>>16&255]+vt[t>>24&255]+"-"+vt[255&e]+vt[e>>8&255]+"-"+vt[e>>16&15|64]+vt[e>>24&255]+"-"+vt[63&n|128]+vt[n>>8&255]+"-"+vt[n>>16&255]+vt[n>>24&255]+vt[255&i]+vt[i>>8&255]+vt[i>>16&255]+vt[i>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*_t.DEG2RAD},radToDeg:function(t){return t*_t.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){var o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),h=o((e+i)/2),c=a((e+i)/2),u=o((e-i)/2),d=a((e-i)/2),p=o((i-e)/2),m=a((i-e)/2);switch(r){case"XYX":t.set(s*c,l*u,l*d,s*h);break;case"YZY":t.set(l*d,s*c,l*u,s*h);break;case"ZXZ":t.set(l*u,l*d,s*c,s*h);break;case"XZX":t.set(s*c,l*m,l*p,s*h);break;case"YXY":t.set(l*p,s*c,l*m,s*h);break;case"ZYZ":t.set(l*m,l*p,s*c,s*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};function xt(t,e){this.x=t||0,this.y=e||0}function wt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(xt.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(xt.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*n-o*i+t.x,this.y=r*i+o*n+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(wt.prototype,{isMatrix3:!0,set:function(t,e,n,i,r,o,a,s,l){var h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=r,h[5]=s,h[6]=n,h[7]=o,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],h=n[4],c=n[7],u=n[2],d=n[5],p=n[8],m=i[0],f=i[3],g=i[6],v=i[1],y=i[4],b=i[7],_=i[2],x=i[5],w=i[8];return r[0]=o*m+a*v+s*_,r[3]=o*f+a*y+s*x,r[6]=o*g+a*b+s*w,r[1]=l*m+h*v+c*_,r[4]=l*f+h*y+c*x,r[7]=l*g+h*b+c*w,r[2]=u*m+d*v+p*_,r[5]=u*f+d*y+p*x,r[8]=u*g+d*b+p*w,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],h=t[8];return e*o*h-e*a*l-n*r*h+n*a*s+i*r*l-i*o*s},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=t.elements,i=this.elements,r=n[0],o=n[1],a=n[2],s=n[3],l=n[4],h=n[5],c=n[6],u=n[7],d=n[8],p=d*l-h*u,m=h*c-d*s,f=u*s-l*c,g=r*p+o*m+a*f;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);var v=1/g;return i[0]=p*v,i[1]=(a*u-d*o)*v,i[2]=(h*o-a*l)*v,i[3]=m*v,i[4]=(d*r-a*c)*v,i[5]=(a*s-h*r)*v,i[6]=f*v,i[7]=(o*c-u*r)*v,i[8]=(l*r-o*s)*v,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,i,r,o,a){var s=Math.cos(r),l=Math.sin(r);this.set(n*s,n*l,-n*(s*o+l*a)+o+t,-i*l,i*s,-i*(-l*o+s*a)+a+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],o=i[3],a=i[6],s=i[1],l=i[4],h=i[7];return i[0]=e*r+n*s,i[3]=e*o+n*l,i[6]=e*a+n*h,i[1]=-n*r+e*s,i[4]=-n*o+e*l,i[7]=-n*a+e*h,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){for(var e=this.elements,n=t.elements,i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var Mt={getDataURL:function(t){var e;if("undefined"==typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===bt&&(bt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),bt.width=t.width,bt.height=t.height;var n=bt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=bt}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},St=0;function Tt(t,e,n,i,r,o,a,s,l,h){Object.defineProperty(this,"id",{value:St++}),this.uuid=_t.generateUUID(),this.name="",this.image=void 0!==t?t:Tt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Tt.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:1001,this.wrapT=void 0!==i?i:1001,this.magFilter=void 0!==r?r:1006,this.minFilter=void 0!==o?o:1008,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:1023,this.internalFormat=null,this.type=void 0!==s?s:1009,this.offset=new xt(0,0),this.repeat=new xt(1,1),this.center=new xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==h?h:3e3,this.version=0,this.onUpdate=null}function Et(t,e,n,i){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==i?i:1}function At(t,e,n){this.width=t,this.height=e,this.scissor=new Et(0,0,t,e),this.scissorTest=!1,this.viewport=new Et(0,0,t,e),n=n||{},this.texture=new Tt(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Ct(t,e,n){At.call(this,t,e,n),this.samples=4}function Pt(t,e,n,i){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==i?i:1}Tt.DEFAULT_IMAGE=void 0,Tt.DEFAULT_MAPPING=300,Tt.prototype=Object.assign(Object.create(gt.prototype),{constructor:Tt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=_t.generateUUID()),!e&&void 0===t.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var o=0,a=i.length;o<a;o++)r.push(Mt.getDataURL(i[o]))}else r=Mt.getDataURL(i);t.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Tt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(Et.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Et.prototype,{isVector4:!0,set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,i=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,i,r,o=t.elements,a=o[0],s=o[4],l=o[8],h=o[1],c=o[5],u=o[9],d=o[2],p=o[6],m=o[10];if(Math.abs(s-h)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(s+h)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(a+c+m-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var f=(a+1)/2,g=(c+1)/2,v=(m+1)/2,y=(s+h)/4,b=(l+d)/4,_=(u+p)/4;return f>g&&f>v?f<.01?(n=0,i=.707106781,r=.707106781):(i=y/(n=Math.sqrt(f)),r=b/n):g>v?g<.01?(n=.707106781,i=0,r=.707106781):(n=y/(i=Math.sqrt(g)),r=_/i):v<.01?(n=.707106781,i=.707106781,r=0):(n=b/(r=Math.sqrt(v)),i=_/r),this.set(n,i,r,e),this}var x=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(h-s)*(h-s));return Math.abs(x)<.001&&(x=1),this.x=(p-u)/x,this.y=(l-d)/x,this.z=(h-s)/x,this.w=Math.acos((a+c+m-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),At.prototype=Object.assign(Object.create(gt.prototype),{constructor:At,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Ct.prototype=Object.assign(Object.create(At.prototype),{constructor:Ct,isWebGLMultisampleRenderTarget:!0,copy:function(t){return At.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(Pt,{slerp:function(t,e,n,i){return n.copy(t).slerp(e,i)},slerpFlat:function(t,e,n,i,r,o,a){var s=n[i+0],l=n[i+1],h=n[i+2],c=n[i+3],u=r[o+0],d=r[o+1],p=r[o+2],m=r[o+3];if(c!==m||s!==u||l!==d||h!==p){var f=1-a,g=s*u+l*d+h*p+c*m,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var b=Math.sqrt(y),_=Math.atan2(b,g*v);f=Math.sin(f*_)/b,a=Math.sin(a*_)/b}var x=a*v;if(s=s*f+u*x,l=l*f+d*x,h=h*f+p*x,c=c*f+m*x,f===1-a){var w=1/Math.sqrt(s*s+l*l+h*h+c*c);s*=w,l*=w,h*=w,c*=w}}t[e]=s,t[e+1]=l,t[e+2]=h,t[e+3]=c},multiplyQuaternionsFlat:function(t,e,n,i,r,o){var a=n[i],s=n[i+1],l=n[i+2],h=n[i+3],c=r[o],u=r[o+1],d=r[o+2],p=r[o+3];return t[e]=a*p+h*c+s*d-l*u,t[e+1]=s*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-s*c,t[e+3]=h*p-a*c-s*u-l*d,t}}),Object.defineProperties(Pt.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Pt.prototype,{isQuaternion:!0,set:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,i=t._y,r=t._z,o=t.order,a=Math.cos,s=Math.sin,l=a(n/2),h=a(i/2),c=a(r/2),u=s(n/2),d=s(i/2),p=s(r/2);switch(o){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],l=n[9],h=n[2],c=n[6],u=n[10],d=i+s+u;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(c-l)*e,this._y=(o-h)*e,this._z=(a-r)*e):i>s&&i>u?(e=2*Math.sqrt(1+i-s-u),this._w=(c-l)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(o+h)/e):s>u?(e=2*Math.sqrt(1+s-i-u),this._w=(o-h)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(l+c)/e):(e=2*Math.sqrt(1+u-i-s),this._w=(a-r)/e,this._x=(o+h)/e,this._y=(l+c)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(_t.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var n=this.angleTo(t);if(0===n)return this;var i=Math.min(1,e/n);return this.slerp(t,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,i=t._y,r=t._z,o=t._w,a=e._x,s=e._y,l=e._z,h=e._w;return this._x=n*h+o*a+i*l-r*s,this._y=i*h+o*s+r*a-n*l,this._z=r*h+o*l+n*s-i*a,this._w=o*h-n*a-i*s-r*l,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-e;return this._w=l*o+e*this._w,this._x=l*n+e*this._x,this._y=l*i+e*this._y,this._z=l*r+e*this._z,this.normalize(),this._onChangeCallback(),this}var h=Math.sqrt(s),c=Math.atan2(h,a),u=Math.sin((1-e)*c)/h,d=Math.sin(e*c)/h;return this._w=o*u+this._w*d,this._x=n*u+this._x*d,this._y=i*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var Lt=new Ot,Rt=new Pt;function Ot(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}Object.assign(Ot.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Rt.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Rt.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements,o=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z,s=t.w,l=s*e+o*i-a*n,h=s*n+a*e-r*i,c=s*i+r*n-o*e,u=-r*e-o*n-a*i;return this.x=l*s+u*-r+h*-a-c*-o,this.y=h*s+u*-o+c*-r-l*-a,this.z=c*s+u*-a+l*-o-h*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,i=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this},projectOnVector:function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return Lt.copy(this).projectOnVector(t),this.sub(Lt)},reflect:function(t){return this.sub(Lt.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(_t.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){var i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});var It=new Ot,Nt=new zt,Dt=new Ot(0,0,0),Bt=new Ot(1,1,1),Ft=new Ot,kt=new Ot,Ut=new Ot;function zt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(zt.prototype,{isMatrix4:!0,set:function(t,e,n,i,r,o,a,s,l,h,c,u,d,p,m,f){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new zt).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,n=t.elements,i=1/It.setFromMatrixColumn(t,0).length(),r=1/It.setFromMatrixColumn(t,1).length(),o=1/It.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,i=t.y,r=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),l=Math.sin(i),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){var u=o*h,d=o*c,p=a*h,m=a*c;e[0]=s*h,e[4]=-s*c,e[8]=l,e[1]=d+p*l,e[5]=u-m*l,e[9]=-a*s,e[2]=m-u*l,e[6]=p+d*l,e[10]=o*s}else if("YXZ"===t.order){var f=s*h,g=s*c,v=l*h,y=l*c;e[0]=f+y*a,e[4]=v*a-g,e[8]=o*l,e[1]=o*c,e[5]=o*h,e[9]=-a,e[2]=g*a-v,e[6]=y+f*a,e[10]=o*s}else if("ZXY"===t.order){f=s*h,g=s*c,v=l*h,y=l*c;e[0]=f-y*a,e[4]=-o*c,e[8]=v+g*a,e[1]=g+v*a,e[5]=o*h,e[9]=y-f*a,e[2]=-o*l,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){u=o*h,d=o*c,p=a*h,m=a*c;e[0]=s*h,e[4]=p*l-d,e[8]=u*l+m,e[1]=s*c,e[5]=m*l+u,e[9]=d*l-p,e[2]=-l,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var b=o*s,_=o*l,x=a*s,w=a*l;e[0]=s*h,e[4]=w-b*c,e[8]=x*c+_,e[1]=c,e[5]=o*h,e[9]=-a*h,e[2]=-l*h,e[6]=_*c+x,e[10]=b-w*c}else if("XZY"===t.order){b=o*s,_=o*l,x=a*s,w=a*l;e[0]=s*h,e[4]=-c,e[8]=l*h,e[1]=b*c+w,e[5]=o*h,e[9]=_*c-x,e[2]=x*c-_,e[6]=a*h,e[10]=w*c+b}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Dt,t,Bt)},lookAt:function(t,e,n){var i=this.elements;return Ut.subVectors(t,e),0===Ut.lengthSq()&&(Ut.z=1),Ut.normalize(),Ft.crossVectors(n,Ut),0===Ft.lengthSq()&&(1===Math.abs(n.z)?Ut.x+=1e-4:Ut.z+=1e-4,Ut.normalize(),Ft.crossVectors(n,Ut)),Ft.normalize(),kt.crossVectors(Ut,Ft),i[0]=Ft.x,i[4]=kt.x,i[8]=Ut.x,i[1]=Ft.y,i[5]=kt.y,i[9]=Ut.y,i[2]=Ft.z,i[6]=kt.z,i[10]=Ut.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],h=n[1],c=n[5],u=n[9],d=n[13],p=n[2],m=n[6],f=n[10],g=n[14],v=n[3],y=n[7],b=n[11],_=n[15],x=i[0],w=i[4],M=i[8],S=i[12],T=i[1],E=i[5],A=i[9],C=i[13],P=i[2],L=i[6],R=i[10],O=i[14],I=i[3],N=i[7],D=i[11],B=i[15];return r[0]=o*x+a*T+s*P+l*I,r[4]=o*w+a*E+s*L+l*N,r[8]=o*M+a*A+s*R+l*D,r[12]=o*S+a*C+s*O+l*B,r[1]=h*x+c*T+u*P+d*I,r[5]=h*w+c*E+u*L+d*N,r[9]=h*M+c*A+u*R+d*D,r[13]=h*S+c*C+u*O+d*B,r[2]=p*x+m*T+f*P+g*I,r[6]=p*w+m*E+f*L+g*N,r[10]=p*M+m*A+f*R+g*D,r[14]=p*S+m*C+f*O+g*B,r[3]=v*x+y*T+b*P+_*I,r[7]=v*w+y*E+b*L+_*N,r[11]=v*M+y*A+b*R+_*D,r[15]=v*S+y*C+b*O+_*B,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],o=t[1],a=t[5],s=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*s*c-i*l*c-r*a*u+n*l*u+i*a*d-n*s*d)+t[7]*(+e*s*d-e*l*u+r*o*u-i*o*d+i*l*h-r*s*h)+t[11]*(+e*l*c-e*a*d-r*o*c+n*o*d+r*a*h-n*l*h)+t[15]*(-i*a*h-e*s*c+e*a*u+i*o*c-n*o*u+n*s*h)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,n){var i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var n=this.elements,i=t.elements,r=i[0],o=i[1],a=i[2],s=i[3],l=i[4],h=i[5],c=i[6],u=i[7],d=i[8],p=i[9],m=i[10],f=i[11],g=i[12],v=i[13],y=i[14],b=i[15],_=p*y*u-v*m*u+v*c*f-h*y*f-p*c*b+h*m*b,x=g*m*u-d*y*u-g*c*f+l*y*f+d*c*b-l*m*b,w=d*v*u-g*p*u+g*h*f-l*v*f-d*h*b+l*p*b,M=g*p*c-d*v*c-g*h*m+l*v*m+d*h*y-l*p*y,S=r*_+o*x+a*w+s*M;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var T=1/S;return n[0]=_*T,n[1]=(v*m*s-p*y*s-v*a*f+o*y*f+p*a*b-o*m*b)*T,n[2]=(h*y*s-v*c*s+v*a*u-o*y*u-h*a*b+o*c*b)*T,n[3]=(p*c*s-h*m*s-p*a*u+o*m*u+h*a*f-o*c*f)*T,n[4]=x*T,n[5]=(d*y*s-g*m*s+g*a*f-r*y*f-d*a*b+r*m*b)*T,n[6]=(g*c*s-l*y*s-g*a*u+r*y*u+l*a*b-r*c*b)*T,n[7]=(l*m*s-d*c*s+d*a*u-r*m*u-l*a*f+r*c*f)*T,n[8]=w*T,n[9]=(g*p*s-d*v*s-g*o*f+r*v*f+d*o*b-r*p*b)*T,n[10]=(l*v*s-g*h*s+g*o*u-r*v*u-l*o*b+r*h*b)*T,n[11]=(d*h*s-l*p*s-d*o*u+r*p*u+l*o*f-r*h*f)*T,n[12]=M*T,n[13]=(d*v*a-g*p*a+g*o*m-r*v*m-d*o*y+r*p*y)*T,n[14]=(g*h*a-l*v*a-g*o*c+r*v*c+l*o*y-r*h*y)*T,n[15]=(l*p*a-d*h*a+d*o*c-r*p*c-l*o*m+r*h*m)*T,this},scale:function(t){var e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=1-n,o=t.x,a=t.y,s=t.z,l=r*o,h=r*a;return this.set(l*o+n,l*a-i*s,l*s+i*a,0,l*a+i*s,h*a+n,h*s-i*o,0,l*s-i*a,h*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){var i=this.elements,r=e._x,o=e._y,a=e._z,s=e._w,l=r+r,h=o+o,c=a+a,u=r*l,d=r*h,p=r*c,m=o*h,f=o*c,g=a*c,v=s*l,y=s*h,b=s*c,_=n.x,x=n.y,w=n.z;return i[0]=(1-(m+g))*_,i[1]=(d+b)*_,i[2]=(p-y)*_,i[3]=0,i[4]=(d-b)*x,i[5]=(1-(u+g))*x,i[6]=(f+v)*x,i[7]=0,i[8]=(p+y)*w,i[9]=(f-v)*w,i[10]=(1-(u+m))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this},decompose:function(t,e,n){var i=this.elements,r=It.set(i[0],i[1],i[2]).length(),o=It.set(i[4],i[5],i[6]).length(),a=It.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Nt.copy(this);var s=1/r,l=1/o,h=1/a;return Nt.elements[0]*=s,Nt.elements[1]*=s,Nt.elements[2]*=s,Nt.elements[4]*=l,Nt.elements[5]*=l,Nt.elements[6]*=l,Nt.elements[8]*=h,Nt.elements[9]*=h,Nt.elements[10]*=h,e.setFromRotationMatrix(Nt),n.x=r,n.y=o,n.z=a,this},makePerspective:function(t,e,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(e-t),l=2*r/(n-i),h=(e+t)/(e-t),c=(n+i)/(n-i),u=-(o+r)/(o-r),d=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,n,i,r,o){var a=this.elements,s=1/(e-t),l=1/(n-i),h=1/(o-r),c=(e+t)*s,u=(n+i)*l,d=(o+r)*h;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});var Ht=new zt,Gt=new Pt;function Vt(t,e,n,i){this._x=t||0,this._y=e||0,this._z=n||0,this._order=i||Vt.DefaultOrder}function jt(){this.mask=1}Vt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Vt.DefaultOrder="XYZ",Object.defineProperties(Vt.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(Vt.prototype,{isEuler:!0,set:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var i=_t.clamp,r=t.elements,o=r[0],a=r[4],s=r[8],l=r[1],h=r[5],c=r[9],u=r[2],d=r[6],p=r[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,h),this._z=0);break;case"YXZ":this._x=Math.asin(-i(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(s,p));break;case"XZY":this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,h),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return Ht.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ht,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return Gt.setFromEuler(this),this.setFromQuaternion(Gt,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Ot(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(jt.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});var Wt=0,Xt=new Ot,Yt=new Pt,qt=new zt,Zt=new Ot,Jt=new Ot,Kt=new Ot,Qt=new Pt,$t=new Ot(1,0,0),te=new Ot(0,1,0),ee=new Ot(0,0,1),ne={type:"added"},ie={type:"removed"};function re(){Object.defineProperty(this,"id",{value:Wt++}),this.uuid=_t.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=re.DefaultUp.clone();var t=new Ot,e=new Vt,n=new Pt,i=new Ot(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new zt},normalMatrix:{value:new wt}}),this.matrix=new zt,this.matrixWorld=new zt,this.matrixAutoUpdate=re.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new jt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function oe(){re.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}re.DefaultUp=new Ot(0,1,0),re.DefaultMatrixAutoUpdate=!0,re.prototype=Object.assign(Object.create(gt.prototype),{constructor:re,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Yt.setFromAxisAngle(t,e),this.quaternion.multiply(Yt),this},rotateOnWorldAxis:function(t,e){return Yt.setFromAxisAngle(t,e),this.quaternion.premultiply(Yt),this},rotateX:function(t){return this.rotateOnAxis($t,t)},rotateY:function(t){return this.rotateOnAxis(te,t)},rotateZ:function(t){return this.rotateOnAxis(ee,t)},translateOnAxis:function(t,e){return Xt.copy(t).applyQuaternion(this.quaternion),this.position.add(Xt.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis($t,t)},translateY:function(t){return this.translateOnAxis(te,t)},translateZ:function(t){return this.translateOnAxis(ee,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(qt.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?Zt.copy(t):Zt.set(t,e,n);var i=this.parent;this.updateWorldMatrix(!0,!1),Jt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qt.lookAt(Jt,Zt,this.up):qt.lookAt(Zt,Jt,this.up),this.quaternion.setFromRotationMatrix(qt),i&&(qt.extractRotation(i.matrixWorld),Yt.setFromRotationMatrix(qt),this.quaternion.premultiply(Yt.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ne)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(ie)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),qt.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),qt.multiply(t.parent.matrixWorld)),t.applyMatrix4(qt),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Ot),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Pt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Jt,t,Kt),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Ot),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Jt,Qt,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Ot),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var i=this.children,r=0,o=i.length;r<o;r++)i[r].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var h=a[s];r(t.shapes,h)}else r(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,l=this.material.length;s<l;s++)c.push(r(t.materials,this.material[s]));i.material=c}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(t).object)}if(e){var u=f(t.geometries),d=f(t.materials),p=f(t.textures),m=f(t.images);a=f(t.shapes);u.length>0&&(n.geometries=u),d.length>0&&(n.materials=d),p.length>0&&(n.textures=p),m.length>0&&(n.images=m),a.length>0&&(n.shapes=a)}return n.object=i,n;function f(t){var e=[];for(var n in t){var i=t[n];delete i.metadata,e.push(i)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var i=t.children[n];this.add(i.clone())}return this}}),oe.prototype=Object.assign(Object.create(re.prototype),{constructor:oe,isScene:!0,copy:function(t,e){return re.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=re.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ae=[new Ot,new Ot,new Ot,new Ot,new Ot,new Ot,new Ot,new Ot],se=new Ot,le=new be,he=new Ot,ce=new Ot,ue=new Ot,de=new Ot,pe=new Ot,me=new Ot,fe=new Ot,ge=new Ot,ve=new Ot,ye=new Ot;function be(t,e){this.min=void 0!==t?t:new Ot(1/0,1/0,1/0),this.max=void 0!==e?e:new Ot(-1/0,-1/0,-1/0)}function _e(t,e,n,i,r){var o,a;for(o=0,a=t.length-3;o<=a;o+=3){ye.fromArray(t,o);var s=r.x*Math.abs(ye.x)+r.y*Math.abs(ye.y)+r.z*Math.abs(ye.z),l=e.dot(ye),h=n.dot(ye),c=i.dot(ye);if(Math.max(-Math.max(l,h,c),Math.min(l,h,c))>s)return!1}return!0}Object.assign(be.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;s<l;s+=3){var h=t[s],c=t[s+1],u=t[s+2];h<e&&(e=h),c<n&&(n=c),u<i&&(i=u),h>r&&(r=h),c>o&&(o=c),u>a&&(a=u)}return this.min.set(e,n,i),this.max.set(r,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=t.count;s<l;s++){var h=t.getX(s),c=t.getY(s),u=t.getZ(s);h<e&&(e=h),c<n&&(n=c),u<i&&(i=u),h>r&&(r=h),c>o&&(o=c),u>a&&(a=u)}return this.min.set(e,n,i),this.max.set(r,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var n=se.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Ot),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Ot),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),le.copy(e.boundingBox),le.applyMatrix4(t.matrixWorld),this.union(le));for(var n=t.children,i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Ot),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,se),se.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(fe),ge.subVectors(this.max,fe),he.subVectors(t.a,fe),ce.subVectors(t.b,fe),ue.subVectors(t.c,fe),de.subVectors(ce,he),pe.subVectors(ue,ce),me.subVectors(he,ue);var e=[0,-de.z,de.y,0,-pe.z,pe.y,0,-me.z,me.y,de.z,0,-de.x,pe.z,0,-pe.x,me.z,0,-me.x,-de.y,de.x,0,-pe.y,pe.x,0,-me.y,me.x,0];return!!_e(e,he,ce,ue,ge)&&(!!_e(e=[1,0,0,0,1,0,0,0,1],he,ce,ue,ge)&&(ve.crossVectors(de,pe),_e(e=[ve.x,ve.y,ve.z],he,ce,ue,ge)))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Ot),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return se.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(se).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(ae[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ae[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ae[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ae[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ae[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ae[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ae[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ae[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ae)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var xe=new be;function we(t,e){this.center=void 0!==t?t:new Ot,this.radius=void 0!==e?e:-1}Object.assign(we.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var n=this.center;void 0!==e?n.copy(e):xe.setFromPoints(t).getCenter(n);for(var i=0,r=0,o=t.length;r<o;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Ot),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new be),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var Me=new Ot,Se=new Ot,Te=new Ot,Ee=new Ot,Ae=new Ot,Ce=new Ot,Pe=new Ot;function Le(t,e){this.origin=void 0!==t?t:new Ot,this.direction=void 0!==e?e:new Ot(0,0,-1)}Object.assign(Le.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Ot),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,Me)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Ot),e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=Me.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Me.copy(this.direction).multiplyScalar(e).add(this.origin),Me.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,i){Se.copy(t).add(e).multiplyScalar(.5),Te.copy(e).sub(t).normalize(),Ee.copy(this.origin).sub(Se);var r,o,a,s,l=.5*t.distanceTo(e),h=-this.direction.dot(Te),c=Ee.dot(this.direction),u=-Ee.dot(Te),d=Ee.lengthSq(),p=Math.abs(1-h*h);if(p>0)if(o=h*c-u,s=l*p,(r=h*u-c)>=0)if(o>=-s)if(o<=s){var m=1/p;a=(r*=m)*(r+h*(o*=m)+2*c)+o*(h*r+o+2*u)+d}else o=l,a=-(r=Math.max(0,-(h*o+c)))*r+o*(o+2*u)+d;else o=-l,a=-(r=Math.max(0,-(h*o+c)))*r+o*(o+2*u)+d;else o<=-s?a=-(r=Math.max(0,-(-h*l+c)))*r+(o=r>0?-l:Math.min(Math.max(-l,-u),l))*(o+2*u)+d:o<=s?(r=0,a=(o=Math.min(Math.max(-l,-u),l))*(o+2*u)+d):a=-(r=Math.max(0,-(h*l+c)))*r+(o=r>0?l:Math.min(Math.max(-l,-u),l))*(o+2*u)+d;else o=h>0?-l:l,a=-(r=Math.max(0,-(h*o+c)))*r+o*(o+2*u)+d;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(Te).multiplyScalar(o).add(Se),a},intersectSphere:function(t,e){Me.subVectors(t.center,this.origin);var n=Me.dot(this.direction),i=Me.dot(Me)-n*n,r=t.radius*t.radius;if(i>r)return null;var o=Math.sqrt(r-i),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,e):this.at(a,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var n,i,r,o,a,s,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,o=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,o=(t.min.y-u.y)*h),n>o||r>i?null:((r>n||n!=n)&&(n=r),(o<i||i!=i)&&(i=o),c>=0?(a=(t.min.z-u.z)*c,s=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,s=(t.min.z-u.z)*c),n>s||a>i?null:((a>n||n!=n)&&(n=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,Me)},intersectTriangle:function(t,e,n,i,r){Ae.subVectors(e,t),Ce.subVectors(n,t),Pe.crossVectors(Ae,Ce);var o,a=this.direction.dot(Pe);if(a>0){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Ee.subVectors(this.origin,t);var s=o*this.direction.dot(Ce.crossVectors(Ee,Ce));if(s<0)return null;var l=o*this.direction.dot(Ae.cross(Ee));if(l<0)return null;if(s+l>a)return null;var h=-o*Ee.dot(Pe);return h<0?null:this.at(h/a,r)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var Re=new Ot,Oe=new Ot,Ie=new wt;function Ne(t,e){this.normal=void 0!==t?t:new Ot(1,0,0),this.constant=void 0!==e?e:0}Object.assign(Ne.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){var i=Re.subVectors(n,e).cross(Oe.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Ot),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Ot);var n=t.delta(Re),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;var r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?void 0:e.copy(n).multiplyScalar(r).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Ot),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){var n=e||Ie.getNormalMatrix(t),i=this.coplanarPoint(Re).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var De=new Ot,Be=new Ot,Fe=new Ot,ke=new Ot,Ue=new Ot,ze=new Ot,He=new Ot,Ge=new Ot,Ve=new Ot,je=new Ot;function We(t,e,n){this.a=void 0!==t?t:new Ot,this.b=void 0!==e?e:new Ot,this.c=void 0!==n?n:new Ot}Object.assign(We,{getNormal:function(t,e,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Ot),i.subVectors(n,e),De.subVectors(t,e),i.cross(De);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)},getBarycoord:function(t,e,n,i,r){De.subVectors(i,e),Be.subVectors(n,e),Fe.subVectors(t,e);var o=De.dot(De),a=De.dot(Be),s=De.dot(Fe),l=Be.dot(Be),h=Be.dot(Fe),c=o*l-a*a;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Ot),0===c)return r.set(-2,-1,-1);var u=1/c,d=(l*s-a*h)*u,p=(o*h-a*s)*u;return r.set(1-d-p,p,d)},containsPoint:function(t,e,n,i){return We.getBarycoord(t,e,n,i,ke),ke.x>=0&&ke.y>=0&&ke.x+ke.y<=1},getUV:function(t,e,n,i,r,o,a,s){return this.getBarycoord(t,e,n,i,ke),s.set(0,0),s.addScaledVector(r,ke.x),s.addScaledVector(o,ke.y),s.addScaledVector(a,ke.z),s},isFrontFacing:function(t,e,n,i){return De.subVectors(n,e),Be.subVectors(t,e),De.cross(Be).dot(i)<0}}),Object.assign(We.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return De.subVectors(this.c,this.b),Be.subVectors(this.a,this.b),.5*De.cross(Be).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Ot),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return We.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Ne),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return We.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,i,r){return We.getUV(t,this.a,this.b,this.c,e,n,i,r)},containsPoint:function(t){return We.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return We.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Ot);var n,i,r=this.a,o=this.b,a=this.c;Ue.subVectors(o,r),ze.subVectors(a,r),Ge.subVectors(t,r);var s=Ue.dot(Ge),l=ze.dot(Ge);if(s<=0&&l<=0)return e.copy(r);Ve.subVectors(t,o);var h=Ue.dot(Ve),c=ze.dot(Ve);if(h>=0&&c<=h)return e.copy(o);var u=s*c-h*l;if(u<=0&&s>=0&&h<=0)return n=s/(s-h),e.copy(r).addScaledVector(Ue,n);je.subVectors(t,a);var d=Ue.dot(je),p=ze.dot(je);if(p>=0&&d<=p)return e.copy(a);var m=d*l-s*p;if(m<=0&&l>=0&&p<=0)return i=l/(l-p),e.copy(r).addScaledVector(ze,i);var f=h*p-d*c;if(f<=0&&c-h>=0&&d-p>=0)return He.subVectors(a,o),i=(c-h)/(c-h+(d-p)),e.copy(o).addScaledVector(He,i);var g=1/(f+m+u);return n=m*g,i=u*g,e.copy(r).addScaledVector(Ue,n).addScaledVector(ze,i)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var Xe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ye={h:0,s:0,l:0},qe={h:0,s:0,l:0};function Ze(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function Je(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function Ke(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Qe(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function $e(t,e,n,i,r,o){this.a=t,this.b=e,this.c=n,this.normal=i&&i.isVector3?i:new Ot,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new Ze,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}Object.assign(Ze.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){if(t=_t.euclideanModulo(t,1),e=_t.clamp(e,0,1),n=_t.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Je(r,i,t+1/3),this.g=Je(r,i,t),this.b=Je(r,i,t-1/3)}return this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,r=n[1],o=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return e(i[5]),this.setHSL(a,s,l)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){var h=n[1],c=h.length;if(3===c)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var e=Xe[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=Ke(t.r),this.g=Ke(t.g),this.b=Ke(t.b),this},copyLinearToSRGB:function(t){return this.r=Qe(t.r),this.g=Qe(t.g),this.b=Qe(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n,i=this.r,r=this.g,o=this.b,a=Math.max(i,r,o),s=Math.min(i,r,o),l=(s+a)/2;if(s===a)e=0,n=0;else{var h=a-s;switch(n=l<=.5?h/(a+s):h/(2-a-s),a){case i:e=(r-o)/h+(r<o?6:0);break;case r:e=(o-i)/h+2;break;case o:e=(i-r)/h+4}e/=6}return t.h=e,t.s=n,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){return this.getHSL(Ye),Ye.h+=t,Ye.s+=e,Ye.l+=n,this.setHSL(Ye.h,Ye.s,Ye.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(Ye),t.getHSL(qe);var n=_t.lerp(Ye.h,qe.h,e),i=_t.lerp(Ye.s,qe.s,e),r=_t.lerp(Ye.l,qe.l,e);return this.setHSL(n,i,r),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),Ze.NAMES=Xe,Object.assign($e.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var tn=0;function en(){Object.defineProperty(this,"id",{value:tn++}),this.uuid=_t.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function nn(t){en.call(this),this.type="MeshBasicMaterial",this.color=new Ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}en.prototype=Object.assign(Object.create(gt.prototype),{constructor:en,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n)if("shading"!==e){var i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){var e=[];for(var n in t){var i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){var r=i(t.textures),o=i(t.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(null!==e){var i=e.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(en.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),nn.prototype=Object.create(en.prototype),nn.prototype.constructor=nn,nn.prototype.isMeshBasicMaterial=!0,nn.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var rn=new Ot;function on(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function an(t,e,n){on.call(this,new Int8Array(t),e,n)}function sn(t,e,n){on.call(this,new Uint8Array(t),e,n)}function ln(t,e,n){on.call(this,new Uint8ClampedArray(t),e,n)}function hn(t,e,n){on.call(this,new Int16Array(t),e,n)}function cn(t,e,n){on.call(this,new Uint16Array(t),e,n)}function un(t,e,n){on.call(this,new Int32Array(t),e,n)}function dn(t,e,n){on.call(this,new Uint32Array(t),e,n)}function pn(t,e,n){on.call(this,new Float32Array(t),e,n)}function mn(t,e,n){on.call(this,new Float64Array(t),e,n)}function fn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function gn(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}Object.defineProperty(on.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(on.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new Ze),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new xt),e[n++]=o.x,e[n++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new Ot),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new Et),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z,e[n++]=o.w}return this},applyMatrix3:function(t){for(var e=0,n=this.count;e<n;e++)rn.x=this.getX(e),rn.y=this.getY(e),rn.z=this.getZ(e),rn.applyMatrix3(t),this.setXYZ(e,rn.x,rn.y,rn.z);return this},applyMatrix4:function(t){for(var e=0,n=this.count;e<n;e++)rn.x=this.getX(e),rn.y=this.getY(e),rn.z=this.getZ(e),rn.applyMatrix4(t),this.setXYZ(e,rn.x,rn.y,rn.z);return this},applyNormalMatrix:function(t){for(var e=0,n=this.count;e<n;e++)rn.x=this.getX(e),rn.y=this.getY(e),rn.z=this.getZ(e),rn.applyNormalMatrix(t),this.setXYZ(e,rn.x,rn.y,rn.z);return this},transformDirection:function(t){for(var e=0,n=this.count;e<n;e++)rn.x=this.getX(e),rn.y=this.getY(e),rn.z=this.getZ(e),rn.transformDirection(t),this.setXYZ(e,rn.x,rn.y,rn.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),an.prototype=Object.create(on.prototype),an.prototype.constructor=an,sn.prototype=Object.create(on.prototype),sn.prototype.constructor=sn,ln.prototype=Object.create(on.prototype),ln.prototype.constructor=ln,hn.prototype=Object.create(on.prototype),hn.prototype.constructor=hn,cn.prototype=Object.create(on.prototype),cn.prototype.constructor=cn,un.prototype=Object.create(on.prototype),un.prototype.constructor=un,dn.prototype=Object.create(on.prototype),dn.prototype.constructor=dn,pn.prototype=Object.create(on.prototype),pn.prototype.constructor=pn,mn.prototype=Object.create(on.prototype),mn.prototype.constructor=mn,Object.assign(fn.prototype,{computeGroups:function(t){for(var e,n=[],i=void 0,r=t.faces,o=0;o<r.length;o++){var a=r[o];a.materialIndex!==i&&(i=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,n.push(e)),e={start:3*o,materialIndex:i})}void 0!==e&&(e.count=3*o-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e,n=t.faces,i=t.vertices,r=t.faceVertexUvs,o=r[0]&&r[0].length>0,a=r[1]&&r[1].length>0,s=t.morphTargets,l=s.length;if(l>0){e=[];for(var h=0;h<l;h++)e[h]={name:s[h].name,data:[]};this.morphTargets.position=e}var c,u=t.morphNormals,d=u.length;if(d>0){c=[];for(h=0;h<d;h++)c[h]={name:u[h].name,data:[]};this.morphTargets.normal=c}var p=t.skinIndices,m=t.skinWeights,f=p.length===i.length,g=m.length===i.length;i.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(h=0;h<n.length;h++){var v=n[h];this.vertices.push(i[v.a],i[v.b],i[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=v.normal;this.normals.push(b,b,b)}var _,x=v.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===o)void 0!==(_=r[0][h])?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new xt,new xt,new xt));if(!0===a)void 0!==(_=r[1][h])?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new xt,new xt,new xt));for(var M=0;M<l;M++){var S=s[M].vertices;e[M].data.push(S[v.a],S[v.b],S[v.c])}for(M=0;M<d;M++){var T=u[M].vertexNormals[h];c[M].data.push(T.a,T.b,T.c)}f&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),g&&this.skinWeights.push(m[v.a],m[v.b],m[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var vn=1,yn=new zt,bn=new re,_n=new Ot,xn=new be,wn=new be,Mn=new Ot;function Sn(){Object.defineProperty(this,"id",{value:vn+=2}),this.uuid=_t.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Sn.prototype=Object.assign(Object.create(gt.prototype),{constructor:Sn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(gn(t)>65535?dn:cn)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new wt).getNormalMatrix(t);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return yn.makeRotationX(t),this.applyMatrix4(yn),this},rotateY:function(t){return yn.makeRotationY(t),this.applyMatrix4(yn),this},rotateZ:function(t){return yn.makeRotationZ(t),this.applyMatrix4(yn),this},translate:function(t,e,n){return yn.makeTranslation(t,e,n),this.applyMatrix4(yn),this},scale:function(t,e,n){return yn.makeScale(t,e,n),this.applyMatrix4(yn),this},lookAt:function(t){return bn.lookAt(t),bn.updateMatrix(),this.applyMatrix4(bn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_n).negate(),this.translate(_n.x,_n.y,_n.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var n=new pn(3*e.vertices.length,3),i=new pn(3*e.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(e.vertices)),this.setAttribute("color",i.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new pn(e.lineDistances.length,1);this.setAttribute("lineDistance",r.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new pn(e,3)),this},updateFromObject:function(t){var e,n=t.geometry;if(t.isMesh){var i=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(i=void 0,n.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(n);i.verticesNeedUpdate=n.verticesNeedUpdate,i.normalsNeedUpdate=n.normalsNeedUpdate,i.colorsNeedUpdate=n.colorsNeedUpdate,i.uvsNeedUpdate=n.uvsNeedUpdate,i.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=i}return!0===n.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(n.vertices),e.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(n.normals),e.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(n.colors),e.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(n.uvs),e.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(n.lineDistances),e.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new fn).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new on(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(3*t.normals.length);this.setAttribute("normal",new on(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var i=new Float32Array(3*t.colors.length);this.setAttribute("color",new on(i,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var r=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new on(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new on(o,2).copyVector2sArray(t.uvs2))}for(var a in this.groups=t.groups,t.morphTargets){for(var s=[],l=t.morphTargets[a],h=0,c=l.length;h<c;h++){var u=l[h],d=new pn(3*u.data.length,3);d.name=u.name,s.push(d.copyVector3sArray(u.data))}this.morphAttributes[a]=s}if(t.skinIndices.length>0){var p=new pn(4*t.skinIndices.length,4);this.setAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var m=new pn(4*t.skinWeights.length,4);this.setAttribute("skinWeight",m.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new be);var t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var n=0,i=e.length;n<i;n++){var r=e[n];xn.setFromBufferAttribute(r),this.morphTargetsRelative?(Mn.addVectors(this.boundingBox.min,xn.min),this.boundingBox.expandByPoint(Mn),Mn.addVectors(this.boundingBox.max,xn.max),this.boundingBox.expandByPoint(Mn)):(this.boundingBox.expandByPoint(xn.min),this.boundingBox.expandByPoint(xn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new we);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(xn.setFromBufferAttribute(t),e)for(var i=0,r=e.length;i<r;i++){var o=e[i];wn.setFromBufferAttribute(o),this.morphTargetsRelative?(Mn.addVectors(xn.min,wn.min),xn.expandByPoint(Mn),Mn.addVectors(xn.max,wn.max),xn.expandByPoint(Mn)):(xn.expandByPoint(wn.min),xn.expandByPoint(wn.max))}xn.getCenter(n);var a=0;for(i=0,r=t.count;i<r;i++)Mn.fromBufferAttribute(t,i),a=Math.max(a,n.distanceToSquared(Mn));if(e)for(i=0,r=e.length;i<r;i++){o=e[i];for(var s=this.morphTargetsRelative,l=0,h=o.count;l<h;l++)Mn.fromBufferAttribute(o,l),s&&(_n.fromBufferAttribute(t,l),Mn.add(_n)),a=Math.max(a,n.distanceToSquared(Mn))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var n=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new on(new Float32Array(n.length),3));else for(var i=e.normal.array,r=0,o=i.length;r<o;r++)i[r]=0;var a,s,l,h=e.normal.array,c=new Ot,u=new Ot,d=new Ot,p=new Ot,m=new Ot;if(t){var f=t.array;for(r=0,o=t.count;r<o;r+=3)a=3*f[r+0],s=3*f[r+1],l=3*f[r+2],c.fromArray(n,a),u.fromArray(n,s),d.fromArray(n,l),p.subVectors(d,u),m.subVectors(c,u),p.cross(m),h[a]+=p.x,h[a+1]+=p.y,h[a+2]+=p.z,h[s]+=p.x,h[s+1]+=p.y,h[s+2]+=p.z,h[l]+=p.x,h[l+1]+=p.y,h[l+2]+=p.z}else for(r=0,o=n.length;r<o;r+=9)c.fromArray(n,r),u.fromArray(n,r+3),d.fromArray(n,r+6),p.subVectors(d,u),m.subVectors(c,u),p.cross(m),h[r]=p.x,h[r+1]=p.y,h[r+2]=p.z,h[r+3]=p.x,h[r+4]=p.y,h[r+5]=p.z,h[r+6]=p.x,h[r+7]=p.y,h[r+8]=p.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==t.attributes[i])for(var r=n[i].array,o=t.attributes[i],a=o.array,s=o.itemSize*e,l=Math.min(a.length,r.length-s),h=0,c=s;h<l;h++,c++)r[c]=a[h];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)Mn.x=t.getX(e),Mn.y=t.getY(e),Mn.z=t.getZ(e),Mn.normalize(),t.setXYZ(e,Mn.x,Mn.y,Mn.z)},toNonIndexed:function(){function t(t,e){for(var n=t.array,i=t.itemSize,r=new n.constructor(e.length*i),o=0,a=0,s=0,l=e.length;s<l;s++){o=e[s]*i;for(var h=0;h<i;h++)r[a++]=n[o++]}return new on(r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Sn,n=this.index.array,i=this.attributes;for(var r in i){var o=t(i[r],n);e.setAttribute(r,o)}var a=this.morphAttributes;for(r in a){for(var s=[],l=a[r],h=0,c=l.length;h<c;h++){o=t(l[h],n);s.push(o)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;for(var u=this.groups,d=(h=0,u.length);h<d;h++){var p=u[h];e.addGroup(p.start,p.count,p.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var i=this.index;null!==i&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var n in r){var o=(d=r[n]).toJSON();""!==d.name&&(o.name=d.name),t.data.attributes[n]=o}var a={},s=!1;for(var n in this.morphAttributes){for(var l=this.morphAttributes[n],h=[],c=0,u=l.length;c<u;c++){var d;o=(d=l[c]).toJSON();""!==d.name&&(o.name=d.name),h.push(o)}h.length>0&&(a[n]=h,s=!0)}s&&(t.data.morphAttributes=a,t.data.morphTargetsRelative=this.morphTargetsRelative);var p=this.groups;p.length>0&&(t.data.groups=JSON.parse(JSON.stringify(p)));var m=this.boundingSphere;return null!==m&&(t.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),t},clone:function(){return(new Sn).copy(this)},copy:function(t){var e,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;null!==r&&this.setIndex(r.clone());var o=t.attributes;for(e in o){var a=o[e];this.setAttribute(e,a.clone())}var s=t.morphAttributes;for(e in s){var l=[],h=s[e];for(n=0,i=h.length;n<i;n++)l.push(h[n].clone());this.morphAttributes[e]=l}this.morphTargetsRelative=t.morphTargetsRelative;var c=t.groups;for(n=0,i=c.length;n<i;n++){var u=c[n];this.addGroup(u.start,u.count,u.materialIndex)}var d=t.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=t.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Tn=new zt,En=new Le,An=new we,Cn=new Ot,Pn=new Ot,Ln=new Ot,Rn=new Ot,On=new Ot,In=new Ot,Nn=new Ot,Dn=new Ot,Bn=new Ot,Fn=new xt,kn=new xt,Un=new xt,zn=new Ot,Hn=new Ot;function Gn(t,e){re.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Sn,this.material=void 0!==e?e:new nn,this.updateMorphTargets()}function Vn(t,e,n,i,r,o,a,s){if(null===(1===e.side?i.intersectTriangle(a,o,r,!0,s):i.intersectTriangle(r,o,a,2!==e.side,s)))return null;Hn.copy(s),Hn.applyMatrix4(t.matrixWorld);var l=n.ray.origin.distanceTo(Hn);return l<n.near||l>n.far?null:{distance:l,point:Hn.clone(),object:t}}function jn(t,e,n,i,r,o,a,s,l,h,c,u){Cn.fromBufferAttribute(r,h),Pn.fromBufferAttribute(r,c),Ln.fromBufferAttribute(r,u);var d=t.morphTargetInfluences;if(e.morphTargets&&o&&d){Nn.set(0,0,0),Dn.set(0,0,0),Bn.set(0,0,0);for(var p=0,m=o.length;p<m;p++){var f=d[p],g=o[p];0!==f&&(Rn.fromBufferAttribute(g,h),On.fromBufferAttribute(g,c),In.fromBufferAttribute(g,u),a?(Nn.addScaledVector(Rn,f),Dn.addScaledVector(On,f),Bn.addScaledVector(In,f)):(Nn.addScaledVector(Rn.sub(Cn),f),Dn.addScaledVector(On.sub(Pn),f),Bn.addScaledVector(In.sub(Ln),f)))}Cn.add(Nn),Pn.add(Dn),Ln.add(Bn)}t.isSkinnedMesh&&(t.boneTransform(h,Cn),t.boneTransform(c,Pn),t.boneTransform(u,Ln));var v=Vn(t,e,n,i,Cn,Pn,Ln,zn);if(v){s&&(Fn.fromBufferAttribute(s,h),kn.fromBufferAttribute(s,c),Un.fromBufferAttribute(s,u),v.uv=We.getUV(zn,Cn,Pn,Ln,Fn,kn,Un,new xt)),l&&(Fn.fromBufferAttribute(l,h),kn.fromBufferAttribute(l,c),Un.fromBufferAttribute(l,u),v.uv2=We.getUV(zn,Cn,Pn,Ln,Fn,kn,Un,new xt));var y=new $e(h,c,u);We.getNormal(Cn,Pn,Ln,y.normal),v.face=y}return v}Gn.prototype=Object.assign(Object.create(re.prototype),{constructor:Gn,isMesh:!0,copy:function(t){return re.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,o=Object.keys(r);if(o.length>0){var a=r[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)n=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var n,i=this.geometry,r=this.material,o=this.matrixWorld;if(void 0!==r&&(null===i.boundingSphere&&i.computeBoundingSphere(),An.copy(i.boundingSphere),An.applyMatrix4(o),!1!==t.ray.intersectsSphere(An)&&(Tn.getInverse(o),En.copy(t.ray).applyMatrix4(Tn),null===i.boundingBox||!1!==En.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var a,s,l,h,c,u,d,p,m,f=i.index,g=i.attributes.position,v=i.morphAttributes.position,y=i.morphTargetsRelative,b=i.attributes.uv,_=i.attributes.uv2,x=i.groups,w=i.drawRange;if(null!==f)if(Array.isArray(r))for(h=0,u=x.length;h<u;h++)for(m=r[(p=x[h]).materialIndex],c=Math.max(p.start,w.start),d=Math.min(p.start+p.count,w.start+w.count);c<d;c+=3)a=f.getX(c),s=f.getX(c+1),l=f.getX(c+2),(n=jn(this,m,t,En,g,v,y,b,_,a,s,l))&&(n.faceIndex=Math.floor(c/3),n.face.materialIndex=p.materialIndex,e.push(n));else for(h=Math.max(0,w.start),u=Math.min(f.count,w.start+w.count);h<u;h+=3)a=f.getX(h),s=f.getX(h+1),l=f.getX(h+2),(n=jn(this,r,t,En,g,v,y,b,_,a,s,l))&&(n.faceIndex=Math.floor(h/3),e.push(n));else if(void 0!==g)if(Array.isArray(r))for(h=0,u=x.length;h<u;h++)for(m=r[(p=x[h]).materialIndex],c=Math.max(p.start,w.start),d=Math.min(p.start+p.count,w.start+w.count);c<d;c+=3)(n=jn(this,m,t,En,g,v,y,b,_,a=c,s=c+1,l=c+2))&&(n.faceIndex=Math.floor(c/3),n.face.materialIndex=p.materialIndex,e.push(n));else for(h=Math.max(0,w.start),u=Math.min(g.count,w.start+w.count);h<u;h+=3)(n=jn(this,r,t,En,g,v,y,b,_,a=h,s=h+1,l=h+2))&&(n.faceIndex=Math.floor(h/3),e.push(n))}else if(i.isGeometry){var M,S,T,E,A=Array.isArray(r),C=i.vertices,P=i.faces,L=i.faceVertexUvs[0];L.length>0&&(E=L);for(var R=0,O=P.length;R<O;R++){var I=P[R],N=A?r[I.materialIndex]:r;if(void 0!==N&&(M=C[I.a],S=C[I.b],T=C[I.c],n=Vn(this,N,t,En,M,S,T,zn))){if(E&&E[R]){var D=E[R];Fn.copy(D[0]),kn.copy(D[1]),Un.copy(D[2]),n.uv=We.getUV(zn,M,S,T,Fn,kn,Un,new xt)}n.face=I,n.faceIndex=R,e.push(n)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Wn=0,Xn=new zt,Yn=new re,qn=new Ot;function Zn(){Object.defineProperty(this,"id",{value:Wn+=2}),this.uuid=_t.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Zn.prototype=Object.assign(Object.create(gt.prototype),{constructor:Zn,isGeometry:!0,applyMatrix4:function(t){for(var e=(new wt).getNormalMatrix(t),n=0,i=this.vertices.length;n<i;n++){this.vertices[n].applyMatrix4(t)}for(n=0,i=this.faces.length;n<i;n++){var r=this.faces[n];r.normal.applyMatrix3(e).normalize();for(var o=0,a=r.vertexNormals.length;o<a;o++)r.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Xn.makeRotationX(t),this.applyMatrix4(Xn),this},rotateY:function(t){return Xn.makeRotationY(t),this.applyMatrix4(Xn),this},rotateZ:function(t){return Xn.makeRotationZ(t),this.applyMatrix4(Xn),this},translate:function(t,e,n){return Xn.makeTranslation(t,e,n),this.applyMatrix4(Xn),this},scale:function(t,e,n){return Xn.makeScale(t,e,n),this.applyMatrix4(Xn),this},lookAt:function(t){return Yn.lookAt(t),Yn.updateMatrix(),this.applyMatrix4(Yn.matrix),this},fromBufferGeometry:function(t){var e=this,n=null!==t.index?t.index.array:void 0,i=t.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var r=i.position.array,o=void 0!==i.normal?i.normal.array:void 0,a=void 0!==i.color?i.color.array:void 0,s=void 0!==i.uv?i.uv.array:void 0,l=void 0!==i.uv2?i.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var h=0;h<r.length;h+=3)e.vertices.push((new Ot).fromArray(r,h)),void 0!==a&&e.colors.push((new Ze).fromArray(a,h));function c(t,n,i,r){var h=void 0===a?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[i].clone()],c=new $e(t,n,i,void 0===o?[]:[(new Ot).fromArray(o,3*t),(new Ot).fromArray(o,3*n),(new Ot).fromArray(o,3*i)],h,r);e.faces.push(c),void 0!==s&&e.faceVertexUvs[0].push([(new xt).fromArray(s,2*t),(new xt).fromArray(s,2*n),(new xt).fromArray(s,2*i)]),void 0!==l&&e.faceVertexUvs[1].push([(new xt).fromArray(l,2*t),(new xt).fromArray(l,2*n),(new xt).fromArray(l,2*i)])}var u=t.groups;if(u.length>0)for(h=0;h<u.length;h++)for(var d=u[h],p=d.start,m=p,f=p+d.count;m<f;m+=3)void 0!==n?c(n[m],n[m+1],n[m+2],d.materialIndex):c(m,m+1,m+2,d.materialIndex);else if(void 0!==n)for(h=0;h<n.length;h+=3)c(n[h],n[h+1],n[h+2]);else for(h=0;h<r.length/3;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(qn).negate(),this.translate(qn.x,qn.y,qn.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,i=new zt;return i.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){for(var t=new Ot,e=new Ot,n=0,i=this.faces.length;n<i;n++){var r=this.faces[n],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];t.subVectors(s,a),e.subVectors(o,a),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){var e,n,i,r,o,a;for(void 0===t&&(t=!0),a=new Array(this.vertices.length),e=0,n=this.vertices.length;e<n;e++)a[e]=new Ot;if(t){var s,l,h,c=new Ot,u=new Ot;for(i=0,r=this.faces.length;i<r;i++)o=this.faces[i],s=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c],c.subVectors(h,l),u.subVectors(s,l),c.cross(u),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),i=0,r=this.faces.length;i<r;i++)a[(o=this.faces[i]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,n=this.vertices.length;e<n;e++)a[e].normalize();for(i=0,r=this.faces.length;i<r;i++){var d=(o=this.faces[i]).vertexNormals;3===d.length?(d[0].copy(a[o.a]),d[1].copy(a[o.b]),d[2].copy(a[o.c])):(d[0]=a[o.a].clone(),d[1]=a[o.b].clone(),d[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,n;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var i=(n=this.faces[t]).vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n,i,r;for(n=0,i=this.faces.length;n<i;n++)for((r=this.faces[n]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),t=0,e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone();var o=new Zn;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)l=new Ot,h={a:new Ot,b:new Ot,c:new Ot},a.push(l),s.push(h)}var l,h,c=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)r=this.faces[n],l=c.faceNormals[n],h=c.vertexNormals[n],l.copy(r.normal),h.a.copy(r.vertexNormals[0]),h.b.copy(r.vertexNormals[1]),h.c.copy(r.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(r=this.faces[n]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new be),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new we),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(t&&t.isGeometry){var i,r=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,l=t.faces,h=this.colors,c=t.colors;void 0===n&&(n=0),void 0!==e&&(i=(new wt).getNormalMatrix(e));for(var u=0,d=a.length;u<d;u++){var p=a[u].clone();void 0!==e&&p.applyMatrix4(e),o.push(p)}for(u=0,d=c.length;u<d;u++)h.push(c[u].clone());for(u=0,d=l.length;u<d;u++){var m,f,g,v=l[u],y=v.vertexNormals,b=v.vertexColors;(m=new $e(v.a+r,v.b+r,v.c+r)).normal.copy(v.normal),void 0!==i&&m.normal.applyMatrix3(i).normalize();for(var _=0,x=y.length;_<x;_++)f=y[_].clone(),void 0!==i&&f.applyMatrix3(i).normalize(),m.vertexNormals.push(f);m.color.copy(v.color);for(_=0,x=b.length;_<x;_++)g=b[_],m.vertexColors.push(g.clone());m.materialIndex=v.materialIndex+n,s.push(m)}for(u=0,d=t.faceVertexUvs.length;u<d;u++){var w=t.faceVertexUvs[u];void 0===this.faceVertexUvs[u]&&(this.faceVertexUvs[u]=[]);for(_=0,x=w.length;_<x;_++){for(var M=w[_],S=[],T=0,E=M.length;T<E;T++)S.push(M[T].clone());this.faceVertexUvs[u].push(S)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,n,i,r,o,a,s,l={},h=[],c=[],u=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)t=this.vertices[n],void 0===l[e=Math.round(t.x*u)+"_"+Math.round(t.y*u)+"_"+Math.round(t.z*u)]?(l[e]=n,h.push(this.vertices[n]),c[n]=h.length-1):c[n]=c[l[e]];var d=[];for(n=0,i=this.faces.length;n<i;n++){(r=this.faces[n]).a=c[r.a],r.b=c[r.b],r.c=c[r.c],o=[r.a,r.b,r.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(n);break}}for(n=d.length-1;n>=0;n--){var m=d[n];for(this.faces.splice(m,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(m,1)}var f=this.vertices.length-h.length;return this.vertices=h,f},setFromPoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var i=t[e];this.vertices.push(new Ot(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));var i,r,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===e&&(i=[]),a&&a.length===e&&(r=[]);for(n=0;n<e;n++){var s=t[n]._id;i&&i.push(o[s]),r&&r.push(a[s])}i&&(this.faceVertexUvs[0]=i),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}for(var i=[],r=0;r<this.vertices.length;r++){var o=this.vertices[r];i.push(o.x,o.y,o.z)}var a=[],s=[],l={},h=[],c={},u=[],d={};for(r=0;r<this.faces.length;r++){var p=this.faces[r],m=void 0!==this.faceVertexUvs[0][r],f=p.normal.length()>0,g=p.vertexNormals.length>0,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,b=0;if(b=M(b,0,0),b=M(b,1,!0),b=M(b,2,!1),b=M(b,3,m),b=M(b,4,f),b=M(b,5,g),b=M(b,6,v),b=M(b,7,y),a.push(b),a.push(p.a,p.b,p.c),a.push(p.materialIndex),m){var _=this.faceVertexUvs[0][r];a.push(E(_[0]),E(_[1]),E(_[2]))}if(f&&a.push(S(p.normal)),g){var x=p.vertexNormals;a.push(S(x[0]),S(x[1]),S(x[2]))}if(v&&a.push(T(p.color)),y){var w=p.vertexColors;a.push(T(w[0]),T(w[1]),T(w[2]))}}function M(t,e,n){return n?t|1<<e:t&~(1<<e)}function S(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]||(l[e]=s.length/3,s.push(t.x,t.y,t.z)),l[e]}function T(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]||(c[e]=h.length,h.push(t.getHex())),c[e]}function E(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]||(d[e]=u.length/2,u.push(t.x,t.y)),d[e]}return t.data={},t.data.vertices=i,t.data.normals=s,h.length>0&&(t.data.colors=h),u.length>0&&(t.data.uvs=[u]),t.data.faces=a,t},clone:function(){return(new Zn).copy(this)},copy:function(t){var e,n,i,r,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,n=s.length;e<n;e++)this.vertices.push(s[e].clone());var l=t.colors;for(e=0,n=l.length;e<n;e++)this.colors.push(l[e].clone());var h=t.faces;for(e=0,n=h.length;e<n;e++)this.faces.push(h[e].clone());for(e=0,n=t.faceVertexUvs.length;e<n;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),i=0,r=c.length;i<r;i++){var u=c[i],d=[];for(o=0,a=u.length;o<a;o++){var p=u[o];d.push(p.clone())}this.faceVertexUvs[e].push(d)}}var m=t.morphTargets;for(e=0,n=m.length;e<n;e++){var f={};if(f.name=m[e].name,void 0!==m[e].vertices)for(f.vertices=[],i=0,r=m[e].vertices.length;i<r;i++)f.vertices.push(m[e].vertices[i].clone());if(void 0!==m[e].normals)for(f.normals=[],i=0,r=m[e].normals.length;i<r;i++)f.normals.push(m[e].normals[i].clone());this.morphTargets.push(f)}var g=t.morphNormals;for(e=0,n=g.length;e<n;e++){var v={};if(void 0!==g[e].vertexNormals)for(v.vertexNormals=[],i=0,r=g[e].vertexNormals.length;i<r;i++){var y=g[e].vertexNormals[i],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),v.vertexNormals.push(b)}if(void 0!==g[e].faceNormals)for(v.faceNormals=[],i=0,r=g[e].faceNormals.length;i<r;i++)v.faceNormals.push(g[e].faceNormals[i].clone());this.morphNormals.push(v)}var _=t.skinWeights;for(e=0,n=_.length;e<n;e++)this.skinWeights.push(_[e].clone());var x=t.skinIndices;for(e=0,n=x.length;e<n;e++)this.skinIndices.push(x[e].clone());var w=t.lineDistances;for(e=0,n=w.length;e<n;e++)this.lineDistances.push(w[e]);var M=t.boundingBox;null!==M&&(this.boundingBox=M.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class Jn extends Sn{constructor(t,e,n,i,r,o){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};var a=this;t=t||1,e=e||1,n=n||1,i=Math.floor(i)||1,r=Math.floor(r)||1,o=Math.floor(o)||1;var s=[],l=[],h=[],c=[],u=0,d=0;function p(t,e,n,i,r,o,p,m,f,g,v){var y,b,_=o/f,x=p/g,w=o/2,M=p/2,S=m/2,T=f+1,E=g+1,A=0,C=0,P=new Ot;for(b=0;b<E;b++){var L=b*x-M;for(y=0;y<T;y++){var R=y*_-w;P[t]=R*i,P[e]=L*r,P[n]=S,l.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[n]=m>0?1:-1,h.push(P.x,P.y,P.z),c.push(y/f),c.push(1-b/g),A+=1}}for(b=0;b<g;b++)for(y=0;y<f;y++){var O=u+y+T*b,I=u+y+T*(b+1),N=u+(y+1)+T*(b+1),D=u+(y+1)+T*b;s.push(O,I,D),s.push(I,N,D),C+=6}a.addGroup(d,C,v),d+=C,u+=A}p("z","y","x",-1,-1,n,e,t,o,r,0),p("z","y","x",1,-1,n,e,-t,o,r,1),p("x","z","y",1,1,t,n,e,i,o,2),p("x","z","y",1,-1,t,n,-e,i,o,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new pn(l,3)),this.setAttribute("normal",new pn(h,3)),this.setAttribute("uv",new pn(c,2))}}function Kn(t){var e={};for(var n in t)for(var i in e[n]={},t[n]){var r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}return e}function Qn(t){for(var e={},n=0;n<t.length;n++){var i=Kn(t[n]);for(var r in i)e[r]=i[r]}return e}var $n={clone:Kn,merge:Qn};function ti(t){en.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function ei(){re.call(this),this.type="Camera",this.matrixWorldInverse=new zt,this.projectionMatrix=new zt,this.projectionMatrixInverse=new zt}function ni(t,e,n,i){ei.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ti.prototype=Object.create(en.prototype),ti.prototype.constructor=ti,ti.prototype.isShaderMaterial=!0,ti.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Kn(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},ti.prototype.toJSON=function(t){var e=en.prototype.toJSON.call(this,t);for(var n in e.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var r={};for(var o in this.extensions)!0===this.extensions[o]&&(r[o]=!0);return Object.keys(r).length>0&&(e.extensions=r),e},ei.prototype=Object.assign(Object.create(re.prototype),{constructor:ei,isCamera:!0,copy:function(t,e){return re.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Ot),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){re.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){re.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ni.prototype=Object.assign(Object.create(ei.prototype),{constructor:ni,isPerspectiveCamera:!0,copy:function(t,e){return ei.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*_t.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*_t.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*_t.RAD2DEG*Math.atan(Math.tan(.5*_t.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,i,r,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*_t.DEG2RAD*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/a,e-=o.offsetY*n/s,i*=o.width/a,n*=o.height/s}var l=this.filmOffset;0!==l&&(r+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=re.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});function ii(t,e,n,i){re.call(this),this.type="CubeCamera";var r=new ni(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new Ot(1,0,0)),this.add(r);var o=new ni(90,1,t,e);o.up.set(0,-1,0),o.lookAt(new Ot(-1,0,0)),this.add(o);var a=new ni(90,1,t,e);a.up.set(0,0,1),a.lookAt(new Ot(0,1,0)),this.add(a);var s=new ni(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new Ot(0,-1,0)),this.add(s);var l=new ni(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new Ot(0,0,1)),this.add(l);var h=new ni(90,1,t,e);h.up.set(0,-1,0),h.lookAt(new Ot(0,0,-1)),this.add(h),i=i||{format:1022,magFilter:1006,minFilter:1006},this.renderTarget=new ri(n,i),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var n=t.getRenderTarget(),i=this.renderTarget,c=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,r),t.setRenderTarget(i,1),t.render(e,o),t.setRenderTarget(i,2),t.render(e,a),t.setRenderTarget(i,3),t.render(e,s),t.setRenderTarget(i,4),t.render(e,l),i.texture.generateMipmaps=c,t.setRenderTarget(i,5),t.render(e,h),t.setRenderTarget(n)},this.clear=function(t,e,n,i){for(var r=t.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)t.setRenderTarget(o,a),t.clear(e,n,i);t.setRenderTarget(r)}}function ri(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),At.call(this,t,t,e)}function oi(t,e,n,i,r,o,a,s,l,h,c,u){Tt.call(this,null,o,a,s,l,h,i,r,c,u),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==h?h:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}ii.prototype=Object.create(re.prototype),ii.prototype.constructor=ii,ri.prototype=Object.create(At.prototype),ri.prototype.constructor=ri,ri.prototype.isWebGLCubeRenderTarget=!0,ri.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var n=new oe,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},r=new ti({type:"CubemapFromEquirect",uniforms:Kn(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;var o=new Gn(new Jn(5,5,5),r);n.add(o);var a=new ii(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(t,n),o.geometry.dispose(),o.material.dispose(),this},oi.prototype=Object.create(Tt.prototype),oi.prototype.constructor=oi,oi.prototype.isDataTexture=!0;var ai=new we,si=new Ot;function li(t,e,n,i,r,o){this.planes=[void 0!==t?t:new Ne,void 0!==e?e:new Ne,void 0!==n?n:new Ne,void 0!==i?i:new Ne,void 0!==r?r:new Ne,void 0!==o?o:new Ne]}Object.assign(li.prototype,{set:function(t,e,n,i,r,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){var e=this.planes,n=t.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],h=n[6],c=n[7],u=n[8],d=n[9],p=n[10],m=n[11],f=n[12],g=n[13],v=n[14],y=n[15];return e[0].setComponents(a-i,c-s,m-u,y-f).normalize(),e[1].setComponents(a+i,c+s,m+u,y+f).normalize(),e[2].setComponents(a+r,c+l,m+d,y+g).normalize(),e[3].setComponents(a-r,c-l,m-d,y-g).normalize(),e[4].setComponents(a-o,c-h,m-p,y-v).normalize(),e[5].setComponents(a+o,c+h,m+p,y+v).normalize(),this},intersectsObject:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),ai.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(ai)},intersectsSprite:function(t){return ai.center.set(0,0,0),ai.radius=.7071067811865476,ai.applyMatrix4(t.matrixWorld),this.intersectsSphere(ai)},intersectsSphere:function(t){for(var e=this.planes,n=t.center,i=-t.radius,r=0;r<6;r++){if(e[r].distanceToPoint(n)<i)return!1}return!0},intersectsBox:function(t){for(var e=this.planes,n=0;n<6;n++){var i=e[n];if(si.x=i.normal.x>0?t.max.x:t.min.x,si.y=i.normal.y>0?t.max.y:t.min.y,si.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(si)<0)return!1}return!0},containsPoint:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}});var hi={common:{diffuse:{value:new Ze(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new wt},uv2Transform:{value:new wt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new xt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ze(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Ze(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new wt}},sprite:{diffuse:{value:new Ze(15658734)},opacity:{value:1},center:{value:new xt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new wt}}};function ci(){var t=null,e=!1,n=null;function i(r,o){!1!==e&&(n(r,o),t.requestAnimationFrame(i))}return{start:function(){!0!==e&&null!==n&&(t.requestAnimationFrame(i),e=!0)},stop:function(){e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function ui(t,e){var n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){e.isInterleavedBufferAttribute&&(e=e.data);var o=i.get(e);void 0===o?i.set(e,function(e,n){var i=e.array,r=e.usage,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,i,r),e.onUploadCallback();var a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,r)):o.version<e.version&&(!function(e,i,r){var o=i.array,a=i.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,o):(n?t.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):t.bufferSubData(r,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,e,r),o.version=e.version)}}}function di(t,e,n,i){Zn.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new pi(t,e,n,i)),this.mergeVertices()}function pi(t,e,n,i){Sn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};var r,o,a=(t=t||1)/2,s=(e=e||1)/2,l=Math.floor(n)||1,h=Math.floor(i)||1,c=l+1,u=h+1,d=t/l,p=e/h,m=[],f=[],g=[],v=[];for(o=0;o<u;o++){var y=o*p-s;for(r=0;r<c;r++){var b=r*d-a;f.push(b,-y,0),g.push(0,0,1),v.push(r/l),v.push(1-o/h)}}for(o=0;o<h;o++)for(r=0;r<l;r++){var _=r+c*o,x=r+c*(o+1),w=r+1+c*(o+1),M=r+1+c*o;m.push(_,x,M),m.push(x,w,M)}this.setIndex(m),this.setAttribute("position",new pn(f,3)),this.setAttribute("normal",new pn(g,3)),this.setAttribute("uv",new pn(v,2))}di.prototype=Object.create(Zn.prototype),di.prototype.constructor=di,pi.prototype=Object.create(Sn.prototype),pi.prototype.constructor=pi;var mi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},fi={basic:{uniforms:Qn([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.fog]),vertexShader:mi.meshbasic_vert,fragmentShader:mi.meshbasic_frag},lambert:{uniforms:Qn([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.fog,hi.lights,{emissive:{value:new Ze(0)}}]),vertexShader:mi.meshlambert_vert,fragmentShader:mi.meshlambert_frag},phong:{uniforms:Qn([hi.common,hi.specularmap,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.fog,hi.lights,{emissive:{value:new Ze(0)},specular:{value:new Ze(1118481)},shininess:{value:30}}]),vertexShader:mi.meshphong_vert,fragmentShader:mi.meshphong_frag},standard:{uniforms:Qn([hi.common,hi.envmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.roughnessmap,hi.metalnessmap,hi.fog,hi.lights,{emissive:{value:new Ze(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mi.meshphysical_vert,fragmentShader:mi.meshphysical_frag},toon:{uniforms:Qn([hi.common,hi.specularmap,hi.aomap,hi.lightmap,hi.emissivemap,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.gradientmap,hi.fog,hi.lights,{emissive:{value:new Ze(0)},specular:{value:new Ze(1118481)},shininess:{value:30}}]),vertexShader:mi.meshtoon_vert,fragmentShader:mi.meshtoon_frag},matcap:{uniforms:Qn([hi.common,hi.bumpmap,hi.normalmap,hi.displacementmap,hi.fog,{matcap:{value:null}}]),vertexShader:mi.meshmatcap_vert,fragmentShader:mi.meshmatcap_frag},points:{uniforms:Qn([hi.points,hi.fog]),vertexShader:mi.points_vert,fragmentShader:mi.points_frag},dashed:{uniforms:Qn([hi.common,hi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mi.linedashed_vert,fragmentShader:mi.linedashed_frag},depth:{uniforms:Qn([hi.common,hi.displacementmap]),vertexShader:mi.depth_vert,fragmentShader:mi.depth_frag},normal:{uniforms:Qn([hi.common,hi.bumpmap,hi.normalmap,hi.displacementmap,{opacity:{value:1}}]),vertexShader:mi.normal_vert,fragmentShader:mi.normal_frag},sprite:{uniforms:Qn([hi.sprite,hi.fog]),vertexShader:mi.sprite_vert,fragmentShader:mi.sprite_frag},background:{uniforms:{uvTransform:{value:new wt},t2D:{value:null}},vertexShader:mi.background_vert,fragmentShader:mi.background_frag},cube:{uniforms:Qn([hi.envmap,{opacity:{value:1}}]),vertexShader:mi.cube_vert,fragmentShader:mi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mi.equirect_vert,fragmentShader:mi.equirect_frag},distanceRGBA:{uniforms:Qn([hi.common,hi.displacementmap,{referencePosition:{value:new Ot},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mi.distanceRGBA_vert,fragmentShader:mi.distanceRGBA_frag},shadow:{uniforms:Qn([hi.lights,hi.fog,{color:{value:new Ze(0)},opacity:{value:1}}]),vertexShader:mi.shadow_vert,fragmentShader:mi.shadow_frag}};function gi(t,e,n,i){var r,o,a=new Ze(0),s=0,l=null,h=0,c=null;function u(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,i)}return{getClearColor:function(){return a},setClearColor:function(t,e){a.set(t),u(a,s=void 0!==e?e:1)},getClearAlpha:function(){return s},setClearAlpha:function(t){u(a,s=t)},render:function(e,i,d,p){var m=i.background,f=t.xr,g=f.getSession&&f.getSession();if(g&&"additive"===g.environmentBlendMode&&(m=null),null===m?u(a,s):m&&m.isColor&&(u(m,1),p=!0),(t.autoClear||p)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||306===m.mapping)){void 0===o&&((o=new Gn(new Jn(1,1,1),new ti({type:"BackgroundCubeMaterial",uniforms:Kn(fi.cube.uniforms),vertexShader:fi.cube.vertexShader,fragmentShader:fi.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o));var v=m.isWebGLCubeRenderTarget?m.texture:m;o.material.uniforms.envMap.value=v,o.material.uniforms.flipEnvMap.value=v.isCubeTexture?-1:1,l===m&&h===v.version&&c===t.toneMapping||(o.material.needsUpdate=!0,l=m,h=v.version,c=t.toneMapping),e.unshift(o,o.geometry,o.material,0,0,null)}else m&&m.isTexture&&(void 0===r&&((r=new Gn(new pi(2,2),new ti({type:"BackgroundMaterial",uniforms:Kn(fi.background.uniforms),vertexShader:fi.background.vertexShader,fragmentShader:fi.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(r.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(r)),r.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),r.material.uniforms.uvTransform.value.copy(m.matrix),l===m&&h===m.version&&c===t.toneMapping||(r.material.needsUpdate=!0,l=m,h=m.version,c=t.toneMapping),e.unshift(r,r.geometry,r.material,0,0,null))}}}function vi(t,e,n,i){var r,o=i.isWebGL2;this.setMode=function(t){r=t},this.render=function(e,i){t.drawArrays(r,e,i),n.update(i,r)},this.renderInstances=function(i,a,s,l){if(0!==l){var h,c;if(o)h=t,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(h=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[c](r,a,s,l),n.update(s,r,l)}}}function yi(t,e,n){var i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===n.logarithmicDepthBuffer,h=t.getParameter(34930),c=t.getParameter(35660),u=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),m=t.getParameter(36347),f=t.getParameter(36348),g=t.getParameter(36349),v=c>0,y=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;var n=e.get("EXT_texture_filter_anisotropic");return i=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:l,maxTextures:h,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:m,maxVaryings:f,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function bi(){var t=this,e=null,n=0,i=!1,r=!1,o=new Ne,a=new wt,s={value:null,needsUpdate:!1};function l(){s.value!==e&&(s.value=e,s.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(e,n,i,r){var l=null!==e?e.length:0,h=null;if(0!==l){if(h=s.value,!0!==r||null===h){var c=i+4*l,u=n.matrixWorldInverse;a.getNormalMatrix(u),(null===h||h.length<c)&&(h=new Float32Array(c));for(var d=0,p=i;d!==l;++d,p+=4)o.copy(e[d]).applyMatrix4(u,a),o.normal.toArray(h,p),h[p+3]=o.constant}s.value=h,s.needsUpdate=!0}return t.numPlanes=l,t.numIntersection=0,h}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(t,r,o){var a=0!==t.length||r||0!==n||i;return i=r,e=h(t,o,0),n=t.length,a},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,l()},this.setState=function(t,o,a,c,u,d){if(!i||null===t||0===t.length||r&&!a)r?h(null):l();else{var p=r?0:n,m=4*p,f=u.clippingState||null;s.value=f,f=h(t,c,m,d);for(var g=0;g!==m;++g)f[g]=e[g];u.clippingState=f,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}}function _i(t){var e={};return{get:function(n){if(void 0!==e[n])return e[n];var i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=i,i}}}function xi(t,e,n){var i=new WeakMap,r=new WeakMap;function o(t){var a=t.target,s=i.get(a);for(var l in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[l]);a.removeEventListener("dispose",o),i.delete(a);var h=r.get(s);h&&(e.remove(h),r.delete(s)),n.memory.geometries--}function a(t){var n=[],i=t.index,o=t.attributes.position,a=0;if(null!==i){var s=i.array;a=i.version;for(var l=0,h=s.length;l<h;l+=3){var c=s[l+0],u=s[l+1],d=s[l+2];n.push(c,u,u,d,d,c)}}else{s=o.array;a=o.version;for(l=0,h=s.length/3-1;l<h;l+=3){c=l+0,u=l+1,d=l+2;n.push(c,u,u,d,d,c)}}var p=new(gn(n)>65535?dn:cn)(n,1);p.version=a,e.update(p,34963);var m=r.get(t);m&&e.remove(m),r.set(t,p)}return{get:function(t,e){var r=i.get(e);return r||(e.addEventListener("dispose",o),e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Sn).setFromObject(t)),r=e._bufferGeometry),i.set(e,r),n.memory.geometries++,r)},update:function(t){var n=t.index,i=t.attributes;for(var r in null!==n&&e.update(n,34963),i)e.update(i[r],34962);var o=t.morphAttributes;for(var r in o)for(var a=o[r],s=0,l=a.length;s<l;s++)e.update(a[s],34962)},getWireframeAttribute:function(t){var e=r.get(t);if(e){var n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return r.get(t)}}}function wi(t,e,n,i){var r,o,a,s=i.isWebGL2;this.setMode=function(t){r=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(r,i,o,e*a),n.update(i,r)},this.renderInstances=function(i,l,h,c){if(0!==c){var u,d;if(s)u=t,d="drawElementsInstanced";else if(d="drawElementsInstancedANGLE",null===(u=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](r,h,o,l*a,c),n.update(h,r,c)}}}function Mi(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(i=i||1,e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Si(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Ti(t){var e={},n=new Float32Array(8);return{update:function(i,r,o,a){var s=i.morphTargetInfluences,l=void 0===s?0:s.length,h=e[r.id];if(void 0===h){h=[];for(var c=0;c<l;c++)h[c]=[c,0];e[r.id]=h}var u=o.morphTargets&&r.morphAttributes.position,d=o.morphNormals&&r.morphAttributes.normal;for(c=0;c<l;c++){0!==(m=h[c])[1]&&(u&&r.deleteAttribute("morphTarget"+c),d&&r.deleteAttribute("morphNormal"+c))}for(c=0;c<l;c++){(m=h[c])[0]=c,m[1]=s[c]}h.sort(Si);var p=0;for(c=0;c<8;c++){var m;if(m=h[c]){var f=m[0],g=m[1];if(g){u&&r.setAttribute("morphTarget"+c,u[f]),d&&r.setAttribute("morphNormal"+c,d[f]),n[c]=g,p+=g;continue}}n[c]=0}var v=r.morphTargetsRelative?1:1-p;a.getUniforms().setValue(t,"morphTargetBaseInfluence",v),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Ei(t,e,n,i){var r=new WeakMap;return{update:function(t){var o=i.render.frame,a=t.geometry,s=e.get(t,a);return r.get(s)!==o&&(a.isGeometry&&s.updateFromObject(t),e.update(s),r.set(s,o)),t.isInstancedMesh&&n.update(t.instanceMatrix,34962),s},dispose:function(){r=new WeakMap}}}function Ai(t,e,n,i,r,o,a,s,l,h){t=void 0!==t?t:[],e=void 0!==e?e:301,a=void 0!==a?a:1022,Tt.call(this,t,e,n,i,r,o,a,s,l,h),this.flipY=!1}function Ci(t,e,n,i){Tt.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:i||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Pi(t,e,n,i){Tt.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:i||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}fi.physical={uniforms:Qn([fi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new xt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ze(0)},transparency:{value:0}}]),vertexShader:mi.meshphysical_vert,fragmentShader:mi.meshphysical_frag},Ai.prototype=Object.create(Tt.prototype),Ai.prototype.constructor=Ai,Ai.prototype.isCubeTexture=!0,Object.defineProperty(Ai.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Ci.prototype=Object.create(Tt.prototype),Ci.prototype.constructor=Ci,Ci.prototype.isDataTexture2DArray=!0,Pi.prototype=Object.create(Tt.prototype),Pi.prototype.constructor=Pi,Pi.prototype.isDataTexture3D=!0;var Li=new Tt,Ri=new Ci,Oi=new Pi,Ii=new Ai,Ni=[],Di=[],Bi=new Float32Array(16),Fi=new Float32Array(9),ki=new Float32Array(4);function Ui(t,e,n){var i=t[0];if(i<=0||i>0)return t;var r=e*n,o=Ni[r];if(void 0===o&&(o=new Float32Array(r),Ni[r]=o),0!==e){i.toArray(o,0);for(var a=1,s=0;a!==e;++a)s+=n,t[a].toArray(o,s)}return o}function zi(t,e){if(t.length!==e.length)return!1;for(var n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Hi(t,e){for(var n=0,i=e.length;n<i;n++)t[n]=e[n]}function Gi(t,e){var n=Di[e];void 0===n&&(n=new Int32Array(e),Di[e]=n);for(var i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Vi(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function ji(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(zi(n,e))return;t.uniform2fv(this.addr,e),Hi(n,e)}}function Wi(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(zi(n,e))return;t.uniform3fv(this.addr,e),Hi(n,e)}}function Xi(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(zi(n,e))return;t.uniform4fv(this.addr,e),Hi(n,e)}}function Yi(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(zi(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Hi(n,e)}else{if(zi(n,i))return;ki.set(i),t.uniformMatrix2fv(this.addr,!1,ki),Hi(n,i)}}function qi(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(zi(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Hi(n,e)}else{if(zi(n,i))return;Fi.set(i),t.uniformMatrix3fv(this.addr,!1,Fi),Hi(n,i)}}function Zi(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(zi(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Hi(n,e)}else{if(zi(n,i))return;Bi.set(i),t.uniformMatrix4fv(this.addr,!1,Bi),Hi(n,i)}}function Ji(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(e||Li,r)}function Ki(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||Ri,r)}function Qi(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Oi,r)}function $i(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(e||Ii,r)}function tr(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function er(t,e){var n=this.cache;zi(n,e)||(t.uniform2iv(this.addr,e),Hi(n,e))}function nr(t,e){var n=this.cache;zi(n,e)||(t.uniform3iv(this.addr,e),Hi(n,e))}function ir(t,e){var n=this.cache;zi(n,e)||(t.uniform4iv(this.addr,e),Hi(n,e))}function rr(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function or(t,e){t.uniform1fv(this.addr,e)}function ar(t,e){t.uniform1iv(this.addr,e)}function sr(t,e){t.uniform2iv(this.addr,e)}function lr(t,e){t.uniform3iv(this.addr,e)}function hr(t,e){t.uniform4iv(this.addr,e)}function cr(t,e){var n=Ui(e,this.size,2);t.uniform2fv(this.addr,n)}function ur(t,e){var n=Ui(e,this.size,3);t.uniform3fv(this.addr,n)}function dr(t,e){var n=Ui(e,this.size,4);t.uniform4fv(this.addr,n)}function pr(t,e){var n=Ui(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function mr(t,e){var n=Ui(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function fr(t,e){var n=Ui(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function gr(t,e,n){var i=e.length,r=Gi(n,i);t.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)n.safeSetTexture2D(e[o]||Li,r[o])}function vr(t,e,n){var i=e.length,r=Gi(n,i);t.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)n.safeSetTextureCube(e[o]||Ii,r[o])}function yr(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Vi;case 35664:return ji;case 35665:return Wi;case 35666:return Xi;case 35674:return Yi;case 35675:return qi;case 35676:return Zi;case 5124:case 35670:return tr;case 35667:case 35671:return er;case 35668:case 35672:return nr;case 35669:case 35673:return ir;case 5125:return rr;case 35678:case 36198:case 36298:case 36306:case 35682:return Ji;case 35679:case 36299:case 36307:return Qi;case 35680:case 36300:case 36308:case 36293:return $i;case 36289:case 36303:case 36311:case 36292:return Ki}}(e.type)}function br(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return or;case 35664:return cr;case 35665:return ur;case 35666:return dr;case 35674:return pr;case 35675:return mr;case 35676:return fr;case 5124:case 35670:return ar;case 35667:case 35671:return sr;case 35668:case 35672:return lr;case 35669:case 35673:return hr;case 35678:case 36198:case 36298:case 36306:case 35682:return gr;case 35680:case 36300:case 36308:case 36293:return vr}}(e.type)}function _r(t){this.id=t,this.seq=[],this.map={}}br.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Hi(e,t)},_r.prototype.setValue=function(t,e,n){for(var i=this.seq,r=0,o=i.length;r!==o;++r){var a=i[r];a.setValue(t,e[a.id],n)}};var xr=/([\w\d_]+)(\])?(\[|\.)?/g;function wr(t,e){t.seq.push(e),t.map[e.id]=e}function Mr(t,e,n){var i=t.name,r=i.length;for(xr.lastIndex=0;;){var o=xr.exec(i),a=xr.lastIndex,s=o[1],l="]"===o[2],h=o[3];if(l&&(s|=0),void 0===h||"["===h&&a+2===r){wr(n,void 0===h?new yr(s,t,e):new br(s,t,e));break}var c=n.map[s];void 0===c&&wr(n,c=new _r(s)),n=c}}function Sr(t,e){this.seq=[],this.map={};for(var n=t.getProgramParameter(e,35718),i=0;i<n;++i){var r=t.getActiveUniform(e,i);Mr(r,t.getUniformLocation(e,r.name),this)}}function Tr(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}Sr.prototype.setValue=function(t,e,n,i){var r=this.map[e];void 0!==r&&r.setValue(t,n,i)},Sr.prototype.setOptional=function(t,e,n){var i=e[n];void 0!==i&&this.setValue(t,n,i)},Sr.upload=function(t,e,n,i){for(var r=0,o=e.length;r!==o;++r){var a=e[r],s=n[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,i)}},Sr.seqWithValue=function(t,e){for(var n=[],i=0,r=t.length;i!==r;++i){var o=t[i];o.id in e&&n.push(o)}return n};var Er=0;function Ar(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function Cr(t,e,n){var i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(t.getShaderSource(e))}function Pr(t,e){var n=Ar(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Lr(t,e){var n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Uncharted2";break;case 4:n="OptimizedCineon";break;case 5:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Rr(t){return""!==t}function Or(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ir(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var Nr=/^[ \t]*#include +<([\w\d./]+)>/gm;function Dr(t){return t.replace(Nr,Br)}function Br(t,e){var n=mi[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Dr(n)}var Fr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,kr=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function Ur(t){return t.replace(kr,Hr).replace(Fr,zr)}function zr(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Hr(t,e,n,i)}function Hr(t,e,n,i){for(var r="",o=parseInt(e);o<parseInt(n);o++)r+=i.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function Gr(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Vr(t,e,n){var i,r,o,a,s,l=t.getContext(),h=n.defines,c=n.vertexShader,u=n.fragmentShader,d=function(t){var e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),p=function(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:e="ENVMAP_TYPE_EQUIREC";break;case 305:e="ENVMAP_TYPE_SPHERE"}return e}(n),m=function(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 304:e="ENVMAP_MODE_REFRACTION"}return e}(n),f=function(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),g=t.gammaFactor>0?t.gammaFactor:1,v=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Rr).join("\n")}(n),y=function(t){var e=[];for(var n in t){var i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(h),b=l.createProgram();if(n.isRawShaderMaterial?((i=[y].filter(Rr).join("\n")).length>0&&(i+="\n"),(r=[v,y].filter(Rr).join("\n")).length>0&&(r+="\n")):(i=[Gr(n),"#define SHADER_NAME "+n.shaderName,y,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+m:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Rr).join("\n"),r=[v,Gr(n),"#define SHADER_NAME "+n.shaderName,y,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.envMap?"#define "+m:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?mi.tonemapping_pars_fragment:"",0!==n.toneMapping?Lr("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?mi.encodings_pars_fragment:"",n.mapEncoding?Pr("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?Pr("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?Pr("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?Pr("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?Pr("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?(o="linearToOutputTexel",a=n.outputEncoding,s=Ar(a),"vec4 "+o+"( vec4 value ) { return LinearTo"+s[0]+s[1]+"; }"):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Rr).join("\n")),c=Ir(c=Or(c=Dr(c),n),n),u=Ir(u=Or(u=Dr(u),n),n),c=Ur(c),u=Ur(u),n.isWebGL2&&!n.isRawShaderMaterial){var _=!1,x=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==c.match(x)&&null!==u.match(x)&&(_=!0,c=c.replace(x,""),u=u.replace(x,"")),i=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,r=["#version 300 es\n","#define varying in",_?"":"out highp vec4 pc_fragColor;",_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+r}var w,M,S=r+u,T=Tr(l,35633,i+c),E=Tr(l,35632,S);if(l.attachShader(b,T),l.attachShader(b,E),void 0!==n.index0AttributeName?l.bindAttribLocation(b,0,n.index0AttributeName):!0===n.morphTargets&&l.bindAttribLocation(b,0,"position"),l.linkProgram(b),t.debug.checkShaderErrors){var A=l.getProgramInfoLog(b).trim(),C=l.getShaderInfoLog(T).trim(),P=l.getShaderInfoLog(E).trim(),L=!0,R=!0;if(!1===l.getProgramParameter(b,35714)){L=!1;var O=Cr(l,T,"vertex"),I=Cr(l,E,"fragment");console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(b,35715),"gl.getProgramInfoLog",A,O,I)}else""!==A?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",A):""!==C&&""!==P||(R=!1);R&&(this.diagnostics={runnable:L,programLog:A,vertexShader:{log:C,prefix:i},fragmentShader:{log:P,prefix:r}})}return l.deleteShader(T),l.deleteShader(E),this.getUniforms=function(){return void 0===w&&(w=new Sr(l,b)),w},this.getAttributes=function(){return void 0===M&&(M=function(t,e){for(var n={},i=t.getProgramParameter(e,35721),r=0;r<i;r++){var o=t.getActiveAttrib(e,r).name;n[o]=t.getAttribLocation(e,o)}return n}(l,b)),M},this.destroy=function(){l.deleteProgram(b),this.program=void 0},this.name=n.shaderName,this.id=Er++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=T,this.fragmentShader=E,this}function jr(t,e,n){var i=[],r=n.isWebGL2,o=n.logarithmicDepthBuffer,a=n.floatVertexTextures,s=n.precision,l=n.maxVertexUniforms,h=n.vertexTextures,c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},u=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function d(t){var e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=3e3,e}this.getParameters=function(i,u,p,m,f,g,v){var y=m.fog,b=i.isMeshStandardMaterial?m.environment:null,_=i.envMap||b,x=c[i.type],w=v.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(a)return 1024;var n=l,i=Math.floor((n-20)/4),r=Math.min(i,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}(v):0;null!==i.precision&&(s=n.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",s,"instead.");var M=function(t,e){var n;if(e){var i=fi[e];n={name:t.type,uniforms:$n.clone(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}}else n={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};return n}(i,x);i.onBeforeCompile(M,t);var S=t.getRenderTarget();return{isWebGL2:r,shaderID:x,shaderName:M.name,uniforms:M.uniforms,vertexShader:M.vertexShader,fragmentShader:M.fragmentShader,defines:i.defines,isRawShaderMaterial:i.isRawShaderMaterial,isShaderMaterial:i.isShaderMaterial,precision:s,instancing:!0===v.isInstancedMesh,supportsVertexTextures:h,outputEncoding:null!==S?d(S.texture):t.outputEncoding,map:!!i.map,mapEncoding:d(i.map),matcap:!!i.matcap,matcapEncoding:d(i.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:d(_),envMapCubeUV:!!_&&(306===_.mapping||307===_.mapping),lightMap:!!i.lightMap,lightMapEncoding:d(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:d(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||!i.displacementMap),fog:!!y,useFog:i.fog,fogExp2:y&&y.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:o,skinning:i.skinning&&w>0,maxBones:w,useVertexTexture:a,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:u.directional.length,numPointLights:u.point.length,numSpotLights:u.spot.length,numRectAreaLights:u.rectArea.length,numHemiLights:u.hemi.length,numDirLightShadows:u.directionalShadowMap.length,numPointLightShadows:u.pointShadowMap.length,numSpotLightShadows:u.spotShadowMap.length,numClippingPlanes:f,numClipIntersection:g,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&p.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:r||null!==e.get("EXT_frag_depth"),rendererExtensionDrawBuffers:r||null!==e.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:r||null!==e.get("EXT_shader_texture_lod"),onBeforeCompile:i.onBeforeCompile}},this.getProgramCacheKey=function(e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)n.push(i),n.push(e.defines[i]);if(void 0===e.isRawShaderMaterial){for(var r=0;r<u.length;r++)n.push(e[u[r]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.onBeforeCompile.toString()),n.join()},this.acquireProgram=function(e,n){for(var r,o=0,a=i.length;o<a;o++){var s=i[o];if(s.cacheKey===n){++(r=s).usedTimes;break}}return void 0===r&&(r=new Vr(t,n,e),i.push(r)),r},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=i.indexOf(t);i[e]=i[i.length-1],i.pop(),t.destroy()}},this.programs=i}function Wr(){var t=new WeakMap;return{get:function(e){var n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function Xr(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Yr(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function qr(){var t=[],e=0,n=[],i=[],r={id:-1};function o(n,i,o,a,s,l){var h=t[e];return void 0===h?(h={id:n.id,object:n,geometry:i,material:o,program:o.program||r,groupOrder:a,renderOrder:n.renderOrder,z:s,group:l},t[e]=h):(h.id=n.id,h.object=n,h.geometry=i,h.material=o,h.program=o.program||r,h.groupOrder=a,h.renderOrder=n.renderOrder,h.z=s,h.group=l),e++,h}return{opaque:n,transparent:i,init:function(){e=0,n.length=0,i.length=0},push:function(t,e,r,a,s,l){var h=o(t,e,r,a,s,l);(!0===r.transparent?i:n).push(h)},unshift:function(t,e,r,a,s,l){var h=o(t,e,r,a,s,l);(!0===r.transparent?i:n).unshift(h)},finish:function(){for(var n=e,i=t.length;n<i;n++){var r=t[n];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Xr),i.length>1&&i.sort(e||Yr)}}}function Zr(){var t=new WeakMap;function e(n){var i=n.target;i.removeEventListener("dispose",e),t.delete(i)}return{get:function(n,i){var r,o=t.get(n);return void 0===o?(r=new qr,t.set(n,new WeakMap),t.get(n).set(i,r),n.addEventListener("dispose",e)):void 0===(r=o.get(i))&&(r=new qr,o.set(i,r)),r},dispose:function(){t=new WeakMap}}}function Jr(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new Ot,color:new Ze};break;case"SpotLight":n={position:new Ot,direction:new Ot,color:new Ze,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ot,color:new Ze,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ot,skyColor:new Ze,groundColor:new Ze};break;case"RectAreaLight":n={color:new Ze,position:new Ot,halfWidth:new Ot,halfHeight:new Ot}}return t[e.id]=n,n}}}var Kr=0;function Qr(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function $r(){for(var t,e=new Jr,n=(t={},{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowRadius:1,shadowMapSize:new xt};break;case"PointLight":n={shadowBias:0,shadowRadius:1,shadowMapSize:new xt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;r<9;r++)i.probe.push(new Ot);var o=new Ot,a=new zt,s=new zt;return{setup:function(t,r,l){for(var h=0,c=0,u=0,d=0;d<9;d++)i.probe[d].set(0,0,0);var p=0,m=0,f=0,g=0,v=0,y=0,b=0,_=0,x=l.matrixWorldInverse;t.sort(Qr),d=0;for(var w=t.length;d<w;d++){var M=t[d],S=M.color,T=M.intensity,E=M.distance,A=M.shadow&&M.shadow.map?M.shadow.map.texture:null;if(M.isAmbientLight)h+=S.r*T,c+=S.g*T,u+=S.b*T;else if(M.isLightProbe)for(var C=0;C<9;C++)i.probe[C].addScaledVector(M.sh.coefficients[C],T);else if(M.isDirectionalLight){if((R=e.get(M)).color.copy(M.color).multiplyScalar(M.intensity),R.direction.setFromMatrixPosition(M.matrixWorld),o.setFromMatrixPosition(M.target.matrixWorld),R.direction.sub(o),R.direction.transformDirection(x),M.castShadow){var P=M.shadow;(L=n.get(M)).shadowBias=P.bias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,i.directionalShadow[p]=L,i.directionalShadowMap[p]=A,i.directionalShadowMatrix[p]=M.shadow.matrix,y++}i.directional[p]=R,p++}else if(M.isSpotLight){if((R=e.get(M)).position.setFromMatrixPosition(M.matrixWorld),R.position.applyMatrix4(x),R.color.copy(S).multiplyScalar(T),R.distance=E,R.direction.setFromMatrixPosition(M.matrixWorld),o.setFromMatrixPosition(M.target.matrixWorld),R.direction.sub(o),R.direction.transformDirection(x),R.coneCos=Math.cos(M.angle),R.penumbraCos=Math.cos(M.angle*(1-M.penumbra)),R.decay=M.decay,M.castShadow){P=M.shadow;(L=n.get(M)).shadowBias=P.bias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,i.spotShadow[f]=L,i.spotShadowMap[f]=A,i.spotShadowMatrix[f]=M.shadow.matrix,_++}i.spot[f]=R,f++}else if(M.isRectAreaLight){(R=e.get(M)).color.copy(S).multiplyScalar(T),R.position.setFromMatrixPosition(M.matrixWorld),R.position.applyMatrix4(x),s.identity(),a.copy(M.matrixWorld),a.premultiply(x),s.extractRotation(a),R.halfWidth.set(.5*M.width,0,0),R.halfHeight.set(0,.5*M.height,0),R.halfWidth.applyMatrix4(s),R.halfHeight.applyMatrix4(s),i.rectArea[g]=R,g++}else if(M.isPointLight){if((R=e.get(M)).position.setFromMatrixPosition(M.matrixWorld),R.position.applyMatrix4(x),R.color.copy(M.color).multiplyScalar(M.intensity),R.distance=M.distance,R.decay=M.decay,M.castShadow){var L;P=M.shadow;(L=n.get(M)).shadowBias=P.bias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,L.shadowCameraNear=P.camera.near,L.shadowCameraFar=P.camera.far,i.pointShadow[m]=L,i.pointShadowMap[m]=A,i.pointShadowMatrix[m]=M.shadow.matrix,b++}i.point[m]=R,m++}else if(M.isHemisphereLight){var R;(R=e.get(M)).direction.setFromMatrixPosition(M.matrixWorld),R.direction.transformDirection(x),R.direction.normalize(),R.skyColor.copy(M.color).multiplyScalar(T),R.groundColor.copy(M.groundColor).multiplyScalar(T),i.hemi[v]=R,v++}}i.ambient[0]=h,i.ambient[1]=c,i.ambient[2]=u;var O=i.hash;O.directionalLength===p&&O.pointLength===m&&O.spotLength===f&&O.rectAreaLength===g&&O.hemiLength===v&&O.numDirectionalShadows===y&&O.numPointShadows===b&&O.numSpotShadows===_||(i.directional.length=p,i.spot.length=f,i.rectArea.length=g,i.point.length=m,i.hemi.length=v,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=b,i.pointShadowMap.length=b,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=b,i.spotShadowMatrix.length=_,O.directionalLength=p,O.pointLength=m,O.spotLength=f,O.rectAreaLength=g,O.hemiLength=v,O.numDirectionalShadows=y,O.numPointShadows=b,O.numSpotShadows=_,i.version=Kr++)},state:i}}function to(){var t=new $r,e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(i){t.setup(e,n,i)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)}}}function eo(){var t=new WeakMap;function e(n){var i=n.target;i.removeEventListener("dispose",e),t.delete(i)}return{get:function(n,i){var r;return!1===t.has(n)?(r=new to,t.set(n,new WeakMap),t.get(n).set(i,r),n.addEventListener("dispose",e)):!1===t.get(n).has(i)?(r=new to,t.get(n).set(i,r)):r=t.get(n).get(i),r},dispose:function(){t=new WeakMap}}}function no(t){en.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function io(t){en.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Ot,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}no.prototype=Object.create(en.prototype),no.prototype.constructor=no,no.prototype.isMeshDepthMaterial=!0,no.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},io.prototype=Object.create(en.prototype),io.prototype.constructor=io,io.prototype.isMeshDistanceMaterial=!0,io.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function ro(t,e,n){var i=new li,r=new xt,o=new xt,a=new Et,s=[],l=[],h={},c={0:1,1:0,2:2},u=new ti({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new xt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=u.clone();d.defines.HORIZONAL_PASS=1;var p=new Sn;p.setAttribute("position",new on(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var m=new Gn(p,u),f=this;function g(n,i){var r=e.update(m);u.uniforms.shadow_pass.value=n.map.texture,u.uniforms.resolution.value=n.mapSize,u.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,u,m,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,d,m,null)}function v(t,e,n){var i=t<<0|e<<1|n<<2,r=s[i];return void 0===r&&(r=new no({depthPacking:3201,morphTargets:t,skinning:e}),s[i]=r),r}function y(t,e,n){var i=t<<0|e<<1|n<<2,r=l[i];return void 0===r&&(r=new io({morphTargets:t,skinning:e}),l[i]=r),r}function b(e,n,i,r,o,a,s){var l=null,u=v,d=e.customDepthMaterial;if(!0===r.isPointLight&&(u=y,d=e.customDistanceMaterial),void 0===d){var p=!1;!0===i.morphTargets&&(p=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);var m=!1;!0===e.isSkinnedMesh&&(!0===i.skinning?m=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),l=u(p,m,!0===e.isInstancedMesh)}else l=d;if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var f=l.uuid,g=i.uuid,b=h[f];void 0===b&&(b={},h[f]=b);var _=b[g];void 0===_&&(_=l.clone(),b[g]=_),l=_}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=3===s?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:c[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=o,l.farDistance=a),l}function _(n,r,o,a,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var l=e.update(n),h=n.material;if(Array.isArray(h))for(var c=l.groups,u=0,d=c.length;u<d;u++){var p=c[u],m=h[p.materialIndex];if(m&&m.visible){var f=b(n,l,m,a,o.near,o.far,s);t.renderBufferDirect(o,null,l,f,n,p)}}else if(h.visible){f=b(n,l,h,a,o.near,o.far,s);t.renderBufferDirect(o,null,l,f,n,null)}}for(var g=n.children,v=0,y=g.length;v<y;v++)_(g[v],r,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,s,l){if(!1!==f.enabled&&(!1!==f.autoUpdate||!1!==f.needsUpdate)&&0!==e.length){var h=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,m=e.length;p<m;p++){var v=e[p],y=v.shadow;if(void 0!==y){r.copy(y.mapSize);var b=y.getFrameExtents();if(r.multiply(b),o.copy(y.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(o.x=Math.floor(n/b.x),r.x=o.x*b.x,y.mapSize.x=o.x),r.y>n&&(o.y=Math.floor(n/b.y),r.y=o.y*b.y,y.mapSize.y=o.y)),null===y.map&&!y.isPointLightShadow&&3===this.type){var x={minFilter:1006,magFilter:1006,format:1023};y.map=new At(r.x,r.y,x),y.map.texture.name=v.name+".shadowMap",y.mapPass=new At(r.x,r.y,x),y.camera.updateProjectionMatrix()}if(null===y.map){x={minFilter:1003,magFilter:1003,format:1023};y.map=new At(r.x,r.y,x),y.map.texture.name=v.name+".shadowMap",y.camera.updateProjectionMatrix()}t.setRenderTarget(y.map),t.clear();for(var w=y.getViewportCount(),M=0;M<w;M++){var S=y.getViewport(M);a.set(o.x*S.x,o.y*S.y,o.x*S.z,o.y*S.w),d.viewport(a),y.updateMatrices(v,M),i=y.getFrustum(),_(s,l,y.camera,v,this.type)}y.isPointLightShadow||3!==this.type||g(y,l)}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}f.needsUpdate=!1,t.setRenderTarget(h,c,u)}}}function oo(t,e,n){var i=n.isWebGL2;var r=new function(){var e=!1,n=new Et,i=null,r=new Et(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,o,a,s){!0===s&&(e*=a,i*=a,o*=a),n.set(e,i,o,a),!1===r.equals(n)&&(t.clearColor(e,i,o,a),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){var e=!1,n=null,i=null,r=null;return{setTest:function(t){t?k(2929):U(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},a=new function(){var e=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,h=null;return{setTest:function(t){e||(t?k(2960):U(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,a){i===e&&r===n&&o===a||(t.stencilFunc(e,n,a),i=e,r=n,o=a)},setOp:function(e,n,i){a===e&&s===n&&l===i||(t.stencilOp(e,n,i),a=e,s=n,l=i)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,n=null,i=null,r=null,o=null,a=null,s=null,l=null,h=null}}},s=t.getParameter(34921),l=new Uint8Array(s),h=new Uint8Array(s),c=new Uint8Array(s),u={},d=null,p=null,m=null,f=null,g=null,v=null,y=null,b=null,_=null,x=!1,w=null,M=null,S=null,T=null,E=null,A=t.getParameter(35661),C=!1,P=0,L=t.getParameter(7938);-1!==L.indexOf("WebGL")?(P=parseFloat(/^WebGL\ ([0-9])/.exec(L)[1]),C=P>=1):-1!==L.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(L)[1]),C=P>=2);var R=null,O={},I=new Et,N=new Et;function D(e,n,i){var r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(var a=0;a<i;a++)t.texImage2D(n+a,0,6408,1,1,0,6408,5121,r);return o}var B={};function F(n,r){(l[n]=1,0===h[n]&&(t.enableVertexAttribArray(n),h[n]=1),c[n]!==r)&&((i?t:e.get("ANGLE_instanced_arrays"))[i?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),c[n]=r)}function k(e){!0!==u[e]&&(t.enable(e),u[e]=!0)}function U(e){!1!==u[e]&&(t.disable(e),u[e]=!1)}B[3553]=D(3553,3553,1),B[34067]=D(34067,34069,6),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),k(2929),o.setFunc(3),j(!1),W(1),k(2884),V(0);var z={100:32774,101:32778,102:32779};if(i)z[103]=32775,z[104]=32776;else{var H=e.get("EXT_blend_minmax");null!==H&&(z[103]=H.MIN_EXT,z[104]=H.MAX_EXT)}var G={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function V(e,n,i,r,o,a,s,l){if(0!==e){if(p||(k(3042),p=!0),5===e)o=o||n,a=a||i,s=s||r,n===f&&o===y||(t.blendEquationSeparate(z[n],z[o]),f=n,y=o),i===g&&r===v&&a===b&&s===_||(t.blendFuncSeparate(G[i],G[r],G[a],G[s]),g=i,v=r,b=a,_=s),m=e,x=null;else if(e!==m||l!==x){if(100===f&&100===y||(t.blendEquation(32774),f=100,y=100),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}g=null,v=null,b=null,_=null,m=e,x=l}}else p&&(U(3042),p=!1)}function j(e){w!==e&&(e?t.frontFace(2304):t.frontFace(2305),w=e)}function W(e){0!==e?(k(2884),e!==M&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):U(2884),M=e}function X(e,n,i){e?(k(32823),T===n&&E===i||(t.polygonOffset(n,i),T=n,E=i)):U(32823)}function Y(e){void 0===e&&(e=33984+A-1),R!==e&&(t.activeTexture(e),R=e)}return{buffers:{color:r,depth:o,stencil:a},initAttributes:function(){for(var t=0,e=l.length;t<e;t++)l[t]=0},enableAttribute:function(t){F(t,0)},enableAttributeAndDivisor:F,disableUnusedAttributes:function(){for(var e=0,n=h.length;e!==n;++e)h[e]!==l[e]&&(t.disableVertexAttribArray(e),h[e]=0)},vertexAttribPointer:function(e,n,r,o,a,s){!0!==i||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,o,a,s):t.vertexAttribIPointer(e,n,r,o,a,s)},enable:k,disable:U,useProgram:function(e){return d!==e&&(t.useProgram(e),d=e,!0)},setBlending:V,setMaterial:function(t,e){2===t.side?U(2884):k(2884);var n=1===t.side;e&&(n=!n),j(n),1===t.blending&&!1===t.transparent?V(0):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),r.setMask(t.colorWrite);var i=t.stencilWrite;a.setTest(i),i&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:j,setCullFace:W,setLineWidth:function(e){e!==S&&(C&&t.lineWidth(e),S=e)},setPolygonOffset:X,setScissorTest:function(t){t?k(3089):U(3089)},activeTexture:Y,bindTexture:function(e,n){null===R&&Y();var i=O[R];void 0===i&&(i={type:void 0,texture:void 0},O[R]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||B[e]),i.type=e,i.texture=n)},unbindTexture:function(){var e=O[R];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===I.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),I.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){for(var e=0;e<h.length;e++)1===h[e]&&(t.disableVertexAttribArray(e),h[e]=0);u={},R=null,O={},d=null,m=null,w=null,M=null,r.reset(),o.reset(),a.reset()}}}function ao(t,e,n,i,r,o,a){var s,l=r.isWebGL2,h=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,p=new WeakMap,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return m?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,i){var r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var o=e?_t.floorPowerOfTwo:Math.floor,a=o(r*t.width),l=o(r*t.height);void 0===s&&(s=f(a,l));var h=n?f(a,l):s;return h.width=a,h.height=l,h.getContext("2d").drawImage(t,0,0,a,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+a+"x"+l+")."),h}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return _t.isPowerOfTwo(t.width)&&_t.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function b(e,n,r,o){t.generateMipmap(e),i.get(n).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function _(n,i,r){if(!1===l)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function x(t){return 1003===t||1004===t||1005===t?9728:9729}function w(e){var n=e.target;n.removeEventListener("dispose",w),function(e){var n=i.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),i.remove(e)}(n),n.isVideoTexture&&p.delete(n),a.memory.textures--}function M(e){var n=e.target;n.removeEventListener("dispose",M),function(e){var n=i.get(e),r=i.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(var o=0;o<6;o++)t.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[o]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);i.remove(e.texture),i.remove(e)}(n),a.memory.textures--}var S=0;function T(t,e){var r=i.get(t);if(t.isVideoTexture&&function(t){var e=a.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){var o=t.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void O(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}function E(e,r){if(6===e.image.length){var a=i.get(e);if(e.version>0&&a.__version!==e.version){R(a,e),n.activeTexture(33984+r),n.bindTexture(34067,a.__webglTexture),t.pixelStorei(37440,e.flipY);for(var s=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture),h=e.image[0]&&e.image[0].isDataTexture,u=[],d=0;d<6;d++)u[d]=s||h?h?e.image[d].image:e.image[d]:g(e.image[d],!1,!0,c);var p,m=u[0],f=v(m)||l,x=o.convert(e.format),w=o.convert(e.type),M=_(e.internalFormat,x,w);if(L(34067,e,f),s){for(d=0;d<6;d++){p=u[d].mipmaps;for(var S=0;S<p.length;S++){var T=p[S];1023!==e.format&&1022!==e.format?null!==x?n.compressedTexImage2D(34069+d,S,M,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+d,S,M,T.width,T.height,0,x,w,T.data)}}a.__maxMipLevel=p.length-1}else{p=e.mipmaps;for(d=0;d<6;d++)if(h){n.texImage2D(34069+d,0,M,u[d].width,u[d].height,0,x,w,u[d].data);for(S=0;S<p.length;S++){var E=(T=p[S]).image[d].image;n.texImage2D(34069+d,S+1,M,E.width,E.height,0,x,w,E.data)}}else{n.texImage2D(34069+d,0,M,x,w,u[d]);for(S=0;S<p.length;S++){T=p[S];n.texImage2D(34069+d,S+1,M,x,w,T.image[d])}}a.__maxMipLevel=p.length}y(e,f)&&b(34067,e,m.width,m.height),a.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(33984+r),n.bindTexture(34067,a.__webglTexture)}}function A(t,e){n.activeTexture(33984+e),n.bindTexture(34067,i.get(t).__webglTexture)}var C={1e3:10497,1001:33071,1002:33648},P={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function L(n,o,a){a?(t.texParameteri(n,10242,C[o.wrapS]),t.texParameteri(n,10243,C[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,C[o.wrapR]),t.texParameteri(n,10240,P[o.magFilter]),t.texParameteri(n,10241,P[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,x(o.magFilter)),t.texParameteri(n,10241,x(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=e.get("EXT_texture_filter_anisotropic");if(s){if(1015===o.type&&null===e.get("OES_texture_float_linear"))return;if(1016===o.type&&null===(l||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(t.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function R(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),a.memory.textures++)}function O(e,i,r){var a=3553;i.isDataTexture2DArray&&(a=35866),i.isDataTexture3D&&(a=32879),R(e,i),n.activeTexture(33984+r),n.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment);var s=function(t){return!l&&(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)}(i)&&!1===v(i.image),h=g(i.image,s,!1,u),c=v(h)||l,d=o.convert(i.format),p=o.convert(i.type),m=_(i.internalFormat,d,p);L(a,i,c);var f,x=i.mipmaps;if(i.isDepthTexture)m=6402,l?m=1015===i.type?36012:1014===i.type?33190:1020===i.type?35056:33189:1015===i.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===i.format&&6402===m&&1012!==i.type&&1014!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=1012,p=o.convert(i.type)),1027===i.format&&6402===m&&(m=34041,1020!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=1020,p=o.convert(i.type))),n.texImage2D(3553,0,m,h.width,h.height,0,d,p,null);else if(i.isDataTexture)if(x.length>0&&c){for(var w=0,M=x.length;w<M;w++)f=x[w],n.texImage2D(3553,w,m,f.width,f.height,0,d,p,f.data);i.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else n.texImage2D(3553,0,m,h.width,h.height,0,d,p,h.data),e.__maxMipLevel=0;else if(i.isCompressedTexture){for(w=0,M=x.length;w<M;w++)f=x[w],1023!==i.format&&1022!==i.format?null!==d?n.compressedTexImage2D(3553,w,m,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,w,m,f.width,f.height,0,d,p,f.data);e.__maxMipLevel=x.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,h.width,h.height,h.depth,0,d,p,h.data),e.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,h.width,h.height,h.depth,0,d,p,h.data),e.__maxMipLevel=0;else if(x.length>0&&c){for(w=0,M=x.length;w<M;w++)f=x[w],n.texImage2D(3553,w,m,d,p,f);i.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else n.texImage2D(3553,0,m,d,p,h),e.__maxMipLevel=0;y(i,c)&&b(a,i,h.width,h.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function I(e,r,a,s){var l=o.convert(r.texture.format),h=o.convert(r.texture.type),c=_(r.texture.internalFormat,l,h);n.texImage2D(s,0,c,r.width,r.height,0,l,h,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,s,i.get(r.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function N(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){var r=33189;if(i){var a=n.depthTexture;a&&a.isDepthTexture&&(1015===a.type?r=36012:1014===a.type&&(r=33190));var s=B(n);t.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(i){s=B(n);t.renderbufferStorageMultisample(36161,s,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{var l=o.convert(n.texture.format),h=o.convert(n.texture.type);r=_(n.texture.internalFormat,l,h);if(i){s=B(n);t.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height)}t.bindRenderbuffer(36161,null)}function D(e){var n=i.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);var r=i.get(n.depthTexture).__webglTexture;if(1026===n.depthTexture.format)t.framebufferTexture2D(36160,36096,3553,r,0);else{if(1027!==n.depthTexture.format)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,e)}else if(r){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(36160,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=t.createRenderbuffer(),N(n.__webglDepthbuffer[o],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),N(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function B(t){return l&&t.isWebGLMultisampleRenderTarget?Math.min(d,t.samples):0}var F=!1,k=!1;this.allocateTextureUnit=function(){var t=S;return t>=h&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+h),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){var r=i.get(t);t.version>0&&r.__version!==t.version?O(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){var r=i.get(t);t.version>0&&r.__version!==t.version?O(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setTextureCubeDynamic=A,this.setupRenderTarget=function(e){var r=i.get(e),s=i.get(e.texture);e.addEventListener("dispose",M),s.__webglTexture=t.createTexture(),a.memory.textures++;var h=!0===e.isWebGLCubeRenderTarget,c=!0===e.isWebGLMultisampleRenderTarget,u=v(e)||l;if(!l||1022!==e.texture.format||1015!==e.texture.type&&1016!==e.texture.type||(e.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){r.__webglFramebuffer=[];for(var d=0;d<6;d++)r.__webglFramebuffer[d]=t.createFramebuffer()}else if(r.__webglFramebuffer=t.createFramebuffer(),c)if(l){r.__webglMultisampledFramebuffer=t.createFramebuffer(),r.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,r.__webglColorRenderbuffer);var p=o.convert(e.texture.format),m=o.convert(e.texture.type),f=_(e.texture.internalFormat,p,m),g=B(e);t.renderbufferStorageMultisample(36161,g,f,e.width,e.height),t.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(r.__webglDepthRenderbuffer=t.createRenderbuffer(),N(r.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(34067,s.__webglTexture),L(34067,e.texture,u);for(d=0;d<6;d++)I(r.__webglFramebuffer[d],e,36064,34069+d);y(e.texture,u)&&b(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,s.__webglTexture),L(3553,e.texture,u),I(r.__webglFramebuffer,e,36064,3553),y(e.texture,u)&&b(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&D(e)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(y(e,v(t)||l)){var r=t.isWebGLCubeRenderTarget?34067:3553,o=i.get(e).__webglTexture;n.bindTexture(r,o),b(r,e,t.width,t.height),n.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(l){var n=i.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);var r=e.width,o=e.height,a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,r,o,0,0,r,o,a,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),k=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?E(t,e):A(t,e)}}function so(t,e,n){var i=n.isWebGL2;return{convert:function(t){var n;if(1009===t)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(1012===t)return 5123;if(1013===t)return 5124;if(1014===t)return 5125;if(1015===t)return 5126;if(1016===t)return i?5131:null!==(n=e.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===t)return 6406;if(1022===t)return 6407;if(1023===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(1026===t)return 6402;if(1027===t)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(null===(n=e.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===t)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(null===(n=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return null!==(n=e.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&null!==(n=e.get("WEBGL_compressed_texture_etc"))){if(37492===t)return n.COMPRESSED_RGB8_ETC2;if(37496===t)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?null!==(n=e.get("WEBGL_compressed_texture_astc"))?t:null:36492===t?null!==(n=e.get("EXT_texture_compression_bptc"))?t:null:1020===t?i?34042:null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function lo(t){ni.call(this),this.cameras=t||[]}function ho(){re.call(this),this.type="Group"}function co(){this._targetRay=null,this._grip=null}function uo(t,e){var n=this,i=null,r=1,o=null,a="local-floor",s=null,l=[],h=new Map,c=new ni;c.layers.enable(1),c.viewport=new Et;var u=new ni;u.layers.enable(2),u.viewport=new Et;var d=[c,u],p=new lo;p.layers.enable(1),p.layers.enable(2);var m=null,f=null;function g(t){var e=h.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function v(){h.forEach((function(t,e){t.disconnect(e)})),h.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),S.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(t){o=t,S.setContext(i),S.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function b(t){for(var e=i.inputSources,n=0;n<l.length;n++)h.set(e[n],l[n]);for(n=0;n<t.removed.length;n++){var r=t.removed[n];(o=h.get(r))&&(o.dispatchEvent({type:"disconnected",data:r}),h.delete(r))}for(n=0;n<t.added.length;n++){var o;r=t.added[n];(o=h.get(r))&&o.dispatchEvent({type:"connected",data:r})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){var e=l[t];return void 0===e&&(e=new co,l[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){var e=l[t];return void 0===e&&(e=new co,l[t]=e),e.getGripSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=function(t){if(null!==(i=t)){i.addEventListener("select",g),i.addEventListener("selectstart",g),i.addEventListener("selectend",g),i.addEventListener("squeeze",g),i.addEventListener("squeezestart",g),i.addEventListener("squeezeend",g),i.addEventListener("end",v);var n=e.getContextAttributes(),o={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:r},s=new XRWebGLLayer(i,e,o);i.updateRenderState({baseLayer:s}),i.requestReferenceSpace(a).then(y),i.addEventListener("inputsourceschange",b)}};var _=new Ot,x=new Ot;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){p.near=u.near=c.near=t.near,p.far=u.far=c.far=t.far,m===p.near&&f===p.far||(i.updateRenderState({depthNear:p.near,depthFar:p.far}),m=p.near,f=p.far);var e=t.parent,n=p.cameras;w(p,e);for(var r=0;r<n.length;r++)w(n[r],e);t.matrixWorld.copy(p.matrixWorld);for(var o=t.children,a=(r=0,o.length);r<a;r++)o[r].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){_.setFromMatrixPosition(e.matrixWorld),x.setFromMatrixPosition(n.matrixWorld);var i=_.distanceTo(x),r=e.projectionMatrix.elements,o=n.projectionMatrix.elements,a=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(o[8]+1)/o[0],d=a*c,p=a*u,m=i/(-c+u),f=m*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var g=a+m,v=s+m,y=d-f,b=p+(i-f),w=l*s/v*g,M=h*s/v*g;t.projectionMatrix.makePerspective(y,b,w,M,g,v)}(p,c,u):p.projectionMatrix.copy(c.projectionMatrix),p};var M=null;var S=new ci;S.setAnimationLoop((function(e,n){if(null!==(s=n.getViewerPose(o))){var r=s.views,a=i.renderState.baseLayer;t.setFramebuffer(a.framebuffer);var h=!1;r.length!==p.cameras.length&&(p.cameras.length=0,h=!0);for(var c=0;c<r.length;c++){var u=r[c],m=a.getViewport(u),f=d[c];f.matrix.fromArray(u.transform.matrix),f.projectionMatrix.fromArray(u.projectionMatrix),f.viewport.set(m.x,m.y,m.width,m.height),0===c&&p.matrix.copy(f.matrix),!0===h&&p.cameras.push(f)}}var g=i.inputSources;for(c=0;c<l.length;c++){var v=l[c],y=g[c];v.update(y,n,o)}M&&M(e,n)})),this.setAnimationLoop=function(t){M=t},this.dispose=function(){}}function po(t){var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,h=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,u=null,d=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p,m,f,g,v,y,b,_,x,w,M,S,T,E,A,C,P,L,R=this,O=!1,I=null,N=0,D=0,B=null,F=null,k=-1,U={geometry:null,program:null,wireframe:!1},z=null,H=null,G=new Et,V=new Et,j=null,W=e.width,X=e.height,Y=1,q=null,Z=null,J=new Et(0,0,W,X),K=new Et(0,0,W,X),Q=!1,$=new li,tt=new bi,et=!1,nt=!1,it=new zt,rt=new Ot;function ot(){return null===B?Y:1}try{var at={alpha:i,depth:r,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:c,xrCompatible:!0};if(e.addEventListener("webglcontextlost",ct,!1),e.addEventListener("webglcontextrestored",ut,!1),null===(p=n||e.getContext("webgl",at)||e.getContext("experimental-webgl",at)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===p.getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function st(){m=new _i(p),!1===(f=new yi(p,m,t)).isWebGL2&&(m.get("WEBGL_depth_texture"),m.get("OES_texture_float"),m.get("OES_texture_half_float"),m.get("OES_texture_half_float_linear"),m.get("OES_standard_derivatives"),m.get("OES_element_index_uint"),m.get("ANGLE_instanced_arrays")),m.get("OES_texture_float_linear"),L=new so(p,m,f),(g=new oo(p,m,f)).scissor(V.copy(K).multiplyScalar(Y).floor()),g.viewport(G.copy(J).multiplyScalar(Y).floor()),v=new Mi(p),y=new Wr,b=new ao(p,m,g,y,f,L,v),_=new ui(p,f),x=new xi(p,_,v),w=new Ei(p,x,_,v),A=new Ti(p),M=new jr(R,m,f),S=new Zr,T=new eo,E=new gi(R,g,w,s),C=new vi(p,m,v,f),P=new wi(p,m,v,f),v.programs=M.programs,R.capabilities=f,R.extensions=m,R.properties=y,R.renderLists=S,R.state=g,R.info=v}st();var lt=new uo(R,p);this.xr=lt;var ht=new ro(R,w,f.maxTextureSize);function ct(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),O=!0}function ut(){console.log("THREE.WebGLRenderer: Context Restored."),O=!1,st()}function dt(t){var e=t.target;e.removeEventListener("dispose",dt),function(t){pt(t),y.remove(t)}(e)}function pt(t){var e=y.get(t).program;t.program=void 0,void 0!==e&&M.releaseProgram(e)}this.shadowMap=ht,this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var t=m.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=m.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(t){void 0!==t&&(Y=t,this.setSize(W,X,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new xt),t.set(W,X)},this.setSize=function(t,n,i){lt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(W=t,X=n,e.width=Math.floor(t*Y),e.height=Math.floor(n*Y),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new xt),t.set(W*Y,X*Y).floor()},this.setDrawingBufferSize=function(t,n,i){W=t,X=n,Y=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Et),t.copy(G)},this.getViewport=function(t){return t.copy(J)},this.setViewport=function(t,e,n,i){t.isVector4?J.set(t.x,t.y,t.z,t.w):J.set(t,e,n,i),g.viewport(G.copy(J).multiplyScalar(Y).floor())},this.getScissor=function(t){return t.copy(K)},this.setScissor=function(t,e,n,i){t.isVector4?K.set(t.x,t.y,t.z,t.w):K.set(t,e,n,i),g.scissor(V.copy(K).multiplyScalar(Y).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(t){g.setScissorTest(Q=t)},this.setOpaqueSort=function(t){q=t},this.setTransparentSort=function(t){Z=t},this.getClearColor=function(){return E.getClearColor()},this.setClearColor=function(){E.setClearColor.apply(E,arguments)},this.getClearAlpha=function(){return E.getClearAlpha()},this.setClearAlpha=function(){E.setClearAlpha.apply(E,arguments)},this.clear=function(t,e,n){var i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===n||n)&&(i|=1024),p.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ct,!1),e.removeEventListener("webglcontextrestored",ut,!1),S.dispose(),T.dispose(),y.dispose(),w.dispose(),lt.dispose(),gt.stop()},this.renderBufferImmediate=function(t,e){g.initAttributes();var n=y.get(t);t.hasPositions&&!n.position&&(n.position=p.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=p.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=p.createBuffer()),t.hasColors&&!n.color&&(n.color=p.createBuffer());var i=e.getAttributes();t.hasPositions&&(p.bindBuffer(34962,n.position),p.bufferData(34962,t.positionArray,35048),g.enableAttribute(i.position),p.vertexAttribPointer(i.position,3,5126,!1,0,0)),t.hasNormals&&(p.bindBuffer(34962,n.normal),p.bufferData(34962,t.normalArray,35048),g.enableAttribute(i.normal),p.vertexAttribPointer(i.normal,3,5126,!1,0,0)),t.hasUvs&&(p.bindBuffer(34962,n.uv),p.bufferData(34962,t.uvArray,35048),g.enableAttribute(i.uv),p.vertexAttribPointer(i.uv,2,5126,!1,0,0)),t.hasColors&&(p.bindBuffer(34962,n.color),p.bufferData(34962,t.colorArray,35048),g.enableAttribute(i.color),p.vertexAttribPointer(i.color,3,5126,!1,0,0)),g.disableUnusedAttributes(),p.drawArrays(4,0,t.count),t.count=0};var mt=new oe;this.renderBufferDirect=function(t,e,n,i,r,o){null===e&&(e=mt);var a=r.isMesh&&r.matrixWorld.determinant()<0,s=Mt(t,e,i,r);g.setMaterial(i,a);var l=!1;U.geometry===n.id&&U.program===s.id&&U.wireframe===(!0===i.wireframe)||(U.geometry=n.id,U.program=s.id,U.wireframe=!0===i.wireframe,l=!0),(i.morphTargets||i.morphNormals)&&(A.update(r,n,i,s),l=!0),!0===r.isInstancedMesh&&(l=!0);var h=n.index,c=n.attributes.position;if(null===h){if(void 0===c||0===c.count)return}else if(0===h.count)return;var u,d=1;!0===i.wireframe&&(h=x.getWireframeAttribute(n),d=2);var v=C;null!==h&&(u=_.get(h),(v=P).setIndex(u)),l&&(!function(t,e,n,i){if(!1===f.isWebGL2&&(t.isInstancedMesh||e.isInstancedBufferGeometry)&&null===m.get("ANGLE_instanced_arrays"))return;g.initAttributes();var r=e.attributes,o=i.getAttributes(),a=n.defaultAttributeValues;for(var s in o){var l=o[s];if(l>=0){var h=r[s];if(void 0!==h){var c=h.normalized,u=h.itemSize;if(void 0===(M=_.get(h)))continue;var d=M.buffer,v=M.type,y=M.bytesPerElement;if(h.isInterleavedBufferAttribute){var b=h.data,x=b.stride,w=h.offset;b&&b.isInstancedInterleavedBuffer?(g.enableAttributeAndDivisor(l,b.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=b.meshPerAttribute*b.count)):g.enableAttribute(l),p.bindBuffer(34962,d),g.vertexAttribPointer(l,u,v,c,x*y,w*y)}else h.isInstancedBufferAttribute?(g.enableAttributeAndDivisor(l,h.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=h.meshPerAttribute*h.count)):g.enableAttribute(l),p.bindBuffer(34962,d),g.vertexAttribPointer(l,u,v,c,0,0)}else if("instanceMatrix"===s){var M;if(void 0===(M=_.get(t.instanceMatrix)))continue;d=M.buffer,v=M.type;g.enableAttributeAndDivisor(l+0,1),g.enableAttributeAndDivisor(l+1,1),g.enableAttributeAndDivisor(l+2,1),g.enableAttributeAndDivisor(l+3,1),p.bindBuffer(34962,d),p.vertexAttribPointer(l+0,4,v,!1,64,0),p.vertexAttribPointer(l+1,4,v,!1,64,16),p.vertexAttribPointer(l+2,4,v,!1,64,32),p.vertexAttribPointer(l+3,4,v,!1,64,48)}else if(void 0!==a){var S=a[s];if(void 0!==S)switch(S.length){case 2:p.vertexAttrib2fv(l,S);break;case 3:p.vertexAttrib3fv(l,S);break;case 4:p.vertexAttrib4fv(l,S);break;default:p.vertexAttrib1fv(l,S)}}}}g.disableUnusedAttributes()}(r,n,i,s),null!==h&&p.bindBuffer(34963,u.buffer));var y=null!==h?h.count:c.count,b=n.drawRange.start*d,w=n.drawRange.count*d,M=null!==o?o.start*d:0,S=null!==o?o.count*d:1/0,T=Math.max(b,M),E=Math.min(y,b+w,M+S)-1,L=Math.max(0,E-T+1);if(0!==L){if(r.isMesh)!0===i.wireframe?(g.setLineWidth(i.wireframeLinewidth*ot()),v.setMode(1)):v.setMode(4);else if(r.isLine){var R=i.linewidth;void 0===R&&(R=1),g.setLineWidth(R*ot()),r.isLineSegments?v.setMode(1):r.isLineLoop?v.setMode(2):v.setMode(3)}else r.isPoints?v.setMode(0):r.isSprite&&v.setMode(4);r.isInstancedMesh?v.renderInstances(n,T,L,r.count):n.isInstancedBufferGeometry?v.renderInstances(n,T,L,n.maxInstancedCount):v.render(T,L)}},this.compile=function(t,e){(d=T.get(t,e)).init(),t.traverse((function(t){t.isLight&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(e);var n={};t.traverse((function(e){if(e.material)if(Array.isArray(e.material))for(var i=0;i<e.material.length;i++)e.material[i].uuid in n==!1&&(wt(e.material[i],t,e),n[e.material[i].uuid]=!0);else e.material.uuid in n==!1&&(wt(e.material,t,e),n[e.material.uuid]=!0)}))};var ft=null;var gt=new ci;function vt(t,e,n,i){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||$.intersectsSprite(t)){i&&rt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(it);var r=w.update(t);(o=t.material).visible&&u.push(t,r,o,n,rt.z,null)}}else if(t.isImmediateRenderObject)i&&rt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(it),u.push(t,null,t.material,n,rt.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==v.render.frame&&(t.skeleton.update(),t.skeleton.frame=v.render.frame),!t.frustumCulled||$.intersectsObject(t))){i&&rt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(it);r=w.update(t);var o=t.material;if(Array.isArray(o))for(var a=r.groups,s=0,l=a.length;s<l;s++){var h=a[s],c=o[h.materialIndex];c&&c.visible&&u.push(t,r,c,n,rt.z,h)}else o.visible&&u.push(t,r,o,n,rt.z,null)}var p=t.children;for(s=0,l=p.length;s<l;s++)vt(p[s],e,n,i)}}function yt(t,e,n,i){for(var r=0,o=t.length;r<o;r++){var a=t[r],s=a.object,l=a.geometry,h=void 0===i?a.material:i,c=a.group;if(n.isArrayCamera){H=n;for(var u=n.cameras,p=0,m=u.length;p<m;p++){var f=u[p];s.layers.test(f.layers)&&(g.viewport(G.copy(f.viewport)),d.setupLights(f),bt(s,e,f,l,h,c))}}else H=null,bt(s,e,n,l,h,c)}}function bt(t,e,n,i,r,o){if(t.onBeforeRender(R,e,n,i,r,o),d=T.get(e,H||n),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var a=Mt(n,e,r,t);g.setMaterial(r),U.geometry=null,U.program=null,U.wireframe=!1,function(t,e){t.render((function(t){R.renderBufferImmediate(t,e)}))}(t,a)}else R.renderBufferDirect(n,e,i,r,t,o);t.onAfterRender(R,e,n,i,r,o),d=T.get(e,H||n)}function wt(t,e,n){var i=y.get(t),r=d.state.lights,o=d.state.shadowsArray,a=r.state.version,s=M.getParameters(t,r.state,o,e,tt.numPlanes,tt.numIntersection,n),l=M.getProgramCacheKey(s),h=i.program,c=!0;if(void 0===h)t.addEventListener("dispose",dt);else if(h.cacheKey!==l)pt(t);else if(i.lightsStateVersion!==a)i.lightsStateVersion=a,c=!1;else{if(void 0!==s.shaderID)return;c=!1}c&&(h=M.acquireProgram(s,l),i.program=h,i.uniforms=s.uniforms,i.outputEncoding=s.outputEncoding,t.program=h);var u=h.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var p=0;p<R.maxMorphTargets;p++)u["morphTarget"+p]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(p=0;p<R.maxMorphNormals;p++)u["morphNormal"+p]>=0&&t.numSupportedMorphNormals++}var m=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(i.numClippingPlanes=tt.numPlanes,i.numIntersection=tt.numIntersection,m.clippingPlanes=tt.uniform),i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=a,i.needsLights&&(m.ambientLightColor.value=r.state.ambient,m.lightProbe.value=r.state.probe,m.directionalLights.value=r.state.directional,m.directionalLightShadows.value=r.state.directionalShadow,m.spotLights.value=r.state.spot,m.spotLightShadows.value=r.state.spotShadow,m.rectAreaLights.value=r.state.rectArea,m.pointLights.value=r.state.point,m.pointLightShadows.value=r.state.pointShadow,m.hemisphereLights.value=r.state.hemi,m.directionalShadowMap.value=r.state.directionalShadowMap,m.directionalShadowMatrix.value=r.state.directionalShadowMatrix,m.spotShadowMap.value=r.state.spotShadowMap,m.spotShadowMatrix.value=r.state.spotShadowMatrix,m.pointShadowMap.value=r.state.pointShadowMap,m.pointShadowMatrix.value=r.state.pointShadowMatrix);var f=i.program.getUniforms(),g=Sr.seqWithValue(f.seq,m);i.uniformsList=g}function Mt(t,e,n,i){b.resetTextureUnits();var r=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===B?R.outputEncoding:B.texture.encoding,s=y.get(n),l=d.state.lights;if(et&&(nt||t!==z)){var h=t===z&&n.id===k;tt.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,s,h)}n.version===s.__version?void 0===s.program||n.fog&&s.fog!==r||s.environment!==o||s.needsLights&&s.lightsStateVersion!==l.state.version?wt(n,e,i):void 0===s.numClippingPlanes||s.numClippingPlanes===tt.numPlanes&&s.numIntersection===tt.numIntersection?s.outputEncoding!==a&&wt(n,e,i):wt(n,e,i):(wt(n,e,i),s.__version=n.version);var c,u,m=!1,v=!1,_=!1,x=s.program,w=x.getUniforms(),M=s.uniforms;if(g.useProgram(x.program)&&(m=!0,v=!0,_=!0),n.id!==k&&(k=n.id,v=!0),m||z!==t){if(w.setValue(p,"projectionMatrix",t.projectionMatrix),f.logarithmicDepthBuffer&&w.setValue(p,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),z!==t&&(z=t,v=!0,_=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var S=w.map.cameraPosition;void 0!==S&&S.setValue(p,rt.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&w.setValue(p,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&w.setValue(p,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){w.setOptional(p,i,"bindMatrix"),w.setOptional(p,i,"bindMatrixInverse");var T=i.skeleton;if(T){var E=T.bones;if(f.floatVertexTextures){if(void 0===T.boneTexture){var A=Math.sqrt(4*E.length);A=_t.ceilPowerOfTwo(A),A=Math.max(A,4);var C=new Float32Array(A*A*4);C.set(T.boneMatrices);var P=new oi(C,A,A,1023,1015);T.boneMatrices=C,T.boneTexture=P,T.boneTextureSize=A}w.setValue(p,"boneTexture",T.boneTexture,b),w.setValue(p,"boneTextureSize",T.boneTextureSize)}else w.setOptional(p,T,"boneMatrices")}}return(v||s.receiveShadow!==i.receiveShadow)&&(s.receiveShadow=i.receiveShadow,w.setValue(p,"receiveShadow",i.receiveShadow)),v&&(w.setValue(p,"toneMappingExposure",R.toneMappingExposure),w.setValue(p,"toneMappingWhitePoint",R.toneMappingWhitePoint),s.needsLights&&(u=_,(c=M).ambientLightColor.needsUpdate=u,c.lightProbe.needsUpdate=u,c.directionalLights.needsUpdate=u,c.directionalLightShadows.needsUpdate=u,c.pointLights.needsUpdate=u,c.pointLightShadows.needsUpdate=u,c.spotLights.needsUpdate=u,c.spotLightShadows.needsUpdate=u,c.rectAreaLights.needsUpdate=u,c.hemisphereLights.needsUpdate=u),r&&n.fog&&function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(M,r),n.isMeshBasicMaterial?St(M,n):n.isMeshLambertMaterial?(St(M,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(M,n)):n.isMeshToonMaterial?(St(M,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(M,n)):n.isMeshPhongMaterial?(St(M,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(M,n)):n.isMeshStandardMaterial?(St(M,n,o),n.isMeshPhysicalMaterial?function(t,e,n){Tt(t,e,n),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate());t.transparency.value=e.transparency}(M,n,o):Tt(M,n,o)):n.isMeshMatcapMaterial?(St(M,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(M,n)):n.isMeshDepthMaterial?(St(M,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(M,n)):n.isMeshDistanceMaterial?(St(M,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(M,n)):n.isMeshNormalMaterial?(St(M,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(M,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(M,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(M,n)):n.isPointsMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*Y,t.scale.value=.5*X,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(M,n):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(M,n):n.isShadowMaterial&&(M.color.value.copy(n.color),M.opacity.value=n.opacity),void 0!==M.ltc_1&&(M.ltc_1.value=hi.LTC_1),void 0!==M.ltc_2&&(M.ltc_2.value=hi.LTC_2),Sr.upload(p,s.uniformsList,M,b),n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Sr.upload(p,s.uniformsList,M,b),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&w.setValue(p,"center",i.center),w.setValue(p,"modelViewMatrix",i.modelViewMatrix),w.setValue(p,"normalMatrix",i.normalMatrix),w.setValue(p,"modelMatrix",i.matrixWorld),x}function St(t,e,n){t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap);var i,r,o=e.envMap||n;o&&(t.envMap.value=o,t.flipEnvMap.value=o.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=y.get(o).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),e.aoMap?r=e.aoMap:e.lightMap&&(r=e.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function Tt(t,e,n){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||n)&&(t.envMapIntensity.value=e.envMapIntensity)}gt.setAnimationLoop((function(t){lt.isPresenting||ft&&ft(t)})),"undefined"!=typeof window&&gt.setContext(window),this.setAnimationLoop=function(t){ft=t,lt.setAnimationLoop(t),gt.start()},this.render=function(t,e){var n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),e&&e.isCamera){if(!O){U.geometry=null,U.program=null,U.wireframe=!1,k=-1,z=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),lt.enabled&&lt.isPresenting&&(e=lt.getCamera(e)),t.onBeforeRender(R,t,e,n||B),(d=T.get(t,e)).init(),it.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),$.setFromProjectionMatrix(it),nt=this.localClippingEnabled,et=tt.init(this.clippingPlanes,nt,e),(u=S.get(t,e)).init(),vt(t,e,0,R.sortObjects),u.finish(),!0===R.sortObjects&&u.sort(q,Z),et&&tt.beginShadows();var r=d.state.shadowsArray;ht.render(r,t,e),d.setupLights(e),et&&tt.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),E.render(u,t,e,i);var o=u.opaque,a=u.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;o.length&&yt(o,t,e,s),a.length&&yt(a,t,e,s)}else o.length&&yt(o,t,e),a.length&&yt(a,t,e);t.onAfterRender(R,t,e),null!==B&&(b.updateRenderTargetMipmap(B),b.updateMultisampleRenderTarget(B)),g.buffers.depth.setTest(!0),g.buffers.depth.setMask(!0),g.buffers.color.setMask(!0),g.setPolygonOffset(!1),u=null,d=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){I!==t&&null===B&&p.bindFramebuffer(36160,t),I=t},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return B},this.setRenderTarget=function(t,e,n){B=t,N=e,D=n,t&&void 0===y.get(t).__webglFramebuffer&&b.setupRenderTarget(t);var i=I,r=!1;if(t){var o=y.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=o[e||0],r=!0):i=t.isWebGLMultisampleRenderTarget?y.get(t).__webglMultisampledFramebuffer:o,G.copy(t.viewport),V.copy(t.scissor),j=t.scissorTest}else G.copy(J).multiplyScalar(Y).floor(),V.copy(K).multiplyScalar(Y).floor(),j=Q;if(F!==i&&(p.bindFramebuffer(36160,i),F=i),g.viewport(G),g.scissor(V),g.setScissorTest(j),r){var a=y.get(t.texture);p.framebufferTexture2D(36160,36064,34069+(e||0),a.__webglTexture,n||0)}},this.readRenderTargetPixels=function(t,e,n,i,r,o,a){if(t&&t.isWebGLRenderTarget){var s=y.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){var l=!1;s!==F&&(p.bindFramebuffer(36160,s),l=!0);try{var h=t.texture,c=h.format,u=h.type;if(1023!==c&&L.convert(c)!==p.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===u||L.convert(u)===p.getParameter(35738)||1015===u&&(f.isWebGL2||m.get("OES_texture_float")||m.get("WEBGL_color_buffer_float"))||1016===u&&(f.isWebGL2?m.get("EXT_color_buffer_float"):m.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===p.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&p.readPixels(e,n,i,r,L.convert(c),L.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&p.bindFramebuffer(36160,F)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);var i=Math.pow(2,-n),r=Math.floor(e.image.width*i),o=Math.floor(e.image.height*i),a=L.convert(e.format);b.setTexture2D(e,0),p.copyTexImage2D(3553,n,a,t.x,t.y,r,o,0),g.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i){void 0===i&&(i=0);var r=e.image.width,o=e.image.height,a=L.convert(n.format),s=L.convert(n.type);b.setTexture2D(n,0),e.isDataTexture?p.texSubImage2D(3553,i,t.x,t.y,r,o,a,s,e.image.data):e.isCompressedTexture?p.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):p.texSubImage2D(3553,i,t.x,t.y,a,s,e.image),0===i&&n.generateMipmaps&&p.generateMipmap(3553),g.unbindTexture()},this.initTexture=function(t){b.setTexture2D(t,0),g.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function mo(t,e){this.name="",this.color=new Ze(t),this.density=void 0!==e?e:25e-5}function fo(t,e,n){this.name="",this.color=new Ze(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function go(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}lo.prototype=Object.assign(Object.create(ni.prototype),{constructor:lo,isArrayCamera:!0}),ho.prototype=Object.assign(Object.create(re.prototype),{constructor:ho,isGroup:!0}),Object.assign(co.prototype,{constructor:co,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new ho,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new ho,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(t,e,n){var i=null,r=null,o=this._targetRay,a=this._grip;return t&&(null!==o&&null!==(i=e.getPose(t.targetRaySpace,n))&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==a&&t.gripSpace&&null!==(r=e.getPose(t.gripSpace,n))&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale))),null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),this}}),Object.assign(uo.prototype,gt.prototype),Object.assign(mo.prototype,{isFogExp2:!0,clone:function(){return new mo(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(fo.prototype,{isFog:!0,clone:function(){return new fo(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(go.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(go.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(var i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var vo,yo=new Ot;function bo(t,e,n,i){this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}function _o(t){en.call(this),this.type="SpriteMaterial",this.color=new Ze(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Object.defineProperties(bo.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(bo.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,n=this.data.count;e<n;e++)yo.x=this.getX(e),yo.y=this.getY(e),yo.z=this.getZ(e),yo.applyMatrix4(t),this.setXYZ(e,yo.x,yo.y,yo.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}}),_o.prototype=Object.create(en.prototype),_o.prototype.constructor=_o,_o.prototype.isSpriteMaterial=!0,_o.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var xo=new Ot,wo=new Ot,Mo=new Ot,So=new xt,To=new xt,Eo=new zt,Ao=new Ot,Co=new Ot,Po=new Ot,Lo=new xt,Ro=new xt,Oo=new xt;function Io(t){if(re.call(this),this.type="Sprite",void 0===vo){vo=new Sn;var e=new go(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);vo.setIndex([0,1,2,0,2,3]),vo.setAttribute("position",new bo(e,3,0,!1)),vo.setAttribute("uv",new bo(e,2,3,!1))}this.geometry=vo,this.material=void 0!==t?t:new _o,this.center=new xt(.5,.5)}function No(t,e,n,i,r,o){So.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(To.x=o*So.x-r*So.y,To.y=r*So.x+o*So.y):To.copy(So),t.copy(e),t.x+=To.x,t.y+=To.y,t.applyMatrix4(Eo)}Io.prototype=Object.assign(Object.create(re.prototype),{constructor:Io,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),wo.setFromMatrixScale(this.matrixWorld),Eo.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Mo.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&wo.multiplyScalar(-Mo.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var o=this.center;No(Ao.set(-.5,-.5,0),Mo,o,wo,n,i),No(Co.set(.5,-.5,0),Mo,o,wo,n,i),No(Po.set(.5,.5,0),Mo,o,wo,n,i),Lo.set(0,0),Ro.set(1,0),Oo.set(1,1);var a=t.ray.intersectTriangle(Ao,Co,Po,!1,xo);if(null!==a||(No(Co.set(-.5,.5,0),Mo,o,wo,n,i),Ro.set(0,1),null!==(a=t.ray.intersectTriangle(Ao,Po,Co,!1,xo)))){var s=t.ray.origin.distanceTo(xo);s<t.near||s>t.far||e.push({distance:s,point:xo.clone(),uv:We.getUV(xo,Ao,Co,Po,Lo,Ro,Oo,new xt),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return re.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var Do,Bo,Fo,ko,Uo,zo=new Ot,Ho=new Ot;function Go(){re.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Vo(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Gn.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new zt,this.bindMatrixInverse=new zt}Go.prototype=Object.assign(Object.create(re.prototype),{constructor:Go,isLOD:!0,copy:function(t){re.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,i=e.length;n<i;n++){var r=e[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var n=this.levels,i=0;i<n.length&&!(e<n[i].distance);i++);return n.splice(i,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){var e=this.levels;if(e.length>0){for(var n=1,i=e.length;n<i&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){zo.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(zo);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){zo.setFromMatrixPosition(t.matrixWorld),Ho.setFromMatrixPosition(this.matrixWorld);var n=zo.distanceTo(Ho)/t.zoom;e[0].object.visible=!0;for(var i=1,r=e.length;i<r&&n>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}},toJSON:function(t){var e=re.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];for(var n=this.levels,i=0,r=n.length;i<r;i++){var o=n[i];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Vo.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Vo,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new Et,e=this.geometry.attributes.skinWeight,n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);var r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Gn.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},boneTransform:(Do=new Ot,Bo=new Et,Fo=new Et,ko=new Ot,Uo=new zt,function(t,e){var n=this.skeleton,i=this.geometry;Bo.fromBufferAttribute(i.attributes.skinIndex,t),Fo.fromBufferAttribute(i.attributes.skinWeight,t),Do.fromBufferAttribute(i.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var r=0;r<4;r++){var o=Fo.getComponent(r);if(0!==o){var a=Bo.getComponent(r);Uo.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),e.addScaledVector(ko.copy(Do).applyMatrix4(Uo),o)}}return e.applyMatrix4(this.bindMatrixInverse)})});var jo=new zt,Wo=new zt;function Xo(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new zt)}}function Yo(){re.call(this),this.type="Bone"}Object.assign(Xo.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new zt;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){var t,e,n;for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,o=t.length;r<o;r++){var a=t[r]?t[r].matrixWorld:Wo;jo.multiplyMatrices(a,e[r]),jo.toArray(n,16*r)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new Xo(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var i=this.bones[e];if(i.name===t)return i}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Yo.prototype=Object.assign(Object.create(re.prototype),{constructor:Yo,isBone:!0});var qo=new zt,Zo=new zt,Jo=[],Ko=new Gn;function Qo(t,e,n){Gn.call(this,t,e),this.instanceMatrix=new on(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function $o(t){en.call(this),this.type="LineBasicMaterial",this.color=new Ze(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}Qo.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Qo,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){var n=this.matrixWorld,i=this.count;if(Ko.geometry=this.geometry,Ko.material=this.material,void 0!==Ko.material)for(var r=0;r<i;r++){this.getMatrixAt(r,qo),Zo.multiplyMatrices(n,qo),Ko.matrixWorld=Zo,Ko.raycast(t,Jo);for(var o=0,a=Jo.length;o<a;o++){var s=Jo[o];s.instanceId=r,s.object=this,e.push(s)}Jo.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),$o.prototype=Object.create(en.prototype),$o.prototype.constructor=$o,$o.prototype.isLineBasicMaterial=!0,$o.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var ta=new Ot,ea=new Ot,na=new zt,ia=new Le,ra=new we;function oa(t,e,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),re.call(this),this.type="Line",this.geometry=void 0!==t?t:new Sn,this.material=void 0!==e?e:new $o}oa.prototype=Object.assign(Object.create(re.prototype),{constructor:oa,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[0],i=1,r=e.count;i<r;i++)ta.fromBufferAttribute(e,i-1),ea.fromBufferAttribute(e,i),n[i]=n[i-1],n[i]+=ta.distanceTo(ea);t.setAttribute("lineDistance",new pn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;(n=t.lineDistances)[0]=0;for(i=1,r=o.length;i<r;i++)n[i]=n[i-1],n[i]+=o[i-1].distanceTo(o[i])}return this},raycast:function(t,e){var n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),ra.copy(n.boundingSphere),ra.applyMatrix4(i),ra.radius+=r,!1!==t.ray.intersectsSphere(ra)){na.getInverse(i),ia.copy(t.ray).applyMatrix4(na);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new Ot,l=new Ot,h=new Ot,c=new Ot,u=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var d=n.index,p=n.attributes.position.array;if(null!==d)for(var m=d.array,f=0,g=m.length-1;f<g;f+=u){var v=m[f],y=m[f+1];if(s.fromArray(p,3*v),l.fromArray(p,3*y),!(ia.distanceSqToSegment(s,l,c,h)>a))c.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(c))<t.near||x>t.far||e.push({distance:x,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this})}else for(f=0,g=p.length/3-1;f<g;f+=u){if(s.fromArray(p,3*f),l.fromArray(p,3*f+3),!(ia.distanceSqToSegment(s,l,c,h)>a))c.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(c))<t.near||x>t.far||e.push({distance:x,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){var b=n.vertices,_=b.length;for(f=0;f<_-1;f+=u){var x;if(!(ia.distanceSqToSegment(b[f],b[f+1],c,h)>a))c.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(c))<t.near||x>t.far||e.push({distance:x,point:h.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var aa=new Ot,sa=new Ot;function la(t,e){oa.call(this,t,e),this.type="LineSegments"}function ha(t,e){oa.call(this,t,e),this.type="LineLoop"}function ca(t){en.call(this),this.type="PointsMaterial",this.color=new Ze(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}la.prototype=Object.assign(Object.create(oa.prototype),{constructor:la,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[],i=0,r=e.count;i<r;i+=2)aa.fromBufferAttribute(e,i),sa.fromBufferAttribute(e,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+aa.distanceTo(sa);t.setAttribute("lineDistance",new pn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;for(n=t.lineDistances,i=0,r=o.length;i<r;i+=2)aa.copy(o[i]),sa.copy(o[i+1]),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+aa.distanceTo(sa)}return this}}),ha.prototype=Object.assign(Object.create(oa.prototype),{constructor:ha,isLineLoop:!0}),ca.prototype=Object.create(en.prototype),ca.prototype.constructor=ca,ca.prototype.isPointsMaterial=!0,ca.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var ua=new zt,da=new Le,pa=new we,ma=new Ot;function fa(t,e){re.call(this),this.type="Points",this.geometry=void 0!==t?t:new Sn,this.material=void 0!==e?e:new ca,this.updateMorphTargets()}function ga(t,e,n,i,r,o,a){var s=da.distanceSqToPoint(t);if(s<n){var l=new Ot;da.closestPointToPoint(t,l),l.applyMatrix4(i);var h=r.ray.origin.distanceTo(l);if(h<r.near||h>r.far)return;o.push({distance:h,distanceToRay:Math.sqrt(s),point:l,index:e,face:null,object:a})}}function va(t,e,n,i,r,o,a,s,l){Tt.call(this,t,e,n,i,r,o,a,s,l),this.format=void 0!==a?a:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==r?r:1006,this.generateMipmaps=!1}function ya(t,e,n,i,r,o,a,s,l,h,c,u){Tt.call(this,null,o,a,s,l,h,i,r,c,u),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function ba(t,e,n,i,r,o,a,s,l){Tt.call(this,t,e,n,i,r,o,a,s,l),this.needsUpdate=!0}function _a(t,e,n,i,r,o,a,s,l,h){if(1026!==(h=void 0!==h?h:1026)&&1027!==h)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===h&&(n=1012),void 0===n&&1027===h&&(n=1020),Tt.call(this,null,i,r,o,a,s,h,n,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:1003,this.minFilter=void 0!==s?s:1003,this.flipY=!1,this.generateMipmaps=!1}function xa(t){Sn.call(this),this.type="WireframeGeometry";var e,n,i,r,o,a,s,l,h,c,u=[],d=[0,0],p={},m=["a","b","c"];if(t&&t.isGeometry){var f=t.faces;for(e=0,i=f.length;e<i;e++){var g=f[e];for(n=0;n<3;n++)s=g[m[n]],l=g[m[(n+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[h=d[0]+","+d[1]]&&(p[h]={index1:d[0],index2:d[1]})}for(h in p)a=p[h],c=t.vertices[a.index1],u.push(c.x,c.y,c.z),c=t.vertices[a.index2],u.push(c.x,c.y,c.z)}else if(t&&t.isBufferGeometry){var v,y,b,_,x,w,M;if(c=new Ot,null!==t.index){for(v=t.attributes.position,y=t.index,0===(b=t.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),r=0,o=b.length;r<o;++r)for(e=x=(_=b[r]).start,i=x+_.count;e<i;e+=3)for(n=0;n<3;n++)s=y.getX(e+n),l=y.getX(e+(n+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[h=d[0]+","+d[1]]&&(p[h]={index1:d[0],index2:d[1]});for(h in p)a=p[h],c.fromBufferAttribute(v,a.index1),u.push(c.x,c.y,c.z),c.fromBufferAttribute(v,a.index2),u.push(c.x,c.y,c.z)}else for(e=0,i=(v=t.attributes.position).count/3;e<i;e++)for(n=0;n<3;n++)w=3*e+n,c.fromBufferAttribute(v,w),u.push(c.x,c.y,c.z),M=3*e+(n+1)%3,c.fromBufferAttribute(v,M),u.push(c.x,c.y,c.z)}this.setAttribute("position",new pn(u,3))}function wa(t,e,n){Zn.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new Ma(t,e,n)),this.mergeVertices()}function Ma(t,e,n){Sn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};var i,r,o=[],a=[],s=[],l=[],h=1e-5,c=new Ot,u=new Ot,d=new Ot,p=new Ot,m=new Ot;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=e+1;for(i=0;i<=n;i++){var g=i/n;for(r=0;r<=e;r++){var v=r/e;t(v,g,u),a.push(u.x,u.y,u.z),v-h>=0?(t(v-h,g,d),p.subVectors(u,d)):(t(v+h,g,d),p.subVectors(d,u)),g-h>=0?(t(v,g-h,d),m.subVectors(u,d)):(t(v,g+h,d),m.subVectors(d,u)),c.crossVectors(p,m).normalize(),s.push(c.x,c.y,c.z),l.push(v,g)}}for(i=0;i<n;i++)for(r=0;r<e;r++){var y=i*f+r,b=i*f+r+1,_=(i+1)*f+r+1,x=(i+1)*f+r;o.push(y,b,x),o.push(b,_,x)}this.setIndex(o),this.setAttribute("position",new pn(a,3)),this.setAttribute("normal",new pn(s,3)),this.setAttribute("uv",new pn(l,2))}function Sa(t,e,n,i){Zn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},this.fromBufferGeometry(new Ta(t,e,n,i)),this.mergeVertices()}function Ta(t,e,n,i){Sn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},n=n||1;var r=[],o=[];function a(t,e,n,i){var r,o,a=Math.pow(2,i),l=[];for(r=0;r<=a;r++){l[r]=[];var h=t.clone().lerp(n,r/a),c=e.clone().lerp(n,r/a),u=a-r;for(o=0;o<=u;o++)l[r][o]=0===o&&r===a?h:h.clone().lerp(c,o/u)}for(r=0;r<a;r++)for(o=0;o<2*(a-r)-1;o++){var d=Math.floor(o/2);o%2==0?(s(l[r][d+1]),s(l[r+1][d]),s(l[r][d])):(s(l[r][d+1]),s(l[r+1][d+1]),s(l[r+1][d]))}}function s(t){r.push(t.x,t.y,t.z)}function l(e,n){var i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function h(t,e,n,i){i<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=i/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}function u(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){for(var n=new Ot,i=new Ot,r=new Ot,o=0;o<e.length;o+=3)l(e[o+0],n),l(e[o+1],i),l(e[o+2],r),a(n,i,r,t)}(i=i||0),function(t){for(var e=new Ot,n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){for(var t=new Ot,e=0;e<r.length;e+=3){t.x=r[e+0],t.y=r[e+1],t.z=r[e+2];var n=c(t)/2/Math.PI+.5,i=u(t)/Math.PI+.5;o.push(n,1-i)}(function(){for(var t=new Ot,e=new Ot,n=new Ot,i=new Ot,a=new xt,s=new xt,l=new xt,u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),a.set(o[d+0],o[d+1]),s.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),i.copy(t).add(e).add(n).divideScalar(3);var p=c(i);h(a,d+0,t,p),h(s,d+2,e,p),h(l,d+4,n,p)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],n=o[t+2],i=o[t+4],r=Math.max(e,n,i),a=Math.min(e,n,i);r>.9&&a<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),i<.2&&(o[t+4]+=1))}}()}(),this.setAttribute("position",new pn(r,3)),this.setAttribute("normal",new pn(r.slice(),3)),this.setAttribute("uv",new pn(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function Ea(t,e){Zn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Aa(t,e)),this.mergeVertices()}function Aa(t,e){Ta.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ca(t,e){Zn.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Pa(t,e)),this.mergeVertices()}function Pa(t,e){Ta.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function La(t,e){Zn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ra(t,e)),this.mergeVertices()}function Ra(t,e){var n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];Ta.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Oa(t,e){Zn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ia(t,e)),this.mergeVertices()}function Ia(t,e){var n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i];Ta.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Na(t,e,n,i,r,o){Zn.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Da(t,e,n,i,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Da(t,e,n,i,r){Sn.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},e=e||64,n=n||1,i=i||8,r=r||!1;var o=t.computeFrenetFrames(e,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new Ot,h=new Ot,c=new xt,u=new Ot,d=[],p=[],m=[],f=[];function g(r){u=t.getPointAt(r/e,u);var a=o.normals[r],c=o.binormals[r];for(s=0;s<=i;s++){var m=s/i*Math.PI*2,f=Math.sin(m),g=-Math.cos(m);h.x=g*a.x+f*c.x,h.y=g*a.y+f*c.y,h.z=g*a.z+f*c.z,h.normalize(),p.push(h.x,h.y,h.z),l.x=u.x+n*h.x,l.y=u.y+n*h.y,l.z=u.z+n*h.z,d.push(l.x,l.y,l.z)}}!function(){for(a=0;a<e;a++)g(a);g(!1===r?e:0),function(){for(a=0;a<=e;a++)for(s=0;s<=i;s++)c.x=a/e,c.y=s/i,m.push(c.x,c.y)}(),function(){for(s=1;s<=e;s++)for(a=1;a<=i;a++){var t=(i+1)*(s-1)+(a-1),n=(i+1)*s+(a-1),r=(i+1)*s+a,o=(i+1)*(s-1)+a;f.push(t,n,o),f.push(n,r,o)}}()}(),this.setIndex(f),this.setAttribute("position",new pn(d,3)),this.setAttribute("normal",new pn(p,3)),this.setAttribute("uv",new pn(m,2))}function Ba(t,e,n,i,r,o,a){Zn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Fa(t,e,n,i,r,o)),this.mergeVertices()}function Fa(t,e,n,i,r,o){Sn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},t=t||1,e=e||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,o=o||3;var a,s,l=[],h=[],c=[],u=[],d=new Ot,p=new Ot,m=new Ot,f=new Ot,g=new Ot,v=new Ot,y=new Ot;for(a=0;a<=n;++a){var b=a/n*r*Math.PI*2;for(A(b,r,o,t,m),A(b+.01,r,o,t,f),v.subVectors(f,m),y.addVectors(f,m),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize(),s=0;s<=i;++s){var _=s/i*Math.PI*2,x=-e*Math.cos(_),w=e*Math.sin(_);d.x=m.x+(x*y.x+w*g.x),d.y=m.y+(x*y.y+w*g.y),d.z=m.z+(x*y.z+w*g.z),h.push(d.x,d.y,d.z),p.subVectors(d,m).normalize(),c.push(p.x,p.y,p.z),u.push(a/n),u.push(s/i)}}for(s=1;s<=n;s++)for(a=1;a<=i;a++){var M=(i+1)*(s-1)+(a-1),S=(i+1)*s+(a-1),T=(i+1)*s+a,E=(i+1)*(s-1)+a;l.push(M,S,E),l.push(S,T,E)}function A(t,e,n,i,r){var o=Math.cos(t),a=Math.sin(t),s=n/e*t,l=Math.cos(s);r.x=i*(2+l)*.5*o,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(s)*.5}this.setIndex(l),this.setAttribute("position",new pn(h,3)),this.setAttribute("normal",new pn(c,3)),this.setAttribute("uv",new pn(u,2))}function ka(t,e,n,i,r){Zn.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new Ua(t,e,n,i,r)),this.mergeVertices()}function Ua(t,e,n,i,r){Sn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},t=t||1,e=e||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||2*Math.PI;var o,a,s=[],l=[],h=[],c=[],u=new Ot,d=new Ot,p=new Ot;for(o=0;o<=n;o++)for(a=0;a<=i;a++){var m=a/i*r,f=o/n*Math.PI*2;d.x=(t+e*Math.cos(f))*Math.cos(m),d.y=(t+e*Math.cos(f))*Math.sin(m),d.z=e*Math.sin(f),l.push(d.x,d.y,d.z),u.x=t*Math.cos(m),u.y=t*Math.sin(m),p.subVectors(d,u).normalize(),h.push(p.x,p.y,p.z),c.push(a/i),c.push(o/n)}for(o=1;o<=n;o++)for(a=1;a<=i;a++){var g=(i+1)*o+a-1,v=(i+1)*(o-1)+a-1,y=(i+1)*(o-1)+a,b=(i+1)*o+a;s.push(g,v,b),s.push(v,y,b)}this.setIndex(s),this.setAttribute("position",new pn(l,3)),this.setAttribute("normal",new pn(h,3)),this.setAttribute("uv",new pn(c,2))}fa.prototype=Object.assign(Object.create(re.prototype),{constructor:fa,isPoints:!0,raycast:function(t,e){var n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),pa.copy(n.boundingSphere),pa.applyMatrix4(i),pa.radius+=r,!1!==t.ray.intersectsSphere(pa)){ua.getInverse(i),da.copy(t.ray).applyMatrix4(ua);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){var s=n.index,l=n.attributes.position.array;if(null!==s)for(var h=s.array,c=0,u=h.length;c<u;c++){var d=h[c];ma.fromArray(l,3*d),ga(ma,d,a,i,t,e,this)}else{c=0;for(var p=l.length/3;c<p;c++)ma.fromArray(l,3*c),ga(ma,c,a,i,t,e,this)}}else{var m=n.vertices;for(c=0,p=m.length;c<p;c++)ga(m[c],c,a,i,t,e,this)}}},updateMorphTargets:function(){var t,e,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,o=Object.keys(r);if(o.length>0){var a=r[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)n=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),va.prototype=Object.assign(Object.create(Tt.prototype),{constructor:va,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),ya.prototype=Object.create(Tt.prototype),ya.prototype.constructor=ya,ya.prototype.isCompressedTexture=!0,ba.prototype=Object.create(Tt.prototype),ba.prototype.constructor=ba,ba.prototype.isCanvasTexture=!0,_a.prototype=Object.create(Tt.prototype),_a.prototype.constructor=_a,_a.prototype.isDepthTexture=!0,xa.prototype=Object.create(Sn.prototype),xa.prototype.constructor=xa,wa.prototype=Object.create(Zn.prototype),wa.prototype.constructor=wa,Ma.prototype=Object.create(Sn.prototype),Ma.prototype.constructor=Ma,Sa.prototype=Object.create(Zn.prototype),Sa.prototype.constructor=Sa,Ta.prototype=Object.create(Sn.prototype),Ta.prototype.constructor=Ta,Ea.prototype=Object.create(Zn.prototype),Ea.prototype.constructor=Ea,Aa.prototype=Object.create(Ta.prototype),Aa.prototype.constructor=Aa,Ca.prototype=Object.create(Zn.prototype),Ca.prototype.constructor=Ca,Pa.prototype=Object.create(Ta.prototype),Pa.prototype.constructor=Pa,La.prototype=Object.create(Zn.prototype),La.prototype.constructor=La,Ra.prototype=Object.create(Ta.prototype),Ra.prototype.constructor=Ra,Oa.prototype=Object.create(Zn.prototype),Oa.prototype.constructor=Oa,Ia.prototype=Object.create(Ta.prototype),Ia.prototype.constructor=Ia,Na.prototype=Object.create(Zn.prototype),Na.prototype.constructor=Na,Da.prototype=Object.create(Sn.prototype),Da.prototype.constructor=Da,Da.prototype.toJSON=function(){var t=Sn.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},Ba.prototype=Object.create(Zn.prototype),Ba.prototype.constructor=Ba,Fa.prototype=Object.create(Sn.prototype),Fa.prototype.constructor=Fa,ka.prototype=Object.create(Zn.prototype),ka.prototype.constructor=ka,Ua.prototype=Object.create(Sn.prototype),Ua.prototype.constructor=Ua;var za=function(t,e,n){n=n||2;var i,r,o,a,s,l,h,c=e&&e.length,u=c?e[0]*n:t.length,d=Ha(t,0,u,n,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(t,e,n,i){var r,o,a,s,l,h=[];for(r=0,o=e.length;r<o;r++)a=e[r]*i,s=r<o-1?e[r+1]*i:t.length,(l=Ha(t,a,s,i,!1))===l.next&&(l.steiner=!0),h.push(Qa(l));for(h.sort(qa),r=0;r<h.length;r++)Za(h[r],n),n=Ga(n,n.next);return n}(t,e,d,n)),t.length>80*n){i=o=t[0],r=a=t[1];for(var m=n;m<u;m+=n)(s=t[m])<i&&(i=s),(l=t[m+1])<r&&(r=l),s>o&&(o=s),l>a&&(a=l);h=0!==(h=Math.max(o-i,a-r))?1/h:0}return Va(d,p,n,i,r,h),p};function Ha(t,e,n,i,r){var o,a;if(r===function(t,e,n,i){for(var r=0,o=e,a=n-i;o<n;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r}(t,e,n,i)>0)for(o=e;o<n;o+=i)a=ls(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=ls(o,t[o],t[o+1],a);return a&&ns(a,a.next)&&(hs(a),a=a.next),a}function Ga(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!ns(i,i.next)&&0!==es(i.prev,i,i.next))i=i.next;else{if(hs(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Va(t,e,n,i,r,o,a){if(t){!a&&o&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=Ka(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,a,s,l,h=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,i=n,s=0,e=0;e<h&&(s++,i=i.nextZ);e++);for(l=h;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,h*=2}while(a>1)}(r)}(t,i,r,o);for(var s,l,h=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?Wa(t,i,r,o):ja(t))e.push(s.i/n),e.push(t.i/n),e.push(l.i/n),hs(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?Va(t=Xa(Ga(t),e,n),e,n,i,r,o,2):2===a&&Ya(t,e,n,i,r,o):Va(Ga(t),e,n,i,r,o,1);break}}}function ja(t){var e=t.prev,n=t,i=t.next;if(es(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if($a(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&es(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Wa(t,e,n,i){var r=t.prev,o=t,a=t.next;if(es(r,o,a)>=0)return!1;for(var s=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,l=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,h=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,u=Ka(s,l,e,n,i),d=Ka(h,c,e,n,i),p=t.prevZ,m=t.nextZ;p&&p.z>=u&&m&&m.z<=d;){if(p!==t.prev&&p!==t.next&&$a(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&es(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==t.prev&&m!==t.next&&$a(r.x,r.y,o.x,o.y,a.x,a.y,m.x,m.y)&&es(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&$a(r.x,r.y,o.x,o.y,a.x,a.y,p.x,p.y)&&es(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&$a(r.x,r.y,o.x,o.y,a.x,a.y,m.x,m.y)&&es(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Xa(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!ns(r,o)&&is(r,i,i.next,o)&&as(r,o)&&as(o,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(o.i/n),hs(i),hs(i.next),i=t=o),i=i.next}while(i!==t);return Ga(i)}function Ya(t,e,n,i,r,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ts(a,s)){var l=ss(a,s);return a=Ga(a,a.next),l=Ga(l,l.next),Va(a,e,n,i,r,o),void Va(l,e,n,i,r,o)}s=s.next}a=a.next}while(a!==t)}function qa(t,e){return t.x-e.x}function Za(t,e){if(e=function(t,e){var n,i=e,r=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>a){if(a=s,s===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n;var l,h=n,c=n.x,u=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&$a(o<u?r:a,o,c,u,o<u?a:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),as(i,t)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&Ja(n,i)))&&(n=i,d=l)),i=i.next}while(i!==h);return n}(t,e)){var n=ss(e,t);Ga(e,e.next),Ga(n,n.next)}}function Ja(t,e){return es(t.prev,t,e.prev)<0&&es(e.next,t,t.next)<0}function Ka(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Qa(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function $a(t,e,n,i,r,o,a,s){return(r-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(r-a)*(i-s)>=0}function ts(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&is(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(as(t,e)&&as(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(es(t.prev,t,e.prev)||es(t,e.prev,e))||ns(t,e)&&es(t.prev,t,t.next)>0&&es(e.prev,e,e.next)>0)}function es(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ns(t,e){return t.x===e.x&&t.y===e.y}function is(t,e,n,i){var r=os(es(t,e,n)),o=os(es(t,e,i)),a=os(es(n,i,t)),s=os(es(n,i,e));return r!==o&&a!==s||(!(0!==r||!rs(t,n,e))||(!(0!==o||!rs(t,i,e))||(!(0!==a||!rs(n,t,i))||!(0!==s||!rs(n,e,i)))))}function rs(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function os(t){return t>0?1:t<0?-1:0}function as(t,e){return es(t.prev,t,t.next)<0?es(t,e,t.next)>=0&&es(t,t.prev,e)>=0:es(t,e,t.prev)<0||es(t,t.next,e)<0}function ss(t,e){var n=new cs(t.i,t.x,t.y),i=new cs(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function ls(t,e,n,i){var r=new cs(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function hs(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function cs(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var us={area:function(t){for(var e=t.length,n=0,i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n},isClockWise:function(t){return us.area(t)<0},triangulateShape:function(t,e){var n=[],i=[],r=[];ds(t),ps(n,t);var o=t.length;e.forEach(ds);for(var a=0;a<e.length;a++)i.push(o),o+=e[a].length,ps(n,e[a]);var s=za(n,i);for(a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}};function ds(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function ps(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function ms(t,e){Zn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new fs(t,e)),this.mergeVertices()}function fs(t,e){Sn.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var n=this,i=[],r=[],o=0,a=t.length;o<a;o++){s(t[o])}function s(t){var o=[],a=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:100,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:6,u=void 0!==e.bevelSize?e.bevelSize:c-2,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3,m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:gs;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);var g,v,y,b,_,x,w,M,S=!1;m&&(g=m.getSpacedPoints(s),S=!0,h=!1,v=m.computeFrenetFrames(s,!1),y=new Ot,b=new Ot,_=new Ot),h||(p=0,c=0,u=0,d=0);var T=t.extractPoints(a),E=T.shape,A=T.holes;if(!us.isClockWise(E))for(E=E.reverse(),w=0,M=A.length;w<M;w++)x=A[w],us.isClockWise(x)&&(A[w]=x.reverse());var C=us.triangulateShape(E,A),P=E;for(w=0,M=A.length;w<M;w++)x=A[w],E=E.concat(x);function L(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}var R,O,I,N,D,B,F=E.length,k=C.length;function U(t,e,n){var i,r,o,a=t.x-e.x,s=t.y-e.y,l=n.x-t.x,h=n.y-t.y,c=a*a+s*s,u=a*h-s*l;if(Math.abs(u)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(l*l+h*h),m=e.x-s/d,f=e.y+a/d,g=((n.x-h/p-m)*h-(n.y+l/p-f)*l)/(a*h-s*l),v=(i=m+a*g-t.x)*i+(r=f+s*g-t.y)*r;if(v<=2)return new xt(i,r);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(h)&&(y=!0),y?(i=-s,r=a,o=Math.sqrt(c)):(i=a,r=s,o=Math.sqrt(c/2))}return new xt(i/o,r/o)}for(var z=[],H=0,G=P.length,V=G-1,j=H+1;H<G;H++,V++,j++)V===G&&(V=0),j===G&&(j=0),z[H]=U(P[H],P[V],P[j]);var W,X,Y=[],q=z.concat();for(w=0,M=A.length;w<M;w++){for(x=A[w],W=[],H=0,V=(G=x.length)-1,j=H+1;H<G;H++,V++,j++)V===G&&(V=0),j===G&&(j=0),W[H]=U(x[H],x[V],x[j]);Y.push(W),q=q.concat(W)}for(R=0;R<p;R++){for(I=R/p,N=c*Math.cos(I*Math.PI/2),O=u*Math.sin(I*Math.PI/2)+d,H=0,G=P.length;H<G;H++)J((D=L(P[H],z[H],O)).x,D.y,-N);for(w=0,M=A.length;w<M;w++)for(x=A[w],W=Y[w],H=0,G=x.length;H<G;H++)J((D=L(x[H],W[H],O)).x,D.y,-N)}for(O=u+d,H=0;H<F;H++)D=h?L(E[H],q[H],O):E[H],S?(b.copy(v.normals[0]).multiplyScalar(D.x),y.copy(v.binormals[0]).multiplyScalar(D.y),_.copy(g[0]).add(b).add(y),J(_.x,_.y,_.z)):J(D.x,D.y,0);for(X=1;X<=s;X++)for(H=0;H<F;H++)D=h?L(E[H],q[H],O):E[H],S?(b.copy(v.normals[X]).multiplyScalar(D.x),y.copy(v.binormals[X]).multiplyScalar(D.y),_.copy(g[X]).add(b).add(y),J(_.x,_.y,_.z)):J(D.x,D.y,l/s*X);for(R=p-1;R>=0;R--){for(I=R/p,N=c*Math.cos(I*Math.PI/2),O=u*Math.sin(I*Math.PI/2)+d,H=0,G=P.length;H<G;H++)J((D=L(P[H],z[H],O)).x,D.y,l+N);for(w=0,M=A.length;w<M;w++)for(x=A[w],W=Y[w],H=0,G=x.length;H<G;H++)D=L(x[H],W[H],O),S?J(D.x,D.y+g[s-1].y,g[s-1].x+N):J(D.x,D.y,l+N)}function Z(t,e){var n,i;for(H=t.length;--H>=0;){n=H,(i=H-1)<0&&(i=t.length-1);var r=0,o=s+2*p;for(r=0;r<o;r++){var a=F*r,l=F*(r+1);Q(e+n+a,e+i+a,e+i+l,e+n+l)}}}function J(t,e,n){o.push(t),o.push(e),o.push(n)}function K(t,e,r){$(t),$(e),$(r);var o=i.length/3,a=f.generateTopUV(n,i,o-3,o-2,o-1);tt(a[0]),tt(a[1]),tt(a[2])}function Q(t,e,r,o){$(t),$(e),$(o),$(e),$(r),$(o);var a=i.length/3,s=f.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);tt(s[0]),tt(s[1]),tt(s[3]),tt(s[1]),tt(s[2]),tt(s[3])}function $(t){i.push(o[3*t+0]),i.push(o[3*t+1]),i.push(o[3*t+2])}function tt(t){r.push(t.x),r.push(t.y)}!function(){var t=i.length/3;if(h){var e=0,r=F*e;for(H=0;H<k;H++)K((B=C[H])[2]+r,B[1]+r,B[0]+r);for(r=F*(e=s+2*p),H=0;H<k;H++)K((B=C[H])[0]+r,B[1]+r,B[2]+r)}else{for(H=0;H<k;H++)K((B=C[H])[2],B[1],B[0]);for(H=0;H<k;H++)K((B=C[H])[0]+F*s,B[1]+F*s,B[2]+F*s)}n.addGroup(t,i.length/3-t,0)}(),function(){var t=i.length/3,e=0;for(Z(P,e),e+=P.length,w=0,M=A.length;w<M;w++)Z(x=A[w],e),e+=x.length;n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new pn(i,3)),this.setAttribute("uv",new pn(r,2)),this.computeVertexNormals()}ms.prototype=Object.create(Zn.prototype),ms.prototype.constructor=ms,ms.prototype.toJSON=function(){var t=Zn.prototype.toJSON.call(this);return vs(this.parameters.shapes,this.parameters.options,t)},fs.prototype=Object.create(Sn.prototype),fs.prototype.constructor=fs,fs.prototype.toJSON=function(){var t=Sn.prototype.toJSON.call(this);return vs(this.parameters.shapes,this.parameters.options,t)};var gs={generateTopUV:function(t,e,n,i,r){var o=e[3*n],a=e[3*n+1],s=e[3*i],l=e[3*i+1],h=e[3*r],c=e[3*r+1];return[new xt(o,a),new xt(s,l),new xt(h,c)]},generateSideWallUV:function(t,e,n,i,r,o){var a=e[3*n],s=e[3*n+1],l=e[3*n+2],h=e[3*i],c=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],m=e[3*r+2],f=e[3*o],g=e[3*o+1],v=e[3*o+2];return Math.abs(s-c)<.01?[new xt(a,1-l),new xt(h,1-u),new xt(d,1-m),new xt(f,1-v)]:[new xt(s,1-l),new xt(c,1-u),new xt(p,1-m),new xt(g,1-v)]}};function vs(t,e,n){if(n.shapes=[],Array.isArray(t))for(var i=0,r=t.length;i<r;i++){var o=t[i];n.shapes.push(o.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}function ys(t,e){Zn.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new bs(t,e)),this.mergeVertices()}function bs(t,e){var n=(e=e||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Zn;var i=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),fs.call(this,i,e),this.type="TextBufferGeometry"}function _s(t,e,n,i,r,o,a){Zn.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new xs(t,e,n,i,r,o,a)),this.mergeVertices()}function xs(t,e,n,i,r,o,a){Sn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,h=Math.min(o+a,Math.PI),c=0,u=[],d=new Ot,p=new Ot,m=[],f=[],g=[],v=[];for(l=0;l<=n;l++){var y=[],b=l/n,_=0;for(0==l&&0==o?_=.5/e:l==n&&h==Math.PI&&(_=-.5/e),s=0;s<=e;s++){var x=s/e;d.x=-t*Math.cos(i+x*r)*Math.sin(o+b*a),d.y=t*Math.cos(o+b*a),d.z=t*Math.sin(i+x*r)*Math.sin(o+b*a),f.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),v.push(x+_,1-b),y.push(c++)}u.push(y)}for(l=0;l<n;l++)for(s=0;s<e;s++){var w=u[l][s+1],M=u[l][s],S=u[l+1][s],T=u[l+1][s+1];(0!==l||o>0)&&m.push(w,M,T),(l!==n-1||h<Math.PI)&&m.push(M,S,T)}this.setIndex(m),this.setAttribute("position",new pn(f,3)),this.setAttribute("normal",new pn(g,3)),this.setAttribute("uv",new pn(v,2))}function ws(t,e,n,i,r,o){Zn.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Ms(t,e,n,i,r,o)),this.mergeVertices()}function Ms(t,e,n,i,r,o){Sn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},t=t||.5,e=e||1,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var a,s,l,h=[],c=[],u=[],d=[],p=t,m=(e-t)/(i=void 0!==i?Math.max(1,i):1),f=new Ot,g=new xt;for(s=0;s<=i;s++){for(l=0;l<=n;l++)a=r+l/n*o,f.x=p*Math.cos(a),f.y=p*Math.sin(a),c.push(f.x,f.y,f.z),u.push(0,0,1),g.x=(f.x/e+1)/2,g.y=(f.y/e+1)/2,d.push(g.x,g.y);p+=m}for(s=0;s<i;s++){var v=s*(n+1);for(l=0;l<n;l++){var y=a=l+v,b=a+n+1,_=a+n+2,x=a+1;h.push(y,b,x),h.push(b,_,x)}}this.setIndex(h),this.setAttribute("position",new pn(c,3)),this.setAttribute("normal",new pn(u,3)),this.setAttribute("uv",new pn(d,2))}function Ss(t,e,n,i){Zn.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},this.fromBufferGeometry(new Ts(t,e,n,i)),this.mergeVertices()}function Ts(t,e,n,i){Sn.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e)||12,n=n||0,i=i||2*Math.PI,i=_t.clamp(i,0,2*Math.PI);var r,o,a,s=[],l=[],h=[],c=1/e,u=new Ot,d=new xt;for(o=0;o<=e;o++){var p=n+o*c*i,m=Math.sin(p),f=Math.cos(p);for(a=0;a<=t.length-1;a++)u.x=t[a].x*m,u.y=t[a].y,u.z=t[a].x*f,l.push(u.x,u.y,u.z),d.x=o/e,d.y=a/(t.length-1),h.push(d.x,d.y)}for(o=0;o<e;o++)for(a=0;a<t.length-1;a++){var g=r=a+o*t.length,v=r+t.length,y=r+t.length+1,b=r+1;s.push(g,v,b),s.push(v,y,b)}if(this.setIndex(s),this.setAttribute("position",new pn(l,3)),this.setAttribute("uv",new pn(h,2)),this.computeVertexNormals(),i===2*Math.PI){var _=this.attributes.normal.array,x=new Ot,w=new Ot,M=new Ot;for(r=e*t.length*3,o=0,a=0;o<t.length;o++,a+=3)x.x=_[a+0],x.y=_[a+1],x.z=_[a+2],w.x=_[r+a+0],w.y=_[r+a+1],w.z=_[r+a+2],M.addVectors(x,w).normalize(),_[a+0]=_[r+a+0]=M.x,_[a+1]=_[r+a+1]=M.y,_[a+2]=_[r+a+2]=M.z}}function Es(t,e){Zn.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new As(t,e)),this.mergeVertices()}function As(t,e){Sn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var n=[],i=[],r=[],o=[],a=0,s=0;if(!1===Array.isArray(t))h(t);else for(var l=0;l<t.length;l++)h(t[l]),this.addGroup(a,s,l),a+=s,s=0;function h(t){var a,l,h,c=i.length/3,u=t.extractPoints(e),d=u.shape,p=u.holes;for(!1===us.isClockWise(d)&&(d=d.reverse()),a=0,l=p.length;a<l;a++)h=p[a],!0===us.isClockWise(h)&&(p[a]=h.reverse());var m=us.triangulateShape(d,p);for(a=0,l=p.length;a<l;a++)h=p[a],d=d.concat(h);for(a=0,l=d.length;a<l;a++){var f=d[a];i.push(f.x,f.y,0),r.push(0,0,1),o.push(f.x,f.y)}for(a=0,l=m.length;a<l;a++){var g=m[a],v=g[0]+c,y=g[1]+c,b=g[2]+c;n.push(v,y,b),s+=3}}this.setIndex(n),this.setAttribute("position",new pn(i,3)),this.setAttribute("normal",new pn(r,3)),this.setAttribute("uv",new pn(o,2))}function Cs(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,i=t.length;n<i;n++){var r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}function Ps(t,e){Sn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var n,i,r,o,a=[],s=Math.cos(_t.DEG2RAD*e),l=[0,0],h={},c=["a","b","c"];t.isBufferGeometry?(o=new Zn).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var u=o.vertices,d=o.faces,p=0,m=d.length;p<m;p++)for(var f=d[p],g=0;g<3;g++)n=f[c[g]],i=f[c[(g+1)%3]],l[0]=Math.min(n,i),l[1]=Math.max(n,i),void 0===h[r=l[0]+","+l[1]]?h[r]={index1:l[0],index2:l[1],face1:p,face2:void 0}:h[r].face2=p;for(r in h){var v=h[r];if(void 0===v.face2||d[v.face1].normal.dot(d[v.face2].normal)<=s){var y=u[v.index1];a.push(y.x,y.y,y.z),y=u[v.index2],a.push(y.x,y.y,y.z)}}this.setAttribute("position",new pn(a,3))}function Ls(t,e,n,i,r,o,a,s){Zn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Rs(t,e,n,i,r,o,a,s)),this.mergeVertices()}function Rs(t,e,n,i,r,o,a,s){Sn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s};var l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var h=[],c=[],u=[],d=[],p=0,m=[],f=n/2,g=0;function v(n){var r,o,m,v=new xt,y=new Ot,b=0,_=!0===n?t:e,x=!0===n?1:-1;for(o=p,r=1;r<=i;r++)c.push(0,f*x,0),u.push(0,x,0),d.push(.5,.5),p++;for(m=p,r=0;r<=i;r++){var w=r/i*s+a,M=Math.cos(w),S=Math.sin(w);y.x=_*S,y.y=f*x,y.z=_*M,c.push(y.x,y.y,y.z),u.push(0,x,0),v.x=.5*M+.5,v.y=.5*S*x+.5,d.push(v.x,v.y),p++}for(r=0;r<i;r++){var T=o+r,E=m+r;!0===n?h.push(E,E+1,T):h.push(E+1,E,T),b+=3}l.addGroup(g,b,!0===n?1:2),g+=b}!function(){var o,v,y=new Ot,b=new Ot,_=0,x=(e-t)/n;for(v=0;v<=r;v++){var w=[],M=v/r,S=M*(e-t)+t;for(o=0;o<=i;o++){var T=o/i,E=T*s+a,A=Math.sin(E),C=Math.cos(E);b.x=S*A,b.y=-M*n+f,b.z=S*C,c.push(b.x,b.y,b.z),y.set(A,x,C).normalize(),u.push(y.x,y.y,y.z),d.push(T,1-M),w.push(p++)}m.push(w)}for(o=0;o<i;o++)for(v=0;v<r;v++){var P=m[v][o],L=m[v+1][o],R=m[v+1][o+1],O=m[v][o+1];h.push(P,L,O),h.push(L,R,O),_+=6}l.addGroup(g,_,0),g+=_}(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new pn(c,3)),this.setAttribute("normal",new pn(u,3)),this.setAttribute("uv",new pn(d,2))}function Os(t,e,n,i,r,o,a){Ls.call(this,0,t,e,n,i,r,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}function Is(t,e,n,i,r,o,a){Rs.call(this,0,t,e,n,i,r,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}function Ns(t,e,n,i){Zn.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new Ds(t,e,n,i)),this.mergeVertices()}function Ds(t,e,n,i){Sn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},t=t||1,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var r,o,a=[],s=[],l=[],h=[],c=new Ot,u=new xt;for(s.push(0,0,0),l.push(0,0,1),h.push(.5,.5),o=0,r=3;o<=e;o++,r+=3){var d=n+o/e*i;c.x=t*Math.cos(d),c.y=t*Math.sin(d),s.push(c.x,c.y,c.z),l.push(0,0,1),u.x=(s[r]/t+1)/2,u.y=(s[r+1]/t+1)/2,h.push(u.x,u.y)}for(r=1;r<=e;r++)a.push(r,r+1,0);this.setIndex(a),this.setAttribute("position",new pn(s,3)),this.setAttribute("normal",new pn(l,3)),this.setAttribute("uv",new pn(h,2))}ys.prototype=Object.create(Zn.prototype),ys.prototype.constructor=ys,bs.prototype=Object.create(fs.prototype),bs.prototype.constructor=bs,_s.prototype=Object.create(Zn.prototype),_s.prototype.constructor=_s,xs.prototype=Object.create(Sn.prototype),xs.prototype.constructor=xs,ws.prototype=Object.create(Zn.prototype),ws.prototype.constructor=ws,Ms.prototype=Object.create(Sn.prototype),Ms.prototype.constructor=Ms,Ss.prototype=Object.create(Zn.prototype),Ss.prototype.constructor=Ss,Ts.prototype=Object.create(Sn.prototype),Ts.prototype.constructor=Ts,Es.prototype=Object.create(Zn.prototype),Es.prototype.constructor=Es,Es.prototype.toJSON=function(){var t=Zn.prototype.toJSON.call(this);return Cs(this.parameters.shapes,t)},As.prototype=Object.create(Sn.prototype),As.prototype.constructor=As,As.prototype.toJSON=function(){var t=Sn.prototype.toJSON.call(this);return Cs(this.parameters.shapes,t)},Ps.prototype=Object.create(Sn.prototype),Ps.prototype.constructor=Ps,Ls.prototype=Object.create(Zn.prototype),Ls.prototype.constructor=Ls,Rs.prototype=Object.create(Sn.prototype),Rs.prototype.constructor=Rs,Os.prototype=Object.create(Ls.prototype),Os.prototype.constructor=Os,Is.prototype=Object.create(Rs.prototype),Is.prototype.constructor=Is,Ns.prototype=Object.create(Zn.prototype),Ns.prototype.constructor=Ns,Ds.prototype=Object.create(Sn.prototype),Ds.prototype.constructor=Ds;var Bs=Object.freeze({__proto__:null,WireframeGeometry:xa,ParametricGeometry:wa,ParametricBufferGeometry:Ma,TetrahedronGeometry:Ea,TetrahedronBufferGeometry:Aa,OctahedronGeometry:Ca,OctahedronBufferGeometry:Pa,IcosahedronGeometry:La,IcosahedronBufferGeometry:Ra,DodecahedronGeometry:Oa,DodecahedronBufferGeometry:Ia,PolyhedronGeometry:Sa,PolyhedronBufferGeometry:Ta,TubeGeometry:Na,TubeBufferGeometry:Da,TorusKnotGeometry:Ba,TorusKnotBufferGeometry:Fa,TorusGeometry:ka,TorusBufferGeometry:Ua,TextGeometry:ys,TextBufferGeometry:bs,SphereGeometry:_s,SphereBufferGeometry:xs,RingGeometry:ws,RingBufferGeometry:Ms,PlaneGeometry:di,PlaneBufferGeometry:pi,LatheGeometry:Ss,LatheBufferGeometry:Ts,ShapeGeometry:Es,ShapeBufferGeometry:As,ExtrudeGeometry:ms,ExtrudeBufferGeometry:fs,EdgesGeometry:Ps,ConeGeometry:Os,ConeBufferGeometry:Is,CylinderGeometry:Ls,CylinderBufferGeometry:Rs,CircleGeometry:Ns,CircleBufferGeometry:Ds,BoxGeometry:class extends Zn{constructor(t,e,n,i,r,o){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new Jn(t,e,n,i,r,o)),this.mergeVertices()}},BoxBufferGeometry:Jn});function Fs(t){en.call(this),this.type="ShadowMaterial",this.color=new Ze(0),this.transparent=!0,this.setValues(t)}function ks(t){ti.call(this,t),this.type="RawShaderMaterial"}function Us(t){en.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ze(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function zs(t){Us.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xt(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function Hs(t){en.call(this),this.type="MeshPhongMaterial",this.color=new Ze(16777215),this.specular=new Ze(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Gs(t){en.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ze(16777215),this.specular=new Ze(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Vs(t){en.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function js(t){en.call(this),this.type="MeshLambertMaterial",this.color=new Ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ze(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ws(t){en.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ze(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Xs(t){$o.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Fs.prototype=Object.create(en.prototype),Fs.prototype.constructor=Fs,Fs.prototype.isShadowMaterial=!0,Fs.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this},ks.prototype=Object.create(ti.prototype),ks.prototype.constructor=ks,ks.prototype.isRawShaderMaterial=!0,Us.prototype=Object.create(en.prototype),Us.prototype.constructor=Us,Us.prototype.isMeshStandardMaterial=!0,Us.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},zs.prototype=Object.create(Us.prototype),zs.prototype.constructor=zs,zs.prototype.isMeshPhysicalMaterial=!0,zs.prototype.copy=function(t){return Us.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Ze).copy(t.sheen):this.sheen=null,this.transparency=t.transparency,this},Hs.prototype=Object.create(en.prototype),Hs.prototype.constructor=Hs,Hs.prototype.isMeshPhongMaterial=!0,Hs.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Gs.prototype=Object.create(en.prototype),Gs.prototype.constructor=Gs,Gs.prototype.isMeshToonMaterial=!0,Gs.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Vs.prototype=Object.create(en.prototype),Vs.prototype.constructor=Vs,Vs.prototype.isMeshNormalMaterial=!0,Vs.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},js.prototype=Object.create(en.prototype),js.prototype.constructor=js,js.prototype.isMeshLambertMaterial=!0,js.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Ws.prototype=Object.create(en.prototype),Ws.prototype.constructor=Ws,Ws.prototype.isMeshMatcapMaterial=!0,Ws.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Xs.prototype=Object.create($o.prototype),Xs.prototype.constructor=Xs,Xs.prototype.isLineDashedMaterial=!0,Xs.prototype.copy=function(t){return $o.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Ys=Object.freeze({__proto__:null,ShadowMaterial:Fs,SpriteMaterial:_o,RawShaderMaterial:ks,ShaderMaterial:ti,PointsMaterial:ca,MeshPhysicalMaterial:zs,MeshStandardMaterial:Us,MeshPhongMaterial:Hs,MeshToonMaterial:Gs,MeshNormalMaterial:Vs,MeshLambertMaterial:js,MeshDepthMaterial:no,MeshDistanceMaterial:io,MeshBasicMaterial:nn,MeshMatcapMaterial:Ws,LineDashedMaterial:Xs,LineBasicMaterial:$o,Material:en}),qs={arraySlice:function(t,e,n){return qs.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=new Array(e),i=0;i!==e;++i)n[i]=i;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){for(var i=t.length,r=new t.constructor(i),o=0,a=0;a!==i;++o)for(var s=n[o]*e,l=0;l!==e;++l)r[a++]=t[s+l];return r},flattenJSON:function(t,e,n,i){for(var r=1,o=t[0];void 0!==o&&void 0===o[i];)o=t[r++];if(void 0!==o){var a=o[i];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[i])&&(e.push(o.time),n.push.apply(n,a)),o=t[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[i])&&(e.push(o.time),a.toArray(n,n.length)),o=t[r++]}while(void 0!==o);else do{void 0!==(a=o[i])&&(e.push(o.time),n.push(a)),o=t[r++]}while(void 0!==o)}},subclip:function(t,e,n,i,r){r=r||30;var o=t.clone();o.name=e;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],h=l.getValueSize(),c=[],u=[],d=0;d<l.times.length;++d){var p=l.times[d]*r;if(!(p<n||p>=i)){c.push(l.times[d]);for(var m=0;m<h;++m)u.push(l.values[d*h+m])}}0!==c.length&&(l.times=qs.convertArray(c,l.times.constructor),l.values=qs.convertArray(u,l.values.constructor),a.push(l))}o.tracks=a;var f=1/0;for(s=0;s<o.tracks.length;++s)f>o.tracks[s].times[0]&&(f=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*f);return o.resetDuration(),o},makeClipAdditive:function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=t),(void 0===i||i<=0)&&(i=30);for(var r=t.tracks.length,o=e/i,a=0;a<r;++a){var s=n.tracks[a],l=s.ValueTypeName;if("bool"!==l&&"string"!==l){var h=t.tracks.find((function(t){return t.name===s.name&&t.ValueTypeName===l}));if(void 0!==h){var c,u=s.getValueSize(),d=s.times.length-1;if(o<=s.times[0])c=qs.arraySlice(s.values,0,s.valueSize);else if(o>=s.times[d]){var p=d*u;c=qs.arraySlice(s.values,p)}else{var m=s.createInterpolant();m.evaluate(o),c=m.resultBuffer}if("quaternion"===l)new Pt(c[0],c[1],c[2],c[3]).normalize().conjugate().toArray(c);for(var f=h.times.length,g=0;g<f;++g){var v=g*u;if("quaternion"===l)Pt.multiplyQuaternionsFlat(h.values,v,c,0,h.values,v);else for(var y=0;y<u;++y)h.values[v+y]-=c[y]}}}}return t.blendMode=2501,t}};function Zs(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function Js(t,e,n,i){Zs.call(this,t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Ks(t,e,n,i){Zs.call(this,t,e,n,i)}function Qs(t,e,n,i){Zs.call(this,t,e,n,i)}function $s(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=qs.convertArray(e,this.TimeBufferType),this.values=qs.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function tl(t,e,n){$s.call(this,t,e,n)}function el(t,e,n,i){$s.call(this,t,e,n,i)}function nl(t,e,n,i){$s.call(this,t,e,n,i)}function il(t,e,n,i){Zs.call(this,t,e,n,i)}function rl(t,e,n,i){$s.call(this,t,e,n,i)}function ol(t,e,n,i){$s.call(this,t,e,n,i)}function al(t,e,n,i){$s.call(this,t,e,n,i)}function sl(t,e,n,i){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==i?i:2500,this.uuid=_t.generateUUID(),this.duration<0&&this.resetDuration()}function ll(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return nl;case"vector":case"vector2":case"vector3":case"vector4":return al;case"color":return el;case"quaternion":return rl;case"bool":case"boolean":return tl;case"string":return ol}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var n=[],i=[];qs.flattenJSON(t.keys,n,i,"value"),t.times=n,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(Zs.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{var o;n:{i:if(!(t<i)){for(var a=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===a)break;if(r=i,t<(i=e[++n]))break e}o=e.length;break n}if(t>=r)break t;var s=e[1];t<s&&(n=2,r=s);for(a=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===a)break;if(i=r,t>=(r=e[--n-1]))break e}o=n,n=0}for(;n<o;){var l=n+o>>>1;t<e[l]?o=l:n=l+1}if(i=e[n],void 0===(r=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i,o=0;o!==i;++o)e[o]=n[r+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Zs.prototype,{beforeStart_:Zs.prototype.copySampleValue_,afterEnd_:Zs.prototype.copySampleValue_}),Js.prototype=Object.assign(Object.create(Zs.prototype),{constructor:Js,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,n){var i=this.parameterPositions,r=t-2,o=t+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=t,a=2*e-n;break;case 2402:a=e+i[r=i.length-2]-i[r+1];break;default:r=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=t,s=2*n-e;break;case 2402:o=1,s=n+i[1]-i[0];break;default:o=t-1,s=e}var l=.5*(n-e),h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(s-n),this._offsetPrev=r*h,this._offsetNext=o*h},interpolate_:function(t,e,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),m=p*p,f=m*p,g=-u*f+2*u*m-u*p,v=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,y=(-1-d)*f+(1.5+d)*m+.5*p,b=d*f-d*m,_=0;_!==a;++_)r[_]=g*o[h+_]+v*o[l+_]+y*o[s+_]+b*o[c+_];return r}}),Ks.prototype=Object.assign(Object.create(Zs.prototype),{constructor:Ks,interpolate_:function(t,e,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,h=(n-e)/(i-e),c=1-h,u=0;u!==a;++u)r[u]=o[l+u]*c+o[s+u]*h;return r}}),Qs.prototype=Object.assign(Object.create(Zs.prototype),{constructor:Qs,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign($s,{toJSON:function(t){var e,n=t.constructor;if(void 0!==n.toJSON)e=n.toJSON(t);else{e={name:t.name,times:qs.convertArray(t.times,Array),values:qs.convertArray(t.values,Array)};var i=t.getInterpolation();i!==t.DefaultInterpolation&&(e.interpolation=i)}return e.type=t.ValueTypeName,e}}),Object.assign($s.prototype,{constructor:$s,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new Qs(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Ks(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Js(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,i=e.length;n!==i;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,i=e.length;n!==i;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,i=n.length,r=0,o=i-1;r!==i&&n[r]<t;)++r;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==r||o!==i){r>=o&&(r=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=qs.arraySlice(n,r,o),this.values=qs.arraySlice(this.values,r*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,a=0;a!==r;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),t=!1;break}o=s}if(void 0!==i&&qs.isTypedArray(i)){a=0;for(var l=i.length;a!==l;++a){var h=i[a];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,h),t=!1;break}}}return t},optimize:function(){for(var t=qs.arraySlice(this.times),e=qs.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),r=1,o=t.length-1,a=1;a<o;++a){var s=!1,l=t[a];if(l!==t[a+1]&&(1!==a||l!==l[0]))if(i)s=!0;else for(var h=a*n,c=h-n,u=h+n,d=0;d!==n;++d){var p=e[h+d];if(p!==e[c+d]||p!==e[u+d]){s=!0;break}}if(s){if(a!==r){t[r]=t[a];var m=a*n,f=r*n;for(d=0;d!==n;++d)e[f+d]=e[m+d]}++r}}if(o>0){t[r]=t[o];for(m=o*n,f=r*n,d=0;d!==n;++d)e[f+d]=e[m+d];++r}return r!==t.length?(this.times=qs.arraySlice(t,0,r),this.values=qs.arraySlice(e,0,r*n)):(this.times=t,this.values=e),this},clone:function(){var t=qs.arraySlice(this.times,0),e=qs.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),tl.prototype=Object.assign(Object.create($s.prototype),{constructor:tl,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),el.prototype=Object.assign(Object.create($s.prototype),{constructor:el,ValueTypeName:"color"}),nl.prototype=Object.assign(Object.create($s.prototype),{constructor:nl,ValueTypeName:"number"}),il.prototype=Object.assign(Object.create(Zs.prototype),{constructor:il,interpolate_:function(t,e,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=(n-e)/(i-e),h=s+a;s!==h;s+=4)Pt.slerpFlat(r,0,o,s-a,o,s,l);return r}}),rl.prototype=Object.assign(Object.create($s.prototype),{constructor:rl,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new il(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),ol.prototype=Object.assign(Object.create($s.prototype),{constructor:ol,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),al.prototype=Object.assign(Object.create($s.prototype),{constructor:al,ValueTypeName:"vector"}),Object.assign(sl,{parse:function(t){for(var e=[],n=t.tracks,i=1/(t.fps||1),r=0,o=n.length;r!==o;++r)e.push(ll(n[r]).scale(i));return new sl(t.name,t.duration,e,t.blendMode)},toJSON:function(t){for(var e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},r=0,o=n.length;r!==o;++r)e.push($s.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(t,e,n,i){for(var r=e.length,o=[],a=0;a<r;a++){var s=[],l=[];s.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);var h=qs.getKeyframeOrder(s);s=qs.sortedArray(s,1,h),l=qs.sortedArray(l,1,h),i||0!==s[0]||(s.push(r),l.push(l[0])),o.push(new nl(".morphTargetInfluences["+e[a].name+"]",s,l).scale(1/n))}return new sl(t,-1,o)},findByName:function(t,e){var n=t;if(!Array.isArray(t)){var i=t;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],l=s.name.match(r);if(l&&l.length>1){var h=i[u=l[1]];h||(i[u]=h=[]),h.push(s)}}var c=[];for(var u in i)c.push(sl.CreateFromMorphTargetSequence(u,i[u],e,n));return c},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(t,e,n,i,r){if(0!==n.length){var o=[],a=[];qs.flattenJSON(n,o,a,i),0!==o.length&&r.push(new t(e,o,a))}},i=[],r=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.blendMode,l=t.hierarchy||[],h=0;h<l.length;h++){var c=l[h].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},d=0;d<c.length;d++)if(c[d].morphTargets)for(var p=0;p<c[d].morphTargets.length;p++)u[c[d].morphTargets[p]]=-1;for(var m in u){var f=[],g=[];for(p=0;p!==c[d].morphTargets.length;++p){var v=c[d];f.push(v.time),g.push(v.morphTarget===m?1:0)}i.push(new nl(".morphTargetInfluence["+m+"]",f,g))}o=u.length*(a||1)}else{var y=".bones["+e[h].name+"]";n(al,y+".position",c,"pos",i),n(rl,y+".quaternion",c,"rot",i),n(al,y+".scale",c,"scl",i)}}return 0===i.length?null:new sl(r,o,i,s)}}),Object.assign(sl.prototype,{resetDuration:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new sl(this.name,this.duration,t,this.blendMode)}});var hl={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function cl(t,e,n){var i=this,r=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===r&&void 0!==i.onStart&&i.onStart(t,o,a),r=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){var e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(var e=0,n=l.length;e<n;e+=2){var i=l[e],r=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return r}return null}}var ul=new cl;function dl(t){this.manager=void 0!==t?t:ul,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(dl.prototype,{load:function(){},loadAsync:function(t,e){var n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}});var pl={};function ml(t){dl.call(this,t)}function fl(t){dl.call(this,t)}function gl(t){dl.call(this,t)}function vl(t){dl.call(this,t)}function yl(t){dl.call(this,t)}function bl(t){dl.call(this,t)}function _l(t){dl.call(this,t)}function xl(){this.type="Curve",this.arcLengthDivisions=200}function wl(t,e,n,i,r,o,a,s){xl.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Ml(t,e,n,i,r,o){wl.call(this,t,e,n,n,i,r,o),this.type="ArcCurve"}function Sl(){var t=0,e=0,n=0,i=0;function r(r,o,a,s){t=r,e=a,n=-3*r+3*o-2*a-s,i=2*r-2*o+a+s}return{initCatmullRom:function(t,e,n,i,o){r(e,n,o*(n-t),o*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,o,a,s){var l=(e-t)/o-(n-t)/(o+a)+(n-e)/a,h=(n-e)/a-(i-e)/(a+s)+(i-n)/s;r(e,n,l*=a,h*=a)},calc:function(r){var o=r*r;return t+e*r+n*o+i*(o*r)}}}ml.prototype=Object.assign(Object.create(dl.prototype),{constructor:ml,load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,o=hl.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout((function(){e&&e(o),r.manager.itemEnd(t)}),0),o;if(void 0===pl[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],h=a[3];h=decodeURIComponent(h),l&&(h=atob(h));try{var c,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var d=new Uint8Array(h.length),p=0;p<h.length;p++)d[p]=h.charCodeAt(p);c="blob"===u?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var m=new DOMParser;c=m.parseFromString(h,s);break;case"json":c=JSON.parse(h);break;default:c=h}setTimeout((function(){e&&e(c),r.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}),0)}}else{pl[t]=[],pl[t].push({onLoad:e,onProgress:n,onError:i});var f=new XMLHttpRequest;for(var g in f.open("GET",t,!0),f.addEventListener("load",(function(e){var n=this.response,i=pl[t];if(delete pl[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),hl.add(t,n);for(var o=0,a=i.length;o<a;o++){(s=i[o]).onLoad&&s.onLoad(n)}r.manager.itemEnd(t)}else{for(o=0,a=i.length;o<a;o++){var s;(s=i[o]).onError&&s.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}}),!1),f.addEventListener("progress",(function(e){for(var n=pl[t],i=0,r=n.length;i<r;i++){var o=n[i];o.onProgress&&o.onProgress(e)}}),!1),f.addEventListener("error",(function(e){var n=pl[t];delete pl[t];for(var i=0,o=n.length;i<o;i++){var a=n[i];a.onError&&a.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}),!1),f.addEventListener("abort",(function(e){var n=pl[t];delete pl[t];for(var i=0,o=n.length;i<o;i++){var a=n[i];a.onError&&a.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(f.responseType=this.responseType),void 0!==this.withCredentials&&(f.withCredentials=this.withCredentials),f.overrideMimeType&&f.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)f.setRequestHeader(g,this.requestHeader[g]);f.send(null)}return r.manager.itemStart(t),f}pl[t].push({onLoad:e,onProgress:n,onError:i})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),fl.prototype=Object.assign(Object.create(dl.prototype),{constructor:fl,load:function(t,e,n,i){var r=this,o=new ml(r.manager);o.setPath(r.path),o.load(t,(function(t){e(r.parse(JSON.parse(t)))}),n,i)},parse:function(t){for(var e=[],n=0;n<t.length;n++){var i=sl.parse(t[n]);e.push(i)}return e}}),gl.prototype=Object.assign(Object.create(dl.prototype),{constructor:gl,load:function(t,e,n,i){var r=this,o=[],a=new ya;a.image=o;var s=new ml(this.manager);function l(l){s.load(t[l],(function(t){var n=r.parse(t,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(h+=1)&&(1===n.mipmapCount&&(a.minFilter=1006),a.format=n.format,a.needsUpdate=!0,e&&e(a))}),n,i)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var h=0,c=0,u=t.length;c<u;++c)l(c);else s.load(t,(function(t){var n=r.parse(t,!0);if(n.isCubemap)for(var i=n.mipmaps.length/n.mipmapCount,s=0;s<i;s++){o[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=1006),a.format=n.format,a.needsUpdate=!0,e&&e(a)}),n,i);return a}}),vl.prototype=Object.assign(Object.create(dl.prototype),{constructor:vl,load:function(t,e,n,i){var r=this,o=new oi,a=new ml(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(t,(function(t){var n=r.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:1001,o.wrapT=void 0!==n.wrapT?n.wrapT:1001,o.magFilter=void 0!==n.magFilter?n.magFilter:1006,o.minFilter=void 0!==n.minFilter?n.minFilter:1006,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=1008),1===n.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,e&&e(o,n))}),n,i),o}}),yl.prototype=Object.assign(Object.create(dl.prototype),{constructor:yl,load:function(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,o=hl.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout((function(){e&&e(o),r.manager.itemEnd(t)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),hl.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}),bl.prototype=Object.assign(Object.create(dl.prototype),{constructor:bl,load:function(t,e,n,i){var r=new Ai,o=new yl(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(t[n],(function(t){r.images[n]=t,6===++a&&(r.needsUpdate=!0,e&&e(r))}),void 0,i)}for(var l=0;l<t.length;++l)s(l);return r}}),_l.prototype=Object.assign(Object.create(dl.prototype),{constructor:_l,load:function(t,e,n,i){var r=new Tt,o=new yl(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(n){r.image=n;var i=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);r.format=i?1022:1023,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}),Object.assign(xl.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n,i=[],r=this.getPoint(0),o=0;for(i.push(0),n=1;n<=t;n++)o+=(e=this.getPoint(n/t)).distanceTo(r),i.push(o),r=e;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n,i=this.getLengths(),r=0,o=i.length;n=e||t*i[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=i[r=Math.floor(s+(l-s)/2)]-n)<0)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(i[r=l]===n)return r/(o-1);var h=i[r];return(r+(n-h)/(i[r+1]-h))/(o-1)},getTangent:function(t,e){var n=t-1e-4,i=t+1e-4;n<0&&(n=0),i>1&&(i=1);var r=this.getPoint(n),o=this.getPoint(i),a=e||(r.isVector2?new xt:new Ot);return a.copy(o).sub(r).normalize(),a},getTangentAt:function(t,e){var n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){var n,i,r,o=new Ot,a=[],s=[],l=[],h=new Ot,c=new zt;for(n=0;n<=t;n++)i=n/t,a[n]=this.getTangentAt(i,new Ot),a[n].normalize();s[0]=new Ot,l[0]=new Ot;var u=Number.MAX_VALUE,d=Math.abs(a[0].x),p=Math.abs(a[0].y),m=Math.abs(a[0].z);for(d<=u&&(u=d,o.set(1,0,0)),p<=u&&(u=p,o.set(0,1,0)),m<=u&&o.set(0,0,1),h.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],h),l[0].crossVectors(a[0],s[0]),n=1;n<=t;n++)s[n]=s[n-1].clone(),l[n]=l[n-1].clone(),h.crossVectors(a[n-1],a[n]),h.length()>Number.EPSILON&&(h.normalize(),r=Math.acos(_t.clamp(a[n-1].dot(a[n]),-1,1)),s[n].applyMatrix4(c.makeRotationAxis(h,r))),l[n].crossVectors(a[n],s[n]);if(!0===e)for(r=Math.acos(_t.clamp(s[0].dot(s[t]),-1,1)),r/=t,a[0].dot(h.crossVectors(s[0],s[t]))>0&&(r=-r),n=1;n<=t;n++)s[n].applyMatrix4(c.makeRotationAxis(a[n],r*n)),l[n].crossVectors(a[n],s[n]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),wl.prototype=Object.create(xl.prototype),wl.prototype.constructor=wl,wl.prototype.isEllipseCurve=!0,wl.prototype.getPoint=function(t,e){for(var n=e||new xt,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,o=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=o?0:i),!0!==this.aClockwise||o||(r===i?r=-i:r-=i);var a=this.aStartAngle+t*r,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var h=Math.cos(this.aRotation),c=Math.sin(this.aRotation),u=s-this.aX,d=l-this.aY;s=u*h-d*c+this.aX,l=u*c+d*h+this.aY}return n.set(s,l)},wl.prototype.copy=function(t){return xl.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},wl.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},wl.prototype.fromJSON=function(t){return xl.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Ml.prototype=Object.create(wl.prototype),Ml.prototype.constructor=Ml,Ml.prototype.isArcCurve=!0;var Tl=new Ot,El=new Sl,Al=new Sl,Cl=new Sl;function Pl(t,e,n,i){xl.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=i||.5}function Ll(t,e,n,i,r){var o=.5*(i-e),a=.5*(r-n),s=t*t;return(2*n-2*i+o+a)*(t*s)+(-3*n+3*i-2*o-a)*s+o*t+n}function Rl(t,e,n,i){return function(t,e){var n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function Ol(t,e,n,i,r){return function(t,e){var n=1-t;return n*n*n*e}(t,e)+function(t,e){var n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}function Il(t,e,n,i){xl.call(this),this.type="CubicBezierCurve",this.v0=t||new xt,this.v1=e||new xt,this.v2=n||new xt,this.v3=i||new xt}function Nl(t,e,n,i){xl.call(this),this.type="CubicBezierCurve3",this.v0=t||new Ot,this.v1=e||new Ot,this.v2=n||new Ot,this.v3=i||new Ot}function Dl(t,e){xl.call(this),this.type="LineCurve",this.v1=t||new xt,this.v2=e||new xt}function Bl(t,e){xl.call(this),this.type="LineCurve3",this.v1=t||new Ot,this.v2=e||new Ot}function Fl(t,e,n){xl.call(this),this.type="QuadraticBezierCurve",this.v0=t||new xt,this.v1=e||new xt,this.v2=n||new xt}function kl(t,e,n){xl.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Ot,this.v1=e||new Ot,this.v2=n||new Ot}function Ul(t){xl.call(this),this.type="SplineCurve",this.points=t||[]}Pl.prototype=Object.create(xl.prototype),Pl.prototype.constructor=Pl,Pl.prototype.isCatmullRomCurve3=!0,Pl.prototype.getPoint=function(t,e){var n,i,r,o,a=e||new Ot,s=this.points,l=s.length,h=(l-(this.closed?0:1))*t,c=Math.floor(h),u=h-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:0===u&&c===l-1&&(c=l-2,u=1),this.closed||c>0?n=s[(c-1)%l]:(Tl.subVectors(s[0],s[1]).add(s[0]),n=Tl),i=s[c%l],r=s[(c+1)%l],this.closed||c+2<l?o=s[(c+2)%l]:(Tl.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=Tl),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(r),d),f=Math.pow(r.distanceToSquared(o),d);m<1e-4&&(m=1),p<1e-4&&(p=m),f<1e-4&&(f=m),El.initNonuniformCatmullRom(n.x,i.x,r.x,o.x,p,m,f),Al.initNonuniformCatmullRom(n.y,i.y,r.y,o.y,p,m,f),Cl.initNonuniformCatmullRom(n.z,i.z,r.z,o.z,p,m,f)}else"catmullrom"===this.curveType&&(El.initCatmullRom(n.x,i.x,r.x,o.x,this.tension),Al.initCatmullRom(n.y,i.y,r.y,o.y,this.tension),Cl.initCatmullRom(n.z,i.z,r.z,o.z,this.tension));return a.set(El.calc(u),Al.calc(u),Cl.calc(u)),a},Pl.prototype.copy=function(t){xl.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Pl.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Pl.prototype.fromJSON=function(t){xl.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e];this.points.push((new Ot).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Il.prototype=Object.create(xl.prototype),Il.prototype.constructor=Il,Il.prototype.isCubicBezierCurve=!0,Il.prototype.getPoint=function(t,e){var n=e||new xt,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Ol(t,i.x,r.x,o.x,a.x),Ol(t,i.y,r.y,o.y,a.y)),n},Il.prototype.copy=function(t){return xl.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Il.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Il.prototype.fromJSON=function(t){return xl.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Nl.prototype=Object.create(xl.prototype),Nl.prototype.constructor=Nl,Nl.prototype.isCubicBezierCurve3=!0,Nl.prototype.getPoint=function(t,e){var n=e||new Ot,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Ol(t,i.x,r.x,o.x,a.x),Ol(t,i.y,r.y,o.y,a.y),Ol(t,i.z,r.z,o.z,a.z)),n},Nl.prototype.copy=function(t){return xl.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Nl.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Nl.prototype.fromJSON=function(t){return xl.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Dl.prototype=Object.create(xl.prototype),Dl.prototype.constructor=Dl,Dl.prototype.isLineCurve=!0,Dl.prototype.getPoint=function(t,e){var n=e||new xt;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Dl.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Dl.prototype.getTangent=function(t,e){return(e||new xt).copy(this.v2).sub(this.v1).normalize()},Dl.prototype.copy=function(t){return xl.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Dl.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Dl.prototype.fromJSON=function(t){return xl.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Bl.prototype=Object.create(xl.prototype),Bl.prototype.constructor=Bl,Bl.prototype.isLineCurve3=!0,Bl.prototype.getPoint=function(t,e){var n=e||new Ot;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},Bl.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Bl.prototype.copy=function(t){return xl.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Bl.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Bl.prototype.fromJSON=function(t){return xl.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Fl.prototype=Object.create(xl.prototype),Fl.prototype.constructor=Fl,Fl.prototype.isQuadraticBezierCurve=!0,Fl.prototype.getPoint=function(t,e){var n=e||new xt,i=this.v0,r=this.v1,o=this.v2;return n.set(Rl(t,i.x,r.x,o.x),Rl(t,i.y,r.y,o.y)),n},Fl.prototype.copy=function(t){return xl.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Fl.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Fl.prototype.fromJSON=function(t){return xl.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},kl.prototype=Object.create(xl.prototype),kl.prototype.constructor=kl,kl.prototype.isQuadraticBezierCurve3=!0,kl.prototype.getPoint=function(t,e){var n=e||new Ot,i=this.v0,r=this.v1,o=this.v2;return n.set(Rl(t,i.x,r.x,o.x),Rl(t,i.y,r.y,o.y),Rl(t,i.z,r.z,o.z)),n},kl.prototype.copy=function(t){return xl.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},kl.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},kl.prototype.fromJSON=function(t){return xl.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Ul.prototype=Object.create(xl.prototype),Ul.prototype.constructor=Ul,Ul.prototype.isSplineCurve=!0,Ul.prototype.getPoint=function(t,e){var n=e||new xt,i=this.points,r=(i.length-1)*t,o=Math.floor(r),a=r-o,s=i[0===o?o:o-1],l=i[o],h=i[o>i.length-2?i.length-1:o+1],c=i[o>i.length-3?i.length-1:o+2];return n.set(Ll(a,s.x,l.x,h.x,c.x),Ll(a,s.y,l.y,h.y,c.y)),n},Ul.prototype.copy=function(t){xl.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e];this.points.push(i.clone())}return this},Ul.prototype.toJSON=function(){var t=xl.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var i=this.points[e];t.points.push(i.toArray())}return t},Ul.prototype.fromJSON=function(t){xl.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e];this.points.push((new xt).fromArray(i))}return this};var zl=Object.freeze({__proto__:null,ArcCurve:Ml,CatmullRomCurve3:Pl,CubicBezierCurve:Il,CubicBezierCurve3:Nl,EllipseCurve:wl,LineCurve:Dl,LineCurve3:Bl,QuadraticBezierCurve:Fl,QuadraticBezierCurve3:kl,SplineCurve:Ul});function Hl(){xl.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Gl(t){Hl.call(this),this.type="Path",this.currentPoint=new xt,t&&this.setFromPoints(t)}function Vl(t){Gl.call(this,t),this.uuid=_t.generateUUID(),this.type="Shape",this.holes=[]}function jl(t,e){re.call(this),this.type="Light",this.color=new Ze(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Wl(t,e,n){jl.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(re.DefaultUp),this.updateMatrix(),this.groundColor=new Ze(e)}function Xl(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new xt(512,512),this.map=null,this.mapPass=null,this.matrix=new zt,this._frustum=new li,this._frameExtents=new xt(1,1),this._viewportCount=1,this._viewports=[new Et(0,0,1,1)]}function Yl(){Xl.call(this,new ni(50,1,.5,500))}function ql(t,e,n,i,r,o){jl.call(this,t,e),this.type="SpotLight",this.position.copy(re.DefaultUp),this.updateMatrix(),this.target=new re,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new Yl}function Zl(){Xl.call(this,new ni(90,1,.5,500)),this._frameExtents=new xt(4,2),this._viewportCount=6,this._viewports=[new Et(2,1,1,1),new Et(0,1,1,1),new Et(3,1,1,1),new Et(1,1,1,1),new Et(3,0,1,1),new Et(1,0,1,1)],this._cubeDirections=[new Ot(1,0,0),new Ot(-1,0,0),new Ot(0,0,1),new Ot(0,0,-1),new Ot(0,1,0),new Ot(0,-1,0)],this._cubeUps=[new Ot(0,1,0),new Ot(0,1,0),new Ot(0,1,0),new Ot(0,1,0),new Ot(0,0,1),new Ot(0,0,-1)]}function Jl(t,e,n,i){jl.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new Zl}function Kl(t,e,n,i,r,o){ei.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Ql(){Xl.call(this,new Kl(-5,5,5,-5,.5,500))}function $l(t,e){jl.call(this,t,e),this.type="DirectionalLight",this.position.copy(re.DefaultUp),this.updateMatrix(),this.target=new re,this.shadow=new Ql}function th(t,e){jl.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function eh(t,e,n,i){jl.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}function nh(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Ot)}function ih(t,e){jl.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new nh}function rh(t){dl.call(this,t),this.textures={}}Hl.prototype=Object.assign(Object.create(xl.prototype),{constructor:Hl,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Dl(e,t))},getPoint:function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=e){var r=n[i]-e,o=this.curves[i],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}i++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,n=[],i=0,r=this.curves;i<r.length;i++)for(var o=r[i],a=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),l=0;l<s.length;l++){var h=s[l];e&&e.equals(h)||(n.push(h),e=h)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(t){xl.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=xl.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++){var i=this.curves[e];t.curves.push(i.toJSON())}return t},fromJSON:function(t){xl.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var i=t.curves[e];this.curves.push((new zl[i.type]).fromJSON(i))}return this}}),Gl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Gl,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var n=new Dl(this.currentPoint.clone(),new xt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,i){var r=new Fl(this.currentPoint.clone(),new xt(t,e),new xt(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(t,e,n,i,r,o){var a=new Il(this.currentPoint.clone(),new xt(t,e),new xt(n,i),new xt(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this},splineThru:function(t){var e=new Ul([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,i,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,n,i,r,o),this},absarc:function(t,e,n,i,r,o){return this.absellipse(t,e,n,n,i,r,o),this},ellipse:function(t,e,n,i,r,o,a,s){var l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,n,i,r,o,a,s),this},absellipse:function(t,e,n,i,r,o,a,s){var l=new wl(t,e,n,i,r,o,a,s);if(this.curves.length>0){var h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return Hl.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=Hl.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return Hl.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Vl.prototype=Object.assign(Object.create(Gl.prototype),{constructor:Vl,getPointsHoles:function(t){for(var e=[],n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Gl.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var i=t.holes[e];this.holes.push(i.clone())}return this},toJSON:function(){var t=Gl.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++){var i=this.holes[e];t.holes.push(i.toJSON())}return t},fromJSON:function(t){Gl.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var i=t.holes[e];this.holes.push((new Gl).fromJSON(i))}return this}}),jl.prototype=Object.assign(Object.create(re.prototype),{constructor:jl,isLight:!0,copy:function(t){return re.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=re.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Wl.prototype=Object.assign(Object.create(jl.prototype),{constructor:Wl,isHemisphereLight:!0,copy:function(t){return jl.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Xl.prototype,{_projScreenMatrix:new zt,_lightPositionWorld:new Ot,_lookTarget:new Ot,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),r.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(r),e.updateMatrixWorld(),i.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Yl.prototype=Object.assign(Object.create(Xl.prototype),{constructor:Yl,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,n=2*_t.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),Xl.prototype.updateMatrices.call(this,t)}}),ql.prototype=Object.assign(Object.create(jl.prototype),{constructor:ql,isSpotLight:!0,copy:function(t){return jl.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Zl.prototype=Object.assign(Object.create(Xl.prototype),{constructor:Zl,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);var n=this.camera,i=this.matrix,r=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;r.setFromMatrixPosition(t.matrixWorld),n.position.copy(r),o.copy(n.position),o.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(o),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),Jl.prototype=Object.assign(Object.create(jl.prototype),{constructor:Jl,isPointLight:!0,copy:function(t){return jl.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Kl.prototype=Object.assign(Object.create(ei.prototype),{constructor:Kl,isOrthographicCamera:!0,copy:function(t,e){return ei.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-t,o=n+t,a=i+e,s=i-e;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(r+=l*this.view.offsetX)+l*this.view.width,s=(a-=h*this.view.offsetY)-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=re.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Ql.prototype=Object.assign(Object.create(Xl.prototype),{constructor:Ql,isDirectionalLightShadow:!0,updateMatrices:function(t){Xl.prototype.updateMatrices.call(this,t)}}),$l.prototype=Object.assign(Object.create(jl.prototype),{constructor:$l,isDirectionalLight:!0,copy:function(t){return jl.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),th.prototype=Object.assign(Object.create(jl.prototype),{constructor:th,isAmbientLight:!0}),eh.prototype=Object.assign(Object.create(jl.prototype),{constructor:eh,isRectAreaLight:!0,copy:function(t){return jl.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=jl.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(nh.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*i),e.addScaledVector(o[2],.488603*r),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*i*1.092548),e.addScaledVector(o[5],i*r*1.092548),e.addScaledVector(o[6],.315392*(3*r*r-1)),e.addScaledVector(o[7],n*r*1.092548),e.addScaledVector(o[8],.546274*(n*n-i*i)),e},getIrradianceAt:function(t,e){var n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*i),e.addScaledVector(o[2],1.023328*r),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*i),e.addScaledVector(o[5],.858086*i*r),e.addScaledVector(o[6],.743125*r*r-.247708),e.addScaledVector(o[7],.858086*n*r),e.addScaledVector(o[8],.429043*(n*n-i*i)),e},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},addScaledSH:function(t,e){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var n=this.coefficients,i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}}),Object.assign(nh,{getBasisAt:function(t,e){var n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}),ih.prototype=Object.assign(Object.create(jl.prototype),{constructor:ih,isLightProbe:!0,copy:function(t){return jl.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){var e=jl.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),rh.prototype=Object.assign(Object.create(dl.prototype),{constructor:rh,load:function(t,e,n,i){var r=this,o=new ml(r.manager);o.setPath(r.path),o.load(t,(function(t){e(r.parse(JSON.parse(t)))}),n,i)},parse:function(t){var e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var i=new Ys[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=(new Ze).setHex(t.sheen)),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.vertexTangents&&(i.vertexTangents=t.vertexTangents),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var r in t.uniforms){var o=t.uniforms[r];switch(i.uniforms[r]={},o.type){case"t":i.uniforms[r].value=n(o.value);break;case"c":i.uniforms[r].value=(new Ze).setHex(o.value);break;case"v2":i.uniforms[r].value=(new xt).fromArray(o.value);break;case"v3":i.uniforms[r].value=(new Ot).fromArray(o.value);break;case"v4":i.uniforms[r].value=(new Et).fromArray(o.value);break;case"m3":i.uniforms[r].value=(new wt).fromArray(o.value);case"m4":i.uniforms[r].value=(new zt).fromArray(o.value);break;default:i.uniforms[r].value=o.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var a in t.extensions)i.extensions[a]=t.extensions[a];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=(new xt).fromArray(s)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new xt).fromArray(t.clearcoatNormalScale)),i},setTextures:function(t){return this.textures=t,this}});var oh=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},ah=function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)};function sh(){Sn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function lh(t,e,n,i){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),on.call(this,t,e,n),this.meshPerAttribute=i||1}function hh(t){dl.call(this,t)}sh.prototype=Object.assign(Object.create(Sn.prototype),{constructor:sh,isInstancedBufferGeometry:!0,copy:function(t){return Sn.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=Sn.prototype.toJSON.call(this);return t.maxInstancedCount=this.maxInstancedCount,t.isInstancedBufferGeometry=!0,t}}),lh.prototype=Object.assign(Object.create(on.prototype),{constructor:lh,isInstancedBufferAttribute:!0,copy:function(t){return on.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=on.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),hh.prototype=Object.assign(Object.create(dl.prototype),{constructor:hh,load:function(t,e,n,i){var r=this,o=new ml(r.manager);o.setPath(r.path),o.load(t,(function(t){e(r.parse(JSON.parse(t)))}),n,i)},parse:function(t){var e=t.isInstancedBufferGeometry?new sh:new Sn,n=t.data.index;if(void 0!==n){var i=new ch[n.type](n.array);e.setIndex(new on(i,1))}var r=t.data.attributes;for(var o in r){var a=r[o],s=(i=new ch[a.type](a.array),new(a.isInstancedBufferAttribute?lh:on)(i,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),e.setAttribute(o,s)}var l=t.data.morphAttributes;if(l)for(var o in l){for(var h=l[o],c=[],u=0,d=h.length;u<d;u++){a=h[u],s=new on(i=new ch[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),c.push(s)}e.morphAttributes[o]=c}t.data.morphTargetsRelative&&(e.morphTargetsRelative=!0);var p=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==p){u=0;for(var m=p.length;u!==m;++u){var f=p[u];e.addGroup(f.start,f.count,f.materialIndex)}}var g=t.data.boundingSphere;if(void 0!==g){var v=new Ot;void 0!==g.center&&v.fromArray(g.center),e.boundingSphere=new we(v,g.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var ch={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function uh(t){dl.call(this,t)}uh.prototype=Object.assign(Object.create(dl.prototype),{constructor:uh,load:function(t,e,n,i){var r=this,o=""===this.path?ah(t):this.path;this.resourcePath=this.resourcePath||o;var a=new ml(r.manager);a.setPath(this.path),a.load(t,(function(n){var o=null;try{o=JSON.parse(n)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,i)},parse:function(t,e){var n=this.parseShape(t.shapes),i=this.parseGeometries(t.geometries,n),r=this.parseImages(t.images,(function(){void 0!==e&&e(s)})),o=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,i,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var n=0,i=t.length;n<i;n++){var r=(new Vl).fromJSON(t[n]);e[r.uuid]=r}return e},parseGeometries:function(t,e){var n={};if(void 0!==t)for(var i=new hh,r=0,o=t.length;r<o;r++){var a,s=t[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Bs[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Bs[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Bs[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Bs[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Bs[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Bs[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Bs[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Bs[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Bs[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Bs[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Bs[s.type]((new zl[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Bs[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Bs[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],h=0,c=s.shapes.length;h<c;h++){var u=e[s.shapes[h]];l.push(u)}a=new Bs[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],h=0,c=s.shapes.length;h<c;h++){u=e[s.shapes[h]];l.push(u)}var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new zl[d.type]).fromJSON(d)),a=new Bs[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(s);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}return n},parseMaterials:function(t,e){var n={},i={};if(void 0!==t){var r=new rh;r.setTextures(e);for(var o=0,a=t.length;o<a;o++){var s=t[o];if("MultiMaterial"===s.type){for(var l=[],h=0;h<s.materials.length;h++){var c=s.materials[h];void 0===n[c.uuid]&&(n[c.uuid]=r.parse(c)),l.push(n[c.uuid])}i[s.uuid]=l}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i},parseAnimations:function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n],r=sl.parse(i);void 0!==i.uuid&&(r.uuid=i.uuid),e.push(r)}return e},parseImages:function(t,e){var n=this,i={};function r(t){return n.manager.itemStart(t),o.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){var o=new yl(new cl(e));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var l=t[a],h=l.url;if(Array.isArray(h)){i[l.uuid]=[];for(var c=0,u=h.length;c<u;c++){var d=h[c],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:n.resourcePath+d;i[l.uuid].push(r(p))}}else{p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:n.resourcePath+l.url;i[l.uuid]=r(p)}}}return i},parseTextures:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var i={};if(void 0!==t)for(var r=0,o=t.length;r<o;r++){var a,s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(e[s.image])?new Ai(e[s.image]):new Tt(e[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=n(s.mapping,ph)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=n(s.wrap[0],mh),a.wrapT=n(s.wrap[1],mh)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=n(s.minFilter,fh)),void 0!==s.magFilter&&(a.magFilter=n(s.magFilter,fh)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),i[s.uuid]=a}return i},parseObject:function(t,e,n){var i;function r(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],i=0,r=t.length;i<r;i++){var o=t[i];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(n[o])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":i=new oe,void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new Ze(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new fo(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new mo(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new ni(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new Kl(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new th(t.color,t.intensity);break;case"DirectionalLight":i=new $l(t.color,t.intensity);break;case"PointLight":i=new Jl(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new eh(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new ql(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new Wl(t.color,t.groundColor,t.intensity);break;case"LightProbe":i=(new ih).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":i=new Gn(a=r(t.geometry),s=o(t.material));break;case"InstancedMesh":var a=r(t.geometry),s=o(t.material),l=t.count,h=t.instanceMatrix;(i=new Qo(a,s,l)).instanceMatrix=new on(new Float32Array(h.array),16);break;case"LOD":i=new Go;break;case"Line":i=new oa(r(t.geometry),o(t.material),t.mode);break;case"LineLoop":i=new ha(r(t.geometry),o(t.material));break;case"LineSegments":i=new la(r(t.geometry),o(t.material));break;case"PointCloud":case"Points":i=new fa(r(t.geometry),o(t.material));break;case"Sprite":i=new Io(o(t.material));break;case"Group":i=new ho;break;default:i=new re}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children)for(var c=t.children,u=0;u<c.length;u++)i.add(this.parseObject(c[u],e,n));if("LOD"===t.type){void 0!==t.autoUpdate&&(i.autoUpdate=t.autoUpdate);for(var d=t.levels,p=0;p<d.length;p++){var m=d[p],f=i.getObjectByProperty("uuid",m.object);void 0!==f&&i.addLevel(f,m.distance)}}return i}});var dh,ph={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},mh={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},fh={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};function gh(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),dl.call(this,t),this.options=void 0}function vh(){this.type="ShapePath",this.color=new Ze,this.subPaths=[],this.currentPath=null}function yh(t){this.type="Font",this.data=t}function bh(t,e,n,i,r){var o=r.glyphs[t]||r.glyphs["?"];if(o){var a,s,l,h,c,u,d,p,m=new vh;if(o.o)for(var f=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=f.length;g<v;){switch(f[g++]){case"m":a=f[g++]*e+n,s=f[g++]*e+i,m.moveTo(a,s);break;case"l":a=f[g++]*e+n,s=f[g++]*e+i,m.lineTo(a,s);break;case"q":l=f[g++]*e+n,h=f[g++]*e+i,c=f[g++]*e+n,u=f[g++]*e+i,m.quadraticCurveTo(c,u,l,h);break;case"b":l=f[g++]*e+n,h=f[g++]*e+i,c=f[g++]*e+n,u=f[g++]*e+i,d=f[g++]*e+n,p=f[g++]*e+i,m.bezierCurveTo(c,u,d,p,l,h)}}return{offsetX:o.ha*e,path:m}}console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".")}function _h(t){dl.call(this,t)}gh.prototype=Object.assign(Object.create(dl.prototype),{constructor:gh,setOptions:function(t){return this.options=t,this},load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,o=hl.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout((function(){e&&e(o),r.manager.itemEnd(t)}),0),o;fetch(t).then((function(t){return t.blob()})).then((function(t){return void 0===r.options?createImageBitmap(t):createImageBitmap(t,r.options)})).then((function(n){hl.add(t,n),e&&e(n),r.manager.itemEnd(t)})).catch((function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}),Object.assign(vh.prototype,{moveTo:function(t,e){return this.currentPath=new Gl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this},bezierCurveTo:function(t,e,n,i,r,o){return this.currentPath.bezierCurveTo(t,e,n,i,r,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n],o=new Vl;o.curves=r.curves,e.push(o)}return e}function i(t,e){for(var n=e.length,i=!1,r=n-1,o=0;o<n;r=o++){var a=e[r],s=e[o],l=s.x-a.x,h=s.y-a.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(a=e[o],l=-l,s=e[r],h=-h),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var c=h*(t.x-a.x)-l*(t.y-a.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return i}var r=us.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);var a,s,l,h=[];if(1===o.length)return s=o[0],(l=new Vl).curves=s.curves,h.push(l),h;var c=!r(o[0].getPoints());c=t?!c:c;var u,d,p=[],m=[],f=[],g=0;m[g]=void 0,f[g]=[];for(var v=0,y=o.length;v<y;v++)a=r(u=(s=o[v]).getPoints()),(a=t?!a:a)?(!c&&m[g]&&g++,m[g]={s:new Vl,p:u},m[g].s.curves=s.curves,c&&g++,f[g]=[]):f[g].push({h:s,p:u[0]});if(!m[0])return n(o);if(m.length>1){for(var b=!1,_=[],x=0,w=m.length;x<w;x++)p[x]=[];for(x=0,w=m.length;x<w;x++)for(var M=f[x],S=0;S<M.length;S++){for(var T=M[S],E=!0,A=0;A<m.length;A++)i(T.p,m[A].p)&&(x!==A&&_.push({froms:x,tos:A,hole:S}),E?(E=!1,p[A].push(T)):b=!0);E&&p[x].push(T)}_.length>0&&(b||(f=p))}v=0;for(var C=m.length;v<C;v++){l=m[v].s,h.push(l);for(var P=0,L=(d=f[v]).length;P<L;P++)l.holes.push(d[P].h)}return h}}),Object.assign(yh.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);for(var n=[],i=function(t,e,n){for(var i=Array.from?Array.from(t):String(t).split(""),r=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,a=[],s=0,l=0,h=0;h<i.length;h++){var c=i[h];if("\n"===c)s=0,l-=o;else{var u=bh(c,r,s,l,n);s+=u.offsetX,a.push(u.path)}}return a}(t,e,this.data),r=0,o=i.length;r<o;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}),_h.prototype=Object.assign(Object.create(dl.prototype),{constructor:_h,load:function(t,e,n,i){var r=this,o=new ml(this.manager);o.setPath(this.path),o.load(t,(function(t){var n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}var i=r.parse(n);e&&e(i)}),n,i)},parse:function(t){return new yh(t)}});var xh=function(){return void 0===dh&&(dh=new(window.AudioContext||window.webkitAudioContext)),dh};function wh(t){dl.call(this,t)}function Mh(t,e,n){ih.call(this,void 0,n);var i=(new Ze).set(t),r=(new Ze).set(e),o=new Ot(i.r,i.g,i.b),a=new Ot(r.r,r.g,r.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function Sh(t,e){ih.call(this,void 0,e);var n=(new Ze).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}wh.prototype=Object.assign(Object.create(dl.prototype),{constructor:wh,load:function(t,e,n,i){var r=new ml(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.load(t,(function(t){var n=t.slice(0);xh().decodeAudioData(n,(function(t){e(t)}))}),n,i)}}),Mh.prototype=Object.assign(Object.create(ih.prototype),{constructor:Mh,isHemisphereLightProbe:!0,copy:function(t){return ih.prototype.copy.call(this,t),this},toJSON:function(t){return ih.prototype.toJSON.call(this,t)}}),Sh.prototype=Object.assign(Object.create(ih.prototype),{constructor:Sh,isAmbientLightProbe:!0,copy:function(t){return ih.prototype.copy.call(this,t),this},toJSON:function(t){return ih.prototype.toJSON.call(this,t)}});var Th=new zt,Eh=new zt;function Ah(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ni,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ni,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var n,i,r=t.projectionMatrix.clone(),o=e.eyeSep/2,a=o*e.near/e.focus,s=e.near*Math.tan(_t.DEG2RAD*e.fov*.5)/e.zoom;Eh.elements[12]=-o,Th.elements[12]=o,n=-s*e.aspect+a,i=s*e.aspect+a,r.elements[0]=2*e.near/(i-n),r.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(r),n=-s*e.aspect-a,i=s*e.aspect-a,r.elements[0]=2*e.near/(i-n),r.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Eh),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Th)}}),Object.assign(Ah.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var Ch=new Ot,Ph=new Pt,Lh=new Ot,Rh=new Ot;function Oh(){re.call(this),this.type="AudioListener",this.context=xh(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Ah}function Ih(t){re.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}Oh.prototype=Object.assign(Object.create(re.prototype),{constructor:Oh,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){re.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ch,Ph,Lh),Rh.set(0,0,-1).applyQuaternion(Ph),e.positionX){var i=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Ch.x,i),e.positionY.linearRampToValueAtTime(Ch.y,i),e.positionZ.linearRampToValueAtTime(Ch.z,i),e.forwardX.linearRampToValueAtTime(Rh.x,i),e.forwardY.linearRampToValueAtTime(Rh.y,i),e.forwardZ.linearRampToValueAtTime(Rh.z,i),e.upX.linearRampToValueAtTime(n.x,i),e.upY.linearRampToValueAtTime(n.y,i),e.upZ.linearRampToValueAtTime(n.z,i)}else e.setPosition(Ch.x,Ch.y,Ch.z),e.setOrientation(Rh.x,Rh.y,Rh.z,n.x,n.y,n.z)}}),Ih.prototype=Object.assign(Object.create(re.prototype),{constructor:Ih,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var Nh=new Ot,Dh=new Pt,Bh=new Ot,Fh=new Ot;function kh(t){Ih.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Uh(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function zh(t,e,n){var i,r,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}kh.prototype=Object.assign(Object.create(Ih.prototype),{constructor:kh,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(re.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Nh,Dh,Bh),Fh.set(0,0,1).applyQuaternion(Dh);var e=this.panner;if(e.positionX){var n=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Nh.x,n),e.positionY.linearRampToValueAtTime(Nh.y,n),e.positionZ.linearRampToValueAtTime(Nh.z,n),e.orientationX.linearRampToValueAtTime(Fh.x,n),e.orientationY.linearRampToValueAtTime(Fh.y,n),e.orientationZ.linearRampToValueAtTime(Fh.z,n)}else e.setPosition(Nh.x,Nh.y,Nh.z),e.setOrientation(Fh.x,Fh.y,Fh.z)}}}),Object.assign(Uh.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length}}),Object.assign(zh.prototype,{accumulate:function(t,e){var n=this.buffer,i=this.valueSize,r=t*i+i,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==i;++a)n[r+a]=n[a];o=e}else{var s=e/(o+=e);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=o},accumulateAdditive:function(t){var e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){var e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var s=e*this._origIndex;this._mixBufferRegion(n,i,s,1-r,e)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(var l=e,h=e+e;l!==h;++l)if(n[l]!==n[l+e]){a.setValue(n,i);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(var r=n,o=i;r!==o;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){var t=this._addIndex*this.valueSize;this.buffer.fill(0,t,t+this.valueSize)},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;this.buffer.copyWithin(e,t,this.valueSize)},_select:function(t,e,n,i,r){if(i>=.5)for(var o=0;o!==r;++o)t[e+o]=t[n+o]},_slerp:function(t,e,n,i){Pt.slerpFlat(t,e,t,e,t,n,i)},_slerpAdditive:function(t,e,n,i,r){var o=this._workIndex*r;Pt.multiplyQuaternionsFlat(t,o,t,e,t,n),Pt.slerpFlat(t,e,t,e,t,o,i)},_lerp:function(t,e,n,i,r){for(var o=1-i,a=0;a!==r;++a){var s=e+a;t[s]=t[s]*o+t[n+a]*i}},_lerpAdditive:function(t,e,n,i,r){for(var o=0;o!==r;++o){var a=e+o;t[a]=t[a]+t[n+o]*i}}});var Hh=new RegExp("[\\[\\]\\.:\\/]","g"),Gh="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Vh=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),jh=/(WCOD+)?/.source.replace("WCOD",Gh),Wh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Xh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Yh=new RegExp("^"+Vh+jh+Wh+Xh+"$"),qh=["material","materials","bones"];function Zh(t,e,n){var i=n||Jh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}function Jh(t,e,n){this.path=e,this.parsedPath=n||Jh.parseTrackName(e),this.node=Jh.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function Kh(t,e,n,i){this._mixer=t,this._clip=e,this._localRoot=n||null,this.blendMode=i||e.blendMode;for(var r=e.tracks,o=r.length,a=new Array(o),s={endingStart:2400,endingEnd:2400},l=0;l!==o;++l){var h=r[l].createInterpolant(null);a[l]=h,h.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Qh(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function $h(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function tc(t,e,n){go.call(this,t,e),this.meshPerAttribute=n||1}function ec(t,e,n,i){this.ray=new Le(t,e),this.near=n||0,this.far=i||1/0,this.camera=null,this.layers=new jt,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function nc(t,e){return t.distance-e.distance}function ic(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i)for(var r=t.children,o=0,a=r.length;o<a;o++)ic(r[o],e,n,!0)}function rc(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}Object.assign(Zh.prototype,{getValue:function(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(Jh,{Composite:Zh,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new Jh.Composite(t,e,n):new Jh(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Hh,"")},parseTrackName:function(t){var e=Yh.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==qh.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var i=function(t){for(var n=0;n<t.length;n++){var r=t[n];if(r.name===e||r.uuid===e)return r;var o=i(r.children);if(o)return o}return null},r=i(t.children);if(r)return r}return null}}),Object.assign(Jh.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)t[e++]=n[i]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=t[e++]},function(t,e){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,i=e.propertyName,r=e.propertyIndex;if(t||(t=Jh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var o=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var s=t[i];if(void 0!==s){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var h=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===r){r=a;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===r){r=a;break}}}h=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(h=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]}else{var c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Jh.prototype,{_getValue_unbound:Jh.prototype.getValue,_setValue_unbound:Jh.prototype.setValue}),Object.assign(function(){this.uuid=_t.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,h=0,c=arguments.length;h!==c;++h){var u=arguments[h],d=u.uuid,p=i[d];if(void 0===p){p=e++,i[d]=p,t.push(u);for(var m=0,f=s;m!==f;++m)a[m].push(new Jh(u,r[m],o[m]))}else if(p<n){l=t[p];var g=--n,v=t[g];i[v.uuid]=p,t[p]=v,i[d]=g,t[g]=u;for(m=0,f=s;m!==f;++m){var y=a[m],b=y[g],_=y[p];y[p]=b,void 0===_&&(_=new Jh(u,r[m],o[m])),y[g]=_}}else t[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,r=i.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,h=n[l];if(void 0!==h&&h>=e){var c=e++,u=t[c];n[u.uuid]=h,t[h]=u,n[l]=c,t[c]=s;for(var d=0,p=r;d!==p;++d){var m=i[d],f=m[c],g=m[h];m[h]=f,m[c]=g}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,o=r.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a],h=l.uuid,c=i[h];if(void 0!==c)if(delete i[h],c<n){var u=--n,d=t[u],p=t[y=--e];i[d.uuid]=c,t[c]=d,i[p.uuid]=u,t[u]=p,t.pop();for(var m=0,f=o;m!==f;++m){var g=(b=r[m])[u],v=b[y];b[c]=g,b[u]=v,b.pop()}}else{var y;i[(p=t[y=--e]).uuid]=c,t[c]=p,t.pop();for(m=0,f=o;m!==f;++m){var b;(b=r[m])[c]=b[y],b.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var n=this._bindingsIndicesByPath,i=n[t],r=this._bindings;if(void 0!==i)return r[i];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,h=this.nCachedObjects_,c=new Array(l);i=r.length,n[t]=i,o.push(t),a.push(e),r.push(c);for(var u=h,d=s.length;u!==d;++u){var p=s[u];c[u]=new Jh(p,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var i=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}}),Object.assign(Kh.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var i=this._clip.duration,r=t._clip.duration,o=r/i,a=i/r;t.warp(1,o,e),this.warp(a,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){var i=this._mixer,r=i.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+n,l[0]=t/a,l[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var o=(t-r)*n;if(o<0||0===n)return;this._startTime=null,e=n*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0){var l=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case 2501:for(var c=0,u=l.length;c!==u;++c)l[c].evaluate(a),h[c].accumulateAdditive(s);break;case 2500:default:for(c=0,u=l.length;c!==u;++c)l[c].evaluate(a),h[c].accumulate(i,s)}}}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,n=this._clip.duration,i=this.loop,r=this._loopCount,o=2202===i;if(0===t)return-1===r?e:o&&1==(1&r)?n-e:e;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=n)e=n;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=n||e<0){var a=Math.floor(e/n);e-=n*a,r+=Math.abs(a);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?n:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=e;if(o&&1==(1&r))return n-e}return e},_setEndings:function(t,e,n){var i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,i.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,e,n){var i=this._mixer,r=i.time,o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=r,s[0]=e,a[1]=r+t,s[1]=n,this}}),Qh.prototype=Object.assign(Object.create(gt.prototype),{constructor:Qh,_bindAction:function(t,e){var n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,l=this._bindingsByRootAndName,h=l[s];void 0===h&&(h={},l[s]=h);for(var c=0;c!==r;++c){var u=i[c],d=u.name,p=h[d];if(void 0!==p)o[c]=p;else{if(void 0!==(p=o[c])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var m=e&&e._propertyBindings[c].binding.parsedPath;++(p=new zh(Jh.create(n,d,m),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[c]=p}a[c].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}for(var r=t._propertyBindings,o=0,a=r.length;o!==a;++o){var s=r[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,i=e.length;n!==i;++n){var r=e[n];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){var i=this._actions,r=this._actionsByClip,o=r[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=i.length,i.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,o=this._actionsByClip,a=o[r],s=a.knownActions,l=s[s.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,s[h]=l,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,n=0,i=e.length;n!==i;++n){var r=e[n];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_addInactiveBinding:function(t,e,n){var i=this._bindingsByRootAndName,r=i[e],o=this._bindings;void 0===r&&(r={},i[e]=r),r[n]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,a=o[i],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete a[r],0===Object.keys(a).length&&delete o[i]},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&((n=new Ks(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){var i=e||this._root,r=i.uuid,o="string"==typeof t?sl.findByName(i,t):t,a=null!==o?o.uuid:t,s=this._actionsByClip[a],l=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){var h=s.actionByRoot[r];if(void 0!==h&&h.blendMode===n)return h;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;var c=new Kh(this,o,e,n);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c},existingAction:function(t,e){var n=e||this._root,i=n.uuid,r="string"==typeof t?sl.findByName(n,t):t,o=r?r.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[i]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,n=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==e;++r)t[r].reset();for(r=0;r!==i;++r)n[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1,a=0;a!==n;++a){e[a]._update(i,t,r,o)}var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var o=r.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var h=l._cacheIndex,c=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=h,e[h]=c,e.pop(),this._removeInactiveBindingsForAction(l)}delete i[n]}},uncacheRoot:function(t){var e=t.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),$h.prototype.clone=function(){return new $h(void 0===this.value.clone?this.value:this.value.clone())},tc.prototype=Object.assign(Object.create(go.prototype),{constructor:tc,isInstancedInterleavedBuffer:!0,copy:function(t){return go.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(ec.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){var i=n||[];return ic(t,this,i,e),i.sort(nc),i},intersectObjects:function(t,e,n){var i=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,o=t.length;r<o;r++)ic(t[r],this,i,e);return i.sort(nc),i}}),Object.assign(rc.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(_t.clamp(e/this.radius,-1,1))),this}}),Object.assign(function(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});var oc=new xt;function ac(t,e){this.min=void 0!==t?t:new xt(1/0,1/0),this.max=void 0!==e?e:new xt(-1/0,-1/0)}Object.assign(ac.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var n=oc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new xt),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new xt),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new xt),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new xt),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return oc.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var sc=new Ot,lc=new Ot;function hc(t,e){this.start=void 0!==t?t:new Ot,this.end=void 0!==e?e:new Ot}function cc(t){re.call(this),this.material=t,this.render=function(){}}Object.assign(hc.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Ot),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Ot),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Ot),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){sc.subVectors(t,this.start),lc.subVectors(this.end,this.start);var n=lc.dot(lc),i=lc.dot(sc)/n;return e&&(i=_t.clamp(i,0,1)),i},closestPointToPoint:function(t,e,n){var i=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Ot),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),cc.prototype=Object.create(re.prototype),cc.prototype.constructor=cc,cc.prototype.isImmediateRenderObject=!0;var uc=new Ot;function dc(t,e){re.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var n=new Sn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,o=1;r<32;r++,o++){var a=r/32*Math.PI*2,s=o/32*Math.PI*2;i.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new pn(i,3));var l=new $o({fog:!1,toneMapped:!1});this.cone=new la(n,l),this.add(this.cone),this.update()}dc.prototype=Object.create(re.prototype),dc.prototype.constructor=dc,dc.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},dc.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),uc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(uc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var pc=new Ot,mc=new zt,fc=new zt;function gc(t){for(var e=function t(e){var n=[];e&&e.isBone&&n.push(e);for(var i=0;i<e.children.length;i++)n.push.apply(n,t(e.children[i]));return n}(t),n=new Sn,i=[],r=[],o=new Ze(0,0,1),a=new Ze(0,1,0),s=0;s<e.length;s++){var l=e[s];l.parent&&l.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new pn(i,3)),n.setAttribute("color",new pn(r,3));var h=new $o({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});la.call(this,n,h),this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function vc(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;var i=new xs(e,4,2),r=new nn({wireframe:!0,fog:!1,toneMapped:!1});Gn.call(this,i,r),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}gc.prototype=Object.create(la.prototype),gc.prototype.constructor=gc,gc.prototype.isSkeletonHelper=!0,gc.prototype.updateMatrixWorld=function(t){var e=this.bones,n=this.geometry,i=n.getAttribute("position");fc.getInverse(this.root.matrixWorld);for(var r=0,o=0;r<e.length;r++){var a=e[r];a.parent&&a.parent.isBone&&(mc.multiplyMatrices(fc,a.matrixWorld),pc.setFromMatrixPosition(mc),i.setXYZ(o,pc.x,pc.y,pc.z),mc.multiplyMatrices(fc,a.parent.matrixWorld),pc.setFromMatrixPosition(mc),i.setXYZ(o+1,pc.x,pc.y,pc.z),o+=2)}n.getAttribute("position").needsUpdate=!0,re.prototype.updateMatrixWorld.call(this,t)},vc.prototype=Object.create(Gn.prototype),vc.prototype.constructor=vc,vc.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},vc.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var yc=new Ot,bc=new Ze,_c=new Ze;function xc(t,e,n){re.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var i=new Pa(e);i.rotateY(.5*Math.PI),this.material=new nn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);var r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.setAttribute("color",new on(o,3)),this.add(new Gn(i,this.material)),this.update()}function wc(t,e,n,i){t=t||10,e=e||10,n=new Ze(void 0!==n?n:4473924),i=new Ze(void 0!==i?i:8947848);for(var r=e/2,o=t/e,a=t/2,s=[],l=[],h=0,c=0,u=-a;h<=e;h++,u+=o){s.push(-a,0,u,a,0,u),s.push(u,0,-a,u,0,a);var d=h===r?n:i;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var p=new Sn;p.setAttribute("position",new pn(s,3)),p.setAttribute("color",new pn(l,3));var m=new $o({vertexColors:!0,toneMapped:!1});la.call(this,p,m),this.type="GridHelper"}function Mc(t,e,n,i,r,o){t=t||10,e=e||16,n=n||8,i=i||64,r=new Ze(void 0!==r?r:4473924),o=new Ze(void 0!==o?o:8947848);var a,s,l,h,c,u,d,p=[],m=[];for(h=0;h<=e;h++)l=h/e*(2*Math.PI),a=Math.sin(l)*t,s=Math.cos(l)*t,p.push(0,0,0),p.push(a,0,s),d=1&h?r:o,m.push(d.r,d.g,d.b),m.push(d.r,d.g,d.b);for(h=0;h<=n;h++)for(d=1&h?r:o,u=t-t/n*h,c=0;c<i;c++)l=c/i*(2*Math.PI),a=Math.sin(l)*u,s=Math.cos(l)*u,p.push(a,0,s),m.push(d.r,d.g,d.b),l=(c+1)/i*(2*Math.PI),a=Math.sin(l)*u,s=Math.cos(l)*u,p.push(a,0,s),m.push(d.r,d.g,d.b);var f=new Sn;f.setAttribute("position",new pn(p,3)),f.setAttribute("color",new pn(m,3));var g=new $o({vertexColors:!0,toneMapped:!1});la.call(this,f,g),this.type="PolarGridHelper"}xc.prototype=Object.create(re.prototype),xc.prototype.constructor=xc,xc.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},xc.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");bc.copy(this.light.color),_c.copy(this.light.groundColor);for(var n=0,i=e.count;n<i;n++){var r=n<i/2?bc:_c;e.setXYZ(n,r.r,r.g,r.b)}e.needsUpdate=!0}t.lookAt(yc.setFromMatrixPosition(this.light.matrixWorld).negate())},wc.prototype=Object.assign(Object.create(la.prototype),{constructor:wc,copy:function(t){return la.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),Mc.prototype=Object.create(la.prototype),Mc.prototype.constructor=Mc;var Sc=new Ot,Tc=new Ot,Ec=new Ot;function Ac(t,e,n){re.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);var i=new Sn;i.setAttribute("position",new pn([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var r=new $o({fog:!1,toneMapped:!1});this.lightPlane=new oa(i,r),this.add(this.lightPlane),(i=new Sn).setAttribute("position",new pn([0,0,0,0,0,1],3)),this.targetLine=new oa(i,r),this.add(this.targetLine),this.update()}Ac.prototype=Object.create(re.prototype),Ac.prototype.constructor=Ac,Ac.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Ac.prototype.update=function(){Sc.setFromMatrixPosition(this.light.matrixWorld),Tc.setFromMatrixPosition(this.light.target.matrixWorld),Ec.subVectors(Tc,Sc),this.lightPlane.lookAt(Tc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Tc),this.targetLine.scale.z=Ec.length()};var Cc=new Ot,Pc=new ei;function Lc(t){var e=new Sn,n=new $o({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={},a=new Ze(16755200),s=new Ze(16711680),l=new Ze(43775),h=new Ze(16777215),c=new Ze(3355443);function u(t,e,n){d(t,n),d(e,n)}function d(t,e){i.push(0,0,0),r.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(i.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",s),u("p","n2",s),u("p","n3",s),u("p","n4",s),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",h),u("p","c",c),u("cn1","cn2",c),u("cn3","cn4",c),u("cf1","cf2",c),u("cf3","cf4",c),e.setAttribute("position",new pn(i,3)),e.setAttribute("color",new pn(r,3)),la.call(this,e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Rc(t,e,n,i,r,o,a){Cc.set(r,o,a).unproject(i);var s=e[t];if(void 0!==s)for(var l=n.getAttribute("position"),h=0,c=s.length;h<c;h++)l.setXYZ(s[h],Cc.x,Cc.y,Cc.z)}Lc.prototype=Object.create(la.prototype),Lc.prototype.constructor=Lc,Lc.prototype.update=function(){var t=this.geometry,e=this.pointMap;Pc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Rc("c",e,t,Pc,0,0,-1),Rc("t",e,t,Pc,0,0,1),Rc("n1",e,t,Pc,-1,-1,-1),Rc("n2",e,t,Pc,1,-1,-1),Rc("n3",e,t,Pc,-1,1,-1),Rc("n4",e,t,Pc,1,1,-1),Rc("f1",e,t,Pc,-1,-1,1),Rc("f2",e,t,Pc,1,-1,1),Rc("f3",e,t,Pc,-1,1,1),Rc("f4",e,t,Pc,1,1,1),Rc("u1",e,t,Pc,.7,1.1,-1),Rc("u2",e,t,Pc,-.7,1.1,-1),Rc("u3",e,t,Pc,0,2,-1),Rc("cf1",e,t,Pc,-1,0,1),Rc("cf2",e,t,Pc,1,0,1),Rc("cf3",e,t,Pc,0,-1,1),Rc("cf4",e,t,Pc,0,1,1),Rc("cn1",e,t,Pc,-1,0,-1),Rc("cn2",e,t,Pc,1,0,-1),Rc("cn3",e,t,Pc,0,-1,-1),Rc("cn4",e,t,Pc,0,1,-1),t.getAttribute("position").needsUpdate=!0};var Oc=new be;function Ic(t,e){this.object=t,void 0===e&&(e=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Sn;r.setIndex(new on(n,1)),r.setAttribute("position",new on(i,3)),la.call(this,r,new $o({color:e,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function Nc(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Sn;i.setIndex(new on(n,1)),i.setAttribute("position",new pn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),la.call(this,i,new $o({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function Dc(t,e,n){this.plane=t,this.size=void 0===e?1:e;var i=void 0!==n?n:16776960,r=new Sn;r.setAttribute("position",new pn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),oa.call(this,r,new $o({color:i,toneMapped:!1})),this.type="PlaneHelper";var o=new Sn;o.setAttribute("position",new pn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Gn(o,new nn({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}Ic.prototype=Object.create(la.prototype),Ic.prototype.constructor=Ic,Ic.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Oc.setFromObject(this.object),!Oc.isEmpty()){var e=Oc.min,n=Oc.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Ic.prototype.setFromObject=function(t){return this.object=t,this.update(),this},Ic.prototype.copy=function(t){return la.prototype.copy.call(this,t),this.object=t.object,this},Ic.prototype.clone=function(){return(new this.constructor).copy(this)},Nc.prototype=Object.create(la.prototype),Nc.prototype.constructor=Nc,Nc.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),re.prototype.updateMatrixWorld.call(this,t))},Dc.prototype=Object.create(oa.prototype),Dc.prototype.constructor=Dc,Dc.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),re.prototype.updateMatrixWorld.call(this,t)};var Bc,Fc,kc=new Ot;function Uc(t,e,n,i,r,o){re.call(this),this.type="ArrowHelper",void 0===t&&(t=new Ot(0,0,1)),void 0===e&&(e=new Ot(0,0,0)),void 0===n&&(n=1),void 0===i&&(i=16776960),void 0===r&&(r=.2*n),void 0===o&&(o=.2*r),void 0===Bc&&((Bc=new Sn).setAttribute("position",new pn([0,0,0,0,1,0],3)),(Fc=new Rs(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new oa(Bc,new $o({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Gn(Fc,new nn({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,o)}function zc(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Sn;n.setAttribute("position",new pn(e,3)),n.setAttribute("color",new pn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new $o({vertexColors:!0,toneMapped:!1});la.call(this,n,i),this.type="AxesHelper"}Uc.prototype=Object.create(re.prototype),Uc.prototype.constructor=Uc,Uc.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{kc.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(kc,e)}},Uc.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},Uc.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},Uc.prototype.copy=function(t){return re.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},Uc.prototype.clone=function(){return(new this.constructor).copy(this)},zc.prototype=Object.create(la.prototype),zc.prototype.constructor=zc;var Hc=Math.pow(2,8),Gc=[.125,.215,.35,.446,.526,.582],Vc=5+Gc.length,jc={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Wc=new Kl,{_lodPlanes:Xc,_sizeLods:Yc,_sigmas:qc}=function(){for(var t=[],e=[],n=[],i=8,r=0;r<Vc;r++){var o=Math.pow(2,i);e.push(o);var a=1/o;r>4?a=Gc[r-8+4-1]:0==r&&(a=0),n.push(a);for(var s=1/(o-1),l=-s/2,h=1+s/2,c=[l,l,h,l,h,h,l,l,h,h,l,h],u=new Float32Array(108),d=new Float32Array(72),p=new Float32Array(36),m=0;m<6;m++){var f=m%3*2/3-1,g=m>2?0:-1,v=[f,g,0,f+2/3,g,0,f+2/3,g+1,0,f,g,0,f+2/3,g+1,0,f,g+1,0];u.set(v,18*m),d.set(c,12*m);var y=[m,m,m,m,m,m];p.set(y,6*m)}var b=new Sn;b.setAttribute("position",new on(u,3)),b.setAttribute("uv",new on(d,2)),b.setAttribute("faceIndex",new on(p,1)),t.push(b),i>4&&i--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}(),Zc=null,Jc=(1+Math.sqrt(5))/2,Kc=1/Jc,Qc=[new Ot(1,1,1),new Ot(-1,1,1),new Ot(1,1,-1),new Ot(-1,1,-1),new Ot(0,Jc,Kc),new Ot(0,Jc,-Kc),new Ot(Kc,0,Jc),new Ot(-Kc,0,Jc),new Ot(Jc,Kc,0),new Ot(-Jc,Kc,0)];function $c(t){var e,n,i,r;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=(e=20,n=new Float32Array(e),i=new Ot(0,1,0),(r=new ks({defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:jc[3e3]},outputEncoding:{value:jc[3e3]}},vertexShader:ou(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${au()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",r),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}function tu(t){return void 0!==t&&1009===t.type&&(3e3===t.encoding||3001===t.encoding||3007===t.encoding)}function eu(t){var e=new At(3*Hc,3*Hc,t);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function nu(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function iu(){var t=new ks({uniforms:{envMap:{value:null},texelSize:{value:new xt(1,1)},inputEncoding:{value:jc[3e3]},outputEncoding:{value:jc[3e3]}},vertexShader:ou(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${au()}\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function ru(){var t=new ks({uniforms:{envMap:{value:null},inputEncoding:{value:jc[3e3]},outputEncoding:{value:jc[3e3]}},vertexShader:ou(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${au()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function ou(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function au(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}$c.prototype={constructor:$c,fromScene:function(t,e=0,n=.1,i=100){Zc=this._renderer.getRenderTarget();var r=this._allocateTargets();return this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r},fromEquirectangular:function(t){return t.magFilter=1003,t.minFilter=1003,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){Zc=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=ru(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=iu(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var t=0;t<Xc.length;t++)Xc[t].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Zc),t.scissorTest=!1,t.setSize(t.width,t.height)},_allocateTargets:function(t){var e={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:tu(t)?t.encoding:3002,depthBuffer:!1,stencilBuffer:!1},n=eu(e);return n.depthBuffer=!t,this._pingPongRenderTarget=eu(e),n},_compileMaterial:function(t){var e=new oe;e.add(new Gn(Xc[0],t)),this._renderer.compile(e,Wc)},_sceneToCubeUV:function(t,e,n,i){var r=new ni(90,1,e,n),o=[1,1,1,1,-1,1],a=[1,1,-1,-1,-1,1],s=this._renderer,l=s.outputEncoding,h=s.toneMapping,c=s.toneMappingExposure,u=s.getClearColor(),d=s.getClearAlpha();s.toneMapping=1,s.toneMappingExposure=1,s.outputEncoding=3e3,t.scale.z*=-1;var p=t.background;if(p&&p.isColor){p.convertSRGBToLinear();var m=Math.max(p.r,p.g,p.b),f=Math.min(Math.max(Math.ceil(Math.log2(m)),-128),127);p=p.multiplyScalar(Math.pow(2,-f));var g=(f+128)/255;s.setClearColor(p,g),t.background=null}for(var v=0;v<6;v++){var y=v%3;0==y?(r.up.set(0,o[v],0),r.lookAt(a[v],0,0)):1==y?(r.up.set(0,0,o[v]),r.lookAt(0,a[v],0)):(r.up.set(0,o[v],0),r.lookAt(0,0,a[v])),nu(i,y*Hc,v>2?Hc:0,Hc,Hc),s.setRenderTarget(i),s.render(t,r)}s.toneMapping=h,s.toneMappingExposure=c,s.outputEncoding=l,s.setClearColor(u,d),t.scale.z*=-1},_textureToCubeUV:function(t,e){var n=new oe,i=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=ru()):null==this._equirectShader&&(this._equirectShader=iu());var r=t.isCubeTexture?this._cubemapShader:this._equirectShader;n.add(new Gn(Xc[0],r));var o=r.uniforms;o.envMap.value=t,t.isCubeTexture||o.texelSize.value.set(1/t.image.width,1/t.image.height),o.inputEncoding.value=jc[t.encoding],o.outputEncoding.value=jc[e.texture.encoding],nu(e,0,0,3*Hc,2*Hc),i.setRenderTarget(e),i.render(n,Wc)},_applyPMREM:function(t){var e=this._renderer,n=e.autoClear;e.autoClear=!1;for(var i=1;i<Vc;i++){var r=Math.sqrt(qc[i]*qc[i]-qc[i-1]*qc[i-1]),o=Qc[(i-1)%Qc.length];this._blur(t,i-1,i,r,o)}e.autoClear=n},_blur:function(t,e,n,i,r){var o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,i,"latitudinal",r),this._halfBlur(o,t,n,n,i,"longitudinal",r)},_halfBlur:function(t,e,n,i,r,o,a){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var h=new oe;h.add(new Gn(Xc[i],l));var c=l.uniforms,u=Yc[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,m=isFinite(r)?1+Math.floor(3*p):20;m>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);for(var f=[],g=0,v=0;v<20;++v){var y=v/p,b=Math.exp(-y*y/2);f.push(b),0==v?g+=b:v<m&&(g+=2*b)}for(v=0;v<f.length;v++)f[v]=f[v]/g;c.envMap.value=t.texture,c.samples.value=m,c.weights.value=f,c.latitudinal.value="latitudinal"===o,a&&(c.poleAxis.value=a),c.dTheta.value=d,c.mipInt.value=8-n,c.inputEncoding.value=jc[t.texture.encoding],c.outputEncoding.value=jc[t.texture.encoding];var _=Yc[i];nu(e,y=3*Math.max(0,Hc-2*_),(0===i?0:2*Hc)+2*_*(i>4?i-8+4:0),3*_,2*_),s.setRenderTarget(e),s.render(h,Wc)}};function su(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Pl.call(this,t),this.type="catmullrom"}xl.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(xl.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(Hl.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Zn,n=0,i=t.length;n<i;n++){var r=t[n];e.vertices.push(new Ot(r.x,r.y,r.z||0))}return e}}),Object.assign(Gl.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Object.create(Pl.prototype),Object.create(Pl.prototype),su.prototype=Object.create(Pl.prototype),Object.assign(su.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),wc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},gc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(dl.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ah(t)}}),dl.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(uh.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(ac.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(be.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(we.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),li.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},hc.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(_t,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),_t.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),_t.ceilPowerOfTwo(t)}}),Object.assign(wt.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(zt.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Ot).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,o)}}),Ne.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Pt.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Le.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(We.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(We,{barycoordFromPoint:function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),We.getBarycoord(t,e,n,i,r)},normal:function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),We.getNormal(t,e,n,i)}}),Object.assign(Vl.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ms(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Es(this,t)}}),Object.assign(xt.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ot.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Et.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Zn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(re.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(re.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Gn.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Gn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Go.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Xo.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Vo.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(xl.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),ni.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(jl.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(on.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(on.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Sn.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new on(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Sn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ec.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(go.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(go.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(fs.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties($h.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(en.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ze}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Hs.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ti.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(po.prototype,{clearTarget:function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(po.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?3001:3e3}}}),Object.defineProperties(ro.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(At.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Ih.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new wh).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Uh.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ii.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};Mt.crossOrigin=void 0,Mt.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new _l;r.setCrossOrigin(this.crossOrigin);var o=r.load(t,n,void 0,i);return e&&(o.mapping=e),o},Mt.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new bl;r.setCrossOrigin(this.crossOrigin);var o=r.load(t,n,void 0,i);return e&&(o.mapping=e),o},Mt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Mt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"116"}}));var lu=function(t){dl.call(this,t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};lu.prototype=Object.assign(Object.create(dl.prototype),{constructor:lu,setDecoderPath:function(t){return this.decoderPath=t,this},setDecoderConfig:function(t){return this.decoderConfig=t,this},setWorkerLimit:function(t){return this.workerLimit=t,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(t,e,n,i){var r=new ml(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&r.setWithCredentials(!0),r.load(t,t=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,n).then(e).catch(i)},n,i)},decodeDracoFile:function(t,e,n,i){var r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(t,r).then(e)},decodeGeometry:function(t,e){for(var n in e.attributeTypes){var i=e.attributeTypes[n];void 0!==i.BYTES_PER_ELEMENT&&(e.attributeTypes[n]=i.name)}var r,o=JSON.stringify(e);if(lu.taskCache.has(t)){var a=lu.taskCache.get(t);if(a.key===o)return a.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var s=this.workerNextTaskID++,l=t.byteLength,h=this._getWorker(s,l).then(n=>(r=n,new Promise((n,i)=>{r._callbacks[s]={resolve:n,reject:i},r.postMessage({type:"decode",id:s,taskConfig:e,buffer:t},[t])}))).then(t=>this._createGeometry(t.geometry));return h.finally(()=>{r&&s&&this._releaseTask(r,s)}),lu.taskCache.set(t,{key:o,promise:h}),h},_createGeometry:function(t){var e=new Sn;t.index&&e.setIndex(new on(t.index.array,1));for(var n=0;n<t.attributes.length;n++){var i=t.attributes[n],r=i.name,o=i.array,a=i.itemSize;e.setAttribute(r,new on(o,a))}return e},_loadLibrary:function(t,e){var n=new ml(this.manager);return n.setPath(this.decoderPath),n.setResponseType(e),new Promise((e,i)=>{n.load(t,e,void 0,i)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(e=>{var n=e[0];t||(this.decoderConfig.wasmBinary=e[1]);var i=lu.DRACOWorker.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending},_getWorker:function(t,e){return this._initDecoder().then(()=>{var n;this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(t){var e=t.data;switch(e.type){case"decode":n._callbacks[e.id].resolve(e);break;case"error":n._callbacks[e.id].reject(e);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+e.type+'"')}},this.workerPool.push(n)):this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));return(n=this.workerPool[this.workerPool.length-1])._taskCosts[t]=e,n._taskLoad+=e,n})},_releaseTask:function(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]},debug:function(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))},dispose:function(){for(var t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}),lu.DRACOWorker=function(){var t,e;function n(t,e,n,i,r,o){var a,s,l=o.num_components(),h=n.num_points()*l;switch(r){case Float32Array:a=new t.DracoFloat32Array,e.GetAttributeFloatForAllPoints(n,o,a),s=new Float32Array(h);break;case Int8Array:a=new t.DracoInt8Array,e.GetAttributeInt8ForAllPoints(n,o,a),s=new Int8Array(h);break;case Int16Array:a=new t.DracoInt16Array,e.GetAttributeInt16ForAllPoints(n,o,a),s=new Int16Array(h);break;case Int32Array:a=new t.DracoInt32Array,e.GetAttributeInt32ForAllPoints(n,o,a),s=new Int32Array(h);break;case Uint8Array:a=new t.DracoUInt8Array,e.GetAttributeUInt8ForAllPoints(n,o,a),s=new Uint8Array(h);break;case Uint16Array:a=new t.DracoUInt16Array,e.GetAttributeUInt16ForAllPoints(n,o,a),s=new Uint16Array(h);break;case Uint32Array:a=new t.DracoUInt32Array,e.GetAttributeUInt32ForAllPoints(n,o,a),s=new Uint32Array(h);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var c=0;c<h;c++)s[c]=a.GetValue(c);return t.destroy(a),{name:i,array:s,itemSize:l}}onmessage=function(i){var r=i.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":var o=r.buffer,a=r.taskConfig;e.then(t=>{var e=t.draco,i=new e.Decoder,s=new e.DecoderBuffer;s.Init(new Int8Array(o),o.byteLength);try{var l=function(t,e,i,r){var o,a,s=r.attributeIDs,l=r.attributeTypes,h=e.GetEncodedGeometryType(i);if(h===t.TRIANGULAR_MESH)o=new t.Mesh,a=e.DecodeBufferToMesh(i,o);else{if(h!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new t.PointCloud,a=e.DecodeBufferToPointCloud(i,o)}if(!a.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var c={index:null,attributes:[]};for(var u in s){var d,p,m=self[l[u]];if(r.useUniqueIDs)p=s[u],d=e.GetAttributeByUniqueId(o,p);else{if(-1===(p=e.GetAttributeId(o,t[s[u]])))continue;d=e.GetAttribute(o,p)}c.attributes.push(n(t,e,o,u,m,d))}if(h===t.TRIANGULAR_MESH){for(var f=o.num_faces(),g=new Uint32Array(3*f),v=new t.DracoInt32Array,y=0;y<f;++y){e.GetFaceFromMesh(o,y,v);for(var b=0;b<3;++b)g[3*y+b]=v.GetValue(b)}c.index={array:g,itemSize:1},t.destroy(v)}return t.destroy(o),c}(e,i,s,a),h=l.attributes.map(t=>t.array.buffer);l.index&&h.push(l.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:l},h)}catch(t){console.error(t),self.postMessage({type:"error",id:r.id,error:t.message})}finally{e.destroy(s),e.destroy(i)}})}}},lu.taskCache=new WeakMap,lu.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},lu.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},lu.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},lu.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};var hu=function(){function t(t){dl.call(this,t),this.dracoLoader=null,this.ddsLoader=null}function e(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}t.prototype=Object.assign(Object.create(dl.prototype),{constructor:t,load:function(t,e,n,i){var r,o=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:ah(t),o.manager.itemStart(t);var a=function(e){i?i(e):console.error(e),o.manager.itemError(t),o.manager.itemEnd(t)},s=new ml(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===o.crossOrigin&&s.setWithCredentials(!0),s.load(t,(function(n){try{o.parse(n,r,(function(n){e(n),o.manager.itemEnd(t)}),a)}catch(t){a(t)}}),n,a)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},parse:function(t,e,l,h){var p,g={};if("string"==typeof t)p=t;else if(oh(new Uint8Array(t,0,4))===s){try{g[n.KHR_BINARY_GLTF]=new c(t)}catch(t){return void(h&&h(t))}p=g[n.KHR_BINARY_GLTF].content}else p=oh(new Uint8Array(t));var v=JSON.parse(p);if(void 0===v.asset||v.asset.version[0]<2)h&&h(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(v.extensionsUsed)for(var y=0;y<v.extensionsUsed.length;++y){var b=v.extensionsUsed[y],_=v.extensionsRequired||[];switch(b){case n.KHR_LIGHTS_PUNCTUAL:g[b]=new r(v);break;case n.KHR_MATERIALS_CLEARCOAT:g[b]=new a;break;case n.KHR_MATERIALS_UNLIT:g[b]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:g[b]=new m;break;case n.KHR_DRACO_MESH_COMPRESSION:g[b]=new u(v,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:g[b]=new i(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:g[b]=new d;break;case n.KHR_MESH_QUANTIZATION:g[b]=new f;break;default:_.indexOf(b)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+b+'".')}}new z(v,g,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(l,h)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=t}function r(t){this.name=n.KHR_LIGHTS_PUNCTUAL;var e=t.extensions&&t.extensions[n.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=e.lights||[]}function o(){this.name=n.KHR_MATERIALS_UNLIT}function a(){this.name=n.KHR_MATERIALS_CLEARCOAT}r.prototype.loadLight=function(t){var e,n=this.lightDefs[t],i=new Ze(16777215);void 0!==n.color&&i.fromArray(n.color);var r=void 0!==n.range?n.range:0;switch(n.type){case"directional":(e=new $l(i)).target.position.set(0,0,-1),e.add(e.target);break;case"point":(e=new Jl(i)).distance=r;break;case"spot":(e=new ql(i)).distance=r,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,e.angle=n.spot.outerConeAngle,e.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,e.target.position.set(0,0,-1),e.add(e.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return e.position.set(0,0,0),e.decay=2,void 0!==n.intensity&&(e.intensity=n.intensity),e.name=n.name||"light_"+t,Promise.resolve(e)},o.prototype.getMaterialType=function(){return nn},o.prototype.extendParams=function(t,e,n){var i=[];t.color=new Ze(1,1,1),t.opacity=1;var r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var o=r.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(t,"map",r.baseColorTexture))}return Promise.all(i)},a.prototype.getMaterialType=function(){return zs},a.prototype.extendParams=function(t,e,n){var i=[],r=e.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){var o=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new xt(o,o)}return Promise.all(i)};var s="glTF",l=1313821514,h=5130562;function c(t){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,12);if(this.header={magic:oh(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==s)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=new DataView(t,12),r=0;r<i.byteLength;){var o=i.getUint32(r,!0);r+=4;var a=i.getUint32(r,!0);if(r+=4,a===l){var c=new Uint8Array(t,12+r,o);this.content=oh(c)}else if(a===h){var u=12+r;this.body=t.slice(u,u+o)}r+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function u(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function d(){this.name=n.KHR_TEXTURE_TRANSFORM}function p(t){Us.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),a={specular:{value:(new Ze).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(var s in a)t.uniforms[s]=a[s];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),t.fragmentShader=t.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_pars_fragment>",e),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_pars_fragment>",n),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_fragment>",i),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_fragment>",r),t.fragmentShader=t.fragmentShader.replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){a.specularMap.value=t}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){a.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function m(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return p},extendParams:function(t,e,n){var i=e.extensions[this.name];t.color=new Ze(1,1,1),t.opacity=1;var r=[];if(Array.isArray(i.diffuseFactor)){var o=i.diffuseFactor;t.color.fromArray(o),t.opacity=o[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new Ze(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new Ze(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var a=i.specularGlossinessTexture;r.push(n.assignTexture(t,"glossinessMap",a)),r.push(n.assignTexture(t,"specularMap",a))}return Promise.all(r)},createMaterial:function(t){var e=new p(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=0,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function f(){this.name=n.KHR_MESH_QUANTIZATION}function g(t,e,n,i){Zs.call(this,t,e,n,i)}u.prototype.decodePrimitive=function(t,e){var n=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},s={},l={};for(var h in o){var c=C[h]||h.toLowerCase();a[c]=o[h]}for(h in t.attributes){c=C[h]||h.toLowerCase();if(void 0!==o[h]){var u=n.accessors[t.attributes[h]],d=S[u.componentType];l[c]=d,s[c]=!0===u.normalized}}return e.getDependency("bufferView",r).then((function(t){return new Promise((function(e){i.decodeDracoFile(t,(function(t){for(var n in t.attributes){var i=t.attributes[n],r=s[n];void 0!==r&&(i.normalized=r)}e(t)}),a,l)}))}))},d.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},p.prototype=Object.create(Us.prototype),p.prototype.constructor=p,p.prototype.copy=function(t){return Us.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},g.prototype=Object.create(Zs.prototype),g.prototype.constructor=g,g.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i,o=0;o!==i;o++)e[o]=n[r+o];return e},g.prototype.beforeStart_=g.prototype.copySampleValue_,g.prototype.afterEnd_=g.prototype.copySampleValue_,g.prototype.interpolate_=function(t,e,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,h=i-e,c=(n-e)/h,u=c*c,d=u*c,p=t*l,m=p-l,f=-2*d+3*u,g=d-u,v=1-f,y=g-u+c,b=0;b!==a;b++){var _=o[m+b+a],x=o[m+b+s]*h,w=o[p+b+a],M=o[p+b]*h;r[b]=v*_+y*x+f*w+g*M}return r};var v=0,y=1,b=2,_=3,x=4,w=5,M=6,S={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},T={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},E={33071:1001,33648:1002,10497:1e3},A={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},C={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},P={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},L={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},R="OPAQUE",O="MASK",I="BLEND",N={"image/png":1023,"image/jpeg":1022};function D(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function B(t,e,n){for(var i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function F(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function k(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){var r=e.extras.targetNames;if(t.morphTargetInfluences.length===r.length){t.morphTargetDictionary={};for(n=0,i=r.length;n<i;n++)t.morphTargetDictionary[r[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function U(t){for(var e="",n=Object.keys(t).sort(),i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function z(t,n,i){this.json=t||{},this.extensions=n||{},this.options=i||{},this.cache=new e,this.primitiveCache={},this.textureLoader=new _l(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new ml(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function H(t,e,n){var i=e.attributes,r=[];function o(e,i){return n.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(var a in i){var s=C[a]||a.toLowerCase();s in t.attributes||r.push(o(i[a],s))}if(void 0!==e.indices&&!t.index){var l=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));r.push(l)}return F(t,e),function(t,e,n){var i=e.attributes,r=new be;if(void 0!==i.POSITION){var o=(p=n.json.accessors[i.POSITION]).min,a=p.max;if(void 0!==o&&void 0!==a){r.set(new Ot(o[0],o[1],o[2]),new Ot(a[0],a[1],a[2]));var s=e.targets;if(void 0!==s){for(var l=new Ot,h=new Ot,c=0,u=s.length;c<u;c++){var d=s[c];if(void 0!==d.POSITION){var p;o=(p=n.json.accessors[d.POSITION]).min,a=p.max;void 0!==o&&void 0!==a?(h.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),h.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),h.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),l.max(h)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(l)}t.boundingBox=r;var m=new we;r.getCenter(m.center),m.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,e,n),Promise.all(r).then((function(){return void 0!==e.targets?function(t,e,n){for(var i=!1,r=!1,o=0,a=e.length;o<a;o++){if(void 0!==(h=e[o]).POSITION&&(i=!0),void 0!==h.NORMAL&&(r=!0),i&&r)break}if(!i&&!r)return Promise.resolve(t);var s=[],l=[];for(o=0,a=e.length;o<a;o++){var h=e[o];if(i){var c=void 0!==h.POSITION?n.getDependency("accessor",h.POSITION):t.attributes.position;s.push(c)}if(r){c=void 0!==h.NORMAL?n.getDependency("accessor",h.NORMAL):t.attributes.normal;l.push(c)}}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(e){var n=e[0],o=e[1];return i&&(t.morphAttributes.position=n),r&&(t.morphAttributes.normal=o),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function G(t,e){var n=t.getIndex();if(null===n){var i=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var o=0;o<r.count;o++)i.push(o);t.setIndex(i),n=t.getIndex()}var a=n.count-2,s=[];if(2===e)for(o=1;o<=a;o++)s.push(n.getX(0)),s.push(n.getX(o)),s.push(n.getX(o+1));else for(o=0;o<a;o++)o%2==0?(s.push(n.getX(o)),s.push(n.getX(o+1)),s.push(n.getX(o+2))):(s.push(n.getX(o+2)),s.push(n.getX(o+1)),s.push(n.getX(o)));s.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=t.clone();return l.setIndex(s),l}return z.prototype.parse=function(t,e){var n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(e){var o={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};B(r,o,i),F(o,i),t(o)})).catch(e)},z.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],i={},r={},o=0,a=e.length;o<a;o++)for(var s=e[o].joints,l=0,h=s.length;l<h;l++)t[s[l]].isBone=!0;for(var c=0,u=t.length;c<u;c++){var d=t[c];void 0!==d.mesh&&(void 0===i[d.mesh]&&(i[d.mesh]=r[d.mesh]=0),i[d.mesh]++,void 0!==d.skin&&(n[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=r},z.prototype.getDependency=function(t,e){var i=t+":"+e,r=this.cache.get(i);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this.loadNode(e);break;case"mesh":r=this.loadMesh(e);break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this.loadBufferView(e);break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this.loadMaterial(e);break;case"texture":r=this.loadTexture(e);break;case"skin":r=this.loadSkin(e);break;case"animation":r=this.loadAnimation(e);break;case"camera":r=this.loadCamera(e);break;case"light":r=this.extensions[n.KHR_LIGHTS_PUNCTUAL].loadLight(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,r)}return r},z.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map((function(e,i){return n.getDependency(t,i)}))),this.cache.add(t,e)}return e},z.prototype.loadBuffer=function(t){var e=this.json.buffers[t],i=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(t,n){i.load(D(e.uri,r.path),t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},z.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)}))},z.prototype.loadAccessor=function(t){var e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(t){var r,o=t[0],a=A[i.type],s=S[i.componentType],l=s.BYTES_PER_ELEMENT,h=l*a,c=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(u&&u!==h){var p=Math.floor(c/u),m="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+p+":"+i.count,f=e.cache.get(m);f||(f=new go(new s(o,p*u,i.count*u/l),u/l),e.cache.add(m,f)),r=new bo(f,a,c%u/l,d)}else r=new on(null===o?new s(i.count*a):new s(o,c,i.count*a),a,d);if(void 0!==i.sparse){var g=A.SCALAR,v=S[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,b=i.sparse.values.byteOffset||0,_=new v(t[1],y,i.sparse.count*g),x=new s(t[2],b,i.sparse.count*a);null!==o&&(r=new on(r.array.slice(),r.itemSize,r.normalized));for(var w=0,M=_.length;w<M;w++){var T=_[w];if(r.setX(T,x[w*a]),a>=2&&r.setY(T,x[w*a+1]),a>=3&&r.setZ(T,x[w*a+2]),a>=4&&r.setW(T,x[w*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return r}))},z.prototype.loadTexture=function(t){var e,i=this,r=this.json,o=this.options,a=this.textureLoader,s=self.URL||self.webkitURL,l=r.textures[t],h=l.extensions||{},c=(e=h[n.MSFT_TEXTURE_DDS]?r.images[h[n.MSFT_TEXTURE_DDS].source]:r.images[l.source]).uri,u=!1;return void 0!==e.bufferView&&(c=i.getDependency("bufferView",e.bufferView).then((function(t){u=!0;var n=new Blob([t],{type:e.mimeType});return c=s.createObjectURL(n)}))),Promise.resolve(c).then((function(t){var e=o.manager.getHandler(t);return e||(e=h[n.MSFT_TEXTURE_DDS]?i.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:a),new Promise((function(n,i){e.load(D(t,o.path),n,void 0,i)}))})).then((function(t){!0===u&&s.revokeObjectURL(c),t.flipY=!1,l.name&&(t.name=l.name),e.mimeType in N&&(t.format=N[e.mimeType]);var n=(r.samplers||{})[l.sampler]||{};return t.magFilter=T[n.magFilter]||1006,t.minFilter=T[n.minFilter]||1008,t.wrapS=E[n.wrapS]||1e3,t.wrapT=E[n.wrapT]||1e3,t}))},z.prototype.assignTexture=function(t,e,i){var r=this;return this.getDependency("texture",i.index).then((function(o){if(!o.isCompressedTexture)switch(e){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":o.format=1022}if(void 0===i.texCoord||0==i.texCoord||"aoMap"===e&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+e+" not yet supported."),r.extensions[n.KHR_TEXTURE_TRANSFORM]){var a=void 0!==i.extensions?i.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;a&&(o=r.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,a))}t[e]=o}))},z.prototype.assignFinalMaterial=function(t){var e=t.geometry,n=t.material,i=void 0!==e.attributes.tangent,r=void 0!==e.attributes.color,o=void 0===e.attributes.normal,a=!0===t.isSkinnedMesh,s=Object.keys(e.morphAttributes).length>0,l=s&&void 0!==e.morphAttributes.normal;if(t.isPoints){var h="PointsMaterial:"+n.uuid,c=this.cache.get(h);c||(c=new ca,en.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(h,c)),n=c}else if(t.isLine){h="LineBasicMaterial:"+n.uuid;var u=this.cache.get(h);u||(u=new $o,en.prototype.copy.call(u,n),u.color.copy(n.color),this.cache.add(h,u)),n=u}if(i||r||o||a||s){h="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(h+="specular-glossiness:"),a&&(h+="skinning:"),i&&(h+="vertex-tangents:"),r&&(h+="vertex-colors:"),o&&(h+="flat-shading:"),s&&(h+="morph-targets:"),l&&(h+="morph-normals:");var d=this.cache.get(h);d||(d=n.clone(),a&&(d.skinning=!0),i&&(d.vertexTangents=!0),r&&(d.vertexColors=!0),o&&(d.flatShading=!0),s&&(d.morphTargets=!0),l&&(d.morphNormals=!0),this.cache.add(h,d)),n=d}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),n.normalScale&&!i&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!i&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),t.material=n},z.prototype.loadMaterial=function(t){var e,i=this.json,r=this.extensions,o=i.materials[t],a={},s=o.extensions||{},l=[];if(s[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=r[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=h.getMaterialType(),l.push(h.extendParams(a,o,this))}else if(s[n.KHR_MATERIALS_UNLIT]){var c=r[n.KHR_MATERIALS_UNLIT];e=c.getMaterialType(),l.push(c.extendParams(a,o,this))}else{e=Us;var u=o.pbrMetallicRoughness||{};if(a.color=new Ze(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){var d=u.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}void 0!==u.baseColorTexture&&l.push(this.assignTexture(a,"map",u.baseColorTexture)),a.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,a.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture&&(l.push(this.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(this.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture)))}!0===o.doubleSided&&(a.side=2);var m=o.alphaMode||R;if(m===I?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,m===O&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&e!==nn&&(l.push(this.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new xt(1,1),void 0!==o.normalTexture.scale&&a.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&e!==nn&&(l.push(this.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&e!==nn&&(a.emissive=(new Ze).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&e!==nn&&l.push(this.assignTexture(a,"emissiveMap",o.emissiveTexture)),s[n.KHR_MATERIALS_CLEARCOAT]){var f=r[n.KHR_MATERIALS_CLEARCOAT];e=f.getMaterialType(),l.push(f.extendParams(a,{extensions:s},this))}return Promise.all(l).then((function(){var t;return t=e===p?r[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new e(a),o.name&&(t.name=o.name),t.map&&(t.map.encoding=3001),t.emissiveMap&&(t.emissiveMap.encoding=3001),F(t,o),o.extensions&&B(r,t,o),t}))},z.prototype.loadGeometries=function(t){var e=this,i=this.extensions,r=this.primitiveCache;function o(t){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return H(n,t,e)}))}for(var a,s,l=[],h=0,c=t.length;h<c;h++){var u,d=t[h],p=(s=void 0,(s=(a=d).extensions&&a.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+U(s.attributes):a.indices+":"+U(a.attributes)+":"+a.mode),m=r[p];if(m)l.push(m.promise);else u=d.extensions&&d.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(d):H(new Sn,d,e),r[p]={primitive:d,promise:u},l.push(u)}return Promise.all(l)},z.prototype.loadMesh=function(t){for(var e,n=this,i=this.json.meshes[t],r=i.primitives,o=[],a=0,s=r.length;a<s;a++){var l=void 0===r[a].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new Us({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial):this.getDependency("material",r[a].material);o.push(l)}return o.push(n.loadGeometries(r)),Promise.all(o).then((function(e){for(var o=e.slice(0,e.length-1),a=e[e.length-1],s=[],l=0,h=a.length;l<h;l++){var c,u=a[l],d=r[l],p=o[l];if(d.mode===x||d.mode===w||d.mode===M||void 0===d.mode)!0!==(c=!0===i.isSkinnedMesh?new Vo(u,p):new Gn(u,p)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),d.mode===w?c.geometry=G(c.geometry,1):d.mode===M&&(c.geometry=G(c.geometry,2));else if(d.mode===y)c=new la(u,p);else if(d.mode===_)c=new oa(u,p);else if(d.mode===b)c=new ha(u,p);else{if(d.mode!==v)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);c=new fa(u,p)}Object.keys(c.geometry.morphAttributes).length>0&&k(c,i),c.name=i.name||"mesh_"+t,a.length>1&&(c.name+="_"+l),F(c,i),n.assignFinalMaterial(c),s.push(c)}if(1===s.length)return s[0];var m=new ho;for(l=0,h=s.length;l<h;l++)m.add(s[l]);return m}))},z.prototype.loadCamera=function(t){var e,n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new ni(_t.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new Kl(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=n.name),F(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},z.prototype.loadSkin=function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))},z.prototype.loadAnimation=function(t){for(var e=this.json.animations[t],n=[],i=[],r=[],o=[],a=[],s=0,l=e.channels.length;s<l;s++){var h=e.channels[s],c=e.samplers[h.sampler],u=h.target,d=void 0!==u.node?u.node:u.id,p=void 0!==e.parameters?e.parameters[c.input]:c.input,m=void 0!==e.parameters?e.parameters[c.output]:c.output;n.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",p)),r.push(this.getDependency("accessor",m)),o.push(c),a.push(u)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(o),Promise.all(a)]).then((function(n){for(var i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=[],h=0,c=i.length;h<c;h++){var u=i[h],d=r[h],p=o[h],m=a[h],f=s[h];if(void 0!==u){var v;switch(u.updateMatrix(),u.matrixAutoUpdate=!0,P[f.path]){case P.weights:v=nl;break;case P.rotation:v=rl;break;case P.position:case P.scale:default:v=al}var y=u.name?u.name:u.uuid,b=void 0!==m.interpolation?L[m.interpolation]:2301,_=[];P[f.path]===P.weights?u.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&_.push(t.name?t.name:t.uuid)})):_.push(y);var x=p.array;if(p.normalized){var w;if(x.constructor===Int8Array)w=1/127;else if(x.constructor===Uint8Array)w=1/255;else if(x.constructor==Int16Array)w=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var M=new Float32Array(x.length),S=0,T=x.length;S<T;S++)M[S]=x[S]*w;x=M}for(S=0,T=_.length;S<T;S++){var E=new v(_[S]+"."+P[f.path],d.array,x,b);"CUBICSPLINE"===m.interpolation&&(E.createInterpolant=function(t){return new g(this.times,this.values,this.getValueSize()/3,t)},E.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(E)}}}return new sl(e.name?e.name:"animation_"+t,void 0,l)}))},z.prototype.loadNode=function(t){var e,i=this.json,r=this.extensions,o=this,a=i.meshReferences,s=i.meshUses,l=i.nodes[t];return(e=[],void 0!==l.mesh&&e.push(o.getDependency("mesh",l.mesh).then((function(t){var e;if(a[l.mesh]>1){var n=s[l.mesh]++;(e=t.clone()).name+="_instance_"+n}else e=t;return void 0!==l.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,n=l.weights.length;e<n;e++)t.morphTargetInfluences[e]=l.weights[e]})),e}))),void 0!==l.camera&&e.push(o.getDependency("camera",l.camera)),l.extensions&&l.extensions[n.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[n.KHR_LIGHTS_PUNCTUAL].light&&e.push(o.getDependency("light",l.extensions[n.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(e)).then((function(t){var e;if((e=!0===l.isBone?new Yo:t.length>1?new ho:1===t.length?t[0]:new re)!==t[0])for(var n=0,i=t.length;n<i;n++)e.add(t[n]);if(l.name&&(e.userData.name=l.name,e.name=Jh.sanitizeNodeName(l.name)),F(e,l),l.extensions&&B(r,e,l),void 0!==l.matrix){var o=new zt;o.fromArray(l.matrix),e.applyMatrix4(o)}else void 0!==l.translation&&e.position.fromArray(l.translation),void 0!==l.rotation&&e.quaternion.fromArray(l.rotation),void 0!==l.scale&&e.scale.fromArray(l.scale);return e}))},z.prototype.loadScene=function(){function t(e,n,i,r){var o=i.nodes[e];return r.getDependency("node",e).then((function(t){return void 0===o.skin?t:r.getDependency("skin",o.skin).then((function(t){for(var n=[],i=0,o=(e=t).joints.length;i<o;i++)n.push(r.getDependency("node",e.joints[i]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(t.isMesh){for(var i=[],r=[],o=0,a=n.length;o<a;o++){var s=n[o];if(s){i.push(s);var l=new zt;void 0!==e.inverseBindMatrices&&l.fromArray(e.inverseBindMatrices.array,16*o),r.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[o])}t.bind(new Xo(i,r),t.matrixWorld)}})),t}));var e})).then((function(e){n.add(e);var a=[];if(o.children)for(var s=o.children,l=0,h=s.length;l<h;l++){var c=s[l];a.push(t(c,e,i,r))}return Promise.all(a)}))}return function(e){var n=this.json,i=this.extensions,r=this.json.scenes[e],o=new ho;r.name&&(o.name=r.name),F(o,r),r.extensions&&B(i,o,r);for(var a=r.nodes||[],s=[],l=0,h=a.length;l<h;l++)s.push(t(a[l],o,n,this));return Promise.all(s).then((function(){return o}))}}(),t}(),cu=n(0);class uu{constructor(){this.events=new cu.MessageDispatcher,uu.Assets={},this.load()}load(){const t=new cl;this.modelsLoader=new hu(t),this.textureLoader=new _l(t);const e=new lu;e.setDecoderPath("/examples/js/libs/draco/"),this.modelsLoader.setDRACOLoader(e),this.loadModels(),this.loadTextures(),t.onLoad=()=>{this.events.post("onLoaded")}}loadModels(){this.modelsLoader.load("./assets/models/book.glb",t=>this.onAssetLoaded(t,"book"))}loadTextures(){this.textureLoader.load("./assets/textures/book_cover.jpg",t=>this.onAssetLoaded(t,"book_cover")),this.textureLoader.load("./assets/textures/road_bw.png",t=>this.onAssetLoaded(t,"road_bw")),this.textureLoader.load("./assets/textures/road.png",t=>this.onAssetLoaded(t,"road")),this.textureLoader.load("./assets/textures/path.png",t=>this.onAssetLoaded(t,"path")),this.textureLoader.load("./assets/textures/path2.jpg",t=>this.onAssetLoaded(t,"path2")),this.textureLoader.load("./assets/textures/sunflowers.jpg",t=>this.onAssetLoaded(t,"sunflowers"))}onAssetLoaded(t,e){uu.Assets[e]=t}}uu.Assets={};var du=function(t,e){var n,i,r,o,a;void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new Ot,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:ht,MIDDLE:ct,RIGHT:ut},this.touches={ONE:dt,TWO:mt},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=u.NONE},this.update=(n=new Ot,i=(new Pt).setFromUnitVectors(t.up,new Ot(0,1,0)),r=i.clone().inverse(),o=new Ot,a=new Pt,function(){var t=s.object.position;return n.copy(t).sub(s.target),n.applyQuaternion(i),m.setFromVector3(n),s.autoRotate&&d===u.NONE&&P(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(m.theta+=f.theta*s.dampingFactor,m.phi+=f.phi*s.dampingFactor):(m.theta+=f.theta,m.phi+=f.phi),m.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,m.theta)),m.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=g,m.radius=Math.max(s.minDistance,Math.min(s.maxDistance,m.radius)),!0===s.enableDamping?s.target.addScaledVector(v,s.dampingFactor):s.target.add(v),n.setFromSpherical(m),n.applyQuaternion(r),t.copy(s.target).add(n),s.object.lookAt(s.target),!0===s.enableDamping?(f.theta*=1-s.dampingFactor,f.phi*=1-s.dampingFactor,v.multiplyScalar(1-s.dampingFactor)):(f.set(0,0,0),v.set(0,0,0)),g=1,!!(y||o.distanceToSquared(s.object.position)>p||8*(1-a.dot(s.object.quaternion))>p)&&(s.dispatchEvent(l),o.copy(s.object.position),a.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",$,!1),s.domElement.removeEventListener("mousedown",W,!1),s.domElement.removeEventListener("wheel",q,!1),s.domElement.removeEventListener("touchstart",J,!1),s.domElement.removeEventListener("touchend",Q,!1),s.domElement.removeEventListener("touchmove",K,!1),document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",Y,!1),s.domElement.removeEventListener("keydown",Z,!1)};var s=this,l={type:"change"},h={type:"start"},c={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=u.NONE,p=1e-6,m=new rc,f=new rc,g=1,v=new Ot,y=!1,b=new xt,_=new xt,x=new xt,w=new xt,M=new xt,S=new xt,T=new xt,E=new xt,A=new xt;function C(){return Math.pow(.95,s.zoomSpeed)}function P(t){f.theta-=t}function L(t){f.phi-=t}var R,O=(R=new Ot,function(t,e){R.setFromMatrixColumn(e,0),R.multiplyScalar(-t),v.add(R)}),I=function(){var t=new Ot;return function(e,n){!0===s.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(s.object.up,t)),t.multiplyScalar(e),v.add(t)}}(),N=function(){var t=new Ot;return function(e,n){var i=s.domElement;if(s.object.isPerspectiveCamera){var r=s.object.position;t.copy(r).sub(s.target);var o=t.length();o*=Math.tan(s.object.fov/2*Math.PI/180),O(2*e*o/i.clientHeight,s.object.matrix),I(2*n*o/i.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(O(e*(s.object.right-s.object.left)/s.object.zoom/i.clientWidth,s.object.matrix),I(n*(s.object.top-s.object.bottom)/s.object.zoom/i.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function D(t){s.object.isPerspectiveCamera?g/=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*t)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function B(t){s.object.isPerspectiveCamera?g*=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/t)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function F(t){b.set(t.clientX,t.clientY)}function k(t){w.set(t.clientX,t.clientY)}function U(t){if(1==t.touches.length)b.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);b.set(e,n)}}function z(t){if(1==t.touches.length)w.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);w.set(e,n)}}function H(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);T.set(0,i)}function G(t){if(1==t.touches.length)_.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);_.set(e,n)}x.subVectors(_,b).multiplyScalar(s.rotateSpeed);var i=s.domElement;P(2*Math.PI*x.x/i.clientHeight),L(2*Math.PI*x.y/i.clientHeight),b.copy(_)}function V(t){if(1==t.touches.length)M.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY);M.set(e,n)}S.subVectors(M,w).multiplyScalar(s.panSpeed),N(S.x,S.y),w.copy(M)}function j(t){var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);E.set(0,i),A.set(0,Math.pow(E.y/T.y,s.zoomSpeed)),D(A.y),T.copy(E)}function W(t){if(!1!==s.enabled){var e;switch(t.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),t.button){case 0:e=s.mouseButtons.LEFT;break;case 1:e=s.mouseButtons.MIDDLE;break;case 2:e=s.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ct:if(!1===s.enableZoom)return;!function(t){T.set(t.clientX,t.clientY)}(t),d=u.DOLLY;break;case ht:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enablePan)return;k(t),d=u.PAN}else{if(!1===s.enableRotate)return;F(t),d=u.ROTATE}break;case ut:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enableRotate)return;F(t),d=u.ROTATE}else{if(!1===s.enablePan)return;k(t),d=u.PAN}break;default:d=u.NONE}d!==u.NONE&&(document.addEventListener("mousemove",X,!1),document.addEventListener("mouseup",Y,!1),s.dispatchEvent(h))}}function X(t){if(!1!==s.enabled)switch(t.preventDefault(),d){case u.ROTATE:if(!1===s.enableRotate)return;!function(t){_.set(t.clientX,t.clientY),x.subVectors(_,b).multiplyScalar(s.rotateSpeed);var e=s.domElement;P(2*Math.PI*x.x/e.clientHeight),L(2*Math.PI*x.y/e.clientHeight),b.copy(_),s.update()}(t);break;case u.DOLLY:if(!1===s.enableZoom)return;!function(t){E.set(t.clientX,t.clientY),A.subVectors(E,T),A.y>0?D(C()):A.y<0&&B(C()),T.copy(E),s.update()}(t);break;case u.PAN:if(!1===s.enablePan)return;!function(t){M.set(t.clientX,t.clientY),S.subVectors(M,w).multiplyScalar(s.panSpeed),N(S.x,S.y),w.copy(M),s.update()}(t)}}function Y(t){!1!==s.enabled&&(document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",Y,!1),s.dispatchEvent(c),d=u.NONE)}function q(t){!1===s.enabled||!1===s.enableZoom||d!==u.NONE&&d!==u.ROTATE||(t.preventDefault(),t.stopPropagation(),s.dispatchEvent(h),function(t){t.deltaY<0?B(C()):t.deltaY>0&&D(C()),s.update()}(t),s.dispatchEvent(c))}function Z(t){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(t){var e=!1;switch(t.keyCode){case s.keys.UP:N(0,s.keyPanSpeed),e=!0;break;case s.keys.BOTTOM:N(0,-s.keyPanSpeed),e=!0;break;case s.keys.LEFT:N(s.keyPanSpeed,0),e=!0;break;case s.keys.RIGHT:N(-s.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),s.update())}(t)}function J(t){if(!1!==s.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(s.touches.ONE){case dt:if(!1===s.enableRotate)return;U(t),d=u.TOUCH_ROTATE;break;case pt:if(!1===s.enablePan)return;z(t),d=u.TOUCH_PAN;break;default:d=u.NONE}break;case 2:switch(s.touches.TWO){case mt:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){s.enableZoom&&H(t),s.enablePan&&z(t)}(t),d=u.TOUCH_DOLLY_PAN;break;case ft:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(t){s.enableZoom&&H(t),s.enableRotate&&U(t)}(t),d=u.TOUCH_DOLLY_ROTATE;break;default:d=u.NONE}break;default:d=u.NONE}d!==u.NONE&&s.dispatchEvent(h)}}function K(t){if(!1!==s.enabled)switch(t.preventDefault(),t.stopPropagation(),d){case u.TOUCH_ROTATE:if(!1===s.enableRotate)return;G(t),s.update();break;case u.TOUCH_PAN:if(!1===s.enablePan)return;V(t),s.update();break;case u.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){s.enableZoom&&j(t),s.enablePan&&V(t)}(t),s.update();break;case u.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(t){s.enableZoom&&j(t),s.enableRotate&&G(t)}(t),s.update();break;default:d=u.NONE}}function Q(t){!1!==s.enabled&&(s.dispatchEvent(c),d=u.NONE)}function $(t){!1!==s.enabled&&t.preventDefault()}s.domElement.addEventListener("contextmenu",$,!1),s.domElement.addEventListener("mousedown",W,!1),s.domElement.addEventListener("wheel",q,!1),s.domElement.addEventListener("touchstart",J,!1),s.domElement.addEventListener("touchend",Q,!1),s.domElement.addEventListener("touchmove",K,!1),s.domElement.addEventListener("keydown",Z,!1),-1===s.domElement.tabIndex&&(s.domElement.tabIndex=0),this.update()};(du.prototype=Object.create(gt.prototype)).constructor=du;var pu=function(t,e){du.call(this,t,e),this.mouseButtons.LEFT=ut,this.mouseButtons.RIGHT=ht,this.touches.ONE=pt,this.touches.TWO=ft};(pu.prototype=Object.create(gt.prototype)).constructor=pu;var mu={orbitControls:!1,cameraPosition:new Ot(0,1.8,-3),ambientLightEnabled:!0,ambientLightColor:16777215,ambientLightIntensity:.3,directionalLightEnabled:!0,directionalLightColor:16777215,directionalLightIntensity:.4,directionalLightPosition:{x:7,y:40,z:-30},directionalLightLookAt:{x:0,y:0,z:20}};const fu=(t,e,n)=>t*(1-n)+e*n;class gu{constructor(t,e){this._camera=e,this._player=t}setStartPosition(){const t=this._getCameraPosition();this._camera.position.copy(t),this._camera.lookAt(this._player.position)}update(){const t=this._getCameraPosition();var e,n,i;this._camera.position.copy((e=this._camera.position,n=t,i=.8,new Ot(fu(e.x,n.x,i),fu(e.y,n.y,i),fu(e.z,n.z,i)))),this._camera.lookAt(this._player.position)}_getCameraPosition(){return this._player.position.clone().add(mu.cameraPosition)}}var vu=[{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:10},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:20},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:30},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:40},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:50},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:50},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:50},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:50},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:50},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:50},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:50},{taskText:"taskText",correctAnswer:"",uncorrectAnswer:"",positionZ:50}];var yu={platfotmWidth:3,platfotmLength:300,platfotmWeight:.2,playerSpeed:5};class bu extends ho{constructor(){super(),this._init()}getSky(){return this._sky}_init(){this._initGround(),this._initSky()}_initGround(){const t=new pi(800,400);t.translate(0,180,0);const e=uu.Assets.sunflowers;e.wrapS=e.wrapT=1e3,e.offset.set(0,0);e.repeat.set(160,80);const n=new Gn(t,new Us({map:e,side:2}));this.add(n),n.rotation.x=.5*Math.PI,n.position.y=.5*-yu.platfotmWeight}_initSky(){const t=new _s(30,32,15),e=new ti({uniforms:{color1:{value:new Ze(4360181)},color2:{value:new Ze(4360181).offsetHSL(-.15,.3,.1)}},vertexShader:"\n        varying vec2 vUv;\n    \n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform vec3 color1;\n        uniform vec3 color2;\n      \n        varying vec2 vUv;\n        \n        void main() {\n          \n          gl_FragColor = vec4(mix(color1, color2, vUv.y), 1.0);\n        }\n      ",side:2}),n=this._sky=new Gn(t,e);this.add(n)}}new js;const _u=new be;function xu(t){return t.clone()}class wu{static createObject(t,e=null){const n=uu.Assets[t];if(!n)throw new Error(`Object ${t} is not in the cache.`);const i=n.scene?xu(n.scene):xu(n);return null===e?i:wu.setObjectMaterial(i,e)}static setObjectMaterial(t,e){return t.traverse(t=>{t.isMesh&&(t.material=e)}),t}static setCastShadows(t,e){return t.traverse(t=>{t.castShadow=e}),t}static setReceiveShadows(t,e){return t.traverse(t=>{t.receiveShadow=e}),t}static getMesh(t){return t.isMesh?t:t.getObjectByProperty("isMesh",!0)}static getMeshByName(t,e){let n=null;return t.traverse(t=>{t.isMesh&&t.name===e&&(n=t)}),n}static toScreenPosition(t,e,n){const i=cu.Device.pixelRatio,r=n.context.canvas.width/i,o=n.context.canvas.height/i,a=(new xt).copy(t);return e.updateMatrixWorld(),a.project(e),a.x=(a.x+1)*r/2,a.y=-(a.y-1)*o/2,a}static getBoundingBox(t){return _u.setFromObject(t),_u.getSize(new Ot)}}class Mu extends ho{constructor(){super(),this._init()}getWidth(){return wu.getBoundingBox(this.book).x}update(t){const e=-this.position.x/yu.platfotmWidth*.5*Math.PI*.3;this.rotation.z=e}_init(){this._initBook(),this._initPlate(),this.rotateX(.05*Math.PI)}_initBook(){const t=this.book=wu.createObject("book");this.add(t),t.rotation.x=.5*Math.PI,t.rotation.y=Math.PI;const e=wu.getBoundingBox(t);t.position.y=.7*e.y,t.position.x=.55*e.x,wu.setObjectMaterial(t,new Us({color:16777215,side:2}))}_initPlate(){const t=new Us({map:uu.Assets.book_cover}),e=wu.getBoundingBox(this.book),n=new Gn(new pi(e.x,e.y),t);this.add(n),n.position.y=this.book.position.y,n.position.z=-e.z-.005,n.rotation.y=Math.PI}}new Us({color:16777215});class Su extends ho{constructor(t,e=!0){super(),this._textString=t,this._isCorrect=e,this._width=.5*yu.platfotmWidth,this._height=.95,this._isEnabled=!0,this._init()}onCollide(){if(this._isEnabled)return this._material.color.set(this._isCorrect?65280:16711680),this._material.needsUpdate=!0,this._isCorrect}isEnabled(){return this._isEnabled}disable(){this._isEnabled=!1}_init(){this._initPlane(),this._initPillars(),this._initText()}_initPlane(){const t=new pi(this._width,this._height);t.translate(0,.5*this._height+.5*yu.platfotmWeight,0);const e=this._material=new Us({transparent:!0,opacity:.5,color:5273830,side:2}),n=this._plane=new Gn(t,e);this.add(n)}_initPillars(){const t=new Rs(.03,.03,this._height,10);t.translate(0,.5*this._height+.5*yu.platfotmWeight,0);const e=new Us({color:16777215}),n=new Gn(t,e),i=new Gn(t,e);this.add(n,i),n.position.x=.5*-this._width,i.position.x=.5*this._width}_initText(){const t=new cu.CanvasRenderTexture(512,512*this._height/this._width,cu.Black.driver.renderScaleFactor),e=new Gs({alphaTest:.1,transparent:!0,opacity:1,map:new ba(t.native)}),n=new Gn(new pi(this._width,this._height),e);this.add(n),n.rotateY(Math.PI),t.renderTarget.clear();const i=new cu.TextField(this._textString);i.autoSize=!0,i.textColor=16777215,i.multiline=!0,i.size=60,i.strokeColor=0,i.strokeThickness=7,i.align="center",i.alignPivotOffset(),i.x=.5*t.width,i.y=.5*t.height,cu.Black.driver.render(i,t,new cu.Matrix),n.position.y=.55*this._height,n.position.z=-.01,n.scale.set(1.5,1.5,1.5)}}class Tu extends ho{constructor(){super(),this._init()}_init(){const t=new Jn(yu.platfotmWidth+.1,yu.platfotmWeight,yu.platfotmLength);t.translate(0,0,.5*-yu.platfotmLength);const e=uu.Assets.road_bw;e.wrapS=e.wrapT=1e3,e.offset.set(0,0),e.repeat.set(1,yu.platfotmLength/yu.platfotmWidth);const n=new Gn(t,new Us({color:15789823,map:e}));this.add(n),n.rotation.y=Math.PI}}class Eu{constructor(t,e){this.events=new cu.MessageDispatcher,this._player=t,this._gatesPool=e,this._prewX=.5*window.innerWidth,this._basicInputWidth=Math.max(100,.1*window.innerWidth),this._maxOffsetX=.5*yu.platfotmWidth,this._playerWidth=this._player.getWidth(),this._isFinished=!1,this._listenSignals()}finish(){this._isFinished=!0,console.log("finish")}update(t){if(.016,this._isFinished)return;const e=this._player;e.position.z+=.016*yu.playerSpeed;const n=(.5*window.innerWidth-this._prewX)/this._basicInputWidth,i=(Math.min(Math.abs(n),this._maxOffsetX)-.5*this._playerWidth)*(n>0?1:-1);e.position.x=fu(e.position.x,i,.3),e.update();const r=this._gatesPool;r.forEach((t,n)=>{if(t[0].position.z-e.position.z<.1&&t[0].isEnabled()){const i=(e.position.x>0?t[0]:t[1]).onCollide();this._showEffect(i),t[0].disable(),t[1].disable(),setTimeout(()=>{r.splice(n,1),0===r.length&&this.finish()},1e3)}})}_showEffect(t){this.events.post("onCollideGates",t)}_listenSignals(){document.addEventListener("pointermove",t=>{this._prewX=t.x,this._isPointerMove=!0})}}var Au=function(t){return{camera:t,enabled:!1,_timestampStart:void 0,_timestampEnd:void 0,_startPoint:void 0,_endPoint:void 0,update:function(){if(1==this.enabled){const t=Date.now();if(this._timestampEnd>t){let t=(Date.now()-this._timestampStart)/(this._timestampEnd-this._timestampStart);this.computePosition(t)}else this.camera.position.copy(this._startPoint),this.enabled=!1}},shake:function(t,e){this.enabled=!0,this._timestampStart=Date.now(),this._timestampEnd=this._timestampStart+e,this._startPoint=(new Ot).copy(this.camera.position),this._endPoint=(new Ot).addVectors(this.camera.position,t)},computePosition:function(t){if(t<.4)var e=this.getQuadra(t/.4);else if(t<.7)e=-.6*this.getQuadra((t-.4)/.3);else if(t<.9)e=.3*this.getQuadra((t-.7)/.2);else e=-.1*this.getQuadra((t-.9)/.1);this.camera.position.lerpVectors(this._startPoint,this._endPoint,e)},getQuadra:function(t){return 9436896e-22+4*t-t*t*4}}};class Cu extends ho{constructor(t){super(),this.events=new cu.MessageDispatcher,this._camera=t,this._gatesPool=[],this._screenShake=Au(this._camera),this._isShaking=!1,this._isPause=!0,this._init()}start(){this._isPause=!1}update(t){this._isPause||(mu.orbitControls||this._cameraController.update(),this._isShaking?this._screenShake.update():(this._playerController.update(t),this._sky.position.copy(this._book.position)))}_init(){this._initPlatform(),this._initBook(),this._initGates(),this._initEnvironment(),cu.Black.input.once("pointerDown",()=>{this.start()}),this._cameraController=new gu(this._book,this._camera),this._cameraController.setStartPosition(),this._playerController=new Eu(this._book,this._gatesPool),this._playerController.events.on("onCollideGates",(t,e)=>this._onCollideGates(e))}_initEnvironment(){const t=this._environment=new bu;this.add(t),this._sky=t.getSky()}_initPlatform(){const t=this.platform=new Tu;this.add(t)}_initBook(){const t=this._book=new Mu;this.add(t),t.position.set(0,0,5)}_initGates(){const t=.25*yu.platfotmWidth,e=.25*-yu.platfotmWidth;vu.forEach((n,i)=>{const r=Math.random()>.5,o=new Su(r?n.correctAnswer:n.uncorrectAnswer,r),a=new Su(r?n.uncorrectAnswer:n.correctAnswer,!r);this.add(o,a);const s=13*i+15;o.position.set(t,0,s),a.position.set(e,0,s),this._gatesPool.push([o,a])})}_onCollideGates(t){t?this.events.post("onCorrectCollide"):setTimeout(()=>{const t=_t.randFloat(.13,.15)*(Math.random()>.5?1:-1),e=_t.randFloat(.02,.03)*(Math.random()>.5?1:-1),n=_t.randInt(240,250);this._screenShake.shake(new Ot(t,e,0),n),this._isShaking=!0,setTimeout(()=>{this._isShaking=!1},n)},100)}}class Pu extends cu.DisplayObject{constructor(){super(),this._value=0,this._init()}increaseValue(){this._value++,this._counter.text=this._value.toString(),this._counter.alignPivotOffset(.5)}_init(){const t=this._counter=new cu.TextField(this._value.toString(),"Arial",16777215,60);this.add(t),t.strokeColor="#333333",t.strokeThickness=4,t.weight="600",t.alignPivotOffset(.5)}}class Lu extends cu.DisplayObject{constructor(){super(),this._init()}increaseCounter(){this._counter.increaseValue()}onResize(){const t=cu.Black.stage.bounds,e=this._counter;e.x=t.center().x,e.y=t.top+100}_init(){this._initCounter(),cu.Black.stage.on("resize",()=>this.onResize()),this.onResize()}_initCounter(){const t=this._counter=new Pu;this.add(t)}}class Ru{constructor(t,e){this._world=t,this._ui=e,this._listenSignals()}_listenSignals(){const t=this._world,e=this._ui;t.events.on("onCorrectCollide",()=>e.increaseCounter())}}class Ou{constructor(){this._scene=null,this._camera=null,this._renderer=null,this._orbitControls=null,this._world=null,this._ui=null,this._isPause=!1,this._clock=new Ah,this._clock.start(),this._init()}_init(){this._initScene(),this._initCamera(),this._initOrbitControls(),this._initRenderer(),this._initLight(),this._initWorld(),cu.Black.engine.containerElement.prepend(this._renderer.domElement),cu.Black.engine.on("paused",()=>this._onPause()),cu.Black.engine.on("unpaused",()=>this._onUnPause()),window.addEventListener("resize",()=>this.onResize()),setTimeout(()=>{window.requestAnimationFrame(()=>this.update())},100)}_initScene(){(this._scene=new oe).background=new Ze(8445951)}_initCamera(){const t=this._camera=new ni(75,window.innerWidth/window.innerHeight,.001,5e3);t.position.x=1,t.position.y=1,t.position.z=50,this._scene.add(t)}_initOrbitControls(){if(mu.orbitControls){const t=this._orbitControls=new du(this._camera,cu.Black.engine.containerElement);t.enableDamping=!0,t.enablePan=!1,t.dampingFactor=.05,t.maxDistance=30,t.minDistance=1,t.touches={ONE:dt,TWO:mt}}}_initRenderer(){const t=this._renderer=new po({canvas:document.querySelector("canvas.webgl"),antialias:!0});t.setSize(window.innerWidth,window.innerHeight),t.setPixelRatio(Math.min(window.devicePixelRatio,2)),t.shadowMap.enabled=!0,t.shadowMap.type=2,t.toneMapping=1,t.toneMappingExposure=.95,t.domElement.style.position="absolute",t.domElement.style.top=0,t.domElement.style.touchAction="none",t.domElement.style.userSelect="none",t.domElement.style.overflow="hidden"}_initLight(){const{ambientLightEnabled:t,ambientLightColor:e,ambientLightIntensity:n,directionalLightEnabled:i,directionalLightColor:r,directionalLightIntensity:o,directionalLightPosition:a,directionalLightLookAt:s}=mu;if(i){const t=new $l(r,.1);t.lookAt(s.x,s.y,s.z),t.position.set(a.x,a.y,a.z),this._scene.add(t),t.castShadow=!0,t.shadow.mapSize.width=1300,t.shadow.mapSize.height=1300;const e=t.shadow.camera;e.left=.4*-7,e.right=7*.4,e.bottom=-3.5,e.top=3.5,e.far=40}const l=new $l(r,.75);l.lookAt(s.x,s.y,s.z),l.position.set(a.x,a.y,a.z),this._scene.add(l),l.castShadow=!1,l.shadow.mapSize.width=1300,l.shadow.mapSize.height=1300;const h=l.shadow.camera;if(h.left=.4*-7,h.right=7*.4,h.bottom=-3.5,h.top=3.5,h.far=40,t){const t=new th(e,n);this._scene.add(t)}}onResize(){const t=window.innerWidth,e=window.innerHeight,{_camera:n,_renderer:i}=this;n.aspect=t/e,n.updateProjectionMatrix(),i.setSize(t,e),i.setPixelRatio(Math.min(window.devicePixelRatio,2))}_initWorld(){const t=this._world=new Cu(this._camera);this._scene.add(t);const e=this._ui=new Lu;cu.Black.stage.add(e),this._gameController=new Ru(t,e)}update(){const t=this._clock.getDelta();!1===this._isPause&&(this._world&&this._world.update(t),this._renderer.render(this._scene,this._camera),mu.orbitControls&&this._orbitControls.update()),window.requestAnimationFrame(()=>this.update())}_onPause(){this._clock.stop(),this._isPause=!0}_onUnPause(){this._clock.start(),this._isPause=!1}}const Iu=new cu.Engine("container",cu.GameObject,cu.CanvasDriver,[cu.Input,cu.MasterAudio]);var Nu;Iu.pauseOnBlur=!0,Iu.pauseOnHide=!0,Iu.viewport.isTransperent=!1,Iu.start(),Iu.stage.setSize(640,960),Iu.stage.scaleMode=cu.StageScaleMode.LETTERBOX,(new uu).events.on("onLoaded",()=>{new Ou}),(Nu=document.createElement("script")).onload=function(){var t=new Stats;document.body.appendChild(t.dom),requestAnimationFrame((function e(){t.update(),requestAnimationFrame(e)}))},Nu.src="//mrdoob.github.io/stats.js/build/stats.min.js",document.head.appendChild(Nu)}]);
//# sourceMappingURL=bundle.5aec7928835d46b0c631.js.map